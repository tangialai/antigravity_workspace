# ODOO DOCUMENTATION SUMMARY - CATEGORY: ODOO16DOCS_DEVELOPER



--- SOURCE: developer/glossary.md ---

orphan
:   true

# Glossary

::: glossary
external id external identifier external identifiers string identifier
stored in `ir.model.data`, can be used to refer to a record regardless
of its database identifier during data imports or export/import
roundtrips.

> External identifiers are in the form `{module}.{id}`{.interpreted-text
> role="samp"} (e.g. `account.invoice_graph`). From within a module, the
> `{module}.`{.interpreted-text role="samp"} prefix can be left out.
>
> Sometimes referred to as \"xml id\" or `xml_id` as XML-based
> `reference/data`{.interpreted-text role="ref"} make extensive use of
> them.

format string

:   inspired by [jinja
    variables](http://jinja.pocoo.org/docs/dev/templates/#variables),
    format strings allow more easily mixing literal content and computed
    content (expressions): content between `{{` and `}}` is interpreted
    as an expression and evaluated, other content is interpreted as
    literal strings and displayed as-is

GIS Geographic Information System any computer system or subsystem to
capture, store, manipulate, analyze, manage or present spatial and
geographical data.

minified minification process of removing extraneous/non-necessary
sections of files (comments, whitespace) and possibly recompiling them
using equivalent but shorter structures ([ternary
operator](http://en.wikipedia.org/wiki/%3F:) instead of `if/else`) in
order to reduce network traffic
:::




--- SOURCE: developer/howtos/company.md ---

# Multi-company Guidelines {#reference/howtos/company}

:::: warning
::: title
Warning
:::

This tutorial requires good knowledge of Odoo. Please refer to the
`../tutorials/getting_started`{.interpreted-text role="doc"} tutorial
first if needed.
::::

As of version 13.0, a user can be logged in to multiple companies at
once. This allows the user to access information from multiple
companies, but also to create/edit records in a multi-company
environment.

If not managed correctly, it may be the source of a lot of inconsistent
multi-company behaviors. For instance, a user logged in to both
companies A and B could create a sales order in company A and add
products belonging to company B to it. It is only when the user logs out
from company B that access errors will occur for the sales order.

To correctly manage multi-company behaviors, Odoo\'s ORM provides
multiple features:

- `Company-dependent fields <howto/company/company_dependent>`{.interpreted-text
  role="ref"}
- `Multi-company consistency <howto/company/check_company>`{.interpreted-text
  role="ref"}
- `Default company <howto/company/default_company>`{.interpreted-text
  role="ref"}
- `Views <howto/company/views>`{.interpreted-text role="ref"}
- `Security rules <howto/company/security>`{.interpreted-text
  role="ref"}

## Company-dependent fields {#howto/company/company_dependent}

When a record is available from multiple companies, we must expect that
different values will be assigned to a given field depending on the
company from which the value is set.

For the field of the same record to support several values, it must be
defined with the attribute [company_dependent]{.title-ref} set to
[True]{.title-ref}.

``` python
from odoo import api, fields, models

class Record(models.Model):
    _name = 'record.public'

    info = fields.Text()
    company_info = fields.Text(company_dependent=True)
    display_info = fields.Text(string='Infos', compute='_compute_display_info')

    @api.depends_context('company')
    def _compute_display_info(self):
        for record in self:
            record.display_info = record.info + record.company_info
```

:::: note
::: title
Note
:::

The [\_compute_display_info]{.title-ref} method is decorated with
[depends_context(\'company\')]{.title-ref} (see
`~odoo.api.depends_context`{.interpreted-text role="attr"}) to ensure
that the computed field is recomputed depending on the current company
([self.env.company]{.title-ref}).
::::

When a company-dependent field is read, the current company is used to
retrieve its value. In other words, if a user is logged in to companies
A and B with A as the main company and creates a record for company B,
the value of company-dependent fields will be that of company A.

To read the values of company-dependent fields set by another company
than the current one, we need to ensure the company we are using is the
correct one. This can be done with
`~odoo.models.Model.with_company`{.interpreted-text role="meth"}, which
updates the current company.

``` python
# Accessed as the main company (self.env.company)
val = record.company_dependent_field

# Accessed as the desired company (company_B)
val = record.with_company(company_B).company_dependent_field
# record.with_company(company_B).env.company == company_B
```

:::: warning
::: title
Warning
:::

Whenever you are computing/creating/\... things that may behave
differently in different companies, you should make sure whatever you
are doing is done in the right company. It doesn\'t cost much to always
use [with_company]{.title-ref} to avoid problems later.

``` python
@api.onchange('field_name')
def _onchange_field_name(self):
 self = self.with_company(self.company_id)
 ...

@api.depends('field_2')
def _compute_field_3(self):
 for record in self:
   record = record.with_company(record.company_id)
   ...
```
::::

## Multi-company consistency {#howto/company/check_company}

When a record is made shareable between several companies by the means
of a [company_id]{.title-ref} field, we must take care that it cannot be
linked to the record of another company through a relational field. For
instance, we do not want to have a sales order and its invoice belonging
to different companies.

To ensure this multi-company consistency, you must:

- Set the class attribute [\_check_company_auto]{.title-ref} to
  [True]{.title-ref}.
- Define relational fields with the attribute
  [check_company]{.title-ref} set to [True]{.title-ref} if their model
  has a [company_id]{.title-ref} field.

On each `~odoo.models.Model.create`{.interpreted-text role="meth"} and
`~odoo.models.Model.write`{.interpreted-text role="meth"}, automatic
checks will be triggered to ensure the multi-company consistency of the
record.

``` python
from odoo import fields, models

class Record(models.Model):
    _name = 'record.shareable'
    _check_company_auto = True

    company_id = fields.Many2one('res.company')
    other_record_id = fields.Many2one('other.record', check_company=True)
```

:::: note
::: title
Note
:::

The field [company_id]{.title-ref} must not be defined with
[check_company=True]{.title-ref}.
::::

::: currentmodule
odoo.models
:::

::: automethod
Model.\_check_company
:::

:::: warning
::: title
Warning
:::

The [check_company]{.title-ref} feature performs a strict check! It
means that if a record has no [company_id]{.title-ref} (i.e., the field
is not required), it cannot be linked to a record whose
[company_id]{.title-ref} is set.
::::

:::: note
::: title
Note
:::

When no domain is defined on the field and [check_company]{.title-ref}
is set to [True]{.title-ref}, a default domain is added: [\[\'\|\',
\'(\'company_id\', \'=\', False), (\'company_id\', \'=\',
company_id)\]]{.title-ref}
::::

## Default company {#howto/company/default_company}

When the field [company_id]{.title-ref} is made required on a model, a
good practice is to set a default company. It eases the setup flow for
the user or even guarantees its validity when the company is hidden from
view. Indeed, the company is usually hidden if the user does not have
access to multiple companies (i.e., when the user does not have the
group [base.group_multi_company]{.title-ref}).

``` python
from odoo import api, fields, models

class Record(models.Model):
    _name = 'record.restricted'
    _check_company_auto = True

    company_id = fields.Many2one(
        'res.company', required=True, default=lambda self: self.env.company
    )
    other_record_id = fields.Many2one('other.record', check_company=True)
```

## Views {#howto/company/views}

As stated in `above <howto/company/default_company>`{.interpreted-text
role="ref"}, the company is usually hidden from view if the user does
not have access to multiple companies. This is assessed with the group
[base.group_multi_company]{.title-ref}.

``` xml
<record model="ir.ui.view" id="record_form_view">
    <field name="name">record.restricted.form</field>
    <field name="model">record.restricted</field>
    <field name="arch" type="xml">
        <form>
            <sheet>
                <group>
                    <group>
                        <field name="company_id" groups="base.group_multi_company"/>
                        <field name="other_record_id"/>
                    </group>
                </group>
            </sheet>
        </form>
    </field>
</record>
```

## Security rules {#howto/company/security}

When working with records shared across companies or restricted to a
single company, we must take care that a user does not have access to
records belonging to other companies.

This is achieved with security rules based on [company_ids]{.title-ref},
which contain the current companies of the user (the companies the user
checked in the multi-company widget).

``` xml
<!-- Shareable Records -->
<record model="ir.rule" id="record_shared_company_rule">
    <field name="name">Shared Record: multi-company</field>
    <field name="model_id" ref="model_record_shared"/>
    <field name="global" eval="True"/>
    <field name="domain_force">
        ['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]
    </field>
</record>
```

``` xml
<!-- Company-restricted Records -->
<record model="ir.rule" id="record_restricted_company_rule">
    <field name="name">Restricted Record: multi-company</field>
    <field name="model_id" ref="model_record_restricted"/>
    <field name="global" eval="True"/>
    <field name="domain_force">
        [('company_id', 'in', company_ids)]
    </field>
</record>
```

::: todo
check_company on company_dependent fields.
:::




--- SOURCE: developer/howtos/connect_device.md ---

# Connect with a device

IoT Drivers allow any Odoo module to communicate in real-time with any
device connected to the IoT Box. Communication with the IoT Box goes
both ways, so the Odoo client can send commands to and receive
information from any of the supported devices.

To add support for a device, all we need is:

- an [Interface]{.title-ref}, to detect connected devices of a specific
  type
- a [Driver]{.title-ref}, to communicate with an individual device

At each boot, the IoT Box will load all of the Interfaces and Drivers
that can be located on the connected Odoo instance. Each module can
contain an [iot_handlers]{.title-ref} directory that will be copied to
the IoT Box. The structure of this directory is the following

``` text
your_module
├── ...
└── iot_handlers
    ├── drivers
    │   ├── DriverName.py
    │   └── ...
    │
    └── interfaces
        ├── InterfaceName.py
        └── ...
```

## Detect Devices

Devices connected to the IoT Box are detected through
[Interfaces]{.title-ref}. There is an Interface for each supported
connection type (USB, Bluetooth, Video, Printers, Serial, etc.). The
interface maintains a list of detected devices and associates them with
the right Driver.

Supported devices will appear both on the IoT Box Homepage that you can
access through its IP address and in the IoT module of the connected
Odoo instance.

### Interface

The role of the Interface is to maintain a list of devices connected
through a determined connection type. Creating a new interface requires

- Extending the [Interface]{.title-ref} class
- Setting the [connection_type]{.title-ref} class attribute
- Implementing the [get_devices]{.title-ref} method, that should return
  a dictionary containing data about each detected device. This data
  will be given as argument to the constructors and
  [supported]{.title-ref} method of the Drivers.

:::: note
::: title
Note
:::

Setting the [\_loop_delay]{.title-ref} attribute will modify the
interval between calls to [get_devices]{.title-ref}. By default, this
interval is set to 3 seconds.
::::

``` python
from odoo.addons.hw_drivers.interface import Interface

class InterfaceName(Interface):
    connection_type = 'ConnectionType'

    def get_devices(self):
        return {
            'device_identifier_1': {...},
            ...
        }
```

### Driver

Once the interface has retrieved the list of detected devices, it will
loop through all of the Drivers that have the same
[connection_type]{.title-ref} attribute and test their respective
[supported]{.title-ref} method on all detected devices. If the supported
method of a Driver returns [True]{.title-ref}, an instance of this
Driver will be created for the corresponding device.

:::: note
::: title
Note
:::

[supported]{.title-ref} methods of drivers are given a priority order.
The [supported]{.title-ref} method of a child class will always be
tested before the one of its parent. This priority can be adjusted by
modifying the [priority]{.title-ref} attribute of the Driver.
::::

Creating a new Driver requires:

- Extending [Driver]{.title-ref}
- Setting the [connection_type]{.title-ref} class attribute.
- Setting the [device_type]{.title-ref}, [device_connection]{.title-ref}
  and [device_name]{.title-ref} attributes.
- Defining the [supported]{.title-ref} method

``` python
from odoo.addons.hw_drivers.driver import Driver

class DriverName(Driver):
    connection_type = 'ConnectionType'

    def __init__(self, identifier, device):
        super(NewDriver, self).__init__(identifier, device)
        self.device_type = 'DeviceType'
        self.device_connection = 'DeviceConnection'
        self.device_name = 'DeviceName'

    @classmethod
    def supported(cls, device):
        ...
```

## Communicate With Devices

Once your new device is detected and appears in the IoT module, the next
step is to communicate with it. Since the box only has a local IP
address, it can only be reached from the same local network.
Communication, therefore, needs to happen on the browser-side, in
JavaScript.

The process depends on the direction of the communication: - From the
browser to the box, through [Actions](#actions) - From the box to the
browser, through [Longpolling](#longpolling)

Both channels are accessed from the same JS object, the
[DeviceProxy]{.title-ref}, which is instantiated using the IP of the IoT
Box and the device identifier.

``` javascript
var DeviceProxy = require('iot.DeviceProxy');

var iot_device = new DeviceProxy({
    iot_ip: iot_ip,
    identifier: device_identifier
});
```

### Actions

Actions are used to tell a selected device to execute a specific action,
such as taking a picture, printing a receipt, etc.

:::: note
::: title
Note
:::

It must be noted that no "answer" will be sent by the box on this route,
only the request status. The answer to the action, if any, has to be
retrieved via the longpolling.
::::

An action can be performed on the DeviceProxy Object.

``` javascript
iot_device.action(data);
```

In your driver, define an [action]{.title-ref} method that will be
executed when called from an Odoo module. It takes the data given during
the call as argument.

``` python
def action(self, data):
    ...
```

### Longpolling

When any module in Odoo wants to read data from a specific device, it
creates a listener identified by the IP/domain of the box and the device
identifier and passes it a callback function to be called every time the
device status changes. The callback is called with the new data as
argument.

``` javascript
iot_device.add_listener(this._onValueChange.bind(this));

_onValueChange: function (result) {
    ...
}
```

In the Driver, an event is released by calling the
[device_changed]{.title-ref} function from the
[event_manager]{.title-ref}. All callbacks set on the listener will then
be called with [self.data]{.title-ref} as argument.

``` python
from odoo.addons.hw_drivers.event_manager import event_manager

class DriverName(Driver):
    connection_type = 'ConnectionType'

    def methodName(self):
        self.data = {
            'value': 0.5,
            ...
        }
        event_manager.device_changed(self)
```




--- SOURCE: developer/howtos/create_reports.md ---

# Create customized reports

SQL views are a technique for creating customized reports to show data
that cannot be shown with existing models\' fields and views. In other
words, this technique helps avoid unnecessary creation and calculation
of additional fields solely for data analysis purposes.

## Create a model

A SQL view is created in a similar manner as a standard model:

``` python
from odoo import fields, models


class ModuleReport(models.Model):
    _name = 'module.report'
    _description = "Module Report"
    _rec_name = 'module_field'
    _auto = False
```

Where the attributes:

- [\_auto = False]{.title-ref} indicates that we do not want to store
  the model in the database
- [\_rec_name]{.title-ref} indicates which of the model\'s fields
  represents a record\'s name (i.e. the name that will be used in the
  navigation breadcrumb when opening a record\'s form view)

and its fields are defined in the same way as a standard model, except
every field is marked as [readonly=True]{.title-ref}.

:::: note
::: title
Note
:::

Don\'t forget to add your new model to your security file.
::::

## Populate the model

There are 2 ways to populate a SQL view\'s table:

- override the [BaseModel.init()]{.title-ref} method,
- set the [\_table_query]{.title-ref} property.

Regardless of which way is used, a SQL query will be executed to
populate the model. Therefore, any SQL commands can be used to collect
and/or calculate the data needed and you are expected to keep in mind
that you are bypassing the ORM (i.e. it is a good idea to read through
`reference/security`{.interpreted-text role="ref"} if you haven\'t
already). The columns returned from the [SELECT]{.title-ref} will
populate the model\'s fields, so ensure that your column names match
your field names, or use alias names that match.

::::::: tabs
:::: tab
Overriding [BaseModel.init()]{.title-ref}

In most cases, overriding the [BaseModel.init()]{.title-ref} method is
the standard and better option to use. It requires the import of
[tools]{.title-ref} and is typically written as follows:

``` python
def init(self):
    tools.drop_view_if_exists(self.env.cr, self._table)
    self.env.cr.execute("""CREATE or REPLACE VIEW %s as (
                           SELECT
                              %s
                           FROM
                              %s
        )""" % (self._table, self._select(), self._from()))
```

[tools.drop_view_if_exists]{.title-ref} ensures that a conflicting view
is not created when the SQL query is executed. It is standard to
separate the different parts of the query to allow for easier model
extension. Exactly how the query is split up across methods is not
standardized, but at minimum, the [\_select]{.title-ref} and
[\_from]{.title-ref} methods are common, and of course, all these
methods will return strings.

::: seealso
[Example: a SQL view using an override of
BaseModel.init()]({GITHUB_PATH}/addons/project/report/project_report.py)
:::
::::

:::: tab
Using [\_table_query]{.title-ref}

The `_table_query` property is used when the view depends on the
context. It is typically written as follows:

``` python
@property
def _table_query(self):
    return 'SELECT %s FROM %s' % (self._select(), self._from())
```

and follows the same [\_select]{.title-ref} and [\_from]{.title-ref}
methods standards as [BaseModel.init()]{.title-ref}.

An example of when the property should be used instead of overriding
[BaseModel.init()]{.title-ref} is in a multi-company and multi-currency
environment where currency related amounts need to be converted using
currency exchange rates when the user switches between companies.

::: seealso
[Example: a SQL view using
\_table_query]({GITHUB_PATH}/addons/account/report/account_invoice_report.py)
:::
::::
:::::::

## Use the model

Views and menu items for your SQL views are created and used in the same
way as any other Odoo model. You are all set to start using your SQL
view. Have fun!

## Extra tips

:::: tip
::: title
Tip
:::

A common mistake in SQL views is not considering the duplication of
certain data due to table JOINs. This can lead to miscounting when using
a field\'s [group_operator]{.title-ref} and/or the pivot view. It is
best to test your SQL view with sufficient data to ensure the resulting
field values are as you expect.
::::

:::: tip
::: title
Tip
:::

If you have a field that you do not want as a measure (i.e., in your
pivot or graph views), add [store=False]{.title-ref} to it, and it will
not show.
::::




--- SOURCE: developer/howtos/javascript_client_action.md ---

# Create a client action

A client action triggers an action that is entirely implemented in the
client side. One of the benefits of using a client action is the ability
to create highly customized interfaces with ease. A client action is
typically defined by an OWL component; we can also use the web framework
and use services, core components, hooks,\...

1.  Create the
    `client action <reference/actions/client>`{.interpreted-text
    role="ref"}, don\'t forget to make it accessible.

    ``` xml
    <record model="ir.actions.client" id="my_client_action">
        <field name="name">My Client Action</field>
        <field name="tag">my_module.MyClientAction</field>
    </record>
    ```

2.  Create a component that represents the client action.

    ``` {.js caption=":file:`my_client_action.js`"}
    /** @odoo-module **/

    import { registry } from "@web/core/registry";

    import { Component } from  "@odoo/owl";

    class MyClientAction extends Component {}
    MyClientAction.template = "my_module.clientaction";

    // remember the tag name we put in the first step
    registry.category("actions").add("my_module.MyClientAction", MyClientAction);
    ```

    ``` {.xml caption=":file:`my_client_action.xml`"}
    <?xml version="1.0" encoding="UTF-8" ?>
    <templates xml:space="preserve">
        <t t-name="awesome_tshirt.clientaction" owl="1">
            Hello world
        </t>
    </templates>
    ```




--- SOURCE: developer/howtos/javascript_field.md ---

# Customize a field

## Subclass an existing field component

Let\'s take an example where we want to extends the
[BooleanField]{.title-ref} to create a boolean field displaying
\"Late!\" in red whenever the checkbox is checked.

1.  Create a new widget component extending the desired field component.

    ``` {.javascript caption=":file:`late_order_boolean_field.js`"}
    /** @odoo-module */

    import { registry } from "@web/core/registry";
    import { BooleanField } from "@web/views/fields/boolean/boolean_field";
    import { Component, xml } from "@odoo/owl";

    class LateOrderBooleanField extends BooleanField {}
    LateOrderBooleanField.template = "my_module.LateOrderBooleanField";
    ```

2.  Create the field template.

    The component uses a new template with the name
    [my_module.LateOrderBooleanField]{.title-ref}. Create it by
    inheriting the current template of the [BooleanField]{.title-ref}.

    ``` {.xml caption=":file:`late_order_boolean_field.xml`"}
    <?xml version="1.0" encoding="UTF-8" ?>
    <templates xml:space="preserve">
        <t t-name="my_module.LateOrderBooleanField" t-inherit="web.BooleanField" owl="1">
            <xpath expr="//CheckBox" position="after">
                  <span t-if="props.value" class="text-danger"> Late! </span>
            </xpath>
        </t>
    </templates>
    ```

3.  Register the component to the fields registry.

    ``` {caption=":file:`late_order_boolean_field.js`"}
    registry.category("fields").add("late_boolean", LateOrderBooleanField);
    ```

4.  Add the widget in the view arch as an attribute of the field.

    ``` xml
    <field name="somefield" widget="late_boolean"/>
    ```

## Create a new field component

Assume that we want to create a field that displays a simple text in
red.

1.  Create a new Owl component representing our new field

    ``` {.js caption=":file:`my_text_field.js`"}
    /** @odoo-module */

    import { standardFieldProps } from "@web/views/fields/standard_field_props";
    import { Component, xml } from "@odoo/owl";
    import { registry } from "@web/core/registry";

    export class MyTextField extends Component {

        /**
        * @param {boolean} newValue
        */
        onChange(newValue) {
            this.props.update(newValue);
        }
    }

    MyTextField.template = xml`
        <input t-att-id="props.id" class="text-danger" t-att-value="props.value" onChange.bind="onChange" />
    `;
    MyTextField.props = {
        ...standardFieldProps,
    };
    MyTextField.supportedTypes = ["char"];
    ```

    The imported [standardFieldProps]{.title-ref} contains the standard
    props passed by the [View]{.title-ref} such as the
    [update]{.title-ref} function to update the value, the
    [type]{.title-ref} of the field in the model, the
    [readonly]{.title-ref} boolean, and others.

2.  In the same file, register the component to the fields registry.

    ``` {.js caption=":file:`my_text_field.js`"}
    registry.category("fields").add("my_text_field", MyTextField);
    ```

    This maps the widget name in the arch to its actual component.

3.  Add the widget in the view arch as an attribute of the field.

    ``` xml
    <field name="somefield" widget="my_text_field"/>
    ```




--- SOURCE: developer/howtos/javascript_view.md ---

# Customize a view type

## Subclass an existing view

Assume we need to create a custom version of a generic view. For
example, a kanban view with some extra ribbon-like widget on top (to
display some specific custom information). In that case, this can be
done in a few steps:

1.  Extend the kanban controller/renderer/model and register it in the
    view registry.

    ``` {.js caption=":file:`custom_kanban_controller.js`"}
    /** @odoo-module */

    import { KanbanController } from "@web/views/kanban/kanban_controller";
    import { kanbanView } from "@web/views/kanban/kanban_view";
    import { registry } from "@web/core/registry";

    // the controller usually contains the Layout and the renderer.
    class CustomKanbanController extends KanbanController {
        // Your logic here, override or insert new methods...
        // if you override setup(), don't forget to call super.setup()
    }

    CustomKanbanController.template = "my_module.CustomKanbanView";

    export const customKanbanView = {
        ...kanbanView, // contains the default Renderer/Controller/Model
        Controller: CustomKanbanController,
    };

    // Register it to the views registry
    registry.category("views").add("custom_kanban", customeKanbanView);
    ```

    In our custom kanban, we defined a new template. We can either
    inherit the kanban controller template and add our template pieces
    or we can define a completely new template.

    ``` {.xml caption=":file:`custom_kanban_controller.xml`"}
    <?xml version="1.0" encoding="UTF-8" ?>
    <templates>
        <t t-name="my_module.CustomKanbanView" t-inherit="web.KanbanView" owl="1">
            <xpath expr="//Layout" position="before">
                <div>
                    Hello world !
                </div>
            </xpath>
        </t>
    </templates>
    ```

2.  Use the view with the [js_class]{.title-ref} attribute in arch.

    ``` xml
    <kanban js_class="custom_kanban">
        <templates>
            <t t-name="kanban-box">
                <!--Your comment-->
            </t>
        </templates>
    </kanban>
    ```

The possibilities for extending views are endless. While we have only
extended the controller here, you can also extend the renderer to add
new buttons, modify how records are presented, or customize the
dropdown, as well as extend other components such as the model and
[buttonTemplate]{.title-ref}.

## Create a new view from scratch

Creating a new view is an advanced topic. This guide highlight only the
essential steps.

1.  Create the controller.

    > The primary role of a controller is to facilitate the coordination
    > between various components of a view, such as the Renderer, Model,
    > and Layout.

    ``` {.js caption=":file:`beautiful_controller.js`"}
    /** @odoo-module */

    import { Layout } from "@web/search/layout";
    import { useService } from "@web/core/utils/hooks";
    import { Component, onWillStart, useState} from "@odoo/owl";

    export class BeautifulController extends Component {
        setup() {
            this.orm = useService("orm");

            // The controller create the model and make it reactive so whenever this.model is
            // accessed and edited then it'll cause a rerendering
            this.model = useState(
                new this.props.Model(
                    this.orm,
                    this.props.resModel,
                    this.props.fields,
                    this.props.archInfo,
                    this.props.domain
                )
            );

            onWillStart(async () => {
                await this.model.load();
            });
        }
    }

    BeautifulController.template = "my_module.View";
    BeautifulController.components = { Layout };
    ```

    The template of the Controller displays the control panel with
    Layout and also the renderer.

    ``` {.xml caption=":file:`beautiful_controller.xml`"}
    <?xml version="1.0" encoding="UTF-8"?>
    <templates xml:space="preserve">
        <t t-name="my_module.View" owl="1">
            <Layout display="props.display" className="'h-100 overflow-auto'">
                <t t-component="props.Renderer" records="model.records" propsYouWant="'Hello world'"/>
            </Layout>
        </t>
    </templates>
    ```

2.  Create the renderer.

    > The primary function of a renderer is to generate a visual
    > representation of data by rendering the view that includes
    > records.

    ``` {.js caption=":file:`beautiful_renderer.js`"}
    import { Component } from "@odoo/owl";
    export class BeautifulRenderer extends Component {}

    BeautifulRenderer.template = "my_module.Renderer";
    ```

    ``` {.xml caption=":file:`beautiful_renderer.xml`"}
    <?xml version="1.0" encoding="UTF-8"?>
    <templates xml:space="preserve">
        <t t-name="my_module.Renderer" owl="1">
            <t t-esc="props.propsYouWant"/>
            <t t-foreach="props.records" t-as="record" t-key="record.id">
                // Show records
            </t>
        </t>
    </templates>
    ```

3.  Create the model.

    The role of the model is to retrieve and manage all the necessary
    data in the view.

    ``` {.js caption=":file:`beautiful_model.js`"}
    /** @odoo-module */

    import { KeepLast } from "@web/core/utils/concurrency";

    export class BeautifulModel {
        constructor(orm, resModel, fields, archInfo, domain) {
            this.orm = orm;
            this.resModel = resModel;
            // We can access arch information parsed by the beautiful arch parser
            const { fieldFromTheArch } = archInfo;
            this.fieldFromTheArch = fieldFromTheArch;
            this.fields = fields;
            this.domain = domain;
            this.keepLast = new KeepLast();
        }

        async load() {
            // The keeplast protect against concurrency call
            const { length, records } = await this.keepLast.add(
                this.orm.webSearchRead(this.resModel, this.domain, [this.fieldsFromTheArch], {})
            );
            this.records = records;
            this.recordsLength = length;
        }
    }
    ```

    :::: note
    ::: title
    Note
    :::

    For advanced cases, instead of creating a model from scratch, it is
    also possible to use [RelationalModel]{.title-ref}, which is used by
    other views.
    ::::

4.  Create the arch parser.

    The role of the arch parser is to parse the arch view so the view
    has access to the information.

    ``` {.js caption=":file:`beautiful_arch_parser.js`"}
    /** @odoo-module */

    import { XMLParser } from "@web/core/utils/xml";

    export class BeautifulArchParser extends XMLParser {
        parse(arch) {
            const xmlDoc = this.parseXML(arch);
            const fieldFromTheArch = xmlDoc.getAttribute("fieldFromTheArch");
            return {
                fieldFromTheArch,
            };
        }
    }
    ```

5.  Create the view and combine all the pieces together, then register
    the view in the views registry.

    ``` {.js caption=":file:`beautiful_view.js`"}
    /** @odoo-module */

    import { registry } from "@web/core/registry";
    import { BeautifulController } from "./beautiful_controller";
    import { BeautifulArchParser } from "./beautiful_arch_parser";
    import { BeautifylModel } from "./beautiful_model";
    import { BeautifulRenderer } from "./beautiful_renderer";

    export const beautifulView = {
        type: "beautiful",
        display_name: "Beautiful",
        icon: "fa fa-picture-o", // the icon that will be displayed in the Layout panel
        multiRecord: true,
        Controller: BeautifulController,
        ArchParser: BeautifulArchParser,
        Model: BeautifulModel,
        Renderer: BeautifulRenderer,

        props(genericProps, view) {
            const { ArchParser } = view;
            const { arch } = genericProps;
            const archInfo = new ArchParser().parse(arch);

            return {
                ...genericProps,
                Model: view.Model,
                Renderer: view.Renderer,
                archInfo,
            };
        },
    };

    registry.category("views").add("beautifulView", beautifulView);
    ```

6.  Declare the `view <reference/views/structure>`{.interpreted-text
    role="ref"} in the arch.

    ``` xml
    ...
    <record id="my_beautiful_view" model="ir.ui.view">
      <field name="name">my_view</field>
      <field name="model">my_model</field>
      <field name="arch" type="xml">
          <beautiful fieldFromTheArch="res.partner"/>
      </field>
    </record>
    ...
    ```




--- SOURCE: developer/howtos/scss_tips.md ---

# Write lean easy-to-maintain CSS

There are many ways to lean and simplify SCSS. The first step is to
establish if custom code is needed at all.

Odoo\'s webclient has been designed to be modular, meaning that
(potentially all) classes can be shared across views. Check the code
before creating a new class. Chances are that there is already a class
or an HTML tag doing exactly what you\'re looking for.

On top of that, Odoo relies on
[Bootstrap](https://getbootstrap.com/docs/5.1/getting-started/introduction/)
(BS), one of the most complete CSS frameworks available. The framework
has been customized in order to match Odoo\'s design (both community and
enterprise versions), meaning that you can use any BS class directly in
Odoo and achieve a visual result that is consistent with our UI.

:::: warning
::: title
Warning
:::

\- The fact that a class achieves the desired visual result doesn\'t
necessarily mean that it\'s the right one for the job. Be aware of
classes triggering JS behaviors, for example. - Be careful about class
semantics. Applying a **button class** to a **title** is not only
semantically wrong, it may also lead to migration issues and visual
inconsistencies.
::::

The following sections describe tips to strip-down SCSS lines **when
custom-code is the only way to go**.

## Browser defaults {#tutorials/scss_tips/browser_defaults}

By default, each browser renders content using a *user agent
stylesheet*. To overcome inconsistencies between browsers, some of these
rules are overridden by [Bootstrap
Reboot](https://getbootstrap.com/docs/5.1/content/reboot/).

At this stage all \"browser-specific-decoration\" rules have been
stripped away, but a big chunk of rules defining basic layout
information is maintained (or reinforced by *Reboot* for consistency
reasons).

You can rely on these rules.

::: example
Applying [display: block;]{.title-ref} to a [\<div/\>]{.title-ref} is
normally not necessary.

``` css
div.element {
   display: block;
   /* not needed 99% of the time */
}
```
:::

::: example
In this instance, you may opt to switching the HTML tag rather than
adding a new CSS rule.

``` css
span.element {
   display: block;
   /* replace <span> with <div> instead
      to get 'display: block' by default */
}
```
:::

Here\'s a non-comprehensive list of default rules:

+-----------------------------------+----------------------------------+
| Tag / Attribute                   | Defaults                         |
+===================================+==================================+
| [\<div/\>]{.title-ref},           | [display: block]{.title-ref}     |
| [\<section/\>]{.title-ref},       |                                  |
| [\<header/\>]{.title-ref},        |                                  |
| [\<footer/\>]{.title-ref}\...     |                                  |
+-----------------------------------+----------------------------------+
| [\<span/\>]{.title-ref},          | [display: inline]{.title-ref}    |
| [\<a/\>]{.title-ref},             |                                  |
| [\<em/\>]{.title-ref},            |                                  |
| [\<b/\>]{.title-ref}\...          |                                  |
+-----------------------------------+----------------------------------+
| [\<button/\>]{.title-ref},        | [display:                        |
| [\<label/\>]{.title-ref},         | inline-block]{.title-ref}        |
| [\<output/\>]{.title-ref}\...     |                                  |
+-----------------------------------+----------------------------------+
| [\<img/\>]{.title-ref},           | [vertical-align:                 |
| [\<svg/\>]{.title-ref}            | middle]{.title-ref}              |
+-----------------------------------+----------------------------------+
| [\<summary/\>]{.title-ref},       | [cursor: pointer;]{.title-ref}   |
| [\[role=\"button\"\]]{.title-ref} |                                  |
+-----------------------------------+----------------------------------+
| [\<q/\>]{.title-ref}              | | [:before {content:             |
|                                   |   open-quote}]{.title-ref}       |
|                                   | | [:after {content:              |
|                                   |   close-quote}]{.title-ref}      |
+-----------------------------------+----------------------------------+
| \...                              | \...                             |
+-----------------------------------+----------------------------------+

::: seealso
[Bootstrap Reboot on
GitHub](https://github.com/twbs/bootstrap/blob/1a6fdfae6b/scss/_reboot.scss)
:::

## HTML tags {#tutorials/scss_tips/html_tags}

It may seem obvious, but the simplest and most **consistent** way of
making text look like a title is to use a header tag
([\<h1\>]{.title-ref}, [\<h2\>]{.title-ref}, \...). Besides reboot
rules, mostly all tags carry decorative styles defined by Odoo.

::: rst-class
bg-light
:::

::::::::::: example
:::::: {.container .alert .alert-danger}
Don\'t

::::: tabs
::: code-tab
html XML

\<span class=\"o_module_custom_title\"\>

:   Hello There!

\</span\>

\<span class=\"o_module_custom_subtitle\"\>

:   I\'m a subtitle.

\</span\>
:::

::: code-tab
css SCSS

.o_module_custom_title {

:   display: block; font-size: 120%; font-weight: bold; animation: 1s
    linear 1s mycustomAnimation;

}

.o_module_custom_subtitle {

:   display: block; font-size: 12px; font-weight: bold; animation: 2s
    linear 1s mycustomAnimation;

}
:::
:::::
::::::

:::::: {.container .alert .alert-success}
Do

::::: tabs
::: code-tab
html XML

\<h5 class=\"o_module_custom_title\"\>

:   Hello There!

\</h5\>

\<div class=\"o_module_custom_subtitle\"\>

:   \<b\>\<small\>I\'m a subtitle.\</small\>\</b\>

\</div\>
:::

::: code-tab
css SCSS

.o_module_custom_title {

:   animation: 1s linear 1s mycustomAnimation;

}

.o_module_custom_subtitle {

:   animation: 2s linear 1s mycustomAnimation;

}
:::
:::::
::::::
:::::::::::

:::: note
::: title
Note
:::

Besides reducing the amount of code, a modular-design approach (use
classes, tags, mixins\...) keeps the visual result consistent and easily
**maintainable**.

Following the last example, if Odoo titles\' design changes, these
changes will be applied in the [o_module_custom_title]{.title-ref}
element too since it\'s using an [\<h5\>]{.title-ref} tag.
::::

## Utility classes {#tutorials/scss_tips/utility_classes}

Our framework defines a multitude of utility classes designed to cover
almost all layout/design/interaction needs. The simple fact that a class
already exists justifies its use over custom CSS whenever possible.

Take the example of [position-relative]{.title-ref}.

``` css
position-relative {
   position: relative !important;
}
```

Since a utility-class is defined, any CSS line with the declaration
[position: relative]{.title-ref} is **potentially** redundant.

Odoo relies on the default [Bootstrap
utility-classes](https://getbootstrap.com/docs/5.1/utilities/background/)
stack and defines its own using [Bootstrap
API](https://getbootstrap.com/docs/5.1/utilities/api/).

::: seealso
\- [Bootstrap utility
classes](https://getbootstrap.com/docs/5.1/utilities/api/) - [Odoo
custom utilities on
github]({GITHUB_PATH}/addons/web/static/src/scss/utilities_custom.scss)
:::

### Handling utility-classes verbosity {#tutorials/scss_tips/utility_classes/downside}

The downside of utility-classes is the potential lack of readability.

::: example
``` html
<myComponent t-attf-class="d-flex border px-lg-2 card
{{props.readonly ? 'o_myComponent_disabled' : ''}}
card d-lg-block position-absolute {{props.active ?
'o_myComponent_active' : ''}}  myComponent px-3"/>
```
:::

To overcome the issue you may combine different approaches:

- in Qweb attributes, only use classes to be toggled *on-the-fly*;
- use new lines for each attribute;
- order classes using the convention [\[odoo component\] \[bootstrap
  component\] \[css declaration order\]]{.title-ref}.

::: example
``` html
<myComponent
   t-att-class="{
      o_myComponent_disabled: props.readonly,
      o_myComponent_active: props.active
   }"
   class="myComponent card position-absolute d-flex d-lg-block border px-3 px-lg-2"
/>
```
:::

::: seealso
`Odoo CSS properties order <contributing/coding_guidelines/scss/properties_order>`{.interpreted-text
role="ref"}
:::




--- SOURCE: developer/howtos/translations.md ---

# Translating Modules {#reference/translations}

This section explains how to provide translation abilities to your
module.

:::: note
::: title
Note
:::

If you want to contribute to the translation of Odoo itself, please
refer to the [Odoo Wiki
page](https://github.com/odoo/odoo/wiki/Translations).
::::

## Exporting translatable term

A number of terms in your modules are implicitly translatable. As a
result, even if you haven\'t done any specific work towards translation,
you can export your module\'s translatable terms and may find content to
work with.

::: todo
needs technical features
:::

Translations export is performed via the administration interface by
logging into the backend interface and opening
`Settings --> Translations
--> Import / Export --> Export Translations`{.interpreted-text
role="menuselection"}

- leave the language to the default (new language/empty template)
- select the [PO
  File](https://en.wikipedia.org/wiki/Gettext#Translating) format
- select your module
- click `Export`{.interpreted-text role="guilabel"} and download the
  file

![image](translations/po-export.png){.align-center width="75.0%"}

This gives you a file called `{yourmodule}.pot`{.interpreted-text
role="file"} which should be moved to the
`{yourmodule}/i18n/`{.interpreted-text role="file"} directory. The file
is a *PO Template* which simply lists translatable strings and from
which actual translations (PO files) can be created. PO files can be
created using
[msginit](https://www.gnu.org/software/gettext/manual/gettext.html#Creating),
with a dedicated translation tool like [POEdit](https://poedit.net/) or
by simply copying the template to a new file called
`{language}.po`{.interpreted-text role="file"}. Translation files should
be put in `{yourmodule}/i18n/`{.interpreted-text role="file"}, next to
`{yourmodule}.pot`{.interpreted-text role="file"}, and will be
automatically loaded by Odoo when the corresponding language is
installed (via
`Settings --> Translations --> Languages`{.interpreted-text
role="menuselection"})

:::: note
::: title
Note
:::

translations for all loaded languages are also installed or updated when
installing or updating a module
::::

## Implicit exports

Odoo automatically exports translatable strings from \"data\"-type
content:

- in non-QWeb views, all text nodes are exported as well as the content
  of the `string`, `help`, `sum`, `confirm` and `placeholder` attributes
- QWeb templates (both server-side and client-side), all text nodes are
  exported except inside `t-translation="off"` blocks, the content of
  the `title`, `alt`, `label` and `placeholder` attributes are also
  exported
- for `~odoo.fields.Field`{.interpreted-text role="class"}, unless their
  model is marked with `_translate = False`:
  - their `string` and `help` attributes are exported
  - if `selection` is present and a list (or tuple), it\'s exported
  - if their `translate` attribute is set to `True`, all of their
    existing values (across all records) are exported
- help/error messages of
  `~odoo.models.Model._constraints`{.interpreted-text role="attr"} and
  `~odoo.models.Model._sql_constraints`{.interpreted-text role="attr"}
  are exported

## Explicit exports

When it comes to more \"imperative\" situations in Python code or
Javascript code, Odoo cannot automatically export translatable terms so
they must be marked explicitly for export. This is done by wrapping a
literal string in a function call.

In Python, the wrapping function is `odoo._`{.interpreted-text
role="func"}:

    title = _("Bank Accounts")

In JavaScript, the wrapping function is generally
`odoo.web._t`{.interpreted-text role="js:func"}:

``` javascript
title = _t("Bank Accounts");
```

:::: warning
::: title
Warning
:::

Only literal strings can be marked for exports, not expressions or
variables. For situations where strings are formatted, this means the
format string must be marked, not the formatted string
::::

The lazy version of [\_]{.title-ref} and [\_t]{.title-ref} is
`odoo._lt`{.interpreted-text role="func"} in python and
`odoo.web._lt`{.interpreted-text role="js:func"} in javascript. The
translation lookup is executed only at rendering and can be used to
declare translatable properties in class methods of global variables.

:::: note
::: title
Note
:::

Translations of a module are **not** exposed to the front end by default
and thus are not accessible from JavaScript. In order to achieve that,
the module name has to be either prefixed with [website]{.title-ref}
(just like [website_sale]{.title-ref}, [website_event]{.title-ref} etc.)
or explicitly register by implementing
`_get_translation_frontend_modules_name`{.interpreted-text role="func"}
for the [ir.http]{.title-ref} model.

This could look like the following:

    from odoo import models

    class IrHttp(models.AbstractModel):
        _inherit = 'ir.http'

        @classmethod
        def _get_translation_frontend_modules_name(cls):
            modules = super()._get_translation_frontend_modules_name()
            return modules + ['your_module']
::::

### Variables

**Don\'t** the extract may work but it will not translate the text
correctly:

    _("Scheduled meeting with %s" % invitee.name)

**Do** set the dynamic variables as a parameter of the translation
lookup (this will fallback on source in case of missing placeholder in
the translation):

    _("Scheduled meeting with %s", invitee.name)

### Blocks

**Don\'t** split your translation in several blocks or multiples lines:

    # bad, trailing spaces, blocks out of context
    _("You have ") + len(invoices) + _(" invoices waiting")
    _t("You have ") + invoices.length + _t(" invoices waiting");

    # bad, multiple small translations
    _("Reference of the document that generated ") + \
    _("this sales order request.")

**Do** keep in one block, giving the full context to translators:

    # good, allow to change position of the number in the translation
    _("You have %s invoices wainting") % len(invoices)
    _.str.sprintf(_t("You have %s invoices wainting"), invoices.length);

    # good, full sentence is understandable
    _("Reference of the document that generated " + \
      "this sales order request.")

### Plural

**Don\'t** pluralize terms the English-way:

    msg = _("You have %(count)s invoice", count=invoice_count)
    if invoice_count > 1:
      msg += _("s")

**Do** keep in mind every language has different plural forms:

    if invoice_count > 1:
      msg = _("You have %(count)s invoices", count=invoice_count)
    else:
      msg = _("You have one invoice")

### Read vs Run Time

**Don\'t** invoke translation lookup at server launch:

    ERROR_MESSAGE = {
      # bad, evaluated at server launch with no user language
      'access_error': _('Access Error'),
      'missing_error': _('Missing Record'),
    }

    class Record(models.Model):

      def _raise_error(self, code):
        raise UserError(ERROR_MESSAGE[code])

**Don\'t** invoke translation lookup when the javascript file is read:

    # bad, js _t is evaluated too early
    var core = require('web.core');
    var _t = core._t;
    var map_title = {
        access_error: _t('Access Error'),
        missing_error: _t('Missing Record'),
    };

**Do** use lazy translation lookup method:

    ERROR_MESSAGE = {
      'access_error': _lt('Access Error'),
      'missing_error': _lt('Missing Record'),
    }

    class Record(models.Model):

      def _raise_error(self, code):
        # translation lookup executed at error rendering
        raise UserError(ERROR_MESSAGE[code])

or **do** evaluate dynamically the translatable content:

    # good, evaluated at run time
    def _get_error_message(self):
      return {
        access_error: _('Access Error'),
        missing_error: _('Missing Record'),
      }

**Do** in the case where the translation lookup is done when the JS file
is *read*, use [\_lt]{.title-ref} instead of [\_t]{.title-ref} to
translate the term when it is *used*:

    # good, js _lt is evaluated lazily
    var core = require('web.core');
    var _lt = core._lt;
    var map_title = {
        access_error: _lt('Access Error'),
        missing_error: _lt('Missing Record'),
    };




--- SOURCE: developer/howtos/upgrade_custom_db.md ---

# Upgrade a customized database

Upgrading to a new version of Odoo can be challenging, especially if the
database you work on contains custom modules. This page intent is to
explain the technical process of upgrading a database with customized
modules. Refer to
`Upgrade documentation </administration/upgrade>`{.interpreted-text
role="doc"} for guidance on how to upgrade a database without customized
modules.

We consider a custom module, any module that extends the standard code
of Odoo and that was not built with the Studio app. Before upgrading
such a module, or before requesting its upgrade, have a look at the
`upgrade-sla`{.interpreted-text role="ref"} to make sure who\'s
responsible for it.

While working on what we refer to as the **custom upgrade** of your
database, keep in mind the goals of an upgrade:

1.  Stay supported
2.  Get the latest features
3.  Enjoy the performance improvement
4.  Reduce the technical debt
5.  Benefit from security improvements

With every new version of Odoo, changes are introduced. These changes
can impact modules on which customization have been developed. This is
the reason why upgrading a database that contains custom modules
requires additional steps in order to upgrade the source code.

These are the steps to follow to upgrade customized databases:

1.  `Stop the devolopments and challenge them <upgrade_custom/stop_developments>`{.interpreted-text
    role="ref"}.
2.  `Request an upgraded database <upgrade_custom/request_upgrade>`{.interpreted-text
    role="ref"}.
3.  `Make your module installable on an empty database <upgrade_custom/empty_database>`{.interpreted-text
    role="ref"}.
4.  `Make your module installable on the upgraded database <upgrade_custom/upgraded_database>`{.interpreted-text
    role="ref"}.
5.  `Test extensively and do a rehearsal <upgrade_custom/testing_rehearsal>`{.interpreted-text
    role="ref"}.
6.  `Upgrade the production database <upgrade_custom/production>`{.interpreted-text
    role="ref"}.

## Step 1: Stop the developments {#upgrade_custom/stop_developments}

Starting an upgrade requires commitment and development resources. If
developments keep being made at the same time, those features will need
to be re-upgraded and tested every time you change them. This is why we
recommend a complete freeze of the codebase when starting the upgrade
process. Needless to say, bug fixing is exempt from this recommendation.

Once you have stopped development, it is a good practice to assess the
developments made and compare them with the features introduced between
your current version and the version you are targeting. Challenge the
developments as much as possible and find functional workarounds.
Removing redundancy between your developments and the standard version
of Odoo will lead to an eased upgrade process and reduce technical debt.

:::: note
::: title
Note
:::

You can find information on the changes between versions in the [Release
Notes](https:/odoo.com/page/release-notes).
::::

## Step 2: Request an upgraded database {#upgrade_custom/request_upgrade}

Once the developments have stopped for the custom modules and the
implemented features have been challenged to remove redundancy and
unnecessary code, the next step is to request an upgraded test database.
To do so, follow the steps mentioned in
`upgrade-request-test`{.interpreted-text role="ref"}, depending on the
hosting type of your database.

The purpose of this stage is not to start working with the custom
modules in the upgraded database, but to make sure the standard upgrade
process works seamlessly, and the test database is delivered properly.
If that\'s not the case, and the upgrade request fails, request the
assistance of Odoo via the [support
page](https://odoo.com/help?stage=migration) by selecting the option
related to testing the upgrade.

## Step 3: Empty database {#upgrade_custom/empty_database}

Before working on an upgraded test database, we recommend to make the
custom developments work on an empty database in the targeted version of
your upgrade. This ensures that the customization is compatible with the
new version of Odoo, allows to analyze how it behaves and interacts with
the new features, and guarantees that they will not cause any issues
when upgrading the database.

Making the custom modules work in an empty database also helps avoid
changes and wrong configurations that might be present in the production
database (like studio customization, customized website pages, email
templates or translations). They are not intrinsically related to the
custom modules and that can raise unwanted issues in this stage of the
upgrade process.

To make custom modules work on an empty database we advise to follow
these steps:

1.  `upgrade_custom/empty_database/modules_installable`{.interpreted-text
    role="ref"}
2.  `upgrade_custom/empty_database/test_fixes`{.interpreted-text
    role="ref"}
3.  `upgrade_custom/empty_database/clean_code`{.interpreted-text
    role="ref"}
4.  `Make standard tests run successfully <upgrade_custom/empty_database/standard_test>`{.interpreted-text
    role="ref"}

### Make custom modules installable {#upgrade_custom/empty_database/modules_installable}

The first step is to make the custom modules installable in the new Odoo
version. This means, starting by ensuring there are no tracebacks or
warnings during their installation. For this, install the custom
modules, one by one, in an empty database of the new Odoo version and
fix the tracebacks and warnings that arise from that.

This process will help detect issues during the installation of the
modules. For example:

- Invalid module dependencies.
- Syntax change: assets declaration, OWL updates, attrs.
- References to standard fields, models, views not existing anymore or
  renamed.
- Xpath that moved or were removed from views.
- Methods renamed or removed.
- \...

### Test and fixes {#upgrade_custom/empty_database/test_fixes}

Once there are no more tracebacks when installing the modules, the next
step is to test them. Even if the custom modules are installable on an
empty database, this does not guarantee there are no errors during their
execution. Because of this, we encourage to test thoroughly all the
customization to make sure everything is working as expected.

This process will help detect further issues that are not identified
during the module installation and can only be detected in runtime. For
example, deprecated calls to standard python or OWL functions,
non-existing references to standard fields, etc.

We recommend to test all the customization, especially the following
elements:

- Views
- Email templates
- Reports
- Server actions and automated actions
- Changes in the standard workflows
- Computed fields

We also encourage to write automated tests to save time during the
testing iterations, increase the test coverage, and ensure that the
changes and fixes introduced do not break the existing flows. If there
are tests already implemented in the customization, make sure they are
upgraded to the new Odoo version and run successfully, fixing issues
that might be present.

### Clean the code {#upgrade_custom/empty_database/clean_code}

At this stage of the upgrade process, we also suggest to clean the code
as much as possible. This includes:

- Remove redundant and unnecessary code.
- Remove features that are now part of Odoo standard, as described in
  `upgrade_custom/stop_developments`{.interpreted-text role="ref"}.
- Clean commented code if it is not needed anymore.
- Refactor the code (functions, fields, views, reports, etc.) if needed.

### Standard tests {#upgrade_custom/empty_database/standard_test}

Once the previous steps are completed, we advise to make sure all
standard tests associated to the dependencies of the custom module pass.
Standard tests ensure the validation of the code logic and prevent data
corruption. They will help you identify bugs or unwanted behavior before
you work on your database.

In case there are standard test failing, we suggest to analyze the
reason for their failure:

- The customization changes the standard workflow: Adapt the standard
  test to your workflow.
- The customization did not take into account a special flow: Adapt your
  customization to ensure it works for all the standard workflows.

## Step 4: Upgraded database {#upgrade_custom/upgraded_database}

Once the custom modules are installable and working properly in an empty
database, it is time to make them work on an
`upgraded database <upgrade-request-test>`{.interpreted-text
role="ref"}.

To make sure the custom code is working flawlessly in the new version,
follow these steps:

- `upgrade_custom/upgraded_database/migrate_data`{.interpreted-text
  role="ref"}
- `upgrade_custom/upgraded_database/test_custom`{.interpreted-text
  role="ref"}

### Migrate the data {#upgrade_custom/upgraded_database/migrate_data}

During the upgrade of the custom modules, you might have to use
`upgrade scripts
<../reference/upgrades/upgrade_scripts>`{.interpreted-text role="doc"}
to reflect changes from the source code to their corresponding data.
Together with the upgrade scripts, you can also make use of the
`../reference/upgrades/upgrade_utils`{.interpreted-text role="doc"} and
its helper functions.

- Any technical data that was renamed during the upgrade of the custom
  code (models, fields, external identifiers) should be renamed using
  upgrade scripts to avoid data loss during the module upgrade. See
  also: `rename_field`{.interpreted-text role="meth"},
  `rename_model`{.interpreted-text role="meth"},
  `rename_xmlid`{.interpreted-text role="meth"}.

- Data from standard models removed from the source code of the newer
  Odoo version and from the database during the standard upgrade process
  might need to be recovered from the old model table if it is still
  present.

  > :::: example
  > Custom fields for model `sale.subscription` are not automatically
  > migrated from Odoo 15 to Odoo 16 (when the model was merged into
  > `sale.order`). In this case, a SQL query can be executed on an
  > upgrade script to move the data from one table to the other. Take
  > into account that all columns/fields must already exist, so consider
  > doing this in a `post-` script (See
  > `upgrade-scripts/phases`{.interpreted-text role="ref"}).
  >
  > ::: spoiler
  > ``` python
  > def migrate(cr, version):
  >    cr.execute(
  >       """
  >       UPDATE sale_order so
  >          SET custom_field = ss.custom_field
  >         FROM sale_subscription ss
  >        WHERE ss.new_sale_order_id = so.id
  >       """
  >    )
  > ```
  >
  > Check the documentation for more information on
  > `../reference/upgrades/upgrade_scripts`{.interpreted-text
  > role="doc"}.
  > :::
  > ::::

Upgrade scripts can also be used to:

- Ease the processing time of an upgrade. For example, to store the
  value of computed stored fields on models with an excessive number of
  records by using SQL queries.
- Recompute fields in case the computation of their value has changed.
  See also `recompute_fields`{.interpreted-text role="meth"}.
- Uninstall unwanted custom modules. See also
  `remove_module`{.interpreted-text role="meth"}.
- Correct faulty data or wrong configurations.

#### Running and testing upgrade scripts

:::::::: tabs
::: group-tab
Odoo Online

As the instalation of custom modules containing Python files is not
allowed on Odoo Online databases, it is not possible to run upgrade
scripts on this platform.
:::

::: group-tab
Odoo.sh

As explained on the [Odoo.sh]{.title-ref} tab of
`upgrade-request-test`{.interpreted-text role="ref"}, Odoo.sh is
integrated with the upgrade platform.

Once the upgrade of a staging branch is on \"Update on commit\" mode,
each time a commit is pushed on the branch, the upgraded backup is
restored and all the custom modules are updated. This update includes
the execution of the upgrade scripts.

When upgrading the production database, the execution of the upgrade
scripts is also part of the update of the custom modules done by the
platform when the upgraded database is restored.
:::

::::: group-tab
On-premise

Once you receive the upgraded dump of the database from the [Upgrade
platform](https://upgrade.odoo.com), deploy the database and update all
the custom modules by invoking the command
`odoo-bin </developer/reference/cli>`{.interpreted-text role="doc"} in
the shell. To update the custom modules, use the option: [-u
\<modules\>, \--update \<modules\>]{.title-ref}.

:::: important
::: title
Important
:::

As mentioned in the
`CLI documentation </developer/reference/cli>`{.interpreted-text
role="doc"}, the command used to call the CLI depends on how you
installed Odoo.
::::
:::::
::::::::

### Test the custom modules {#upgrade_custom/upgraded_database/test_custom}

To make sure the custom modules work properly with your data in the
upgraded database, they need to be tested as well. This helps ensure
both the standard and the custom data stored in the database are
consistent and that nothing was lost during the upgrade process.

Things to pay attention to:

- Views not working: During the upgrade, if a view causes issues because
  of its content, it gets disabled. You can find the information on
  disabled views on the Upgrade report. This view needs to be activated
  again (or removed if not useful anymore). To achieve this, we
  recommend the use of upgrade scripts.
- `Module data <../tutorials/define_module_data>`{.interpreted-text
  role="doc"} not updated: Custom records that have the `noupdate` flag
  are not updated when upgrading the module in the new database. For the
  custom data that needs to be updated due to changes in the new
  version, we recommend to use upgrade scripts to do so. See also:
  `update_record_from_xml`{.interpreted-text role="meth"}.

## Step 5: Testing and rehearsal {#upgrade_custom/testing_rehearsal}

When the custom modules are working properly in the upgraded database,
it is crucial to do another round of testing to assess the database
usability and detect any issues that might have gone unnoticed in
previous tests. For further information about testing the upgraded
database, check `upgrade-testing`{.interpreted-text role="ref"}.

As mentioned in `upgrade-production`{.interpreted-text role="ref"}, both
standard upgrade scripts and your database are constantly evolving.
Therefore it is highly recommended to frequently request new upgraded
test databases and ensure that the upgrade process is still successful.

In addition to that, make a full rehearsal of the upgrade process the
day before upgrading the production database to avoid undesired behavior
during the upgrade and to detect any issue that might have occurred with
the migrated data.

## Step 6: Production upgrade {#upgrade_custom/production}

Once you are confident about upgrading your production database, follow
the process described on `upgrade-production`{.interpreted-text
role="ref"}, depending on the hosting type of your database.




--- SOURCE: developer/howtos/web_services.md ---

# Web Services

The web-service module offers a common interface for all web services:

- XML-RPC
- JSON-RPC

Business objects can also be accessed via the distributed object
mechanism. They can all be modified via the client interface with
contextual views.

Odoo is accessible through XML-RPC/JSON-RPC interfaces, for which
libraries exist in many languages.

## XML-RPC Library

The following example is a Python 3 program that interacts with an Odoo
server with the library `xmlrpc.client`:

    import xmlrpc.client

    root = 'http://%s:%d/xmlrpc/' % (HOST, PORT)

    uid = xmlrpc.client.ServerProxy(root + 'common').login(DB, USER, PASS)
    print("Logged in as %s (uid: %d)" % (USER, uid))

    # Create a new note
    sock = xmlrpc.client.ServerProxy(root + 'object')
    args = {
        'color' : 8,
        'memo' : 'This is a note',
        'create_uid': uid,
    }
    note_id = sock.execute(DB, uid, PASS, 'note.note', 'create', args)

:::: exercise
Add a new service to the client

Write a Python program able to send XML-RPC requests to a PC running
Odoo (yours, or your instructor\'s). This program should display all the
sessions, and their corresponding number of seats. It should also create
a new session for one of the courses.

::: only
solutions

``` python
import functools
import xmlrpc.client
HOST = 'localhost'
PORT = 8069
DB = 'openacademy'
USER = 'admin'
PASS = 'admin'
ROOT = 'http://%s:%d/xmlrpc/' % (HOST,PORT)

# 1. Login
uid = xmlrpc.client.ServerProxy(ROOT + 'common').login(DB,USER,PASS)
print("Logged in as %s (uid:%d)" % (USER,uid))

call = functools.partial(
    xmlrpc.client.ServerProxy(ROOT + 'object').execute,
    DB, uid, PASS)

# 2. Read the sessions
sessions = call('openacademy.session','search_read', [], ['name','seats'])
for session in sessions:
    print("Session %s (%s seats)" % (session['name'], session['seats']))
# 3.create a new session
session_id = call('openacademy.session', 'create', {
    'name' : 'My session',
    'course_id' : 2,
})
```

Instead of using a hard-coded course id, the code can look up a course
by name:

    # 3.create a new session for the "Functional" course
    course_id = call('openacademy.course', 'search', [('name','ilike','Functional')])[0]
    session_id = call('openacademy.session', 'create', {
        'name' : 'My session',
        'course_id' : course_id,
    })
:::
::::

::: seealso
\- `../reference/external_api`{.interpreted-text role="doc"}: The
in-depth tutorial on XML-RPC, with examples spanning multiple
programming languages.
:::

## JSON-RPC Library

The following example is a Python 3 program that interacts with an Odoo
server with the standard Python libraries `urllib.request` and `json`.
This example assumes the **Productivity** app (`note`) is installed:

    import json
    import random
    import urllib.request

    HOST = 'localhost'
    PORT = 8069
    DB = 'openacademy'
    USER = 'admin'
    PASS = 'admin'

    def json_rpc(url, method, params):
        data = {
            "jsonrpc": "2.0",
            "method": method,
            "params": params,
            "id": random.randint(0, 1000000000),
        }
        req = urllib.request.Request(url=url, data=json.dumps(data).encode(), headers={
            "Content-Type":"application/json",
        })
        reply = json.loads(urllib.request.urlopen(req).read().decode('UTF-8'))
        if reply.get("error"):
            raise Exception(reply["error"])
        return reply["result"]

    def call(url, service, method, *args):
        return json_rpc(url, "call", {"service": service, "method": method, "args": args})

    # log in the given database
    url = "http://%s:%s/jsonrpc" % (HOST, PORT)
    uid = call(url, "common", "login", DB, USER, PASS)

    # create a new note
    args = {
        'color': 8,
        'memo': 'This is another note',
        'create_uid': uid,
    }
    note_id = call(url, "object", "execute", DB, uid, PASS, 'note.note', 'create', args)

Examples can be easily adapted from XML-RPC to JSON-RPC.

:::: note
::: title
Note
:::

There are a number of high-level APIs in various languages to access
Odoo systems without *explicitly* going through XML-RPC or JSON-RPC,
such as:

- <https://github.com/akretion/ooor>
- <https://github.com/OCA/odoorpc>
- <https://github.com/nicolas-van/openerp-client-lib>
- <http://pythonhosted.org/OdooRPC>
- <https://github.com/abhishek-jaiswal/php-openerp-lib>
::::




--- SOURCE: developer/howtos/website_themes/animations.md ---

# Animations

Odoo uses eye-catching animations that can bring your website to life.
By default, we can use two kinds of animations:

- Animations on appearance
- Animations on scroll

## On appearance {#website_themes/animations/appearance}

In standard, you can add animations to column, text and image elements
when they appear, thanks to the Website Builder. Odoo detects when your
element is in the viewport and launches the animation. A large selection
of animations is available:

- Fade in
- Bounce in
- Rotate in
- Zoom in
- ...

You can easily define an animation on a column in your custom theme. You
need to add two classes: [o_animate]{.title-ref} and
[o_anim_fade_in]{.title-ref}. The second class changes depending on the
type of animation you want to use.

Add the [o_animate_both_scroll]{.title-ref} class to launch the
animation every time the column appears on the screen. The animation is
only launched once by default.

You should also define an [animation-duration]{.title-ref} and an
[animation-delay]{.title-ref} directly in the [style]{.title-ref}
attribute.

Additionally, you can add an animation direction. For instance, to
animate the element from the bottom of the screen, add a
[o_anim_from_bottom]{.title-ref} class and set a
[\--wanim-intensity]{.title-ref} in the [style]{.title-ref} attribute to
control the animation\'s direction intensity.

**Use**

``` xml
<div class="col-lg-6 o_animate o_anim_fade_in o_animate_both_scroll o_anim_from_bottom" style="--wanim-intensity: 100; animation-duration: 2s; animation-delay: 1s;">
    <h2>A Section Subtitle</h2>
    <p>Write one or two paragraphs describing your product or services.</p>
</div>
```

![Animation on appearance options](animations/appearance.png)

## On scroll {#website_themes/animations/scroll}

In the same way as we have seen above, you can add animations on scroll
to column, text and image elements whenever the viewport scrolls through
the animated element.

We can add 6 animation on scroll effects:

- Fade
- Slide
- Bounce
- Rotate
- Zoom Out
- Zoom In

Additionally, we can also set an [in]{.title-ref} or [out]{.title-ref}
effect, an animation [direction]{.title-ref} , the animation
[intensity]{.title-ref} and a [scroll zone]{.title-ref}.

**Use**

``` xml
<div class="col-lg-6 o_animate o_animate_on_scroll o_animate_out o_anim_fade_in o_anim_from_right" data-scroll-zone-start="50" data-scroll-zone-end="100" style="--wanim-intensity: 100;">
    <h2>A Section Subtitle</h2>
    <p>Write one or two paragraphs describing your product or services.</p>
</div>
```

![Animation on scroll options](animations/scroll.png)

::: seealso
[Website
Animate](https://github.com/odoo/odoo/blob/34c0c9c1ae00aba391932129d4cefd027a9c6bbd/addons/website/static/src/scss/website.scss#L1638)
:::




--- SOURCE: developer/howtos/website_themes/building_blocks.md ---

# Building blocks

Building blocks, also known as snippets, are how users design and layout
pages. They are important XML elements of your design.

The building blocks are classified into four categories:

1.  **Structure blocks**: to give a basic structure to the website
2.  **Feature blocks**: to describe the features of a product or service
3.  **Dynamic Content blocks**: blocks that are animated or interact
    with the backend
4.  **Inner Content blocks**: blocks used inside other building blocks

At the end of this chapter, you will be able to `create custom snippets
<website_themes/building_blocks/custom>`{.interpreted-text role="ref"}
and to add them into a dedicated category.

## File structure {#website_themes/building_blocks/file_structure}

The layout\'s file structure is the following.

    views
    ├── snippets
    │   └── options.xml
    │   └── s_snippet_name.xml

The styles\' file structure is the following.

    static
    ├── src
    │   └── snippets
    │       └── s_snippet_name
    │           └── 000.js
    │           └── 000.scss
    │           └── 000.xml
    │           └── options.js

::: seealso
[XML templates of the different
snippets](https://github.com/odoo/odoo/blob/ccb78f7af2a4413836a969ff8009dc3df6c2df33/addons/website/views/snippets/snippets.xml)
:::

::: admonition
Demo page

Demo data have to be installed to access this page:

    https://your-database.com/website/demo/snippets
:::

## Layout {#website_themes/building_blocks/layout}

Snippets are editable by the user using the Website Builder. Some
Bootstrap classes are important as **they trigger some Website Builder
options**.

### Wrapper {#website_themes/building_blocks/layout/wrapper}

The standard main container of any snippet is a [section]{.title-ref}.
Any section element can be edited like a block of content that you can
move or duplicate.

``` xml
<section class="s_snippet_name" data-name="..." data-snippet="...">
    <!-- Content -->
</section>
```

For inner content snippets, any other HTML tag can be used.

``` xml
<div class="s_snippet_name" data-name="..." data-snippet="...">
    <!-- Content -->
</div>
```

  -----------------------------------------------------------------------
  Attribute      Description
  -------------- --------------------------------------------------------
  class          Unique class name for this snippet

  data-name      Displayed in the right panel as the name of the snippet.
                 If not found, it will fall back to *Block*.

  data-snippet   Used by the system to identify the snippet
  -----------------------------------------------------------------------

The system automatically adds the [data-name]{.title-ref} and
[data-snippet]{.title-ref} attributes during the drag and drop based on
the template\'s name.

:::: warning
::: title
Warning
:::

Those attributes should be specifically added when a snippet is declared
on a theme page.
::::

:::: warning
::: title
Warning
:::

Avoid adding a [section]{.title-ref} tag inside another
[section]{.title-ref} tag: this will trigger twice the Website
Builder\'s options. You can use inner content snippets instead.
::::

:::: tip
::: title
Tip
:::

To write the content of a static page with standard snippets, there are
two possible approaches:

- 

  **Pre-build the custom static pages with the Website Builder:** Drag & drop snippets, then

  :   copy/paste the code into your file and clean it up.

|  \*\*OR\*\*

- 

  **Code everything directly:** But beware of compatibility with the Website Builder. It

  :   requires certain classes, names, id, data, etc. to work properly.
      A good practice is to seek out the snippets code created in
      standard code in the Odoo source files. Pay attention that the
      Website Builder sometimes adds classes to the snippets after
      dropped in the page.
::::

### Elements {#website_themes/building_blocks/layout/elements}

There is a list of \"features\" we can enable/disable by using specific
CSS classes.

#### Sizing {#website_themes/building_blocks/layout/elements/sizing}

Any large Bootstrap columns directly descending from a
[.row]{.title-ref} element (respecting Bootstrap structure) will be
triggered by the Website Builder to make them resizable.

``` css
.row > .col-lg-*
```

Add padding on columns and [\<section\>]{.title-ref}.

``` xml
class="pt80 pb80"
```

:::: note
::: title
Note
:::

[pb\*]{.title-ref} and [pt\*]{.title-ref} are the Odoo classes used to
control the handlers. Their values are increased by **multiples of 8**,
till a **max of 256** (0, 8, 16, 24, 32, 40, 48, \...).
::::

Enable the columns selector.

``` xml
<div class="container s_allow_columns">
```

Disable the columns amount option.

``` xml
<div class="row s_nb_column_fixed">
```

Disable the size option for all child columns.

``` xml
<div class="row s_col_no_resize">
```

Disable the size option for one specific column.

``` xml
<div class="col-lg-* s_col_no_resize">
```

#### Colors {#website_themes/building_blocks/layout/elements/colors}

Add a background based on the color palette for columns and
[\<section\>]{.title-ref}.

``` xml
class="o_cc o_cc*"
```

Disable the background color option for all columns.

``` xml
<div class="row s_col_no_bgcolor">
```

Disable the background color option of one specific column.

``` xml
<div class="col-lg-* s_col_no_bgcolor">
```

Add a black color filter with an opacity of 50%.

``` xml
<section>
    <div class="o_we_bg_filter bg-black-50"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

Add a white color filter with an opacity of 85%.

``` xml
<section>
    <div class="o_we_bg_filter bg-white-85"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

Add a custom color filter.

``` xml
<section>
    <div class="o_we_bg_filter" style="background-color: rgba(39, 110, 114, 0.54) !important;"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

Add a custom gradient filter.

``` xml
<section>
    <div class="o_we_bg_filter" style="background-image: linear-gradient(135deg, rgba(255, 204, 51, 0.5) 0%, rgba(226, 51, 255, 0.5) 100%) !important;"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

#### Features {#website_themes/building_blocks/layout/elements/features}

Make an element not editable.

``` xml
<div class="o_not_editable">
```

Make an element not removable.

``` xml
<div class="oe_unremovable">
```

Add a background image and have it centered.

``` xml
<div class="oe_img_bg o_bg_img_center" style="background-image: url('...')">
```

Add parallax effect.

``` xml
<section class="parallax s_parallax_is_fixed s_parallax_no_overflow_hidden" data-scroll-background-ratio="1">
    <span class="s_parallax_bg oe_img_bg o_bg_img_center" style="background-image: url('...'); background-position: 50% 75%;"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

::: todo
Update the ref below after the Media section has been created
(howto/website_themes/media_videos).
:::

:::: note
::: title
Note
:::

A video background can be set on a section. Refer to the
\"`media`{.interpreted-text role="doc"}\" chapter of this documentation.
::::

### Grid layout {#website_themes/building_blocks/layout/grid}

Grid Layout is a powerful and flexible layout system in CSS that enables
users to design complex building block layouts with ease.

Enable the Grid Layout by adding the [o_grid_mode]{.title-ref} class on
the [row]{.title-ref}. The number of rows in your grid is defined in the
[data-row-count]{.title-ref} attribute. The grid always contains 12
columns.

**Use**

``` xml
<div class="row o_grid_mode" data-row-count="13">
   <!-- Content -->
</div>
```

Add items in the grid with the [o_grid_item]{.title-ref} class. If the
grid item contains an image, use the [o_grid_item_image]{.title-ref}
class.

``` {.xml emphasize-lines="2,3,4,5,6"}
<div class="row o_grid_mode" data-row-count="13">
   <div class="o_grid_item g-height-* g-col-lg-*" style="grid-area: 2 / 1 / 7 / 8; z-index: 3;">
      <!-- Content -->
   </div>
   <div class="o_grid_item o_grid_item_image g-height-* g-col-lg-*" style="grid-area: 1 / 6 / 9 / 13; z-index: 2;">
      <img src="..." alt="..." >
   </div>
</div>
```

The dimensions and position of a grid item are defined by the grid-area
that can be explicitly set in the [style]{.title-ref} attribute along
with the z-index.

The [g-height-\*]{.title-ref} and [g-col-lg-\*]{.title-ref} classes are
generated by the Website Builder for editing purposes.

## Compatibility system {#website_themes/building_blocks/compatibility}

When a snippet has a [data-vcss]{.title-ref}, [data-vjs]{.title-ref} and/or [data-vxml]{.title-ref} attribute, it means it is an updated

:   version, not the original one.

``` xml
<section class="s_snippet_name" data-vcss="001" data-vxml="001" data-js="001">
    <!-- Content -->
</section>
```

These data attributes indicate to the system which file version to load
for that snippet (e.g., `001.js`{.interpreted-text role="file"},
`002.scss`{.interpreted-text role="file"}).

## Custom snippet {#website_themes/building_blocks/custom}

To create a custom snippet, create first the snippet template. Then, add
it to the list and make it available via the Website Builder.

### Template {#website_themes/building_blocks/custom/template}

**Declaration**

``` {.xml caption="``/website_airproof/views/snippets/s_airproof_snippet.xml``"}
<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="s_airproof_snippet" name="...">
        <section class="s_airproof_snippet">
            <!-- Content -->
        </section>
    </template>

</odoo>
```

:::: warning
::: title
Warning
:::

[data-name]{.title-ref} and [data-snippet]{.title-ref} attributes have
to be specified when a snippet is declared on a theme page. Otherwise,
the snippet won\'t be recognised by the Website Builder and issues might
occur whenever a database upgrade is done. Additionally, remember that
the name attribute is shown as the name of your custom snippet in the
`Blocks`{.interpreted-text role="guilabel"} section of the options
panel.
::::

:::: tip
::: title
Tip
:::

\- Use Bootstrap native classes as much as possible. - Prefix all your
custom classes. - Use underscore lowercase notation to name classes,
e.g., [.x_nav]{.title-ref}, [.x_nav_item]{.title-ref}. - Avoid using ID
attribute within your [section]{.title-ref} as several instances of a
snippet may appear throughout the page (An ID attribute has to be unique
on a page).
::::

Add your custom snippet to the list of standard snippets, so the user
can drag and drop it on the page, directly from the edit panel.

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="snippets" inherit_id="website.snippets" name="Airproof - Custom Snippets">
    <xpath expr="//*[@id='default_snippets']" position="before">
        <t id="x_theme_snippets">
            <div id="x_theme_snippets_category" class="o_panel">
                <div class="o_panel_header">Theme</div>
                <div class="o_panel_body">
                    <t t-snippet="website_airproof.s_airproof_snippet" t-thumbnail="/website_airproof/static/src/img/wbuilder/s_airproof_snippet.svg">
                        <keywords>Snippet</keywords>
                    </t>
                </div>
            </div>
        </t>
    </xpath>
</template>
```

  -----------------------------------------------------------------------
  Attribute      Description
  -------------- --------------------------------------------------------
  t-snippet      The template to use

  t-thumbnail    The path to the snippet thumbnail

  \<keywords\>   Keywords entered by the user in the search field in the
                 Snippets panel
  -----------------------------------------------------------------------

### Options {#website_themes/building_blocks/custom/options}

Options allow users to edit a snippet\'s appearance/behavior using the
Website Builder. You can create snippet options easily and automatically
add them to the Website Builder.

::: seealso
[Standard snippet
options](https://github.com/odoo/odoo/blob/ccb78f7af2a4413836a969ff8009dc3df6c2df33/addons/website/views/snippets/snippets.xml)
:::

#### Template {#website_themes/building_blocks/custom/options/template}

There are a bunch of commands to set the options of a custom snippet.
These options can be created into
`/website_airproof/views/snippets/s_airproof_snippet.xml`{.interpreted-text
role="file"}.

``` {.xml caption="``/website_airproof/views/snippets/s_airproof_snippet.xml``"}
<template id="s_airproof_snippet_options" inherit_id="website.snippet_options" name="Airproof - Snippets Options">
   <xpath expr="." position="inside">
      <!-- Options -->
   </xpath>
</template>
```

Then insert the different available options:

``` {.xml caption="``/website_airproof/views/snippets/s_airproof_snippet.xml``" emphasize-lines="3-16"}
<template id="s_airproof_snippet_options" inherit_id="website.snippet_options" name="Airproof - Snippets Options">
   <xpath expr="." position="inside">
      <div data-selector=".s_airproof_snippet">
         <we-select string="Layout">
            <we-button data-select-class="">Default</we-button>
            <we-button data-select-class="s_airproof_snippet_portrait">Portrait</we-button>
            <we-button data-select-class="s_airproof_snippet_square">Square</we-button>
            <we-button data-select-class="s_airproof_snippet_landscape">Landscape</we-button>
         </we-select>
         <we-title>Space</we-title>
         <we-button-group string="Before">
            <we-button data-select-class="mt-0">1</we-button>
            <we-button data-select-class="mt-3">2</we-button>
            <we-button data-select-class="mt-5">3</we-button>
         </we-button-group>
      </div>
   </xpath>
</template>
```

#### Binding {#website_themes/building_blocks/custom/options/binding}

These options use CSS selectors (class, XML tag, id, etc).

##### data-selector {#website_themes/building_blocks/custom/options/binding/data_selector}

Options are wrapped in groups. Groups can have properties that define
how the included options interact with the user interface.

[data-selector]{.title-ref} binds all the options included in the group
to a particular element matching the selector value (CSS class, ID,
etc). The option will appear when the matching selector is selected.

``` xml
<div data-selector="section, h1, .custom_class, #custom_id">
```

It can be used in combination with other attributes like
[data-target]{.title-ref}, [data-exclude]{.title-ref} or
[data-apply-to]{.title-ref}.

##### data-target {#website_themes/building_blocks/custom/options/binding/data_target}

[data-target=\"\"]{.title-ref} allows to apply the option to a child
element of the [data-selector=\"\"]{.title-ref}.

``` xml
<div
   data-selector=".s_airproof_snippet"
   data-target=".row">
```

##### data-exclude {#website_themes/building_blocks/custom/options/binding/data_exclude}

[data-exclude=\"\"]{.title-ref} allows to exclude some particular
selectors from the rule.

``` {.xml caption="The option appears if an `<ul>` tag (without `.navbar-nav` class) is selected"}
<div
   data-selector="ul"
   data-exclude=".navbar-nav">
```

##### data-drop-in {#website_themes/building_blocks/custom/options/binding/data_drop_in}

[data-drop-in]{.title-ref} defines the list of elements where the
snippet can be dropped into.

``` xml
<div data-selector=".s_airproof_snippet" data-drop-in=".x_custom_location">
```

##### data-drop-near {#website_themes/building_blocks/custom/options/binding/data_drop_near}

[data-drop-near]{.title-ref} defines the list of elements where the
snippet can be dropped beside.

``` xml
<div data-selector=".s_airproof_snippet_card" data-drop-near=".card">
```

##### data-js {#website_themes/building_blocks/custom/options/binding/data_js}

[data-js]{.title-ref} binds a custom JavaScript methods.

``` xml
<div data-selector=".s_airproof_snippet" data-js="CustomMethodName">
```

#### Layout & fields {#website_themes/building_blocks/custom/options/layout_fields}

##### [\<we-title\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_title}

Add titles between options to categorize them.

``` xml
<we-title>Option subtitle 1</we-title>
```

![Add a subtitle between custom options](building_blocks/we-title.jpg){width="300px"}

##### [\<we-row\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_row}

Create a row in which elements is displayed next to each other.

``` xml
<we-row string="My option">
   <we-select>...</we-select>
   <we-button-group>...</we-button-group>
</we-row>
```

The perfect example for this case is the `Animation`{.interpreted-text
role="guilabel"} row:

![Group different option fields into the same row.](building_blocks/we-row.png)

##### [\<we-button\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_button}

This tag is used inside [\<we-select\>]{.title-ref} and
[\<we-button-group\>]{.title-ref}.

``` {.xml emphasize-lines="2-4"}
<we-button-group string="Before">
   <we-button data-select-class="mt-0">1</we-button>
   <we-button data-select-class="mt-3">2</we-button>
   <we-button data-select-class="mt-5">3</we-button>
</we-button-group>
```

Add [data-select-class=\"\"]{.title-ref} to indicate which class is
added to the targeted element when this choice is selected. Like any XML
node, add other attributes allows to improve the style and/or the user
experience.

``` xml
<we-button
   class="fa fa-fw fa-angle-double-right"
   title="Move to last"
   data-position="last" />
```

![Add option choices and style them with some icons](building_blocks/we-button.jpg){width="300px"}

##### [\<we-select\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_select}

Formats the option as a dropdown list. Add [string=\"\"]{.title-ref} to
indicate the field name.

``` xml
<we-select string="Layout">...</we-select>
```

![Add a dropddown list field](building_blocks/we-select.jpg){width="300px"}

##### [\<we-button-group\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_button_group}

Formats the option as buttons next to each other.

``` xml
<we-button-group string="Before">...</we-button-group>
```

![Add a dropddown list field](building_blocks/we-button-group.jpg){width="300px"}

##### [\<we-checkbox\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_checkbox}

Formats the option as a toggle switch.

``` xml
<we-checkbox
   string="Tooltip"
   data-select-class="s_airproof_snippet_tooltip" />
```

![Add a toggle switch.](building_blocks/we-checkbox.jpg){width="300px"}

##### [\<we-range\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_range}

Formats the option as a slider.

``` xml
<we-range
   string="Images Spacing"
   data-select-class="o_spc-none|o_spc-small|o_spc-medium|o_spc-big" />
```

Each step of the range is separated by a [\|]{.title-ref}. Here, each
class name corresponds to a step.

![Add a toggle switch.](building_blocks/we-range.jpg){width="300px"}

##### [\<we-input\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_input}

Formats the option as a text field.

``` {.xml emphasize-lines="3-5" caption="`data-unit`, `data-save-unit` and `data-step` are optional"}
<we-input
   string="Speed"
   data-unit="s"
   data-save-unit="ms"
   data-step="0.1" />
```

![Add a text field.](building_blocks/we-input.jpg){width="300px"}

[\<we-input\>]{.title-ref} comes with optional attributes particularly
useful in specific case:

  --------------------------------------------------------------------------------
  Attribute                      Description
  ------------------------------ -------------------------------------------------
  [data-unit]{.title-ref}        Shows the expected unit of measure.

  [data-save-unit]{.title-ref}   Set the unit of measure to which the value
                                 entered by the user is converted and saved.

  [data-step]{.title-ref}        Set the numerical value by which the field can be
                                 incremented.
  --------------------------------------------------------------------------------

##### [\<we-colorpicker\>]{.title-ref} {#website_themes/building_blocks/custom/options/layout_fields/we_colorpicker}

Formats the option as a color/gradient to choose from.

``` xml
<we-colorpicker
   string="Color filter"
   data-select-style="true"
   data-css-property="background-color"
   data-color-prefix="bg-"
   data-apply-to=".s_map_color_filter" />
```

![Add a colorpicker.](building_blocks/we-colorpicker.jpg){width="300px"}

  -----------------------------------------------------------------------------------
  Attribute                         Description
  --------------------------------- -------------------------------------------------
  [data-select-style]{.title-ref}   Refers to [selectStyle]{.title-ref} JavaScript
                                    method. Matchs the value of the
                                    [style=\"\"]{.title-ref} attribute applied on the
                                    target to thick the right option choice.

  [data-css-property]{.title-ref}   Define the CSS property targeted by the
                                    colorpicker.

  [data-color-prefix]{.title-ref}   Define the prefix applied to the CSS class
                                    returned.

  [data-apply-to]{.title-ref}       Set the element on which the color is applied.
  -----------------------------------------------------------------------------------

#### Methods {#website_themes/building_blocks/custom/options/methods}

Beside *binding options* allowing to select, target or exclude an
element. Option fields have several useful data attributes refering to
standard JavaScript methods.

For example, [data-select-class]{.title-ref} refers to the JavaScript
method named [selectClass]{.title-ref}.

##### Built-in methods {#website_themes/building_blocks/custom/options/methods/builtin}

###### Selection {#website_themes/building_blocks/custom/options/methods/builtin/selection}

There are several built-in methods available. They are callable by using
the related data attribute directly into the XML template.

  --------------------------------------------------------------------------------------------
  Data attributes                               Description
  --------------------------------------------- ----------------------------------------------
  [data-select-class]{.title-ref}               Allows to select one and only one class in the
                                                option classes set and set it on the
                                                associated snippet.

  [data-select-data-attribute]{.title-ref} +    Allows to select a value and set it on the
  [data-attribute-name]{.title-ref}             associated snippet as an attribute. The
                                                attribute name is given by the
                                                [data-attribute-name]{.title-ref} attribute.

  [data-select-property]{.title-ref} +          Allows to select a value and set it on the
  [data-property-name]{.title-ref}              associated snippet as a property. The
                                                attribute name is given by the
                                                [data-property-name]{.title-ref} attribute.

  [data-select-style]{.title-ref} +             Allows to select a value and set it on the
  [data-css-property]{.title-ref}               associated snippet as a CSS style. The
                                                attribute name is given by the
                                                [data-css-property]{.title-ref} attribute.

  [data-select-color-combination]{.title-ref}   Enable the selection of a color palette.
                                                **Only for** [\<we-colorpicker\>]{.title-ref}
  --------------------------------------------------------------------------------------------

###### Events {#website_themes/building_blocks/custom/options/methods/builtin/events}

There are also built-in methods directly linked to events the Website
Builder listens to:

  -----------------------------------------------------------------------
  Name           Description
  -------------- --------------------------------------------------------
  start          Occurs when the publisher selects the snippet for the
                 first time in an editing session or when the snippet is
                 drag-and-dropped on the page.

  destroy        Occurs after the publisher has saved the page.

  onFocus        Occurs each time the snippet is selected by the user or
                 when the snippet is drag-and-dropped on the page.

  onBlur         Occurs when a snippet loses focus.

  onClone        Occurs just after a snippet is duplicated.

  onRemove       Occurs just before the snippet is removed.

  onBuilt        Occurs just after the snippet is drag-and-dropped on a
                 drop zone. When this event is triggered, the content is
                 already inserted in the page.

  cleanForSave   Occurs before the publisher saves the page.
  -----------------------------------------------------------------------

::: seealso
\- [Web Editor - JavaScript methods related to snippet options on
GitHub](https://github.com/odoo/odoo/blob/380c9153b5fa9a0ea6d7ae485ef52a16ae999eda/addons/web_editor/static/src/js/editor/snippets.options.js#L3247) -
[XML templates of the different
snippets](https://github.com/odoo/odoo/blob/ccb78f7af2a4413836a969ff8009dc3df6c2df33/addons/website/views/snippets/snippets.xml)
:::

##### Custom methods {#website_themes/building_blocks/custom/options/methods/custom}

To create custom JavaScript methods, a link between the options group
and the custom methods has to be created. To do so, a JavaScript class
has to be created and called in the XML template with
[data-js]{.title-ref}.

Add the [data-js]{.title-ref} attribute to your options group:

``` {.xml emphasize-lines="3"}
<template id="s_airproof_snippet_options" inherit_id="website.snippet_options" name="Airproof - Snippets Options">
   <xpath expr="." position="inside">
      <div data-selector=".s_airproof_snippet" data-js="airproofSnippet">
         // Options
      </div>
   </xpath>
</template>
```

Then, the class can be created in a JavaScript file:

``` {.javascript caption="``/website_airproof/static/src/s_airproof_snippet/options.js``"}
/** @odoo-module */

import options from 'web_editor.snippets.options';

const AirproofSnippet = options.Class.extend({
   // Built-in method example
   start: function() {
      //...
   }
   // Custom method example
   customMethodName: function() {
      //...
   }
});

options.registry.AirproofSnippet = AirproofSnippet;

export default AirproofSnippet;
```

Finally, the custom method can be called on your custom option through
the XML template:

``` {.xml emphasize-lines="3"}
<template id="s_airproof_snippet_options" inherit_id="website.snippet_options" name="Airproof - Snippets Options">
   <xpath expr="." position="inside">
      <div data-selector=".s_airproof_snippet" data-js="airproofSnippet">
         <we-checkbox data-custom-method-name="" />
      </div>
   </xpath>
</template>
```

### Dynamic Content templates {#website_themes/building_blocks/custom/dynamic}

By default, Dynamic Content blocks have a selection of templates
available in the Website Builder. Custom templates can also be added to
the list automatically by use the same naming convention for the
template id attribute.

#### Call the template {#website_themes/building_blocks/custom/dynamic/call}

The selected dynamic snippet replace the [\<div
class=\"dynamic_snippet_template\"/\>]{.title-ref} placeholder by the
right template based on the [data-template-key]{.title-ref} and the
custom CSS class:

``` {.xml emphasize-lines="3,4"}
<section
   data-snippet="s_blog_posts"
   data-name="Blog Posts"
   class="s_blog_post_airproof s_dynamic_snippet_blog_posts s_blog_posts_effect_marley s_dynamic pb32 o_cc o_cc2 o_dynamic_empty"
   data-template-key="website_airproof.dynamic_filter_template_blog_post_airproof"
   data-filter-by-blog-id="-1"
   data-number-of-records="3"
   data-number-of-elements="3"
>
   <div class="container o_not_editable">
      <div class="css_non_editable_mode_hidden">
            <div class="missing_option_warning alert alert-info rounded-0 fade show d-none d-print-none">
               Your Dynamic Snippet will be displayed here... This message is displayed because you did not provided both a filter and a template to use.<br/>
            </div>
      </div>
      <div class="dynamic_snippet_template"/>
   </div>
</section>
```

#### Examples {#website_themes/building_blocks/custom/dynamic/examples}

:::::: tabs
::: tab
Blog posts

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="dynamic_filter_template_blog_post_airproof" name="...">
   <div t-foreach="records" t-as="data" class="s_blog_posts_post">
      <t t-set="record" t-value="data['_record']"/>
      <!-- Content -->
   </div>
</template>
```

  -----------------------------------------------------------------------
  Attribute      Description
  -------------- --------------------------------------------------------
  id             The ID of the template. Has to start with
                 [dynamic_filter_template_blog_post\_]{.title-ref}

  name           Human-readable name of the template
  -----------------------------------------------------------------------
:::

::: tab
Products

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="dynamic_filter_template_product_product_airproof" name="...">
   <t t-foreach="records" t-as="data" data-number-of-elements="4" data-number-of-elements-sm="1" data-number-of-elements-fetch="8">
      <t t-set="record" t-value="data['_record']"/>
      <!-- Content -->
   </t>
</template>
```

  -----------------------------------------------------------------------------------------
  Attribute                       Description
  ------------------------------- ---------------------------------------------------------
  id                              The ID of the template. Has to start with
                                  [dynamic_filter_template_product_product\_]{.title-ref}

  name                            Human-readable name of the template

  data-number-of-elements         Number of products per slide on desktop

  data-number-of-elements-sm      Number of products per slide on mobile

  data-number-of-elements-fetch   The total amount of fetched products
  -----------------------------------------------------------------------------------------
:::

::: tab
Events

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="dynamic_filter_template_event_event_airproof" name="...">
   <div t-foreach="records" t-as="data" class="s_events_event">
      <t t-set="record" t-value="data['_record']._set_tz_context()"/>
      <!-- Content -->
   </div>
</template>
```

  -----------------------------------------------------------------------
  Attribute      Description
  -------------- --------------------------------------------------------
  id             The ID of the template. Has to start with
                 [dynamic_filter_template_event_event\_]{.title-ref}

  name           Human-readable name of the template
  -----------------------------------------------------------------------
:::
::::::




--- SOURCE: developer/howtos/website_themes/forms.md ---

# Forms

Forms in Odoo are very powerful. They are directly integrated with other
applications and can be used for many different purposes.

In this chapter, you will discover how to:

- Add a form in your custom theme.
- Change the action of the form.
- Stylize the form thanks to Bootstrap variables.

## Default form {#website_themes/forms/default_forms }

To add a form to a page, copy and paste the code generated by the
Website Builder in the page.

It should look something like the following.

``` xml
<form
   action="/website/form/" method="post"
   enctype="multipart/form-data"
   class="o_mark_required"
   data-mark="*" data-pre-fill="true"
   data-success-mode="redirect"
   data-success-page="/contactus-thank-you"
   data-model_name="mail.mail">
     <div class="s_website_form_rows row s_col_no_bgcolor">
          <div class="form-group s_website_form_field col-12 s_website_form_dnone" data-name="Field">
               <!-- Form fields -->
           </div>
     </div>
</form>
```

## Actions {#website_themes/forms/actions }

There is a [data-model_name]{.title-ref} in the form tag. It enables you
to define different actions for your form.

Send an email (this action is used by default).

``` xml
<form data-model_name="mail.mail">
```

Apply for a job.

``` xml
<form data-model_name="hr.applicant">
```

Create a customer.

``` xml
<form data-model_name="res.partner">
```

Create a ticket.

``` xml
<form data-model_name="helpdesk.ticket">
```

Create an opportunity.

``` xml
<form data-model_name="crm.lead">
```

Create a task.

``` xml
<form data-model_name="project.task">
```

:::: note
::: title
Note
:::

The default action is `Send an E-mail`{.interpreted-text
role="guilabel"} but following the Apps installed on the database, some
other options can be found, such as: Apply for a job, create a customer,
create a ticket, create an opportunity, etc.

Please, note that some of these actions may need specific required
fields in order to be functional. To not forget some requirements, we
highly recommend to preset the form snippet with the Website Builder and
copy/paste the generated source code.
::::

## Success {#website_themes/forms/success }

Define what happens once the form is submitted thanks to the
[data-success-mode]{.title-ref} attribute.

Redirect the user to a page defined in the
[data-success-page]{.title-ref}.

``` xml
<form data-success-mode="redirect" data-success-page="/contactus-thank-you">
```

Show a message (on the same page).

``` xml
<form data-success-mode="message">
```

Add a success message directly under the form tag. Always add the
[d-none]{.title-ref} class to make sure that the success message is
hidden if the form hasn\'t been submitted.

``` xml
<div class="s_website_form_end_message d-none">
     <div class="oe_structure">
          <section class="s_text_block pt64 pb64" data-snippet="s_text_block">
               <div class="container">
                     <h2 class="text-center">This is a success!</h2>
               </div>
          </section>
     </div>
</div>
```




--- SOURCE: developer/howtos/website_themes/going_live.md ---

# Going live

Once all the web design and development work finished, it\'s time to
deploy it on a development or production database.

## Module import {#website_themes/going_live/module_import}

### Odoo SaaS {#website_themes/going_live/module_import/saas}

Follow these steps the first time you import a module:

1.  Create a ZIP file of your module.
2.  Connect to the project database.
3.  Enable the `developer mode <developer-mode>`{.interpreted-text
    role="ref"}.
4.  Go to `Apps`{.interpreted-text role="guilabel"}, search for
    [base_import_module]{.title-ref}, and install it if necessary.
5.  Click on `Import Module`{.interpreted-text role="guilabel"} in the
    menu.
6.  Upload your ZIP file, tick `Force init`{.interpreted-text
    role="guilabel"}, and click the `Import App`{.interpreted-text
    role="guilabel"} button.

![Import a module on Odoo Online](going_live/screenshot-import-module.png)

If you need to re-import a module after making some changes, follow the
same steps, but before importing the module, open the developer menu and
select `Become Superuser`{.interpreted-text role="guilabel"}. To leave
the Superuser mode, log out and log back in.

:::: important
::: title
Important
:::

\- Don\'t forget to untick `Force init`{.interpreted-text
role="guilabel"} if you import a module for the second time. Otherwise,
existing data might be lost.
(`Related to noupdate=1 <website_themes/pages/theme_pages/noupdate>`{.interpreted-text
role="ref"}). - The ZIP file size must be less than 50 MB.
::::

::: seealso
\- [Odoo eLearning: Register a Free Domain
Name](https://www.odoo.com/slides/slide/register-a-free-domain-name-1663)
:::

### Odoo.sh {#website_themes/going_live/module_import/sh}

Go to `Apps`{.interpreted-text role="guilabel"} and click on
`Update Apps List`{.interpreted-text role="guilabel"} in the menu.
Search for your module in the list and install it.

::: seealso
`Introduction to Odoo.sh <../../../administration/odoo_sh/overview/introduction>`{.interpreted-text
role="doc"}
:::

## What\'s next? {#website_themes/going_live/whats_next}

After importing and installing the module and before going live, make
sure to check the SEO and redirects as well as your domain name.

::: seealso
**SEO & Redirects**

- `../../../applications/websites/website/pages/seo`{.interpreted-text
  role="doc"}
- `website/URL-redirection`{.interpreted-text role="ref"}

**Domain name**

- `domain-name/existing`{.interpreted-text role="ref"}
:::




--- SOURCE: developer/howtos/website_themes/gradients.md ---

# Gradients

In this chapter, you will discover how to:

- Add a gradient to a section or a title.
- Add a custom gradient to the Website Builder palette.

## Standard {#website_themes/gradients/standard}

In standard, several gradients can be selected directly from the Website
Builder. However, for custom themes, gradients have to be added directly
in the [section]{.title-ref} tag with a [style]{.title-ref} attribute.

**Use**

``` xml
<section class="s_text_image" data-snippet="s_text_image" data-name="Text - Image" style="background-image: linear-gradient(135deg, rgb(255, 204, 51) 0%, rgb(226, 51, 255) 100%) !important;">
    <!-- Content -->
</section>
```

To apply a gradient to text, use a [font]{.title-ref} tag with the
[text-gradient]{.title-ref} class.

``` xml
<h2>
    <font class="text-gradient" style="background-image: linear-gradient(135deg, rgb(203, 94, 238) 0%, rgb(75, 225, 236) 100%);">A Section Subtitle</font>
</h2>
```

## Custom {#website_themes/gradients/custom}

Add a custom gradient to the Website Builder. This way, the user can
easily use them without manually recreating them.

``` {.xml caption="``/website_airproof/data/gradients.xml``"}
<record id="colorpicker" model="ir.ui.view">
   <field name="key">website_airproof.colorpicker</field>
   <field name="name">Custom Gradients</field>
   <field name="type">qweb</field>
   <field name="inherit_id" ref="web_editor.colorpicker"/>
   <field name="arch" type="xml">
      <xpath expr="//div[@data-name='predefined_gradients']/t[@t-set='gradients']" position="after">
         <t t-set="gradients" t-value="gradients + ['linear-gradient(135deg, rgb(203, 94, 238) 0%, rgb(75, 225, 236) 100%)']" />
      </xpath>
   </field>
</record>
```




--- SOURCE: developer/howtos/website_themes/layout.md ---

# Layout

In this chapter, you will learn how to:

- Create a custom header.
- Create a custom footer.
- Modify a standard template.
- Add a copyright section.
- Improve your website\'s responsiveness.

## Default {#website_themes/layout/default }

An Odoo page combines cross-page and unique elements. Cross-page
elements are the same on every page, while unique elements are only
related to a specific page. By default, a page has two cross-page
elements, the header and the footer, and a unique main element that
contains the specific content of that page.

``` xml
<div id="wrapwrap">
   <header/>
      <main>
         <div id="wrap" class="oe_structure">
            <!-- Page Content -->
         </div>
      </main>
   <footer/>
</div>
```

Any Odoo XML file starts with encoding specifications. After that, you
must write your code inside an [\<odoo\>]{.title-ref} tag.

``` xml
<?xml version="1.0" encoding="utf-8" ?>
<odoo>
   ...
</odoo>
```

:::: note
::: title
Note
:::

Using precise template names is important to find information through
all modules quickly. Template names should only contain lowercase
alphanumerics and underscores.

Always add an empty line at the end of your file. This can be done
automatically by configuring your IDE.
::::

## XPath {#website_themes/layout/xpath }

XPath (XML Path Language) is an expression language that enables you to
navigate through elements and attributes in an XML document easily.
XPath is used to extend standard Odoo templates.

A view is coded the following way.

``` xml
<template id="..." inherit_id="..." name="...">
   <!-- Content -->
</template>
```

  -----------------------------------------------------------------------
  Attribute      Description
  -------------- --------------------------------------------------------
  id             ID of the modified view

  inherited_id   ID of the standard view (using the following pattern:
                 [module.template]{.title-ref})

  name           Human-readable name of the modified view
  -----------------------------------------------------------------------

For each XPath, you modify two attributes: **expression** and
**position**.

::: {.example caption="``/website_airproof/views/website_templates.xml``"}
.. code-block:: xml

\<template id=\"layout\" inherit_id=\"website.layout\" name=\"Welcome Message\"\>

:   

    \<xpath expr=\"//header\" position=\"before\"\>

    :   \<!\-- Content \--\>

    \</xpath\>

\</template\>

This XPath adds a welcome message right before the page content.
:::

:::: warning
::: title
Warning
:::

Be careful when replacing default elements\' attributes. As your theme
extends the default one, your changes will take priority over any future
Odoo update.
::::

:::: note
::: title
Note
:::

\- You should update your module every time you create a new template or
record. - *XML IDs* of inheriting views should use the same *ID* as the
original record. It helps to find all inheritance at a glance. As final
*XML IDs* are prefixed by the module that creates them, there is no
overlap.
::::

### Expressions {#website_themes/layout/xpath/expressions }

XPath uses path expressions to select nodes in an XML document.
Selectors are used inside the expression to target the right element.
The most useful ones are listed below.

  -----------------------------------------------------------------------
  Descendent     Description
  selectors      
  -------------- --------------------------------------------------------
  /              Selects from the root node.

  //             Selects nodes in the document from the current node that
                 matches the selection no matter where they are.
  -----------------------------------------------------------------------

  ------------------------------------------------------------------------------------
  Attribute selectors         Description
  --------------------------- --------------------------------------------------------
  \*                          Selects any XML tag. [\*]{.title-ref} can be replaced by
                              a specific tag if the selection needs to be more
                              precise.

  \*\[@id=\"id\"\]            Selects a specific ID.

  \*\[hasclass(\"class\")\]   Selects a specific class.

  \*\[@name=\"name\"\]        Selects a tag with a specific name.

  \*\[@t-call=\"t-call\"\]    Selects a specific t-call.
  ------------------------------------------------------------------------------------

### Position {#website_themes/layout/xpath/position }

The position defines where the code is placed inside the template. The
possible values are listed below:

  -----------------------------------------------------------------------
  Position       Description
  -------------- --------------------------------------------------------
  replace        Replaces the targeted node with the XPath content.

  inside         Adds the XPath content inside the targeted node.

  before         Adds the XPath content before the targeted node.

  after          Adds the XPath content after the targeted node.

  attributes     Adds the XPath content inside an attribute.
  -----------------------------------------------------------------------

::: example
This XPath removes the first element with a [.breadcrumb]{.title-ref}
class.

``` xml
<xpath expr="//*[hasclass('breadcrumb')]" position="replace"/>
```

This XPath adds an extra [\<li\>]{.title-ref} element after the last
child of the [\<ul\>]{.title-ref} element.

``` xml
<xpath expr="//ul" position="inside">
   <li>Last element of the list</li>
</xpath>
```

This XPath adds a [\<div\>]{.title-ref} before the [\<nav\>]{.title-ref}
that is a direct child of the [\<header\>]{.title-ref}.

``` xml
<xpath expr="//header/nav" position="before">
   <div>Some content before the header</div>
</xpath>
```

This XPath removes [x_airproof_header]{.title-ref} in the class
attribute of the header. In this case, you don\'t need to use the
[separator]{.title-ref} attribute.

``` xml
<xpath expr="//header" position="attributes">
   <attribute name="class" remove="x_airproof_header" />
</xpath>
```

This XPath adds [x_airproof_header]{.title-ref} in the class attribute
of the header. You also need to define a [separator]{.title-ref}
attribute to add a space before the class you are adding.

``` xml
<xpath expr="//header" position="attributes">
   <attribute name="class" add="x_airproof_header" separator=" "/>
</xpath>
```

This XPath moves the element with [.o_footer_scrolltop_wrapper]{.title-ref} class before the element with the

:   [footer]{.title-ref} ID attribute.

``` xml
<xpath expr="//div[@id='footer']" position="before">
   <xpath expr="//div[@id='o_footer_scrolltop_wrapper']" position="move" />
</xpath>
```
:::

::::: tip
::: title
Tip
:::

Using [move]{.title-ref} directives inside an other XPath forces you to
use only this kind of directives.

::: example
\| **Good example:**

``` xml
<xpath expr="//*[hasclass('o_wsale_products_main_row')]" position="before">
<xpath expr="//t[@t-if='opt_wsale_categories_top']" position="move" />
</xpath>
<xpath expr="//*[hasclass('o_wsale_products_main_row')]" position="before">
<div><!-- Content --></div>
</xpath>
```

| **Bad example:**

``` xml
<xpath expr="//*[hasclass('o_wsale_products_main_row')]" position="before">
<xpath expr="//t[@t-if='opt_wsale_categories_top']" position="move" />
<div><!-- Content --></div>
</xpath>
```
:::
:::::

::: seealso
You can find more information about XPath in this [cheat
sheet](https://devhints.io/xpath).
:::

## QWeb {#website_themes/layout/qweb }

QWeb is the primary templating engine used by Odoo. It is an XML
templating engine mainly used to generate HTML fragments and pages.

::: seealso
`QWeb templates documentation <../../reference/frontend/qweb>`{.interpreted-text
role="doc"}.
:::

## Custom fields {#website_themes/layout/custom_fields }

Depending on your needs, you can create custom fields to save data in
the database.

### Declaration {#website_themes/layout/custom_fields/declaration }

First, create a record to declare the field. This field has to be linked
to an existing model.

``` {.xml caption="``/website_airproof/data/fields.xml``"}
<record id="x_post_category" model="ir.model.fields">
   <field name="name">x_post_category</field>
   <field name="field_description">...</field>
   <field name="ttype">html</field>
   <field name="state">manual</field>
   <field name="index">0</field>
   <field name="model_id" ref="website_blog.model_blog_post"/>
</record>
```

:::: note
::: title
Note
:::

Fields creation is also possible (and recommended) through [a model
using Python](/developer/tutorials/backend).
::::

### Back-end {#website_themes/layout/custom_fields/backend }

Add the field to the relevant view through an XPath. Therefore, the user
can see the field in the interface and fill it afterwards.

``` {.xml caption="``/website_airproof/views/backend/website_blog_views.xml``"}
<record id="view_blog_post_form_category" model="ir.ui.view">
   <field name="name">view_blog_post_form_category</field>
   <field name="model">blog.post</field>
   <field name="inherit_id" ref="website_blog.view_blog_post_form"/>
   <field name="arch" type="xml">
      <xpath expr="//field[@name='blog_id']" position="before">
         <field name="x_post_category" string="..." placeholder="..."/>
      </xpath>
   </field>
</record>
```

### Front-end {#website_themes/layout/custom_fields/frontend }

The field value can be shown somewhere in a page by calling
[model_name.field_name]{.title-ref} like this:

``` {.xml caption="``/website_airproof/views/website_blog_templates.xml``"}
<h1 t-field="blog_post.x_post_category"/>
```

## Background {#website_themes/layout/background }

You can define a color or an image as the background of your website.

### Colors {#website_themes/layout/background/colors }

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-color-palettes: map-merge($o-color-palettes,
   (
      'airproof': (
         'o-cc1-bg':                     'o-color-5',
         'o-cc5-bg':                     'o-color-1',
      ),
    )
);
```

### Image/pattern {#website_themes/layout/background/image_pattern }

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'body-image': '/website_airproof/static/src/img/background-lines.svg',
      'body-image-type': 'image' or 'pattern'
   )
);
```

## Header {#website_themes/layout/header }

By default, the header contains a responsive navigation menu and the
company\'s logo. You can easily add new elements or create your own
template.

### Standard {#website_themes/layout/header/standard }

Enable one of the header default templates.

::::: important
::: title
Important
:::

Don\'t forget that you may need to disable the active header template
first.

::: example
``` {.xml caption="``/website_aiproof/data/presets.xml``"}
<record id="website.template_header_default" model="ir.ui.view">
   <field name="active" eval="False"/>
</record>
```
:::
:::::

Explicitly set the desired template in the
[primary_variables.scss]{.title-ref} file.

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'header-template': 'Contact',
   ),
);
```

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="website.template_header_contact" model="ir.ui.view">
   <field name="active" eval="True"/>
</record>
```

### Custom {#website_themes/layout/header/custom }

Create your own template and add it to the list.

:::: important
::: title
Important
:::

Don\'t forget that you may need to disable the active header template
first before enabling the custom one.
::::

**Option**

Use the following code to add an option for your new custom header on
the Website Builder.

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="template_header_opt" inherit_id="website.snippet_options" name="Header Template - Option">
   <xpath expr="//we-select[@data-variable='header-template']" position="inside">
      <we-button title="airproof"
         data-customize-website-views="website_airproof.header"
         data-customize-website-variable="'airproof'"  data-img="/website_airproof/static/src/img/wbuilder/template_header_opt.svg"/>
   </xpath>
</template>
```

  ------------------------------------------------------------------------------------------
  Attribute                         Description
  --------------------------------- --------------------------------------------------------
  data-customize-website-views      The template to enable

  data-customize-website-variable   The name given to the variable

  data-img                          The thumbnail of the custom template shown in the
                                    templates selection on the Website Builder
  ------------------------------------------------------------------------------------------

Now you have to explicitly define that you want to use your custom
template in the Odoo SASS variables.

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'header-template': 'airproof',
   ),
);
```

**Template**

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="header" inherit_id="website.layout" name="Airproof - Header" active="True">
   <xpath expr="//header//nav" position="replace">
      <!-- Static Content -->
      <!-- Components -->
      <!-- Editable areas -->
   </xpath>
</template>
```

### Components {#website_themes/layout/header/components }

In your custom header, you can call several sub-templates using the
[t-call]{.title-ref} directive from QWeb:

#### Logo {#website_themes/layout/header/components/logo }

``` xml
<t t-call="website.placeholder_header_brand">
   <t t-set="_link_class" t-valuef="..."/>
</t>
```

:::: important
::: title
Important
:::

Don\'t forget to
`create a record of the website logo <website_themes/media/images/use/logo>`{.interpreted-text
role="ref"} logo in the database.
::::

#### Menu {#website_themes/layout/headers/components/menu }

``` xml
<t t-foreach="website.menu_id.child_id" t-as="submenu">
   <t t-call="website.submenu">
      <t t-set="item_class" t-valuef="nav-item"/>
      <t t-set="link_class" t-valuef="nav-link"/>
   </t>
</t>
```

#### Sign in {#website_themes/layout/header/components/signin }

``` xml
<t t-call="portal.placeholder_user_sign_in">
   <t t-set="_item_class" t-valuef="nav-item"/>
   <t t-set="_link_class" t-valuef="nav-link"/>
</t>
```

#### User dropdown {#website_themes/layout/header/components/user_dropdown }

``` xml
<t t-call="portal.user_dropdown">
   <t t-set="_user_name" t-value="true"/>
   <t t-set="_icon" t-value="false"/>
   <t t-set="_avatar" t-value="false"/>
   <t t-set="_item_class" t-valuef="nav-item dropdown"/>
   <t t-set="_link_class" t-valuef="nav-link"/>
   <t t-set="_dropdown_menu_class" t-valuef="..."/>
</t>
```

#### Language selector {#website_themes/layout/header/components/language_selector }

``` xml
<t t-call="website.placeholder_header_language_selector">
   <t t-set="_div_classes" t-valuef="..."/>
</t>
```

#### Call to action {#website_themes/layout/header/components/cta }

``` xml
<t t-call="website.placeholder_header_call_to_action">
   <t t-set="_div_classes" t-valuef="..."/>
</t>
```

#### Navbar toggler {#website_themes/layout/header/components/navbar_toggler }

``` xml
<t t-call="website.navbar_toggler">
   <t t-set="_toggler_class" t-valuef="..."/>
</t>
```

::: seealso
You can add a
`header overlay <website_themes/pages/theme_pages/header_overlay>`{.interpreted-text
role="ref"} to position your header over the content of your page. It
has to be done on each page individually.
:::

## Footer {#website_themes/layout/footer }

By default, the footer contains a section with some static content. You
can easily add new elements or create your own template.

### Standard {#website_themes/layout/footer/standard }

Enable one of the default footer templates. Don\'t forget that you may
need to disable the active footer template first.

::::: important
::: title
Important
:::

Don\'t forget that you may need to disable the active footer template
first.

::: example
``` {.xml caption="``/website_aiproof/data/presets.xml``"}
<record id="website.footer_custom" model="ir.ui.view">
   <field name="active" eval="False"/>
</record>
```
:::
:::::

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'footer-template': 'Links',
   ),
);
```

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="website.template_footer_links" model="ir.ui.view">
   <field name="active" eval="True"/>
</record>
```

### Custom {#website_themes/layout/footer/custom }

Create your own template and add it to the list. Don\'t forget that you
may need to disable the active footer template first.

**Option**

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="template_footer_opt" inherit_id="website.snippet_options" name="Footer Template - Option">
   <xpath expr="//we-select[@data-variable='footer-template']" position="inside">
      <we-button title="airproof"
         data-customize-website-views="website_airproof.footer"
         data-customize-website-variable="'airproof'"
         data-img="/website_airproof/static/src/img/wbuilder/template_footer_opt.svg"/>
   </xpath>
</template>
```

**Declaration**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'footer-template': 'airproof',
   ),
);
```

**Template**

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="footer" inherit_id="website.layout" name="Airproof - Footer" active="True">
  <xpath expr="//div[@id='footer']" position="replace">
     <div id="footer" class="oe_structure oe_structure_solo" t-ignore="true" t-if="not no_footer">
        <!-- Content -->
     </div>
  </xpath>
</record>
```

## Copyright {#website_themes/layout/copyright }

There is only one template available at the moment for the copyright
bar.

To replace the content or modify its structure, you can add your own
code to the following XPath.

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="copyright" inherit_id="website.layout">
   <xpath expr="//div[hasclass('o_footer_copyright')]" position="replace">
      <div class="o_footer_copyright" data-name="Copyright">
         <!-- Content -->
      </div>
   </xpath>
</template>
```

## Drop zone {#website_themes/layout/dropzone }

Instead of defining the complete layout of a page, you can create
building blocks (snippets) and let the user choose where to drag and
drop them, creating the page layout on their own. We call this *modular
design*.

You can define an empty area that the user can fill with snippets.

``` xml
<div id="oe_structure_layout_01" class="oe_structure"/>
```

  -----------------------------------------------------------------------------------
  Class                      Description
  -------------------------- --------------------------------------------------------
  oe_structure               Define a drag-and-drop area for the user.

  oe_structure_solo          Only one snippet can be dropped in this area.

  oe_structure_not_nearest   If a building block is dropped outside of a Drop zone
                             having this class, the block will be moved in the
                             nearest Drop Zone.
  -----------------------------------------------------------------------------------

You can also populate an existing drop zone with your content.

``` xml
<template id="oe_structure_layout_01" inherit_id="..." name="...">
   <xpath expr="//*[@id='oe_structure_layout_01']" position="replace">
      <div id="oe_structure_layout_01" class="oe_structure oe_structure_solo">
         <!-- Content -->
      </div>
   </xpath>
</template>
```

## Responsive {#website_themes/layout/responsive }

Odoo in general relies on the Bootstrap framework which eases the responsiveness of your website on

:   desktop and mobile. On Odoo 16, you can mainly take action on 3
    aspects:

1.  Automatic computed font sizes depending on the device
2.  Column sizes on desktop (the columns are automatically stacked on
    mobile)
3.  Visibility conditions (Show/Hide something on desktop/mobile)

::: seealso
\- [Bootstrap documentation on display
property](https://getbootstrap.com/docs/5.1/utilities/display/)
:::

### Font sizes {#website_themes/layout/reponsive/font_sizes }

In Bootstrap 5, responsive font sizes are enabled by default, allowing
text to scale more naturally across device and viewport sizes (relying
on the [\$enable-rfs]{.title-ref} variable).

::: seealso
\- [Bootstrap documentation about responsive font
sizes](https://getbootstrap.com/docs/5.1/getting-started/rfs/)
:::

### Column sizes {#website_themes/layout/reponsive/column_sizes }

Bootstrap uses a grid made of rows and columns to layout a page. Thanks
to this structure, columns can be sized differently on mobile and
desktop. In this version, the Website Builder allows to set mobile sizes
([col-12]{.title-ref} for example) and desktop ones
([col-lg-4]{.title-ref} for example) but not the medium breakpoints
([col-md-4]{.title-ref} for example).

:::: warning
::: title
Warning
:::

The medium sizes can be set but the end-user is not able to edit them
within the Website Builder.
::::

::: seealso
\- [Bootstrap documentation on responsive
breakpoints](https://getbootstrap.com/docs/5.1/layout/breakpoints/) -
[Bootstrap documentation about the
grid](https://getbootstrap.com/docs/5.1/layout/grid/)
:::

### Visibility conditions {#website_themes/layout/reponsive/visibility_conditions }

In the Odoo Website Builder, entire sections or specific columns can be hidden on mobile or desktop.

:   This functionality leverages Bootstrap along with Odoo-specific
    classes:

- [o_snippet_mobile_invisible]{.title-ref}
- [o_snippet_desktop_invisible]{.title-ref}

Hide a section on desktop:

``` xml
<section class="s_text_block o_cc o_cc1 o_colored_level pt16 pb16 d-lg-none o_snippet_desktop_invisible" data-snippet="s_text_block" name="Text">
    <!-- Content -->
</section>
```

Hide a column on mobile:

``` xml
<section class="s_text_block o_cc o_cc1 o_colored_level pt16 pb16" data-snippet="s_text_block" name="Text">
   <div class="container s_allow_columns">
      <div class="row">
         <div class="col-12 col-lg-6 d-none d-lg-block o_snippet_mobile_invisible">
            Column 1
         </div>
         <div class="col-12 col-lg-6">
            Column 2
         </div>
      </div>
   </div>
</section>
```

  --------------------------------------------------------------------------------------
  Class                         Description
  ----------------------------- --------------------------------------------------------
  o_snippet_mobile_invisible    It tells the Website Builder that the element is hidden
                                and is using visibility conditions option.

  o_snippet_desktop_invisible   It tells the Website Builder that the element is hidden
                                **on desktop and** is using visibility conditions
                                option.

  d-none                        Hide the element in every situations.

  d-lg-block                    Show the element from the \"large\" breakpoint (on
                                desktop).
  --------------------------------------------------------------------------------------

:::: important
::: title
Important
:::

[o_snippet_mobile_invisible]{.title-ref} /
[o_snippet_desktop_invisible]{.title-ref} classes have to be specified
to keep the visibility conditions option functional. Even if an element
is hidden on desktop, the Website Builder displays a list of these
elements allowing the end-user to force show the element and edit it
without switching between mobile and desktop mode.

![Force show a hidden element on the current device.](layout/screenshot-visibility.png)
::::




--- SOURCE: developer/howtos/website_themes/media.md ---

# Media

In this chapter we will see how to include media elements such as
images, videos or icons within Odoo.

## Images {#website_themes/media/images}

Record images in the database and use them later in your design/code.
They will also be available for the end user through the *media dialog*.

![Media window](media/media-window.png)

The Website Builder supports the following image file formats: JPG, GIF,
PNG, and SVG.

:::: warning
::: title
Warning
:::

Some options offered by the Website Builder are only applicable to media
registered into a record. You might not see some options if you add an
image directly with a relative path to your module folder.
::::

### Declaration {#website_themes/media/images/declaration}

To use your images in your code and have them included in the builder\'s
gallery (so the client can reuse them), declare them like this:

``` {.xml caption="``/website_airproof/data/images.xml``"}
<record id="img_about_01" model="ir.attachment">
    <field name="name">About Image 01</field>
    <field name="datas" type="base64" file="website_airproof/static/src/img/content/img_about_01.jpg"/>
    <field name="res_model">ir.ui.view</field>
    <field name="public" eval="True"/>
</record>
```

  -----------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------
  id             The name of your image to be used in your code

  name           A descriptive name for your image

  datas          The location of your image
  -----------------------------------------------------------------------

### Use {#website_themes/media/images/use}

#### Regular images {#website_themes/media/images/use/regular}

In your xml templates, call your images as follows:

``` xml
<img src="/web/image/website_airproof.img_about_01" alt=""/>
```

Being [img_about_01]{.title-ref} the id you gave to your image.

#### Background images {#website_themes/media/images/use/background}

``` xml
<section style="background-image: url('/web/image/website_airproof.img_about_01');">
```

#### Company logo {#website_themes/media/images/use/logo}

For the company logo, the use is a little bit different. First declare
it within the [images.xml]{.title-ref} library and then call it using
the right template. For instance, to call inside the header, we will use
[\<t t-call=\"website.placeholder_header_brand\"\>]{.title-ref}.

``` {.xml caption="``/website_airproof/data/images.xml``"}
<record id="website.default_website" model="website">
    <field name="logo" type="base64" file="website_airproof/static/src/img/content/logo.png"/>
</record>
```

:::: tip
::: title
Tip
:::

To make sure that your images don\'t slow down your web page and don\'t
weigh too much, try to respect these few points:

- **Weight**: \< 200Kb.
- **Size**: not more than 1500px if not needed.
- **Extension**: use svg or jpg, png or gif.
- **Name**: no spaces, accents or special characters and separate words
  with dashes. Use relevant words whenever possible.
- Images larger than 1920px will be heavily compressed by the website
  builder. If \< 1920px, they will remain intact.
::::

## Videos {#website_themes/media/videos}

Add videos as background.

``` xml
<section class="o_background_video" data-bg-video-src="...">
    <!-- Content -->
</section>
```

  ----------------------------------------------------------------------------
  Attribute           Description
  ------------------- --------------------------------------------------------
  data-bg-video-src   Video URL.

  ----------------------------------------------------------------------------

Add videos as content.

``` xml
<div class="media_iframe_video" data-oe-expression="...">
    <div class="css_editable_mode_display" />
    <div class="media_iframe_video_size" contenteditable="false" />
    <iframe src="..."
        frameborder="0"
        contenteditable="false"
        allowfullscreen="allowfullscreen"/>
</div>
```

  -----------------------------------------------------------------------------
  Attribute            Description
  -------------------- --------------------------------------------------------
  data-oe-expression   Video URL.

  src                  Video URL.
  -----------------------------------------------------------------------------

## Icons {#website_themes/media/icons}

By default, the Font Awesome icons library is included in the Website
Builder. You can place icons anywhere using the CSS Prefix
[fa]{.title-ref} and the icon\'s name. Font Awesome is designed to be
used with inline elements. You can use [\<i\>]{.title-ref} tag for
brevity, but using a [\<span\>]{.title-ref} is more semantically
correct.

``` xml
<span class="fa fa-picture-o"/>
```

::: seealso
[Font Awesome v4 icons](https://fontawesome.com/v4/icons/)
:::

Enable the Website Builder style options.

``` xml
<span class="fa fa-2x fa-picture-o rounded-circle"/>
```

Increase the icon size (fa-2x, fa-3x, fa-4x, or fa-5x classes).

``` xml
<span class="fa fa-2x fa-picture-o"/>
```

![Icon options](media/icon-options.png)




--- SOURCE: developer/howtos/website_themes/navigation.md ---

# Navigation

You can easily modify the navigation with the Website Builder to fit
your needs.

In this chapter, you will learn how to:

- Delete and create menu items.
- Create a dropdown menu.
- Create a mega menu.

## Default {#website_themes/navigation/default}

Odoo automatically generates some basic menu items depending on the apps
you installed. For example, the Website app adds two items to the main
menu. These items are linked to pages, which are also automatically
created.

Delete default menu items.

``` {.xml caption="``/website_airproof/data/menu.xml``"}
<!-- Contact us -->
<delete model="website.menu" search="[('url','in', ['/', '/contactus']),
('website_id', '=', 1)]"/>

<!-- Shop -->
<delete model="website.menu" search="[('url','in', ['/', '/shop']),
('website_id', '=', 1)]"/>
```

## Menu item {#website_themes/navigation/menu}

**Declaration**

``` {.xml caption="``/website_airproof/data/menu.xml``"}
<record id="menu_about_us" model="website.menu">
    <field name="name">About us</field>
    <field name="url">/about-us</field>
    <field name="parent_id" search="[
        ('url', '=', '/default-main-menu'),
        ('website_id', '=', 1)]"/>
    <field name="website_id">1</field>
    <field name="sequence" type="int">10</field>
</record>
```

  -----------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------
  name           Link text

  url            Value of the href attribute

  parent_id      The menu in which the item will be added.

  website_id     The website on which the item will be added.

  sequence       Defines the link\'s position in the top menu.
  -----------------------------------------------------------------------

### New window {#website_themes/navigation/menu/new_window}

Open the link\'s URL in a new tab.

``` xml
<record id="..." model="website.menu">
    <field name="new_window" eval="True"/>
</record>
```

### External Links {#website_themes/navigation/menu/external_links}

Add a link to an external website.

``` xml
<record id="..." model="website.menu">
    <field name="url">https://www.odoo.com</field>
</record>
```

### Anchor {#website_themes/navigation/menu/anchor}

Link to a specific section of a page.

``` xml
<record id="..." model="website.menu">
    <field name="url">/about-us#our-team</field>
</record>
```

## Dropdown menu {#website_themes/navigation/dropdown}

**Declaration**

``` {.xml caption="``/website_airproof/data/menu.xml``"}
<record id="menu_services" model="website.menu">
    <field name="name">Services</field>
    <field name="website_id">1</field>
    <field name="parent_id" search="[
        ('url', '=', '/default-main-menu'),
        ('website_id', '=', 1)]"/>
    <field name="sequence" type="int">...</field>
</record>
```

Add an item to a dropdown menu.

``` xml
<record id="menu_services_item_1" model="website.menu">
    <field name="name">Item 1</field>
    <field name="url">/dropdown/item-1</field>
    <field name="website_id">1</field>
    <field name="parent_id" ref="website_airproof.menu_services"/>
    <field name="sequence" type="int">...</field>
</record>
```

  -----------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------
  parent_id      The dropdown in which the item will be added.

  -----------------------------------------------------------------------

## Mega menu {#website_themes/navigation/mega_menu}

A mega menu is a dropdown menu with additional possibilities and not
just a list of links. In a mega menu, you can use any kind of content
(text, images, icons, \...).

In Odoo, you can select a mega-menu template in the list. If you don\'t
need a custom layout, you can re-use the template structure in the
[mega_menu_content]{.title-ref} field like any static content.

**Declaration**

``` {.xml caption="``/website_airproof/data/menu.xml``"}
<record id="menu_mega_menu" model="website.menu">
    <field name="name">Mega Menu</field>
    <field name="parent_id" search="[
        ('url', '=', '/default-main-menu'),
        ('website_id', '=', 1)]"/>
    <field name="website_id">1</field>
    <field name="sequence" type="int">..</field>
    <field name="is_mega_menu" eval="True"/>
    <field name="mega_menu_classes">...</field>
    <field name="mega_menu_content" type="html">
        <section class="s_mega_menu_multi_menus py-4 o_colored_level o_cc o_cc1">
            <div class="container">
                <div class="row">
                    <div class="col-12 col-sm py-2 text-center">
                        <h4 class="o_default_snippet_text">First Menu</h4>
                        <nav class="nav flex-column">
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 1</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 2</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 3</a>
                        </nav>
                    </div>
                    <div class="col-12 col-sm py-2 text-center">
                        <h4 class="o_default_snippet_text">Second Menu</h4>
                        <nav class="nav flex-column">
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 1</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 2</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 3</a>
                        </nav>
                    </div>
                    <div class="col-12 col-sm py-2 text-center">
                        <h4 class="o_default_snippet_text">Third Menu</h4>
                        <nav class="nav flex-column">
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 1</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 2</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 3</a>
                        </nav>
                    </div>
                    <div class="col-12 col-sm py-2 text-center">
                        <h4 class="o_default_snippet_text">Last Menu</h4>
                        <nav class="nav flex-column">
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 1</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 2</a>
                            <a href="#" class="nav-link o_default_snippet_text" data-name="Menu Item">Menu Item 3</a>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </field>
</record>
```

  ----------------------------------------------------------------------------
  Field               Description
  ------------------- --------------------------------------------------------
  is_mega_menu        Enable the mega menu feature.

  mega_menu_classes   Custom classes to be added to the main element

  mega_menu_content   The default content of the mega menu
  ----------------------------------------------------------------------------

Beside that, you might need to create something more visually advanced
with a custom template. Feel free to check how the [standard
templates]({GITHUB_PATH}/addons/website/views/snippets/s_mega_menu_odoo_menu.xml)
are built in the Odoo source code.

### Custom template {#website_themes/navigation/mega_menu/custom}

Create your own template and add it to the list.

**Layout**

``` {.xml caption="``/website_airproof/views/website_templates.xml``"}
<template id="s_mega_menu_airproof" name="Airproof" groups="base.group_user">
    <section class="s_mega_menu_airproof o_cc o_cc1 pt40">
        <!-- Content -->
    </section>
</template>
```

**Option**

Use the following code to add an option for your new custom mega menu on
the Website Builder.

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="snippet_options" inherit_id="website.snippet_options" name="Airproof - Mega Menu Options">
    <xpath expr="//*[@data-name='mega_menu_template_opt']/*" position="before">
        <t t-set="_label">Airproof</t>
        <we-button t-att-data-select-label="_label"
            data-select-template="website_airproof.s_mega_menu_airproof"
            data-img="/website_airproof/static/src/img/builder/header_opt.svg"
            t-out="_label"/>
    </xpath>
</template>
```




--- SOURCE: developer/howtos/website_themes/pages.md ---

# Pages

In this chapter, you will learn how to declare static pages.

## Default pages {#website_themes/pages/default }

In Odoo, websites come with a few default static pages (Home, Contact
us, 404, \...). They are built the following way.

``` {.xml caption="`/website/data/website_data.xml`"}
<template id="website.homepage" name="Home">
   <t t-call="website.layout">
      <t t-set="pageName" t-value="'homepage'"/>
      <div id="wrap" class="oe_structure oe_empty" />
   </t>
</template>
```

Each default page is a template with its own content saved into a
record. This is the reason why,
`custom pages are created within a record <website_themes/pages/theme_pages>`{.interpreted-text
role="ref"}.

The [\<t -call=\'website.layout\'\>]{.title-ref} has some variables that
can be set:

Define the meta title.

``` xml
<t t-set="additional_title">My Page Title</t>
```

::::: tip
::: title
Tip
:::

The [t-set]{.title-ref} here does not pass the value into a
[t-value]{.title-ref} or a [t-valuef]{.title-ref} attribute. This is for
translation purpose. The content of a [t-value]{.title-ref} or a
[t-valuef]{.title-ref} is not explicitly exported for translation.
Beside that, as it\'s written in XML, a string located between an
opening and a closing tag is considered translatable by default.

::: example
**Good example:**

``` xml
<t t-set="additional_title">My title</t>
```

**Bad example:**

``` xml
<t t-set="additional_title" t-valuef="My title"/>
```
:::
:::::

Define the meta description.

``` xml
<t t-set="meta_description">This is the description of the page that will appear on Search
Engines.</t>
```

Add a CSS class to the page.

``` xml
<t t-set="pageName" t-valuef="..."/>
```

Hide the header.

``` xml
<t t-set="no_header" t-value="true"/>
```

Hide the footer.

``` xml
<t t-set="no_footer" t-value="true"/>
```

If needed, deactivate default pages.

``` {.xml caption="``/website_airproof/data/pages/home.xml``"}
<record id="website.homepage" model="ir.ui.view">
    <field name="active" eval="False"/>
</record>
```

``` {.xml caption="``/website_airproof/data/pages/contactus.xml``"}
<record id="website.contactus" model="ir.ui.view">
    <field name="active" eval="False"/>
</record>
```

Alternatively, replace the default content of these pages using XPath.

``` {.xml caption="``/website_airproof/data/pages/404.xml``"}
<template id="404" inherit_id="http_routing.404">
    <xpath expr="//*[@id='wrap']" position="replace">
        <t t-set="additional_title" t-value="'404 - Not found'"/>

        <div id="wrap" class="oe_structure">
            <!-- Content -->
        </div>
    </xpath>
</template>
```

::: seealso
\-
`Odoo Documentation on SEO <../../../applications/websites/website/pages/seo>`{.interpreted-text
role="doc"}
:::

## Theme pages {#website_themes/pages/theme_pages }

You can add as many pages as you want to your website. Instead of
defining a [\<template\>]{.title-ref}, create a page object.

**Declaration**

``` {.xml caption="``/website_airproof/data/pages/about_us.xml``"}
<odoo>
   <data noupdate="1">
      <record id="page_about_us" model="website.page">
            <field name="name">About us</field>
            <field name="is_published" eval="True"/>
            <field name="key">website_airproof.page_about_us</field>
            <field name="url">/about-us</field>
            <field name="website_id" eval="1" />
            <field name="type">qweb</field>
            <field name="arch" type="xml">
               <t t-name="website_airproof.page_about_us">
                  <t t-call="website.layout">
                     <div id="wrap" class="oe_structure">
                        <!-- Content -->
                     </div>
                  </t>
               </t>
            </field>
      </record>
   </data>
</odoo>
```

::: admonition
Multiwebsite and [website_id]{.title-ref}

In a module context, the record created above is available, by default,
on every website available on the database. It\'s preferable to specify
the [website_id]{.title-ref} of the website where the page will be
findable.
:::

  -----------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------
  name           Page name (human-readable).

  is_published   Define if the page is published (visible to visitors).

  key            View key (must be unique)

  url            Relative path where the page is reachable.

  type           View type

  arch           View architecture (the markup of your page)
  -----------------------------------------------------------------------

With [\<t t-call=\"website.layout\"\>]{.title-ref} you use the Odoo
default page layout with your code.

### [noupdate]{.title-ref} attribute {#website_themes/pages/theme_pages/noupdate }

This attribute prevents data overwriting.

``` xml
<data noupdate="1">
   <!-- Your record -->
</data>
```

**Use case**

There are several static pages created in the module. This one has been
installed on the database and the end-user has updated some of those
pages. Some bug fixes must be applied on the static pages while avoiding
any loss of changes made by the end-user.

**Problem**

In case of a module update on the database, every record declared into
the module will overwrite those existing in the database even if the
end-user has changed some of these records.

**Solution**

By wrapping the record (or all records declared in the file) into a
[\<data noupdate=\"1\"\>\</data\>]{.title-ref} tag, the record declared
is created at the first module installation but not updated after a
module update.

::: spoiler
What happens if the record has been manually deleted (e.g.: a menu item)
?

The system detects that this record doesn\'t exist and will re-create
it.
:::

::: spoiler
Is this method only valid on static page records?

Of course not. It\'s technically usable for every type of records.
:::

### Header overlay {#website_themes/pages/theme_pages/header_overlay }

Make the header background transparent and stand on top of the page
content.

``` xml
<field name="header_overlay" eval="True"/>
```

![Header overlay](pages/header-overlay.png)

:::: note
::: title
Note
:::

To create the content of a static page, use the Odoo way of doing things
in order to remain editable by the Website Builder. Please note that
Odoo takes advantage of Bootstrap framework (5.1.3).

Find the available classes and components:

- [Bootstrap cheat
  sheet](https://getbootstrap.com/docs/5.1/examples/cheatsheet/)
- [Bootstrap
  documentation](https://getbootstrap.com/docs/5.1/getting-started/introduction/)
::::




--- SOURCE: developer/howtos/website_themes/setup.md ---

# Setup

In this chapter, you will learn:

- To set up your local development environment.
- The outline of the Odoo database structure.
- To export and import an Odoo database in your local environment.
- To have an Odoo instance up and running.

## Install {#website_themes/setup/install }

There are multiple ways to
`install Odoo </administration/on_premise>`{.interpreted-text
role="doc"}, depending on the intended use case. This documentation
assumes you use the `source install
</administration/on_premise/source>`{.interpreted-text role="doc"}
(running Odoo from the source code), which is best suited for Odoo
designers and developers.

## Databases {#website_themes/setup/databases }

### Structure {#website_themes/setup/databases/structure }

Every Odoo application works similarly; they are built with the same
logic. A model contains fields and relational fields that link to other
models. Each model has views representing all its fields, with backend
and frontend views.

#### Models {#website_themes/setup/databases/models }

The basis of Odoo is models. Models use fields to record the data.
Records are stored in a database: they are therefore linked to a model.
In Odoo, you can find the different models in the backend by enabling
the `developer mode <developer-mode>`{.interpreted-text role="ref"} and
then going to
`Settings --> Technical --> Database Structure: Models`{.interpreted-text
role="menuselection"}.

![Models page](setup/models-page.png)

#### Fields {#website_themes/setup/databases/fields }

In a model, we will centralize fields (field names we need to target in
our code).

::: seealso
`/applications/studio/fields`{.interpreted-text role="doc"}
:::

##### Classic fields {#website_themes/setup/databases/fields/classic }

- Date
- Char
- Selection
- ...

##### Relational fields {#website_themes/setup/databases/fields/relational }

Relational fields call a field from another model. They allow you to
link models together and make them interact easily. In other words, when
you use a relational field, you link a record with another one (located
on another model), enabling you to retrieve the content of the fields
located on this linked record.

- **Many2one** fields are filled in by choosing one record from a list
  of records on another model (from *many* records, you select *one*).
  For example, the *customer* field on a quotation makes you choose one
  customer from a list of several customers on the *contact* model.
- **One2many** fields are reverse searches of existing many2one
  relations. For example, you could list on a contact all their existing
  quotations (from *one* record, you display *many*).
- **Many2many** fields are filled in by choosing one or several records
  from a list of records on another model. For example, you can put
  several tags on one product, and several products can use the same
  tags (from *many* records, you can select *many*).

#### Views {#website_themes/setup/databases/views }

Views define how records should be displayed to end-users. They are
specified in XML, meaning they can be edited independently from the
models they represent. They are flexible and allow deep customization of
the screens they control.

##### Backend vs. Frontend {#website_themes/setup/databases/views/backend_vs_frontend }

- **Backend views**: Kanban, List, Form, etc.
- **Frontend view**: QWeb

##### Static vs. Dynamic {#website_themes/setup/databases/views/static_vs_dynamic }

- **Static pages** have stable content, such as the homepage. You can
  define their URL and set some properties like published, indexed, etc.
- **Dynamic pages** are dynamically generated, such as the product page.
  Their URL is dynamic and is accessible to all by default (this can be
  changed by configuring access rights).

##### Base vs. Inherited vs. Duplicated {#website_themes/setup/databases/views/standard_vs_inherited }

- **Base view:** View natively implemented by Odoo. It is directly
  derived from their model. A base view should never be altered as it
  allows updating an Odoo database without overwriting a client\'s
  modification.

Modifications always take place in either a duplicated or inherited view
with some differences:

- **Inherited view** always has an [inherit_id]{.title-ref} and applies
  modifications based on the source code of the base view it inherits
  from.
- **Duplicated view** is a duplication from another one. Most of the
  time this kind of view is created by Odoo when the end-user applies
  modifications through the Website Builder. This mechanism prevents
  data loss when the module is updated because only the source view will
  be updated, not the duplicated one. If a duplicated view exists, both
  the original view and the duplicated one are visible in the list but
  only the duplicated one has an [external_id]{.title-ref} (an
  [external_id]{.title-ref} set means that the view has been created by
  the source code of a module).

### Import an existing database {#website_themes/setup/databases/import }

:::: note
::: title
Note
:::

You can directly go to the `theming`{.interpreted-text role="doc"}
chapter if you do not need to import an existing database.
::::

#### Dump {#website_themes/setup/databases/import/dump }

##### Odoo SaaS {#website_themes/setup/databases/import/saas }

1.  Log in to a user account with sufficient access rights.
2.  Go to [\<database_url\>/saas_worker/dump]{.title-ref}.

##### Odoo.sh {#website_themes/setup/databases/import/sh }

1.  Connect to Odoo.sh.

2.  Select the branch you want to back up.

3.  Choose the `BACKUPS`{.interpreted-text role="guilabel"} tab.

4.  Click the `Create Backup`{.interpreted-text role="guilabel"} button.

5.  When the process is over, a notification appears. Open it and click
    the `Go to Backup`{.interpreted-text role="guilabel"} button.

6.  Click the `Download`{.interpreted-text role="guilabel"} icon. Select
    `Testing`{.interpreted-text role="guilabel"} under
    `Purpose`{.interpreted-text role="guilabel"} and
    `With filestore`{.interpreted-text role="guilabel"} under
    `Filestore`{.interpreted-text role="guilabel"}.

    ![Download backup](setup/download-backup.png)

7.  You will receive a notification when the dump is ready to be
    downloaded. Open it and click on `Download`{.interpreted-text
    role="guilabel"} to get your dump.

    ![Database backup](setup/database-backup.png)

#### Move filestore {#website_themes/setup/databases/import/filestore }

Copy all the folders included in the filestore folder and paste them to
the following location on your computer:

- macOS: [/Users/\<User\>/Library/Application
  Support/Odoo/filestore/\<database_name\>]{.title-ref}
- Linux:
  [/home/\<User\>/.local/share/Odoo/filestore/\<database_name\>]{.title-ref}

:::: note
::: title
Note
:::

[/Library]{.title-ref} is a hidden folder.
::::

#### Database setup {#website_themes/setup/databases/import/database_setup }

Create an empty database.

``` bash
createdb <database_name>
```

Import the SQL file in the database that you just created.

``` bash
psql <database_name> < dump.sql
```

Reset the admin user password.

``` bash
psql \c
<database_name>
update res_users set login='admin', password='admin' where id=2;
```

If necessary, disable the two-factor authentication enforcing policy
option.

``` bash
psql <database-name>
update res_users set totp_secret='' where id=2;
```

## Getting started {#website_themes/setup/getting_started }

### Running Odoo {#website_themes/setup/getting_started/running_odoo }

Once all dependencies are set up, Odoo can be launched by running
[odoo-bin]{.title-ref}, the command-line interface of the server. It is
located at the root of the Odoo Community directory.

- `Running Odoo <install/source/running_odoo>`{.interpreted-text
  role="ref"}
- [Docker](https://hub.docker.com/_/odoo/)

To configure the server, you can specify command-line arguments or a
configuration file. The first method is presented below.

The `CLI <reference/cmdline>`{.interpreted-text role="ref"} offers
several functionalities related to Odoo. You can use it to
`run the server <reference/cmdline/server>`{.interpreted-text
role="ref"}, scaffold an Odoo theme, populate a database, or count the
number of lines of code.

### Shell script {#website_themes/setup/getting_started/shell_script }

A typical way to
`run the server <reference/cmdline/server>`{.interpreted-text
role="ref"} would be to add all command line arguments to a
[.sh]{.title-ref} script.

::: example
.. code-block:: xml

./odoo-bin \--addons-path=../enterprise,addons \--db-filter=\<database\>
-d \<database\> \--without-demo=all -i website \--dev=xml
:::

+--------------------------------------------------------------+--------------------------------------------------------+
| Folder                                                       | Description                                            |
+==============================================================+========================================================+
| `--addons-path <odoo-bin --addons-path>`{.interpreted-text   | Comma-separated list of directories in which modules   |
| role="option"}                                               | are stored. These directories are scanned for modules. |
+--------------------------------------------------------------+--------------------------------------------------------+
| `-d <odoo-bin --database>`{.interpreted-text role="option"}  | database(s) used when installing or updating modules.  |
|                                                              |                                                        |
| `--database <odoo-bin --database>`{.interpreted-text         |                                                        |
| role="option"}                                               |                                                        |
+--------------------------------------------------------------+--------------------------------------------------------+
| `--db-filter <odoo-bin --db-filter>`{.interpreted-text       | Hides databases that do not match the filter.          |
| role="option"}                                               |                                                        |
+--------------------------------------------------------------+--------------------------------------------------------+
| `-i <odoo-bin --init>`{.interpreted-text role="option"}      | Comma-separated list of modules to install before      |
|                                                              | running the server. (requires [-d]{.title-ref})        |
| `--init <odoo-bin --init>`{.interpreted-text role="option"}  |                                                        |
+--------------------------------------------------------------+--------------------------------------------------------+
| `-u <odoo-bin --update>`{.interpreted-text role="option"}    | Comma-separated list of modules to update before       |
|                                                              | running the server. (requires [-d]{.title-ref})        |
| `--update <odoo-bin --update>`{.interpreted-text             |                                                        |
| role="option"}                                               |                                                        |
+--------------------------------------------------------------+--------------------------------------------------------+
| `--without-demo <odoo-bin --without-demo>`{.interpreted-text | Disables demo data loading for modules installed       |
| role="option"}                                               | comma-separated; use [all]{.title-ref} for all         |
|                                                              | modules. (requires [-d]{.title-ref} and                |
|                                                              | [-i]{.title-ref})                                      |
+--------------------------------------------------------------+--------------------------------------------------------+
| `--dev <odoo-bin --dev>`{.interpreted-text role="option"}    | Comma-separated list of features. For development      |
|                                                              | purposes only. `More info                              |
|                                                              | <reference/cmdline/dev>`{.interpreted-text role="ref"} |
+--------------------------------------------------------------+--------------------------------------------------------+

### Sign in {#website_themes/setup/getting_started/signin }

After the server has started (the INFO log [odoo.modules.loading:
Modules loaded.]{.title-ref} is printed), open <http://localhost:8069>
in your web browser and log in with the base administrator account.

Type **admin** for the email and **admin** for the password.

![Welcome homepage](setup/welcome-homepage.png)

:::: tip
::: title
Tip
:::

Hit *CTRL+C* to stop the server. Do it twice if needed.
::::

### Developer mode {#website_themes/setup/getting_started/developer_mode }

The developer mode, also known as debug mode, is useful for development
as it gives access to additional tools. In the next chapters, it is
assumed that you have enabled the developer mode.

::: seealso
`/applications/general/developer_mode`{.interpreted-text role="doc"}
:::




--- SOURCE: developer/howtos/website_themes/shapes.md ---

# Shapes

Shapes are handy if you want to add personality to your website.

In this chapter, you will learn how to add standard and custom
background and image shapes.

## Background shapes {#website_themes/shapes/bg}

Background shapes are SVG files that you can add as a decorative
background in your different sections. Each shape has one or several
customizable colors, and some of them are animated.

:::: warning
::: title
Warning
:::

Odoo\'s default shapes use the Odoo default colors palette map as
reference. This way, colors will be automatically adapted to a new
palette everytime it changes:

``` scss
default_palette = {
    '1': '#3AADAA',
    '2': '#7C6576',
    '3': '#F6F6F6',
    '4': '#FFFFFF',
    '5': '#383E45',
}
```
::::

### Standard {#website_themes/shapes/bg/standard}

A large selection of default background shapes is available.

**Use**

``` xml
<section data-oe-shape-data="{'shape':'web_editor/Zigs/06'}">
    <div class="o_we_shape o_web_editor_Zigs_06"/>
    <div class="container">
        <!-- Content -->
     </div>
</section>
```

[data-oe-shape-data]{.title-ref} is a JSON object containing information
about your shape like the location of the SVG file, the repeat and flip
options, etc.

For example, you can **flip the shape** horizontally or vertically by
using the X or Y axis like this:

``` xml
<section data-oe-shape-data="{'shape':'web_editor/Zigs/06','flip':[x,y]}">
    <div class="o_we_shape o_we_flip_x o_we_flip_y o_web_editor_Zigs_06"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

#### Colors mapping {#website_themes/shapes/bg/standard/colors}

You can also change the default colors mapping of your shape either by
switching colors in the current map or by creating a alternate map
without modifying the initial one.

##### Switch colors mapping {#website_themes/shapes/bg/standard/colors/switch}

First, we can use a shape like this:

![Initial shape](shapes/shapes-initial.png)

``` xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" width="100%" height="100%">
    <defs>
        <svg id="zigs06_top" viewBox="0 0 30 30" preserveAspectRatio="xMinYMin meet" fill="#383E45" width="100%">
            <path d="M30,7.9C22.5,7.9,22.5,20,15,20S7.5,7.9,0,7.9V0h30V7.9z"/>
        </svg>
        <svg id="zigs06_bottom" viewBox="0 0 30 30" preserveAspectRatio="xMinYMax meet" fill="#FFFFFF" width="100%">
            <path d="M0,22.1C7.5,22.1,7.5,10,15,10s7.5,12.1,15,12.1V30H0V22.1z"/>
        </svg>
    </defs>
    <svg>
        <use xlink:href="#zigs06_top"/>
        <use xlink:href="#zigs06_bottom"/>
    </svg>
</svg>
```

Here, we use [#383E45]{.title-ref} and [#FFFFFF]{.title-ref} which
corresponds to the 5th and 4th colors in the Odoo\'s default color
palette.

The shape is declared as follows in SCSS:

``` {.sass caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
'Zigs/06': ('position': bottom, 'size': 30px 100%, 'colors': (4, 5), 'repeat-x': true),
```

![Shape colors](shapes/shapes-bg.jpg)

The blackish color is used at the top ([c5]{.title-ref}), the lightish
([c4]{.title-ref}) at the bottom and in between, the shape is simply
transparent.

We are going to rewrite the [colors]{.title-ref} map with some [key:
value]{.title-ref} couples:

**With color palette reference and custom color**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-bg-shapes: change-shape-colors-mapping('web_editor', 'Zigs/06', (4: 3, 5: rgb(187, 27, 152)))
```

**Or just with references**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-bg-shapes: change-shape-colors-mapping('web_editor', 'Zigs/06', (4: 3, 5: 1));
```

The [c4]{.title-ref} (white) will be replaced by [c3]{.title-ref}
(whitish) and [c5]{.title-ref} (black) by [c1]{.title-ref} (white).

**Results**

![Shape final](shapes/shapes-final.png)

![Shape final options](shapes/shapes-final-options.png)

##### Add extra colors mapping {#website_themes/shapes/bg/standard/colors/extra}

Adding extra color mapping allows you to add a color variant to the
template of a shape while keeping the original.

``` {.scss caption="``/website_airproof/static/src/scss/boostrap_overridden.scss``"}
$o-bg-shapes: add-extra-shape-colors-mapping('web_editor', 'Zigs/06', 'second', (4: 3, 5: 1));
```

``` xml
<section data-oe-shape-data="{'shape':'web_editor/Zigs/06'}">
    <div class="o_we_shape o_web_editor_Zigs_06 o_second_extra_shape_mapping"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

### Custom {#website_themes/shapes/bg/custom}

Sometimes, your design might require creating one or several custom
shapes.

Firstly, you need to create an SVG file for your shape.

``` {.xml caption="``/website_airproof/static/shapes/hexagons/01.svg``"}
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="86" height="100">
    <polygon points="0 25, 43 0, 86 25, 86 75, 43 100, 0 75" style="fill: #3AADAA;"/>
</svg>
```

Make sure to use colors from the default Odoo palette for your shape (as
explained `above <website_themes/shapes/bg>`{.interpreted-text
role="ref"}).

``` scss
default_palette = {
    '1': '#3AADAA',
    '2': '#7C6576',
    '3': '#F6F6F6',
    '4': '#FFFFFF',
    '5': '#383E45',
}
```

#### Attachment {#website_themes/shapes/bg/custom/attachment}

Declare your shape file.

``` {.xml caption="``/website_airproof/data/shapes.xml``"}
<record id="shape_hexagon_01" model="ir.attachment">
    <field name="name">01.svg</field>
    <field name="datas" type="base64" file="website_airproof/static/shapes/hexagons/01.svg"/>
    <field name="url">/web_editor/shape/illustration/hexagons/01.svg</field>
    <field name="public" eval="True"/>
</record>
```

  -----------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------
  name           Name of the shape

  datas          Path to the shape

  url            The location of your shape in the web editor. The file
                 is automatically duplicated in
                 [/web_editor/shape/illustration]{.title-ref} by the
                 Website Builder.

  public         Makes the shape available for later editing.
  -----------------------------------------------------------------------

#### SCSS {#website_themes/shapes/bg/custom/scss}

Define the styles of your shape.

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-bg-shapes: map-merge($o-bg-shapes,
    (
        'illustration': map-merge(
            map-get($o-bg-shapes, 'illustration') or (),
            (
                'hexagons/01': ('position': center center, 'size': auto 100%, 'colors': (1), 'repeat-x': true, 'repeat-y': true),
            ),
        ),
    )
);
```

  -----------------------------------------------------------------------
  Key            Description
  -------------- --------------------------------------------------------
  File location  [hexagons/01]{.title-ref} corresponds to the location of
                 your file in the [shapes]{.title-ref} folder.

  position       Defines the position of your shape.

  size           Defines the size of your shape.

  colors         Defines the color c\* you want it to have (this will
                 override the color you specified in your SVG).

  repeat-x       Defines if the shape is repeated horizontally. This key
                 is optional and only needs to be defined if set to
                 [true]{.title-ref}.

  repeat-y       Defines if the shape is repeated vertically. This key is
                 optional and only needs to be defined if set to
                 [true]{.title-ref}.
  -----------------------------------------------------------------------

#### Add the option {#website_themes/shapes/bg/custom/option}

Lastly, add your shape to the list of shapes available on the Website
Builder.

``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
<template id="snippet_options_background_options" inherit_id="website.snippet_options_background_options" name="Shapes">
    <xpath expr="//*[hasclass('o_we_shape_menu')]/*[last()]" position="after">
        <we-select-page string="Theme">
            <we-button data-shape="illustration/hexagons/01" data-select-label="Hexagon 01"/>
        </we-select-page>
    </xpath>
</template>
```

#### Use it into your pages {#website_themes/shapes/bg/custom/use}

In your XML pages, you can use your shape in the same way as the others.

``` xml
<section class="..." data-oe-shape-data="{'shape': 'illustration/hexagons/01', 'colors': 'c4': '#8595A2', 'c5': 'rgba(0, 255, 0)'}">
    <div class="o_we_shape o_illustration_hexagons_01"/>
    <div class="container">
        <!-- Content -->
    </div>
</section>
```

You can also redefine colors using the [data-oe-shape-data
attribute]{.title-ref}, but this is optional.




--- SOURCE: developer/howtos/website_themes/theming.md ---

# Theming

After your development environment is fully set up, you can start
building the skeleton of your theme module. In this chapter, you will
discover how to:

- Enable/disable the Website Builder\'s standard options and templates.
- Define the colors and fonts to use for your design.
- Get the most out of Bootstrap variables.
- Add custom styles and JavaScript.

## Theme module {#theming/module}

Odoo comes with a default theme that provides minimal structure and
layout. When you create a new theme, you are extending the default
theme.

Remember to add the directory containing your module to the
[addons-path]{.title-ref} command-line argument when running Odoo in
your development environment.

### Technical naming {#theming/module/naming}

The first step is to create a new directory.

``` xml
website_airproof
```

:::: note
::: title
Note
:::

Prefix it with [website\_]{.title-ref} and use only lowercase ASCII
alphanumeric characters and underscores.

In this documentation, we will use **Airproof** (a fictional project) as
an example.
::::

### File structure {#theming/module/structure}

Themes are packaged like any Odoo module. Even if you are designing a
basic website, you need to package its theme like a module.

    website_airproof
    ├── data
    ├── i18n
    ├── static
    │   ├── description
    │   ├── fonts
    │   ├── lib
    │   ├── shapes // Shapes for background
    │   └── src
    │       ├── img
    │       │   ├── content // For those used in the pages of your website
    │       │   └── wbuilder // For those used in the builder
    │       ├── js
    │       ├── scss // Theme specific styles
    │       └── snippets // custom snippets
    ├── views
    ├── __init__.py
    └── __manifest__.py

  -----------------------------------------------------------------------
  Folder         Description
  -------------- --------------------------------------------------------
  data           Presets, menus, pages, images, shapes, ...
                 ([\*.xml]{.title-ref})

  i18n           Translations ([\*.po]{.title-ref}, [\*.pot]{.title-ref})

  lib            External libraries ([\*.js]{.title-ref})

  static         Custom assets ([\*.jpg]{.title-ref},
                 [\*.gif]{.title-ref}, [\*.png]{.title-ref},
                 [\*.svg]{.title-ref}, [\*.pdf]{.title-ref},
                 [\*.scss]{.title-ref}, [\*.js]{.title-ref})

  views          Custom views and templates ([\*.xml]{.title-ref})
  -----------------------------------------------------------------------

### Initialization {#theming/module/initialization}

An Odoo module is also a Python package with a
`__init__.py`{.interpreted-text role="file"} file containing import
instructions for various Python files in the module. This file can
remain empty for now.

### Declaration {#theming/module/declaration}

An Odoo module is declared by its manifest file. This file declares a
Python package as an Odoo module and specifies the module\'s metadata.
It must at least contain the [name]{.title-ref} field, which is always
required. It usually contains much more information.

``` {.python caption="``/website_airproof/__manifest__.py``"}
{
   'name': 'Airproof Theme',
   'description': '...',
   'category': 'Website/Theme',
   'version': '{BRANCH}.0',
   'author': '...',
   'license': '...',
   'depends': ['website'],
   'data': [
      # ...
   ],
   'assets': {
      # ...
   },
}
```

  -----------------------------------------------------------------------------------
  Field          Description
  -------------- --------------------------------------------------------------------
  name           Human-readable name of the module (required)

  description    Extended description of the module, in
                 [reStructuredText](https://en.wikipedia.org/wiki/ReStructuredText)

  category       Classification category within Odoo

  version        Odoo version this module is addressing

  author         Name of the module author

  license        By default, we use the [LGPL-3]{.title-ref} license. More
                 information in the `module manifest
                 <reference/module/manifest>`{.interpreted-text role="ref"} page.

  depends        Odoo modules must be loaded before this one, either because this
                 module uses features they create or because it alters resources they
                 define

  data           List of XML files

  assets         List of SCSS and JS files
  -----------------------------------------------------------------------------------

:::: note
::: title
Note
:::

\- The file structure above is just a suggestion. We could add as many
other folders as needed in the project, such as
[/controllers]{.title-ref} to include controllers or
[/views/backend]{.title-ref} for backend views, etc. - To create a
website theme, you only need to install the Website app. If you need
other apps (Blogs, Events, eCommerce, \...), you can also add them. -
Odoo version and major number are mandatory. However, patch number is
optional. If you want to specify the required version of Odoo to run
your module, you should use a five arguments structure, using the first
two arguments to indicate the Odoo version.

![Module versioning](theming/versioning.png){width="300px"}
::::

:::: warning
::: title
Warning
:::

Automated file inclusion using wildcard notations [(ex.:
/myfolder/\*.scss)]{.title-ref} doesn\'t work in Odoo SaaS databases. In
this case, include each file manually in the manifest.
::::

## Default options {#theming/options}

First, try to construct your theme by using Odoo\'s default options.
This ensures two things:

1.  You do not re-invent something which already exists. For example, as
    Odoo provides an option to add a border on the footer, you
    shouldn\'t recode it yourself. Instead, enable the default option
    first, then extend it if needed.
2.  The user can still use all of Odoo\'s features with your theme. For
    example, if you recode the border on the footer, you may break the
    default option or make it useless, giving the user a bad experience.
    Also, your recode might not work as well as the default option, as
    other Odoo features may rely on it.

:::: tip
::: title
Tip
:::

\- Use four spaces per indentation level. - Do not use tabs. - Never mix
spaces and tabs.
::::

::: seealso
`Odoo coding guidelines <../../../contributing/development/coding_guidelines>`{.interpreted-text
role="doc"}
:::

### Odoo variables {#theming/module/variables}

Odoo declares many CSS rules, most entirely customizable by overriding
the related SCSS variables. To do so, create a
`primary_variables.scss`{.interpreted-text role="file"} file and add it
to the [\_assets_primary_variables]{.title-ref} bundle.

**Declaration**

``` {.python caption="``/website_airproof/__manifest__.py``"}
'assets': {
   'web._assets_primary_variables': [
      'website_airproof/static/src/scss/primary_variables.scss',
   ],
},
```

By reading the source code, variables related to options are easily
noticeable.

``` xml
<we-button title="..."
   data-name="..."
   data-customize-website-views="..."
   data-customize-website-variable="'Sidebar'"
   data-img="..."/>
```

These variables can be overridden through the
[\$o-website-value-palettes]{.title-ref} map, for example.

#### Global {#theming/module/variables/global}

**Declaration**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      // Templates
      // Colors
      // Fonts
      // Buttons
      // ...
   ),
);
```

:::: tip
::: title
Tip
:::

That file must only contain definitions and overrides of SCSS variables
and mixins.
::::

::: seealso
[Primary variables
SCSS](https://github.com/odoo/odoo/blob/34c0c9c1ae00aba391932129d4cefd027a9c6bbd/addons/website/static/src/scss/primary_variables.scss#L1954)
:::

#### Fonts {#theming/module/variables/fonts}

You can embed any font on your website. The Website Builder
automatically makes them available in the font selector.

**Declaration**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-theme-font-configs: (
   <font-name>: (
      'family': <css font family list>,
      'url' (optional): <related part of Google fonts URL>,
      'properties' (optional): (
         <font-alias>: (
            <website-value-key>: <value>,
            ...,
         ),
      ...,
   )
)
```

**Use**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'font':                             '<font-name>',
      'headings-font':                    '<font-name>',
      'navbar-font':                      '<font-name>',
      'buttons-font':                     '<font-name>',
   ),
);
```

##### Google fonts {#theming/module/variables/fonts/google}

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-theme-font-configs: (
   'Poppins': (
      'family':                         ('Poppins', sans-serif),
      'url':                            'Poppins:400,500',
      'properties' : (
         'base': (
            'font-size-base':           1rem,
         ),
      ),
   ),
);
```

##### Custom fonts {#theming/module/variables/fonts/custom}

First, create a specific SCSS file to declare your custom font(s).

``` {.python caption="``/website_airproof/__manifest__.py``"}
'assets': {
   'web.assets_frontend': [
      'website_airproof/static/src/scss/font.scss',
   ],
},
```

Then, use the [\@font-face]{.title-ref} rule to allow you custom font(s)
to be loaded on your website.

``` {.scss caption="``/website_airproof/static/src/scss/font.scss``"}
@font-face {
   font-family: "My Custom Font", Helvetica, Helvetica Neue, Arial, sans-serif;
   font-weight: 400;
   font-style: normal;
   src: url('/fonts/my-custom-font.woff') format('woff'),
        url('/fonts/my-custom-font.woff2') format('woff2');
}
```

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-theme-font-configs: (
   'Proxima Nova': (
      'family':                         ('Proxima Nova', sans-serif),
      'properties' : (
         'base': (
            'font-size-base':           1rem,
         ),
      ),
   ),
);
```

:::: tip
::: title
Tip
:::

It is recommended to use the [.woff]{.title-ref} and/or
[.woff2]{.title-ref} format for your fonts.
::::

#### Colors {#theming/module/variables/colors}

The Website Builder relies on palettes composed of five named colors.
Defining those in your theme ensures it stays consistent.

  -----------------------------------------------------------------------
  Color          Description
  -------------- --------------------------------------------------------
  o-color-1      Primary

  o-color-2      Secondary

  o-color-3      Extra (Light)

  o-color-4      Whitish

  o-color-5      Blackish
  -----------------------------------------------------------------------

![Theme colors](theming/theme-colors.png){width="300px"}

**Declaration**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-color-palettes: map-merge($o-color-palettes,
   (
      'airproof': (
         'o-color-1':                    #bedb39,
         'o-color-2':                    #2c3e50,
         'o-color-3':                    #f2f2f2,
         'o-color-4':                    #ffffff,
         'o-color-5':                    #000000,
      ),
   )
);
```

Add the created palette to the list of palettes offered by the Website
Builder.

``` scss
$o-selected-color-palettes-names: append($o-selected-color-palettes-names, 'airproof');
```

**Use**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'color-palettes-name':              'airproof',
   ),
);
```

![Theme colors Airproof](theming/theme-colors-airproof.png){width="800px"}

**Color combinations**

Based on the previously defined five color palettes, the Website Builder
automatically generates five color combinations, each defining a color
for the background, text, headings, links, primary buttons, and
secondary buttons. These colors can be customized later by the user.

![Theme colors](theming/theme-colors-big.png){width="300px"}

The colors used in a color combination are accessible and can be
overridden through [\$o-color-palettes]{.title-ref} using a specific
prefix ([o-cc]{.title-ref} for [color combination]{.title-ref}).

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-color-palettes: map-merge($o-color-palettes,
   (
      'airproof': (

         'o-cc*-bg':                     'o-color-*',
         'o-cc*-text':                   'o-color-*',
         'o-cc*-headings':               'o-color-*',
         'o-cc*-h2':                     'o-color-*',
         'o-cc*-h3':                     'o-color-*',
         'o-cc*-h4':                     'o-color-*',
         'o-cc*-h5':                     'o-color-*',
         'o-cc*-h6':                     'o-color-*',
         'o-cc*-link':                   'o-color-*',
         'o-cc*-btn-primary':            'o-color-*',
         'o-cc*-btn-primary-border':     'o-color-*',
         'o-cc*-btn-secondary':          'o-color-*',
         'o-cc*-btn-secondary-border':   'o-color-*',

      ),
   )
);
```

:::: note
::: title
Note
:::

For each [o-cc\*]{.title-ref}, replace the [\*]{.title-ref} with the
digit (1 - 5) corresponding to the desired color combination.

The default text color is [o-color-5]{.title-ref}. If the background is
too dark, it will automatically change to the [o-color-4]{.title-ref}
color.
::::

::: seealso
[Color combinations
SCSS](https://github.com/odoo/odoo/blob/34c0c9c1ae00aba391932129d4cefd027a9c6bbd/addons/web_editor/static/src/scss/web_editor.common.scss#L711)
:::

::: admonition
Demo page

The Website Builder automatically generates a page to view the color
combinations of the theme color palette:
<http://localhost:8069/website/demo/color-combinations>
:::

#### Gradients {#theming/module/variables/gradients}

You can also define gradients for the menu, header, footer and copyright
bar, directly in your [primary_variables.scss]{.title-ref} file.

**Declaration**

``` {.scss caption="``/website_airproof/static/src/scss/primary_variables.scss``"}
$o-website-values-palettes: (
   (
      'menu-gradient': linear-gradient(135deg, rgb(203, 94, 238) 0%, rgb(75, 225, 236) 100%),
      'header-boxed-gradient': [your-gradient],
      'footer-gradient': [your-gradient],
      'copyright-gradient': [your-gradient],
   ),
);
```

### Bootstrap variables {#theming/module/bootstrap}

Odoo includes Bootstrap by default. You can use all variables and mixins
of the framework.

If Odoo does not provide the variable you are looking for, there could
be a Bootstrap variable that allows it. Indeed all Odoo layouts respect
Bootstrap structures and use Bootstrap components or their extensions.
If you customize a Bootstrap variable, you add a generic style for the
whole user website.

Use a dedicated file added to the
`_assets_frontend_helpers`{.interpreted-text role="file"} bundle to
override Bootstrap values and *not* the
`primary_variables.scss`{.interpreted-text role="file"} file.

**Declaration**

``` {.python caption="``/website_airproof/__manifest__.py``"}
'assets': {
   'web._assets_frontend_helpers': [
      ('prepend', 'website_airproof/static/src/scss/bootstrap_overridden.scss'),
   ],
},
```

**Use**

``` {.scss caption="``/website_airproof/static/src/scss/bootstrap_overridden.scss``"}
// Typography
$h1-font-size:                 4rem !default;

// Navbar
$navbar-nav-link-padding-x:    1rem!default;

// Buttons + Forms
$input-placeholder-color:      o-color('o-color-1') !default;

// Cards
$card-border-width:            0 !default;
```

:::: tip
::: title
Tip
:::

That file must only contain definitions and overrides of SCSS variables
and mixins.
::::

:::: warning
::: title
Warning
:::

Don\'t override Bootstrap variables that depend on Odoo variables.
Otherwise, you might break the possibility for the user to customize
them using the Website Builder.

When an option is defined by a variable in
[primary_variables.scss]{.title-ref} and by a Boostrap variable, you
should always go for an override through the primary variables. Do it
via [bootstrap_overridden.scss]{.title-ref} only if nothing exists in
the primary variables.
::::

::: seealso
[Bootstrap overridden
SCSS]({GITHUB_PATH}/addons/web/static/lib/bootstrap/scss/_variables.scss)
:::

::: admonition
Demo page

<http://localhost:8069/website/demo/bootstrap>
:::

### Views {#theming/module/views}

For some options, in addition to the Website Builder variable, you also
have to activate a specific view.

By reading the source code, templates related to options are easily
found.

``` xml
<we-button title="..."
   data-name="..."
   data-customize-website-views="website.template_header_default"
   data-customize-website-variable="'...'"
   data-img="..."/>
```

``` xml
<template id="..." inherit_id="..." name="..." active="True"/>
<template id="..." inherit_id="..." name="..." active="False"/>
```

#### Presets {#theming/module/views/presets}

In order to activate and deactivate views as presets, you should include
those inside the [presets.xml]{.title-ref} file.

**Use**

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="module.view" model="ir.ui.view">
      <field name="active" eval="False"/>
</record>
```

::: example
**Changing the menu items\' horizontal alignment**

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="website.template_header_default_align_center" model="ir.ui.view">
   <field name="active" eval="True"/>
</record>
```

The same logic can be used for others Odoo apps as well.

**eCommerce - Display products categories**

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="website_sale.products_categories" model="ir.ui.view">
   <field name="active" eval="False"/>
</record>
```

**Portal - Disable the language selector**

``` {.xml caption="``/website_airproof/data/presets.xml``"}
<record id="portal.footer_language_selector" model="ir.ui.view">
   <field name="active" eval="False"/>
</record>
```
:::

## Assets {#theming/assets}

For this part, we will refer to the [assets_frontend]{.title-ref} bundle
located in the web module. This bundle specifies the list of assets
loaded by the Website Builder, and the goal is to add your SCSS and JS
files to the bundle.

This is a non-exhaustive list of the frequently used bundles for a
website:

  -------------------------------------------------------------------------------------------
  Bundle                             Description
  ---------------------------------- --------------------------------------------------------
  web.\_assets_primary_variables     Mainly used for the [primary_variables.scss]{.title-ref}
                                     file

  web.\_assets_secondary_variables   Mainly used for the
                                     [secondary_variables.scss]{.title-ref} file

  web.\_assets_frontend_helpers      Mainly used for the
                                     [bootstrap_overridden.scss]{.title-ref} file

  web.assets_frontend                You can add all your custom SCSS, JS or QWeb JS files

  website.assets_wysiwyg             Add your JS files related to the Website Builder options
                                     behaviors (for instance, a custom method for your custom
                                     building block)

  website.assets_wysiwyg             If you need to extend Boostrap through the Bootstrap
                                     Utilities API, for example
  -------------------------------------------------------------------------------------------

### Styles {#theming/assets/styles}

The Website Builder together with Bootstrap are great for defining the
basic styles of your website. But to design something unique, you should
go a step further. For this, you can easily add any SCSS file to your
theme.

**Declaration**

``` {.python caption="``/website_airproof/__manifest__.py``"}
'assets': {
   'web.assets_frontend': [
      'website_airproof/static/src/scss/theme.scss',
   ],
},
```

Feel free to reuse the variables from your Bootstrap file and the ones
used by Odoo in your `theme.scss`{.interpreted-text role="file"} file.

::: {.example caption="``/website_airproof/static/src/scss/theme.scss``"}
.. code-block:: javascript

blockquote {

:   border-radius: \$rounded-pill; color: o-color(\'o-color-3\');
    font-family: o-website-value(\'headings-font\');

}
:::

### Interactivity {#theming/assets/interactivity}

Odoo supports three different kinds of JavaScript files:

- `plain JavaScript files <frontend/modules/plain_js>`{.interpreted-text
  role="ref"} (no module system),
- `native JavaScript module <frontend/modules/native_js>`{.interpreted-text
  role="ref"}, and
- `Odoo modules <frontend/modules/odoo_module>`{.interpreted-text
  role="ref"} (using a custom module system).

Most new Odoo JavaScript codes should use the native JavaScript module
system. It\'s simpler and brings the benefit of a better developer
experience with better integration with the IDE.

:::: important
::: title
Important
:::

Odoo needs to know which files should be translated into `Odoo modules
<frontend/js_modules>`{.interpreted-text role="ref"} and which files
should not. It\'s an opt-in system: Odoo looks at the first line of a
JavaScript file and checks if it contains the string
[\@odoo-module]{.title-ref}. If so, it will automatically be converted
to an Odoo module.
::::

``` javascript
/** @odoo-module **/
```

**Declaration**

``` {.python caption="``/website_airproof/__manifest__.py``"}
'assets': {
   'web.assets_frontend': [
      'website_airproof/static/src/js/theme.js',
   ],
},
```

:::: note
::: title
Note
:::

If you want to include files from an external library, you can add them
to the `/lib`{.interpreted-text role="file"} folder of your module.
::::

:::: tip
::: title
Tip
:::

\- Use a linter (JSHint, \...). - Never add minified JavaScript
libraries. - Add [\'use strict\';]{.title-ref} at the top of every
old-style module (this is automatic for new-style modules). - Use
[js\_]{.title-ref} prefixed CSS classes on elements you target with
JavaScript. - Variables and functions should be *camelCased*
([myVariable]{.title-ref}) instead of *snake_cased*
([my_variable]{.title-ref}). - Do not name a variable
[event]{.title-ref}; use [ev]{.title-ref} instead. This is to avoid bugs
on non-Chrome browsers, as Chrome is magically assigning a global
[event]{.title-ref} variable (so if you use the [event]{.title-ref}
variable without declaring it, it will work fine on Chrome but crash on
every other browser). - Use strict comparisons ([===]{.title-ref}
instead of [==]{.title-ref}). - Use double quotes for all textual
strings (such as [\"Hello\"]{.title-ref}) and single quotes for all
other strings, such as a CSS selector [.x_nav_item]{.title-ref}. - If
you\'re using native standard JS functions ([start()]{.title-ref},
[willStart()]{.title-ref}, [cleanForSave()]{.title-ref}, etc), make sure
you call [this.\_super.apply(this, arguments)]{.title-ref}; (Check if
it\'s necessary in the standard code).
::::

::: seealso
\- [Odoo JavaScript coding
guidelines](https://github.com/odoo/odoo/wiki/Javascript-coding-guidelines) -
`Overview of the Odoo JavaScript framework
<../../reference/frontend/javascript_reference>`{.interpreted-text
role="doc"} - [Odoo Experience Talk: 10 Tips to take your website design
to the next
level!](https://www.youtube.com/watch?v=vAgE_fPVXUQ&ab_channel=Odoo)
:::




--- SOURCE: developer/howtos/website_themes/translations.md ---

# Translations

With Odoo, you can translate your website into different languages.

In this chapter, you will learn how to:

- Translate the content of a module.
- Import and export translations.
- Integrate translations to a module.

## Frontend {#website_themes/translations/frontend}

To translate your pages with the Website Builder, go to your website and
click on the language selector to switch to it. If your website was
never translated to the target language, click
`Add a language...`{.interpreted-text role="guilabel"}, select it in the
pop-up window, and click `Add`{.interpreted-text role="guilabel"}.

Click `Translate`{.interpreted-text role="guilabel"} to start
translating. Depending on the language, some text is automatically
translated and highlighted in green, while everything that should be
translated manually is highlighted in yellow.

![Translate button](translations/translate-button.png){width="570px"}

However, you have to understand what\'s happening under the hood when
you translate something through the Website Builder.

### Default pages {#website_themes/translations/frontend/default_pages}

Odoo creates a base view once the Website is installed. If you edit the
page with the Builder, a duplicated view will be created and all your
modifications will be saved into this one (and your translations also).
The only exception concerns the homepage (by default, Odoo creates a
base and duplicated view even before you\'ve edited anything).

![Translations dupliclated page](translations/translations-page.png)

We recommend to be very careful about the order in which you will carry
out translations or modifications in the source language, either if you
created the page through the Website Builder or through the source code
with a record. Note that every single modification of the source
language ([Edit master]{.title-ref}) will break the link between the
source language and the existing translations. In other words, you\'ll
have to re-create the translations if you edit the source language.

### Translatable strings {#website_themes/translations/frontend/strings}

::: {#website_themes/translations/frontend/strings/t-att}
t-att- / t-attf-\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~
:::

If you want to set a translatable string, use preferably
[t-attf-]{.title-ref} instead of [t-att-]{.title-ref} whenever possible.

**Example**

To write "Hello *username*", you can do it in the following way:

``` xml
<div t-attf-title="Hello #{user.name}" />
```

:::: warning
::: title
Warning
:::

You could also achieve the same result with an [t-att-title]{.title-ref}
like the example below. However, the result won\'t be considered
natively as a translatable string:

``` xml
<div t-att-title="'Hello' + user.name" />
```
::::

#### Exception: t-value / t-valuef {#website_themes/translations/frontend/strings/exception}

[t-value]{.title-ref} and [t-valuef]{.title-ref} are a bit different.
None of them are explicitly translatable, so you could write something
like this:

``` xml
<t t-set=”additional_title”>My Page Title Shown in the Browser Tab</t>
```

As we are writing XML context, text located between two XML tags are
translatable.

#### Mixing translatable and non-translatable {#website_themes/translations/frontend/strings/mixing}

In a situation where we need to set a translatable text in only one
single place:

``` xml
<t t-set=”title”>Foo</t>
```

And then we need to call it in different locations:

``` xml
<div t-att-title=”label” />
...
<nav t-att-title=”label” />
```

Here we just called the translatable content into a non-translatable
attribute ([t-att-title]{.title-ref}). So the [t-att-title]{.title-ref}
is not translatable but the casted variable is.

## Backend {#website_themes/translations/backend}

Translating pages directly from the backend allows you to translate
several languages at the same time. To do so, go to
`Settings --> Technical --> User Interface: Views`{.interpreted-text
role="menuselection"}, search for the name of the page you want to
translate, and click the `Edit Translations`{.interpreted-text
role="guilabel"} button.

![Edit translations](translations/edit-translations.png){width="718px"}

## Export {#website_themes/translations/export}

Once you are done translating, you need to export the translations to
integrate them into your module. To export everything at once, open your
database, activate `developer mode
<developer-mode>`{.interpreted-text role="ref"}, and go to
`Settings --> Translations --> Export Translation`{.interpreted-text
role="menuselection"}. Select the `Language`{.interpreted-text
role="guilabel"} you translated, *PO File* under
`File Format`{.interpreted-text role="guilabel"}, and *website_airproof*
as the `Apps To Export`{.interpreted-text role="guilabel"}.

Download the file and move it to the `i18n`{.interpreted-text
role="file"} folder. If needed, you can manually edit the
`.po`{.interpreted-text role="file"} file afterward.

## PO file {#website_themes/translations/po}

You can translate directly by editing a `.po`{.interpreted-text
role="file"} file or creating the file yourself. Check out the
`translating modules documentation <../translations>`{.interpreted-text
role="doc"} to write your translations.

``` {.po caption="``/website_coconuts/i18n/fr_BE.po``"}
#. module: website_airproof
#: model_terms:ir.ui.view,arch_db:website_airproof.s_custom_snippet
msgid "..."
msgstr "..."
```

## Import {#website_themes/translations/import}

To import your translation files into Odoo, go to
`Settings --> Translations -->
Import Translation`{.interpreted-text role="menuselection"} and upload
them.




--- SOURCE: developer/howtos/website_themes.md ---

show-content

:   

hide-page-toc

:   

show-toc

:   

# Website themes

![Artistic illustration of \"Web design\"](website_themes/web-design.png){width="600px"}

The Odoo Website Builder is an excellent tool for creating a website
fully integrated with other Odoo apps. Using the theme\'s options and
building blocks is easy and allows you to personalize your web presence
the way you want. However, you can take things even further.

In this documentation, you will learn to completely customize your
website without touching Odoo\'s core files, and this way, preserve the
editing options of the Website Builder.

The information compiled in this documentation is based on our past
experiences - both failures and successes. We invite you to use it as a
base to build your own website and adapt it to your needs.

::: {.toctree maxdepth="2"}
website_themes/setup website_themes/theming website_themes/layout
website_themes/navigation website_themes/pages website_themes/media
website_themes/building_blocks website_themes/shapes
website_themes/gradients website_themes/animations website_themes/forms
website_themes/translations website_themes/going_live
:::




--- SOURCE: developer/howtos.md ---

show-content

:   

hide-page-toc

:   

# How-to guides

::: {.toctree titlesonly=""}
howtos/scss_tips howtos/javascript_field howtos/javascript_view
howtos/javascript_client_action howtos/web_services howtos/company
howtos/create_reports howtos/accounting_localization howtos/translations
howtos/website_themes howtos/connect_device howtos/upgrade_custom_db
:::

::::::::::::::: cards
::: {.card target="howtos/scss_tips"}
Write lean easy-to-maintain CSS

Follow this guide to keep the technical debt of your CSS code under
control.
:::

::: {.card target="howtos/javascript_field"}
Customize a field

Learn how to customize field components in the Odoo JavaScript web
framework.
:::

::: {.card target="howtos/javascript_view"}
Customize a view type

Learn how to customize view types in the Odoo JavaScript web framework.
:::

::: {.card target="howtos/javascript_client_action"}
Create a client action

Learn how to create client actions in the Odoo JavaScript web framework.
:::

::: {.card target="howtos/web_services"}
Web services

Learn more about Odoo\'s web services.
:::

::: {.card target="howtos/company"}
Multi-company guidelines

Learn how to manage multiple companies and deal with the records-related
specificities of a multi-company environment.
:::

::: {.card target="howtos/create_reports"}
Create customized reports

Learn how to create customized reports with SQL Views.
:::

::: {.card target="howtos/accounting_localization"}
Accounting localization

Learn how to build a localization module, create bank operation models
and dynamic reports.
:::

::: {.card target="howtos/translations"}
Translating modules

Learn how to provide translation abilities to your module.
:::

::: {.card target="howtos/website_themes"}
Website themes

Learn how to customize your website by creating a custom theme.
:::

::: {.card target="howtos/connect_device"}
Connect with a device

Learn how to enable a module to detect and communicate with an IoT
device.
:::

::: {.card target="howtos/upgrade_custom_db"}
Upgrade a customized database

Learn how to upgrade a customized database, as well as the code and data
of its custom modules.
:::
:::::::::::::::




--- SOURCE: developer/reference/backend/actions.md ---

# Actions {#reference/actions}

Actions define the behavior of the system in response to user actions:
login, action button, selection of an invoice, \...

Actions can be stored in the database or returned directly as
dictionaries in e.g. button methods. All actions share two mandatory
attributes:

`type`

:   the category of the current action, determines which fields may be
    used and how the action is interpreted

`name`

:   short user-readable description of the action, may be displayed in
    the client\'s interface

A client can get actions in 4 forms:

- 

  `False`

  :   if any action dialog is currently open, close it

- 

  A string

  :   if a `client action <reference/actions/client>`{.interpreted-text
      role="ref"} matches, interpret as a client action\'s tag,
      otherwise treat as a number

- 

  A number

  :   read the corresponding action record from the database, may be a
      database identifier or an `external id`{.interpreted-text
      role="term"}

- 

  A dictionary

  :   treat as a client action descriptor and execute

## Bindings {#reference/bindings}

Aside from their two mandatory attributes, all actions also share
*optional* attributes used to present an action in an arbitrary model\'s
contextual menu:

`binding_model_id`

:   specifies which model the action is bound to

    :::: note
    ::: title
    Note
    :::

    For Server Actions, use `model_id`.
    ::::

`binding_type`

:   specifies the type of binding, which is mostly which contextual menu
    the action will appear under

    `action` (default)

    :   Specifies that the action will appear in the
        `Action`{.interpreted-text role="menuselection"} contextual menu
        of the bound model.

    `report`

    :   Specifies that the action will appear in the
        `Print`{.interpreted-text role="menuselection"} contextual menu
        of the bound model.

`binding_view_types`

:   a comma-separated list of view types for which the action appears in
    the contextual menu, mostly \"list\" and / or \"form\". Defaults to
    `list,form` (both list and form )

## Window Actions (`ir.actions.act_window`) {#reference/actions/window}

The most common action type, used to present visualisations of a model
through `views <reference/views>`{.interpreted-text role="ref"}: a
window action defines a set of view types (and possibly specific views)
for a model (and possibly specific record of the model).

Its fields are:

`res_model`

:   model to present views for

`views`

:   a list of `(view_id, view_type)` pairs. The second element of each
    pair is the category of the view (tree, form, graph, \...) and the
    first is an optional database id (or `False`). If no id is provided,
    the client should fetch the default view of the specified type for
    the requested model (this is automatically done by
    `~odoo.models.Model.fields_view_get`{.interpreted-text
    role="meth"}). The first type of the list is the default view type
    and will be open by default when the action is executed. Each view
    type should be present at most once in the list

`res_id` (optional)

:   if the default view is `form`, specifies the record to load
    (otherwise a new record should be created)

`search_view_id` (optional)

:   `(id, name)` pair, `id` is the database identifier of a specific
    search view to load for the action. Defaults to fetching the default
    search view for the model

`target` (optional)

:   whether the views should be open in the main content area
    (`current`), in full screen mode (`fullscreen`) or in a dialog/popup
    (`new`). Use `main` instead of `current` to clear the breadcrumbs.
    Defaults to `current`.

`context` (optional)

:   additional context data to pass to the views

`domain` (optional)

:   filtering domain to implicitly add to all view search queries

`limit` (optional)

:   number of records to display in lists by default. Defaults to 80 in
    the web client

For instance, to open customers (partner with the `customer` flag set)
with list and form views:

    {
        "type": "ir.actions.act_window",
        "res_model": "res.partner",
        "views": [[False, "tree"], [False, "form"]],
        "domain": [["customer", "=", true]],
    }

Or to open the form view of a specific product (obtained separately) in
a new dialog:

    {
        "type": "ir.actions.act_window",
        "res_model": "product.product",
        "views": [[False, "form"]],
        "res_id": a_product_id,
        "target": "new",
    }

In-database window actions have a few different fields which should be
ignored by clients, mostly to use in composing the `views` list:

`view_mode` (default= `tree,form` )

:   comma-separated list of view types as a string (/!\\ No spaces
    /!\\). All of these types will be present in the generated `views`
    list (with at least a `False` view_id)

`view_ids`

:   M2M[^1] to view objects, defines the initial content of `views`

    :::: note
    ::: title
    Note
    :::

    Act_window views can also be defined cleanly through
    `ir.actions.act_window.view`.

    If you plan to allow multiple views for your model, prefer using
    ir.actions.act_window.view instead of the action `view_ids`

    ``` xml
    <record model="ir.actions.act_window.view" id="test_action_tree">
       <field name="sequence" eval="1"/>
       <field name="view_mode">tree</field>
       <field name="view_id" ref="view_test_tree"/>
       <field name="act_window_id" ref="test_action"/>
    </record>
    ```
    ::::

`view_id`

:   specific view added to the `views` list in case its type is part of
    the `view_mode` list and not already filled by one of the views in
    `view_ids`

These are mostly used when defining actions from
`reference/data`{.interpreted-text role="ref"}:

``` xml
<record model="ir.actions.act_window" id="test_action">
    <field name="name">A Test Action</field>
    <field name="res_model">some.model</field>
    <field name="view_mode">graph</field>
    <field name="view_id" ref="my_specific_view"/>
</record>
```

will use the \"my_specific_view\" view even if that\'s not the default
view for the model.

The server-side composition of the `views` sequence is the following:

- get each `(id, type)` from `view_ids` (ordered by `sequence`)
- if `view_id` is defined and its type isn\'t already filled, append its
  `(id, type)`
- for each unfilled type in `view_mode`, append `(False, type)`

::: todo
- `usage`?
- `groups_id`?
- `filter`?
:::

## URL Actions (`ir.actions.act_url`) {#reference/actions/url}

Allow opening a URL (website/web page) via an Odoo action. Can be
customized via two fields:

`url`

:   the address to open when activating the action

`target`

:   opens the address in a new window/page if `new`, replaces the
    current content with the page if `self`. Defaults to `new`

<!-- -->

    {
        "type": "ir.actions.act_url",
        "url": "https://odoo.com",
        "target": "self",
    }

will replace the current content section by the Odoo home page.

## Server Actions (`ir.actions.server`) {#reference/actions/server}

::: autoclass
odoo.addons.base.models.ir_actions.IrActionsServer
:::

Allow triggering complex server code from any valid action location.
Only two fields are relevant to clients:

`id`

:   the in-database identifier of the server action to run

`context` (optional)

:   context data to use when running the server action

In-database records are significantly richer and can perform a number of
specific or generic actions based on their `state`. Some fields (and
corresponding behaviors) are shared between states:

`model_id`

:   Odoo model linked to the action.

`state`

- `code`: Executes python code given through the `code` argument.
- `object_create`: Creates a new record of model `crud_model_id`
  following `fields_lines` specifications.
- `object_write`: Updates the current record(s) following `fields_lines`
  specifications
- `multi`: Executes several actions given through the `child_ids`
  argument.

### State fields

Depending on its state, the behavior is defined through different
fields. The concerned state is given after each field.

`code` (code)

:   Specify a piece of Python code to execute when the action is called

    ``` xml
    <record model="ir.actions.server" id="print_instance">
        <field name="name">Res Partner Server Action</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="state">code</field>
        <field name="code">
            raise Warning(record.name)
        </field>
    </record>
    ```

    :::: note
    ::: title
    Note
    :::

    The code segment can define a variable called `action`, which will
    be returned to the client as the next action to execute:

    ``` xml
    <record model="ir.actions.server" id="print_instance">
        <field name="name">Res Partner Server Action</field>
        <field name="model_id" ref="model_res_partner"/>
        <field name="state">code</field>
        <field name="code">
            if record.some_condition():
                action = {
                    "type": "ir.actions.act_window",
                    "view_mode": "form",
                    "res_model": record._name,
                    "res_id": record.id,
                }
        </field>
    </record>
    ```

    will ask the client to open a form for the record if it fulfills
    some condition
    ::::

`crud_model_id` (create)(required)

:   model in which to create a new record

`link_field_id` (create)

:   many2one to `ir.model.fields`, specifies the current record\'s m2o
    field on which the newly created record should be set (models should
    match)

`fields_lines` (create/write)

:   fields to override when creating or copying the record.
    `~odoo.fields.One2many`{.interpreted-text role="class"} with the
    fields:

    `col1`

    :   `ir.model.fields` to set in the concerned model (`crud_model_id`
        for creates, `model_id` for updates)

    `value`

    :   value for the field, interpreted via `type`

    `type` (value[\|reference\|](##SUBST##|reference|)equation)

    :   If `value`, the `value` field is interpreted as a literal value
        (possibly converted), if `equation` the `value` field is
        interpreted as a Python expression and evaluated

`child_ids` (multi)

:   Specify the multiple sub-actions (`ir.actions.server`) to enact in
    state multi. If sub-actions themselves return actions, the last one
    will be returned to the client as the multi\'s own next action

### Evaluation context {#reference/actions/server/context}

A number of keys are available in the evaluation context of or
surrounding server actions:

- `model` model object linked to the action via `model_id`
- `record`/`records` record/recorset on which the action is triggered,
  can be void.
- `env` Odoo Environment
- `datetime`, `dateutil`, `time`, `timezone` corresponding Python
  modules
- `log: log(message, level='info')` logging function to record debug
  information in ir.logging table
- `Warning` constructor for the `Warning` exception

## Report Actions (`ir.actions.report`) {#reference/actions/report}

Triggers the printing of a report.

If you define your report through a [\<record\>]{.title-ref} instead of
a [\<report\>]{.title-ref} tag and want the action to show up in the
Print menu of the model\'s views, you will also need to specify
`binding_model_id` from `reference/bindings`{.interpreted-text
role="ref"}. It\'s not necessary to set `binding_type` to `report`,
since `ir.actions.report` will implicitly default to that.

`name` (mandatory)

:   used as the file name if `print_report_name` is not specified.
    Otherwise, only useful as a mnemonic/description of the report when
    looking for one in a list of some sort

`model` (mandatory)

:   the model your report will be about

`report_type` (default=qweb-pdf)

:   either `qweb-pdf` for PDF reports or `qweb-html` for HTML

`report_name` (mandatory)

:   the name (`external id`{.interpreted-text role="term"}) of the qweb
    template used to render the report

`print_report_name`

:   python expression defining the name of the report.

`groups_id`

:   `~odoo.fields.Many2many`{.interpreted-text role="class"} field to
    the groups allowed to view/use the current report

`multi`

:   if set to `True`, the action will not be displayed on a form view.

`paperformat_id`

:   `~odoo.fields.Many2one`{.interpreted-text role="class"} field to the
    paper format you wish to use for this report (if not specified, the
    company format will be used)

`attachment_use`

:   if set to `True`, the report is only generated once the first time
    it is requested, and re-printed from the stored report afterwards
    instead of being re-generated every time.

    Can be used for reports which must only be generated once (e.g. for
    legal reasons)

`attachment`

:   python expression that defines the name of the report; the record is
    accessible as the variable `object`

## Client Actions (`ir.actions.client`) {#reference/actions/client}

Triggers an action implemented entirely in the client.

`tag`

:   the client-side identifier of the action, an arbitrary string which
    the client should know how to react to

`params` (optional)

:   a Python dictionary of additional data to send to the client,
    alongside the client action tag

`target` (optional)

:   whether the client action should be open in the main content area
    (`current`), in full screen mode (`fullscreen`) or in a dialog/popup
    (`new`). Use `main` instead of `current` to clear the breadcrumbs.
    Defaults to `current`.

<!-- -->

    {
        "type": "ir.actions.client",
        "tag": "pos.ui"
    }

tells the client to start the Point of Sale interface, the server has no
idea how the POS interface works.

::: seealso
\-
`Tutorial: Client Actions <howtos/web/client_actions>`{.interpreted-text
role="ref"}
:::

## Automated Actions (`ir.cron`) {#reference/actions/cron}

Actions triggered automatically on a predefined frequency.

`name`

:   Name of the automated action (Mainly used in log display)

`interval_number`

:   Number of *interval_type* uom between two executions of the action

`interval_type`

:   Unit of measure of frequency interval (`minutes`, `hours`, `days`,
    `weeks`, `months`)

`numbercall`

:   Number of times this action has to be run. If the action is expected
    to run indefinitely, set to `-1`.

`doall`

:   Boolean precising whether the missed actions have to be executed in
    case of server restarts.

`model_id`

:   Model on which this action will be called

`code`

:   Code content of the action. Can be a simple call to the model\'s
    method :

    ``` python
    model.<method_name>()
    ```

`nextcall`

:   Next planned execution date of this action (date/time format)

[^1]: technically not an M2M: adds a sequence field and may be composed
    of just a view type, without a view id.




--- SOURCE: developer/reference/backend/http.md ---

# Web Controllers {#reference/controllers}

## Controllers

Controllers need to provide extensibility, much like
`~odoo.models.Model`{.interpreted-text role="class"}, but can\'t use the
same mechanism as the pre-requisites (a database with loaded modules)
may not be available yet (e.g. no database created, or no database
selected).

Controllers thus provide their own extension mechanism, separate from
that of models:

Controllers are created by
`inheriting <python:tut-inheritance>`{.interpreted-text role="ref"} from
`~odoo.http.Controller`{.interpreted-text role="class"}. Routes are
defined through methods decorated with
`~odoo.http.route`{.interpreted-text role="func"}:

    class MyController(odoo.http.Controller):
        @route('/some_url', auth='public')
        def handler(self):
            return stuff()

To *override* a controller,
`inherit <python:tut-inheritance>`{.interpreted-text role="ref"} from
its class and override relevant methods, re-exposing them if necessary:

    class Extension(MyController):
        @route()
        def handler(self):
            do_before()
            return super(Extension, self).handler()

- decorating with `~odoo.http.route`{.interpreted-text role="func"} is
  necessary to keep the method (and route) visible: if the method is
  redefined without decorating, it will be \"unpublished\"

- the decorators of all methods are combined, if the overriding
  method\'s decorator has no argument all previous ones will be kept,
  any provided argument will override previously defined ones e.g.:

      class Restrict(MyController):
          @route(auth='user')
          def handler(self):
              return super(Restrict, self).handler()

  will change `/some_url` from public authentication to user (requiring
  a log-in)

## API

### Routing {#reference/http/routing}

::: autodecorator
odoo.http.route
:::

### Request {#reference/http/request}

The request object is automatically set on
`odoo.http.request`{.interpreted-text role="data"} at the start of the
request.

::: {.autoclass members="" member-order="bysource"}
odoo.http.Request
:::

::: {.autoclass members="" member-order="bysource"}
odoo.http.JsonRPCDispatcher
:::

::: {.autoclass members="" member-order="bysource"}
odoo.http.HttpDispatcher
:::

### Response

::: {.autoclass members="" member-order="bysource"}
odoo.http.Response
:::




--- SOURCE: developer/reference/backend/mixins.md ---

# Mixins and Useful Classes {#reference/mixins}

Odoo implements some useful classes and mixins that make it easy for you
to add often-used behaviours on your objects. This guide will details
most of them, with examples and use cases.

## Messaging features {#reference/mixins/mail}

### Messaging integration {#reference/mixins/mail/chatter}

#### Basic messaging system

Integrating messaging features to your model is extremely easy. Simply
inheriting the `mail.thread` model and adding the messaging fields (and
their appropriate widgets) to your form view will get you up and running
in no time.

::: example
Let\'s create a simplistic model representing a business trip. Since
organizing this kind of trip usually involves a lot of people and a lot
of discussion, let\'s add support for message exchange on the model.

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread']
    _description = 'Business Trip'

    name = fields.Char()
    partner_id = fields.Many2one('res.partner', 'Responsible')
    guest_ids = fields.Many2many('res.partner', 'Participants')
```

In the form view:

``` xml
<record id="businness_trip_form" model="ir.ui.view">
    <field name="name">business.trip.form</field>
    <field name="model">business.trip</field>
    <field name="arch" type="xml">
        <form string="Business Trip">
            <!-- Your usual form view goes here
            ...
            Then comes chatter integration -->
            <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>
        </form>
    </field>
</record>
```
:::

Once you\'ve added chatter support on your model, users can easily add
messages or internal notes on any record of your model; every one of
those will send a notification (to all followers for messages, to
employee (*base.group_user*) users for internal notes). If your mail
gateway and catchall address are correctly configured, these
notifications will be sent by e-mail and can be replied-to directly from
your mail client; the automatic routing system will route the answer to
the correct thread.

Server-side, some helper functions are there to help you easily send
messages and to manage followers on your record:

**Posting messages**

::: method
message_post(self, body=\'\', subject=None,
message_type=\'notification\', subtype=None, parent_id=False,
attachments=None, \*\*kwargs)

Post a new message in an existing thread, returning the new mail.message
ID.

param str body
:   body of the message, usually raw HTML that will be sanitized

param str message_type
:   see mail_message.message_type field

param int parent_id
:   handle reply to a previous message by adding the parent partners to
    the message in case of private discussion

param list(tuple(str,str)) attachments
:   list of attachment tuples in the form `(name,content)`, where
    content is NOT base64 encoded

param [\*\*kwargs]{.title-ref}
:   extra keyword arguments will be used as default column values for
    the new mail.message record

return
:   ID of newly created mail.message

rtype
:   int
:::

::: method
message_post_with_view(views_or_xmlid, \*\*kwargs):

Helper method to send a mail / post a message using a view_id to render
using the ir.qweb engine. This method is stand alone, because there is
nothing in template and composer that allows to handle views in batch.
This method will probably disappear when templates handle ir ui views.

param str or `ir.ui.view` record
:   external id or record of the view that should be sent
:::

::: method
message_post_with_template(template_id, \*\*kwargs)

Helper method to send a mail with a template

param template_id
:   the id of the template to render to create the body of the message

param [\*\*kwargs]{.title-ref}
:   parameter to create a mail.compose.message wizard (which inherit
    from mail.message)
:::

**Receiving messages**

These methods are called when a new e-mail is processed by the mail
gateway. These e-mails can either be new thread (if they arrive via an
`alias <reference/mixins/mail/alias>`{.interpreted-text role="ref"}) or
simply replies from an existing thread. Overriding them allows you to
set values on the thread\'s record depending on some values from the
email itself (i.e. update a date or an e-mail address, add CC\'s
addresses as followers, etc.).

::: method
message_new(msg_dict, custom_values=None)

Called by `message_process` when a new message is received for a given
thread model, if the message did not belong to an existing thread.

The default behavior is to create a new record of the corresponding
model (based on some very basic info extracted from the message).
Additional behavior may be implemented by overriding this method.

param dict msg_dict
:   a map containing the email details and attachments. See
    `message_process` and `mail.message.parse` for details

param dict custom_values
:   optional dictionary of additional field values to pass to create()
    when creating the new thread record; be careful, these values may
    override any other values coming from the message

rtype
:   int

return
:   the id of the newly created thread object
:::

::: method
message_update(msg_dict, update_vals=None)

Called by `message_process` when a new message is received for an
existing thread. The default behavior is to update the record with
`update_vals` taken from the incoming email.

Additional behavior may be implemented by overriding this method.

param dict msg_dict
:   a map containing the email details and attachments; see
    `message_process` and `mail.message.parse()` for details.

param dict update_vals
:   a dict containing values to update records given their ids; if the
    dict is None or is void, no write operation is performed.

return
:   True
:::

**Followers management**

::: method
message_subscribe(partner_ids=None, channel_ids=None, subtype_ids=None,
force=True)

Add partners to the records followers.

param list(int) partner_ids
:   IDs of the partners that will be subscribed to the record

param list(int) channel_ids
:   IDs of the channels that will be subscribed to the record

param list(int) subtype_ids
:   IDs of the subtypes that the channels/partners will be subscribed to
    (defaults to the default subtypes if `None`)

param force
:   if True, delete existing followers before creating new one using the
    subtypes given in the parameters

return
:   Success/Failure

rtype
:   bool
:::

::: method
message_unsubscribe(partner_ids=None, channel_ids=None)

Remove partners from the record\'s followers.

param list(int) partner_ids
:   IDs of the partners that will be subscribed to the record

param list(int) channel_ids
:   IDs of the channels that will be subscribed to the record

return
:   True

rtype
:   bool
:::

::: method
message_unsubscribe_users(user_ids=None)

Wrapper on message_subscribe, using users.

param list(int) user_ids
:   IDs of the users that will be unsubscribed to the record; if None,
    unsubscribe the current user instead.

return
:   True

rtype
:   bool
:::

#### Logging changes

The `mail` module adds a powerful tracking system on fields, allowing
you to log changes to specific fields in the record\'s chatter. To add
tracking to a field, simple set the tracking attribute to True.

::: example
Let\'s track changes on the name and responsible of our business trips:

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread']
    _description = 'Business Trip'

    name = fields.Char(tracking=True)
    partner_id = fields.Many2one('res.partner', 'Responsible',
                                 tracking=True)
    guest_ids = fields.Many2many('res.partner', 'Participants')
```

From now on, every change to a trip\'s name or responsible will log a
note on the record. The `name` field will be displayed in the
notification as well to give more context about the notification (even
if the name did not change).
:::

#### Subtypes

Subtypes give you more granular control over messages. Subtypes act as a
classification system for notifications, allowing subscribers to a
document to customize the subtype of notifications they wish to receive.

Subtypes are created as data in your module; the model has the following
fields:

`name` (mandatory) - `~odoo.fields.Char`{.interpreted-text role="class"}

:   name of the subtype, will be displayed in the notification
    customization popup

`description` - `~odoo.fields.Char`{.interpreted-text role="class"}

:   description that will be added in the message posted for this
    subtype. If void, the name will be added instead

`internal` - `~odoo.fields.Boolean`{.interpreted-text role="class"}

:   messages with internal subtypes will be visible only by employees,
    aka members of the `base.group_user` group

`parent_id` - `~odoo.fields.Many2one`{.interpreted-text role="class"}

:   link subtypes for automatic subscription; for example project
    subtypes are linked to task subtypes through this link. When someone
    is subscribed to a project, he will be subscribed to all tasks of
    this project with subtypes found using the parent subtype

`relation_field` - `~odoo.fields.Char`{.interpreted-text role="class"}

:   as an example, when linking project and tasks subtypes, the relation
    field is the project_id field of tasks

`res_model` - `~odoo.fields.Char`{.interpreted-text role="class"}

:   model the subtype applies to; if False, this subtype applies to all
    models

`default` - `~odoo.fields.Boolean`{.interpreted-text role="class"}

:   whether the subtype is activated by default when subscribing

`sequence` - `~odoo.fields.Integer`{.interpreted-text role="class"}

:   used to order subtypes in the notification customization popup

`hidden` - `~odoo.fields.Boolean`{.interpreted-text role="class"}

:   whether the subtype is hidden in the notification customization
    popup

Interfacing subtypes with field tracking allows to subscribe to
different kind of notifications depending on what might interest users.
To do this, you can override the `_track_subtype()` function:

::: method
[track_subtype]{#track_subtype}(init_values)

Give the subtype triggered by the changes on the record according to
values that have been updated.

param dict init_values
:   the original values of the record; only modified fields are present
    in the dict

returns
:   a subtype\'s full external id or False if no subtype is triggered
:::

::: example
Let\'s add a `state` field on our example class and trigger a
notification with a specific subtype when this field change values.

First, let\'s define our subtype:

``` xml
<record id="mt_state_change" model="mail.message.subtype">
    <field name="name">Trip confirmed</field>
    <field name="res_model">business.trip</field>
    <field name="default" eval="True"/>
    <field name="description">Business Trip confirmed!</field>
</record>
```

Then, we need to override the `track_subtype()` function. This function
is called by the tracking system to know which subtype should be used
depending on the change currently being applied. In our case, we want to
use our shiny new subtype when the `state` field changes from *draft* to
*confirmed*:

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread']
    _description = 'Business Trip'

    name = fields.Char(tracking=True)
    partner_id = fields.Many2one('res.partner', 'Responsible',
                                 tracking=True)
    guest_ids = fields.Many2many('res.partner', 'Participants')
    state = fields.Selection([('draft', 'New'), ('confirmed', 'Confirmed')],
                             tracking=True)

    def _track_subtype(self, init_values):
        # init_values contains the modified fields' values before the changes
        #
        # the applied values can be accessed on the record as they are already
        # in cache
        self.ensure_one()
        if 'state' in init_values and self.state == 'confirmed':
            return self.env.ref('my_module.mt_state_change')
        return super(BusinessTrip, self)._track_subtype(init_values)
```
:::

#### Customizing notifications

When sending notifications to followers, it can be quite useful to add
buttons in the template to allow quick actions directly from the e-mail.
Even a simple button to link directly to the record\'s form view can be
useful; however in most cases you don\'t want to display these buttons
to portal users.

The notification system allows customizing notification templates in the
following ways:

- Display *Access Buttons*: these buttons are visible at the top of the
  notification e-mail and allow the recipient to directly access the
  form view of the record
- Display *Follow Buttons*: these buttons allow the recipient to
  directly quickly subscribe from the record
- Display *Unfollow Buttons*: these buttons allow the recipient to
  directly quickly unsubscribe from the record
- Display *Custom Action Buttons*: these buttons are calls to specific
  routes and allow you to make some useful actions directly available
  from the e-mail (i.e. converting a lead to an opportunity, validating
  an expense sheet for an Expense Manager, etc.)

These buttons settings can be applied to different groups that you can
define yourself by overriding the function `_notify_get_groups`.

::: method
[notify_get_groups]{#notify_get_groups}(message, groups)

Give the subtype triggered by the changes on the record according to
values that have been updated.

param `record` message
:   `mail.message` record currently being sent

param list(tuple) groups
:   list of tuple of the form (group_name, group_func,group_data) where:

> 
>
> group_name
>
> :   is an identifier used only to be able to override and manipulate
>     groups. Default groups are `user` (recipients linked to an
>     employee user), `portal` (recipients linked to a portal user) and
>     `customer` (recipients not linked to any user). An example of
>     override use would be to add a group linked to a res.groups like
>     Hr Officers to set specific action buttons to them.
>
> group_func
>
> :   is a function pointer taking a partner record as parameter. This
>     method will be applied on recipients to know whether they belong
>     to a given group or not. Only first matching group is kept.
>     Evaluation order is the list order.
>
> group_data
>
> :   is a dict containing parameters for the notification email with
>     the following possible keys - values:
>
>     - 
>
>       has_button_access
>
>       :   whether to display Access \<Document\> in email. True by
>           default for new groups, False for portal / customer.
>
>     - 
>
>       button_access
>
>       :   dict with url and title of the button
>
>     - 
>
>       has_button_follow
>
>       :   whether to display Follow in email (if recipient is not
>           currently following the thread). True by default for new
>           groups, False for portal / customer.
>
>     - 
>
>       button_follow
>
>       :   dict with url and title of the button
>
>     - 
>
>       has_button_unfollow
>
>       :   whether to display Unfollow in email (if recipient is
>           currently following the thread). True by default for new
>           groups, False for portal / customer.
>
>     - 
>
>       button_unfollow
>
>       :   dict with url and title of the button
>
>     - 
>
>       actions
>
>       :   list of action buttons to display in the notification email.
>           Each action is a dict containing url and title of the
>           button.

returns
:   a subtype\'s full external id or False if no subtype is triggered
:::

The urls in the actions list can be generated automatically by calling
the `_notify_get_action_link()` function:

::: method
[notify_get_action_link]{#notify_get_action_link}(self, link_type,
\*\*kwargs)

Generate a link for the given type on the current record (or on a
specific record if the kwargs `model` and `res_id` are set).

param str link_type
:   link type to be generated; can be any of these values:

> 
>
> `view`
>
> :   link to form view of the record
>
> `assign`
>
> :   assign the logged user to the `user_id` field of the record (if it
>     exists)
>
> `follow`
>
> :   self-explanatory
>
> `unfollow`
>
> :   self-explanatory
>
> `method`
>
> :   call a method on the record; the method\'s name should be provided
>     as the kwarg `method`
>
> `new`
>
> :   open an empty form view for a new record; you can specify a
>     specific action by providing its id (database id or fully resolved
>     external id) in the kwarg `action_id`

returns
:   link of the type selected for the record

rtype
:   str
:::

::: example
Let\'s add a custom button to the Business Trip state change
notification; this button will reset the state to Draft and will be only
visible to a member of the (imaginary) group Travel Manager
(`business.group_trip_manager`)

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread', 'mail.alias.mixin']
    _description = 'Business Trip'

    # Pevious code goes here

    def action_cancel(self):
        self.write({'state': 'draft'})

    def _notify_get_groups(self, message, groups):
        """ Handle Trip Manager recipients that can cancel the trip at the last
        minute and kill all the fun. """
        groups = super(BusinessTrip, self)._notify_get_groups(message, groups)

        self.ensure_one()
        if self.state == 'confirmed':
            app_action = self._notify_get_action_link('method',
                                method='action_cancel')
            trip_actions = [{'url': app_action, 'title': _('Cancel')}]

        new_group = (
            'group_trip_manager',
            lambda partner: bool(partner.user_ids) and
            any(user.has_group('business.group_trip_manager')
            for user in partner.user_ids),
            {
                'actions': trip_actions,
            })

        return [new_group] + groups
```

Note that that I could have defined my evaluation function outside of
this method and define a global function to do it instead of a lambda,
but for the sake of being more brief and less verbose in these
documentation files that can sometimes be boring, I choose the former
instead of the latter.
:::

#### Overriding defaults

There are several ways you can customize the behaviour of `mail.thread`
models, including (but not limited to):

`_mail_post_access` - `~odoo.models.Model`{.interpreted-text role="class"} attribute

:   the required access rights to be able to post a message on the
    model; by default a `write` access is needed, can be set to `read`
    as well

Context keys:

:   These context keys can be used to somewhat control `mail.thread`
    features like auto-subscription or field tracking during calls to
    `create()` or `write()` (or any other method where it may be
    useful).

    - `mail_create_nosubscribe`: at create or message_post, do not
      subscribe the current user to the record thread
    - `mail_create_nolog`: at create, do not log the automatic
      \'\<Document\> created\' message
    - `mail_notrack`: at create and write, do not perform the value
      tracking creating messages
    - `tracking_disable`: at create and write, perform no MailThread
      features (auto subscription, tracking, post, \...)
    - `mail_auto_delete`: auto delete mail notifications; True by
      default
    - `mail_notify_force_send`: if less than 50 email notifications to
      send, send them directly instead of using the queue; True by
      default
    - `mail_notify_user_signature`: add the current user signature in
      email notifications; True by default

### Mail alias {#reference/mixins/mail/alias}

Aliases are configurable email addresses that are linked to a specific
record (which usually inherits the `mail.alias.mixin` model) that will
create new records when contacted via e-mail. They are an easy way to
make your system accessible from the outside, allowing users or
customers to quickly create records in your database without needing to
connect to Odoo directly.

#### Aliases vs. Incoming Mail Gateway

Some people use the Incoming Mail Gateway for this same purpose. You
still need a correctly configured mail gateway to use aliases, however a
single catchall domain will be sufficient since all routing will be done
inside Odoo. Aliases have several advantages over Mail Gateways:

- 

  Easier to configure

  :   - A single incoming gateway can be used by many aliases; this
        avoids having to configure multiple emails on your domain name
        (all configuration is done inside Odoo)
      - No need for System access rights to configure aliases

- 

  More coherent

  :   - Configurable on the related record, not in a Settings submenu

- 

  Easier to override server-side

  :   - Mixin model is built to be extended from the start, allowing you
        to extract useful data from incoming e-mails more easily than
        with a mail gateway.

#### Alias support integration

Aliases are usually configured on a parent model which will then create
specific record when contacted by e-mail. For example, Project have
aliases to create tasks or issues, Sales Team have aliases to generate
Leads.

:::: note
::: title
Note
:::

The model that will be created by the alias **must** inherit the
`mail_thread` model.
::::

Alias support is added by inheriting `mail.alias.mixin`; this mixin will
generate a new `mail.alias` record for each record of the parent class
that gets created (for example, every `project.project` record having
its `mail.alias` record initialized on creation).

:::: note
::: title
Note
:::

Aliases can also be created manually and supported by a simple
`~odoo.fields.Many2one`{.interpreted-text role="class"} field. This
guide assumes you wish a more complete integration with automatic
creation of the alias, record-specific default values, etc.
::::

Unlike `mail.thread` inheritance, the `mail.alias.mixin` **requires**
some specific overrides to work correctly. These overrides will specify
the values of the created alias, like the kind of record it must create
and possibly some default values these records may have depending on the
parent object:

::: method
[get_alias_model_name]{#get_alias_model_name}(vals)

Return the model name for the alias. Incoming emails that are not
replies to existing records will cause the creation of a new record of
this alias model. The value may depend on `vals`, the dict of values
passed to `create` when a record of this model is created.

param vals dict
:   values of the newly created record that will holding the alias

return
:   model name

rtype
:   str
:::

::: method
[get_alias_values]{#get_alias_values}()

Return values to create an alias, or to write on the alias after its
creation. While not completely mandatory, it is usually required to make
sure that newly created records will be linked to the alias\' parent
(i.e. tasks getting created in the right project) by setting a
dictionary of default values in the alias\' `alias_defaults` field.

return
:   dictionary of values that will be written to the new alias

rtype
:   dict
:::

The `_get_alias_values()` override is particularly interesting as it
allows you to modify the behaviour of your aliases easily. Among the
fields that can be set on the alias, the following are of particular
interest:

`alias_name` - `~odoo.fields.Char`{.interpreted-text role="class"}

:   name of the email alias, e.g. \'jobs\' if you want to catch emails
    for \<jobs@example.odoo.com\>

`alias_user_id` - `~odoo.fields.Many2one`{.interpreted-text role="class"} (`res.users`)

:   owner of records created upon receiving emails on this alias; if
    this field is not set the system will attempt to find the right
    owner based on the sender (From) address, or will use the
    Administrator account if no system user is found for that address

`alias_defaults` - `~odoo.fields.Text`{.interpreted-text role="class"}

:   Python dictionary that will be evaluated to provide default values
    when creating new records for this alias

`alias_force_thread_id` - `~odoo.fields.Integer`{.interpreted-text role="class"}

:   optional ID of a thread (record) to which all incoming messages will
    be attached, even if they did not reply to it; if set, this will
    disable the creation of new records completely

`alias_contact` - `~odoo.fields.Selection`{.interpreted-text role="class"}

:   Policy to post a message on the document using the mailgateway

    - *everyone*: everyone can post
    - *partners*: only authenticated partners
    - *followers*: only followers of the related document or members of
      following channels

Note that aliases make use of
`delegation inheritance <reference/orm/inheritance>`{.interpreted-text
role="ref"}, which means that while the alias is stored in another
table, you have access to all these fields directly from your parent
object. This allows you to make your alias easily configurable from the
record\'s form view.

::: example
Let\'s add aliases on our business trip class to create expenses on the
fly via e-mail.

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread', 'mail.alias.mixin']
    _description = 'Business Trip'

    name = fields.Char(tracking=True)
    partner_id = fields.Many2one('res.partner', 'Responsible',
                                 tracking=True)
    guest_ids = fields.Many2many('res.partner', 'Participants')
    state = fields.Selection([('draft', 'New'), ('confirmed', 'Confirmed')],
                             tracking=True)
    expense_ids = fields.One2many('business.expense', 'trip_id', 'Expenses')
    alias_id = fields.Many2one('mail.alias', string='Alias', ondelete="restrict",
                               required=True)

    def _get_alias_model_name(self, vals):
    """ Specify the model that will get created when the alias receives a message """
        return 'business.expense'

    def _get_alias_values(self):
    """ Specify some default values that will be set in the alias at its creation """
        values = super(BusinessTrip, self)._get_alias_values()
        # alias_defaults holds a dictionary that will be written
        # to all records created by this alias
        #
        # in this case, we want all expense records sent to a trip alias
        # to be linked to the corresponding business trip
        values['alias_defaults'] = {'trip_id': self.id}
        # we only want followers of the trip to be able to post expenses
        # by default
        values['alias_contact'] = 'followers'
        return values

class BusinessExpense(models.Model):
    _name = 'business.expense'
    _inherit = ['mail.thread']
    _description = 'Business Expense'

    name = fields.Char()
    amount = fields.Float('Amount')
    trip_id = fields.Many2one('business.trip', 'Business Trip')
    partner_id = fields.Many2one('res.partner', 'Created by')
```

We would like our alias to be easily configurable from the form view of
our business trips, so let\'s add the following to our form view:

``` xml
<page string="Emails">
    <group name="group_alias">
        <label for="alias_name" string="Email Alias"/>
        <div name="alias_def">
            <!-- display a link while in view mode and a configurable field
            while in edit mode -->
            <field name="alias_id" class="oe_read_only oe_inline"
                    string="Email Alias" required="0"/>
            <div class="oe_edit_only oe_inline" name="edit_alias"
                 style="display: inline;" >
                <field name="alias_name" class="oe_inline"/>
                @
                <field name="alias_domain" class="oe_inline" readonly="1"/>
            </div>
        </div>
        <field name="alias_contact" class="oe_inline"
                string="Accept Emails From"/>
    </group>
</page>
```

Now we can change the alias address directly from the form view and
change who can send e-mails to the alias.

We can then override `message_new()` on our expense model to fetch the
values from our email when the expense will be created:

``` python
class BusinessExpense(models.Model):
    # Previous code goes here
    # ...

    def message_new(self, msg, custom_values=None):
        """ Override to set values according to the email.

        In this simple example, we simply use the email title as the name
        of the expense, try to find a partner with this email address and
        do a regex match to find the amount of the expense."""
        name = msg_dict.get('subject', 'New Expense')
        # Match the last occurrence of a float in the string
        # Example: '50.3 bar 34.5' becomes '34.5'. This is potentially the price
        # to encode on the expense. If not, take 1.0 instead
        amount_pattern = '(\d+(\.\d*)?|\.\d+)'
        expense_price = re.findall(amount_pattern, name)
        price = expense_price and float(expense_price[-1][0]) or 1.0
        # find the partner by looking for it's email
        partner = self.env['res.partner'].search([('email', 'ilike', email_address)],
                                                 limit=1)
        defaults = {
            'name': name,
            'amount': price,
            'partner_id': partner.id
        }
        defaults.update(custom_values or {})
        res = super(BusinessExpense, self).message_new(msg, custom_values=defaults)
        return res
```
:::

### Activities tracking {#reference/mixins/mail/activities}

Activities are actions users have to take on a document like making a
phone call or organizing a meeting. Activities come with the mail module
as they are integrated in the Chatter but are *not bundled with
mail.thread*. Activities are records of the `mail.activity` class, which
have a type (`mail.activity.type`), name, description, scheduled time
(among others). Pending activities are visible above the message history
in the chatter widget.

You can integrate activities using the `mail.activity.mixin` class on
your object and the specific widgets to display them (via the field
`activity_ids`) in the form view and kanban view of your records
(`mail_activity` and `kanban_activity` widgets, respectively).

::: example
Organizing a business trip is a tedious process and tracking needed
activities like ordering plane tickets or a cab for the airport could be
useful. To do so, we will add the activities mixin on our model and
display the next planned activities in the message history of our trip.

``` python
class BusinessTrip(models.Model):
    _name = 'business.trip'
    _inherit = ['mail.thread', 'mail.activity.mixin']
    _description = 'Business Trip'

    name = fields.Char()
    # [...]
```

We modify the form view of our trips to display their next activities:

``` xml
<record id="businness_trip_form" model="ir.ui.view">
    <field name="name">business.trip.form</field>
    <field name="model">business.trip</field>
    <field name="arch" type="xml">
        <form string="Business Trip">
            <!-- Your usual form view goes here -->
            <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="activity_ids" widget="mail_activity"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>
        </form>
    </field>
</record>
```
:::

You can find concrete examples of integration in the following models:

- `crm.lead` in the CRM (*crm*) Application
- `sale.order` in the Sales (*sale*) Application
- `project.task` in the Project (*project*) Application

## Website features {#reference/mixins/website}

### Visitor tracking {#reference/mixins/website/utm}

The `utm.mixin` class can be used to track online
marketing/communication campaigns through arguments in links to
specified resources. The mixin adds 3 fields to your model:

- `campaign_id`: `~odoo.fields.Many2one`{.interpreted-text role="class"}
  field to a `utm.campaign` object (i.e. Christmas_Special,
  Fall_Collection, etc.)
- `source_id`: `~odoo.fields.Many2one`{.interpreted-text role="class"}
  field to a `utm.source` object (i.e. Search Engine, mailing list,
  etc.)
- `medium_id`: `~odoo.fields.Many2one`{.interpreted-text role="class"}
  field to a `utm.medium` object (i.e. Snail Mail, e-Mail, social
  network update, etc.)

These models have a single field `name` (i.e. they are simply there to
distinguish campaigns but don\'t have any specific behaviour).

Once a customer visits your website with these parameters set in the url
(i.e.
<https://www.odoo.com/?campaign_id=mixin_talk&source_id=www.odoo.com&medium_id=website>),
three cookies are set in the visitor\'s website for these parameters.
Once a object that inherits the utm.mixin is created from the website
(i.e. lead form, job application, etc.), the utm.mixin code kicks in and
fetches the values from the cookies to set them in the new record. Once
this is done, you can then use the campaign/source/medium fields as any
other field when defining reports and views (group by, etc.).

To extend this behaviour, simply add a relational field to a simple
model (the model should support the *quick create* (i.e. call to
`create()` with a single `name` value) and extend the function
`tracking_fields()`:

``` python
class UtmMyTrack(models.Model):
    _name = 'my_module.my_track'
    _description = 'My Tracking Object'

    name = fields.Char(string='Name', required=True)


class MyModel(models.Models):
    _name = 'my_module.my_model'
    _inherit = ['utm.mixin']
    _description = 'My Tracked Object'

    my_field = fields.Many2one('my_module.my_track', 'My Field')

    @api.model
    def tracking_fields(self):
        result = super(MyModel, self).tracking_fields()
        result.append([
        # ("URL_PARAMETER", "FIELD_NAME_MIXIN", "NAME_IN_COOKIES")
            ('my_field', 'my_field', 'odoo_utm_my_field')
        ])
        return result
```

This will tell the system to create a cookie named *odoo_utm_my_field*
with the value found in the url parameter `my_field`; once a new record
of this model is created by a call from a website form, the generic
override of the `create()` method of `utm.mixin` will fetch the default
values for this field from the cookie (and the `my_module.my_track`
record will be creatwed on the fly if it does not exist yet).

You can find concrete examples of integration in the following models:

- `crm.lead` in the CRM (*crm*) Application
- `hr.applicant` in the Recruitment Process (*hr_recruitment*)
  Application
- `helpdesk.ticket` in the Helpdesk (*helpdesk* - Odoo Enterprise only)
  Application

### Website visibility {#reference/mixins/website/published}

You can quite easily add a website visibility toggle on any of your
record. While this mixin is quite easy to implement manually, it is the
most often-used after the `mail.thread` inheritance; a testament to its
usefulness. The typical use case for this mixin is any object that has a
frontend-page; being able to control the visibility of the page allows
you to take your time while editing the page and only publish it when
you\'re satisfied.

To include the functionality, you only need to inherit
`website.published.mixin`:

``` python
class BlogPost(models.Model):
    _name = "blog.post"
    _description = "Blog Post"
    _inherit = ['website.published.mixin']
```

This mixin adds 2 fields on your model:

- `website_published`: `~odoo.fields.Boolean`{.interpreted-text
  role="class"} field which represents the status of the publication
- `website_url`: `~odoo.fields.Char`{.interpreted-text role="class"}
  field which represents the URL through which the object is accessed

Note that this last field is a computed field and must be implemented
for your class:

``` python
def _compute_website_url(self):
    for blog_post in self:
        blog_post.website_url = "/blog/%s" % (log_post.blog_id)
```

Once the mechanism is in place, you just have to adapt your frontend and
backend views to make it accessible. In the backend, adding a button in
the button box is usually the way to go:

``` xml
<button class="oe_stat_button" name="website_publish_button"
    type="object" icon="fa-globe">
    <field name="website_published" widget="website_button"/>
</button>
```

In the frontend, some security checks are needed to avoid showing
\'Editing\' buttons to website visitors:

``` xml
<div id="website_published_button" class="float-right"
     groups="base.group_website_publisher"> <!-- or any other meaningful group -->
    <t t-call="website.publish_management">
      <t t-set="object" t-value="blog_post"/>
      <t t-set="publish_edit" t-value="True"/>
      <t t-set="action" t-value="'blog.blog_post_action'"/>
    </t>
</div>
```

Note that you must pass your object as the variable `object` to the
template; in this example, the `blog.post` record was passed as the
`blog_post` variable to the `qweb` rendering engine, it is necessary to
specify this to the publish management template. The `publish_edit`
variable allow the frontend button to link to the backend (allowing you
to switch from frontend to backend and vice-versa easily); if set, you
must specify the full external id of the action you want to call in the
backend in the `action` variable (note that a Form View must exist for
the model).

The action `website_publish_button` is defined in the mixin and adapts
its behaviour to your object: if the class has a valid `website_url`
compute function, the user is redirected to the frontend when he clicks
on the button; the user can then publish the page directly from the
frontend. This ensures that no online publication can happen by
accident. If there is not compute function, the boolean
`website_published` is simply triggered.

### Website metadata {#reference/mixins/website/seo}

This simple mixin simply allows you to easily inject metadata in your
frontend pages.

``` python
class BlogPost(models.Model):
    _name = "blog.post"
    _description = "Blog Post"
    _inherit = ['website.seo.metadata', 'website.published.mixin']
```

This mixin adds 3 fields on your model:

- `website_meta_title`: `~odoo.fields.Char`{.interpreted-text
  role="class"} field that allow you to set an additional title to your
  page
- `website_meta_description`: `~odoo.fields.Char`{.interpreted-text
  role="class"} field that contains a short description of the page
  (sometimes used in search engines results)
- `website_meta_keywords`: `~odoo.fields.Char`{.interpreted-text
  role="class"} field that contains some keywords to help your page to
  be classified more precisely by search engines; the \"Promote\" tool
  will help you select lexically-related keywords easily

These fields are editable in the frontend using the \"Promote\" tool
from the Editor toolbar. Setting these fields can help search engines to
better index your pages. Note that search engines do not base their
results only on these metadata; the best SEO practice should still be to
get referenced by reliable sources.

## Others {#reference/mixins/misc}

### Customer Rating {#reference/mixins/misc/rating}

The rating mixin allows sending email to ask for customer rating,
automatic transitioning in a kanban processes and aggregating statistics
on your ratings.

#### Adding rating on your model

To add rating support, simply inherit the `rating.mixin` model:

``` python
class MyModel(models.Models):
    _name = 'my_module.my_model'
    _inherit = ['rating.mixin', 'mail.thread']

    user_id = fields.Many2one('res.users', 'Responsible')
    partner_id = fields.Many2one('res.partner', 'Customer')
```

The behaviour of the mixin adapts to your model:

- The `rating.rating` record will be linked to the `partner_id` field of
  your model (if the field is present).
  - this behaviour can be overridden with the function
    `rating_get_partner_id()` if you use another field than `partner_id`
- The `rating.rating` record will be linked to the partner of the
  `user_id` field of your model (if the field is present) (i.e. the
  partner who is rated)
  - this behaviour can be overridden with the function
    `rating_get_rated_partner_id()` if you use another field than
    `user_id` (note that the function must return a `res.partner`, for
    `user_id` the system automatically fetches the partner of the user)
- The chatter history will display the rating event (if your model
  inherits from `mail.thread`)

#### Send rating requests by e-mail

If you wish to send emails to request a rating, simply generate an
e-mail with links to the rating object. A very basic email template
could look like this:

``` xml
<record id="rating_my_model_email_template" model="mail.template">
            <field name="name">My Model: Rating Request</field>
            <field name="email_from">${object.rating_get_rated_partner_id().email or '' | safe}</field>
            <field name="subject">Service Rating Request</field>
            <field name="model_id" ref="my_module.model_my_model"/>
            <field name="partner_to" >${object.rating_get_partner_id().id}</field>
            <field name="auto_delete" eval="True"/>
            <field name="body_html"><![CDATA[
% set access_token = object.rating_get_access_token()
<p>Hi,</p>
<p>How satsified are you?</p>
<ul>
    <li><a href="/rate/${access_token}/5">Satisfied</a></li>
    <li><a href="/rate/${access_token}/3">Okay</a></li>
    <li><a href="/rate/${access_token}/1">Dissatisfied</a></li>
</ul>
]]></field>
</record>
```

Your customer will then receive an e-mail with links to a simple webpage
allowing them to provide a feedback on their interaction with your users
(including a free-text feedback message).

You can then quite easily integrate your ratings with your form view by
defining an action for the ratings:

``` xml
<record id="rating_rating_action_my_model" model="ir.actions.act_window">
    <field name="name">Customer Ratings</field>
    <field name="res_model">rating.rating</field>
    <field name="view_mode">kanban,pivot,graph</field>
    <field name="domain">[('res_model', '=', 'my_module.my_model'), ('res_id', '=', active_id), ('consumed', '=', True)]</field>
</record>

<record id="my_module_my_model_view_form_inherit_rating" model="ir.ui.view">
    <field name="name">my_module.my_model.view.form.inherit.rating</field>
    <field name="model">my_module.my_model</field>
    <field name="inherit_id" ref="my_module.my_model_view_form"/>
    <field name="arch" type="xml">
        <xpath expr="//div[@name='button_box']" position="inside">
            <button name="%(rating_rating_action_my_model)d" type="action"
                    class="oe_stat_button" icon="fa-smile-o">
                <field name="rating_count" string="Rating" widget="statinfo"/>
            </button>
        </xpath>
    </field>
</record>
```

Note that there are default views (kanban,pivot,graph) for ratings which
allow you a quick bird\'s eye view of your customer ratings.

You can find concrete examples of integration in the following models:

- `project.task` in the Project (*rating_project*) Application
- `helpdesk.ticket` in the Helpdesk (*helpdesk* - Odoo Enterprise only)
  Application




--- SOURCE: developer/reference/backend/module.md ---

# Module Manifests

## Manifest {#reference/module/manifest}

The manifest file serves to declare a python package as an Odoo module
and to specify module metadata.

It is a file called `__manifest__.py` and contains a single Python
dictionary, where each key specifies module metadatum.

    {
        'name': "A Module",
        'version': '1.0',
        'depends': ['base'],
        'author': "Author Name",
        'category': 'Category',
        'description': """
        Description text
        """,
        # data files always loaded at installation
        'data': [
            'views/mymodule_view.xml',
        ],
        # data files containing optionally loaded demonstration data
        'demo': [
            'demo/demo_data.xml',
        ],
    }

Available manifest fields are:

`name` (`str`, required)

:   the human-readable name of the module

`version` (`str`)

:   this module\'s version, should follow [semantic
    versioning](https://semver.org) rules

`description` (`str`)

:   extended description for the module, in reStructuredText

`author` (`str`)

:   name of the module author

`website` (`str`)

:   website URL for the module author

`license` (`str`, defaults: `LGPL-3`)

:   distribution license for the module. Possible values:

    - [GPL-2]{.title-ref}
    - [GPL-2 or any later version]{.title-ref}
    - [GPL-3]{.title-ref}
    - [GPL-3 or any later version]{.title-ref}
    - [AGPL-3]{.title-ref}
    - [LGPL-3]{.title-ref}
    - [Other OSI approved licence]{.title-ref}
    - [OEEL-1]{.title-ref} (Odoo Enterprise Edition License v1.0)
    - [OPL-1]{.title-ref} (Odoo Proprietary License v1.0)
    - [Other proprietary]{.title-ref}

`category` (`str`, default: `Uncategorized`)

:   classification category within Odoo, rough business domain for the
    module.

    Although using [existing
    categories](%7BGITHUB_PATH%7D/odoo/addons/base/data/ir_module_category_data.xml)
    is recommended, the field is freeform and unknown categories are
    created on-the-fly. Category hierarchies can be created using the
    separator `/` e.g. `Foo / Bar` will create a category `Foo`, a
    category `Bar` as child category of `Foo`, and will set `Bar` as the
    module\'s category.

`depends` (`list(str)`)

:   Odoo modules which must be loaded before this one, either because
    this module uses features they create or because it alters resources
    they define.

    When a module is installed, all of its dependencies are installed
    before it. Likewise dependencies are loaded before a module is
    loaded.

:::: note
::: title
Note
:::

Module [base]{.title-ref} is always installed in any Odoo instance. But
you still need to specify it as dependency to make sure your module is
updated when [base]{.title-ref} is updated.
::::

`data` (`list(str)`)

:   List of data files which must always be installed or updated with
    the module. A list of paths from the module root directory

`demo` (`list(str)`)

:   List of data files which are only installed or updated in
    *demonstration mode*

`auto_install` (`bool` or `list(str)`, default: `False`)

:   If `True`, this module will automatically be installed if all of its
    dependencies are installed.

    It is generally used for \"link modules\" implementing synergetic
    integration between two otherwise independent modules.

    For instance `sale_crm` depends on both `sale` and `crm` and is set
    to `auto_install`. When both `sale` and `crm` are installed, it
    automatically adds CRM campaigns tracking to sale orders without
    either `sale` or `crm` being aware of one another.

    If it is a list, it must contain a subset of the dependencies. This
    module will automatically be installed as soon as all the
    dependencies in the subset are installed. The remaining dependencies
    will be automatically installed as well. If the list is empty, this
    module will always be automatically installed regardless of its
    dependencies and these will be installed as well.

`external_dependencies` (`dict(key=list(str))`)

:   A dictionary containing python and/or binary dependencies.

    For python dependencies, the `python` key must be defined for this
    dictionary and a list of python modules to be imported should be
    assigned to it.

    For binary dependencies, the `bin` key must be defined for this
    dictionary and a list of binary executable names should be assigned
    to it.

    The module won\'t be installed if either the python module is not
    installed in the host machine or the binary executable is not found
    within the host machine\'s PATH environment variable.

`application` (`bool`, default: `False`)

:   Whether the module should be considered as a fully-fledged
    application (`True`) or is just a technical module (`False`) that
    provides some extra functionality to an existing application module.

`assets` (`dict`)

:   A definition of how all static files are loaded in various assets
    bundles. See the `assets <reference/assets>`{.interpreted-text
    role="ref"} page for more details on how to describe bundles.

`installable` (`bool` default: `True`)

:   Whether a user should be able to install the module from the Web UI
    or not.

`maintainer` (`str`)

:   Person or entity in charge of the maintenance of this module, by
    default it is assumed that the author is the maintainer.

`{pre_init, post_init, uninstall}_hook` (`str`)

:   Hooks for module installation/uninstallation, their value should be
    a string representing the name of a function defined inside the
    module\'s `__init__.py`.

    `pre_init_hook` takes a cursor as its only argument, this function
    is executed prior to the module\'s installation.

    `post_init_hook` takes a cursor and a registry as its arguments,
    this function is executed right after the module\'s installation.

    `uninstall_hook` takes a cursor and a registry as its arguments,
    this function is executed after the module\'s uninstallation.

    These hooks should only be used when setup/cleanup required for this
    module is either extremely difficult or impossible through the api.

`active` (`bool`)

:   Deprecated. Replaced by `auto_install`.




--- SOURCE: developer/reference/backend/orm/changelog.md ---

# Changelog {#reference/orm/changelog}

## Odoo version 16.0

- Translations for translated fields are stored as JSONB values with
  [#97692](https://github.com/odoo/odoo/pull/97692) and
  [#101115](https://github.com/odoo/odoo/pull/101115). Code translations
  are no longer stored into the database. They become static and are
  extracted from the PO files when needed.
- `~odoo.models.Model.search_count`{.interpreted-text role="meth"} takes
  the `limit`{.interpreted-text role="attr"} argument into account with
  [#95589](https://github.com/odoo/odoo/pull/95589). It limits the
  number of records to count, improving performance when a partial
  result is acceptable.

## Odoo Online version 15.4

- New API for flushing to the database and invalidating the cache with
  [#87527](https://github.com/odoo/odoo/pull/87527). New methods have
  been added to [odoo.models.Model]{.title-ref} and
  [odoo.api.Environment]{.title-ref}, and are less confusing about what
  is actually done in each case. See the section
  `SQL Execution <reference/orm/sql>`{.interpreted-text role="ref"}.

## Odoo Online version 15.3

- The argument [args]{.title-ref} is renamed to [domain]{.title-ref} for
  `~odoo.models.Model.search`{.interpreted-text role="meth"},
  `~odoo.models.Model.search_count`{.interpreted-text role="meth"} and
  `~odoo.models.Model._search`{.interpreted-text role="meth"}.
  [#83687](https://github.com/odoo/odoo/pull/83687)
- `~odoo.models.Model.filtered_domain`{.interpreted-text role="meth"}
  conserves the order of the current recordset.
  [#83687](https://github.com/odoo/odoo/pull/83687)
- `~odoo.models.Model.browse`{.interpreted-text role="meth"} does not
  accept `str`{.interpreted-text role="class"} as [ids]{.title-ref}.
  [#83687](https://github.com/odoo/odoo/pull/83687)
- The methods `~odoo.models.Model.fields_get_keys`{.interpreted-text
  role="meth"} and `~odoo.models.Model.get_xml_id`{.interpreted-text
  role="meth"} on `~odoo.models.Model`{.interpreted-text role="class"}
  are deprecated. [#83687](https://github.com/odoo/odoo/pull/83687)
- The method `~odoo.models.Model._mapped_cache`{.interpreted-text
  role="meth"} is removed.
  [#83687](https://github.com/odoo/odoo/pull/83687)
- Remove the `limit`{.interpreted-text role="attr"} attribute of
  `~odoo.fields.One2many`{.interpreted-text role="class"} and
  `~odoo.fields.Many2many`{.interpreted-text role="class"}.
  [#83687](https://github.com/odoo/odoo/pull/83687)

## Odoo Online version 15.2

- Specific index types on fields: With
  [#83274](https://github.com/odoo/odoo/pull/83274) and
  [#83015](https://github.com/odoo/odoo/pull/83015), developers can now
  define what type of indexes can be used on fields by PostgreSQL. See
  the `index property <reference/fields>`{.interpreted-text role="ref"}
  of [odoo.fields.Field]{.title-ref}.
- The `_sequence`{.interpreted-text role="attr"} attribute of
  `~odoo.models.Model`{.interpreted-text role="class"} is removed. Odoo
  lets PostgreSQL use the default sequence of the primary key.
  [#82727](https://github.com/odoo/odoo/pull/82727)
- The method `~odoo.models.Model._write`{.interpreted-text role="meth"}
  does not raise an error for non-existing records.
  [#82727](https://github.com/odoo/odoo/pull/82727)
- The `column_format`{.interpreted-text role="attr"} and
  `deprecated`{.interpreted-text role="attr"} attributes of
  `~odoo.fields.Field`{.interpreted-text role="class"} are removed.
  [#82727](https://github.com/odoo/odoo/pull/82727)




--- SOURCE: developer/reference/backend/orm.md ---

show-content

:   

# ORM API {#reference/orm}

::: {.toctree titlesonly=""}
orm/changelog
:::

::: automodule
odoo.models
:::

## Models[]{#reference/orm/models} {#reference/orm/model}

Model fields are defined as attributes on the model itself:

    from odoo import models, fields
    class AModel(models.Model):
        _name = 'a.model.name'

        field1 = fields.Char()

:::: warning
::: title
Warning
:::

this means you cannot define a field and a method with the same name,
the last one will silently overwrite the former ones.
::::

By default, the field\'s label (user-visible name) is a capitalized
version of the field name, this can be overridden with the `string`
parameter. :

    field2 = fields.Integer(string="Field Label")

For the list of field types and parameters, see `the fields reference
<reference/fields>`{.interpreted-text role="ref"}.

Default values are defined as parameters on fields, either as a value:

    name = fields.Char(default="a value")

or as a function called to compute the default value, which should
return that value:

    def _default_name(self):
        return self.get_value()

    name = fields.Char(default=lambda self: self._default_name())

**API**

:::::::::::::::::::: autoclass
odoo.models.BaseModel()

::: autoattribute
[auto]{#auto}
:::

::: attribute
[log_access]{#log_access}

Whether the ORM should automatically generate and update the
`reference/fields/automatic/log_access`{.interpreted-text role="ref"}.

Defaults to whatever value was set for `~._auto`{.interpreted-text
role="attr"}.
:::

::: autoattribute
[table]{#table}
:::

::: autoattribute
[sql_constraints]{#sql_constraints}
:::

::: autoattribute
[register]{#register}
:::

::: autoattribute
[abstract]{#abstract}
:::

::: autoattribute
[transient]{#transient}
:::

::: autoattribute
[name]{#name}
:::

::: autoattribute
[description]{#description}
:::

::: autoattribute
[inherit]{#inherit}
:::

::: autoattribute
[inherits]{#inherits}
:::

::: autoattribute
[rec_name]{#rec_name}
:::

::: autoattribute
[order]{#order}
:::

::: autoattribute
[check_company_auto]{#check_company_auto}
:::

::: autoattribute
[parent_name]{#parent_name}
:::

::: autoattribute
[parent_store]{#parent_store}
:::

::: autoattribute
[fold_name]{#fold_name}
:::
::::::::::::::::::::

### AbstractModel

::: autoclass
odoo.models.AbstractModel
:::

### Model

::::: autoclass
odoo.models.Model

::: autoattribute
[auto]{#auto}
:::

::: autoattribute
[abstract]{#abstract}
:::
:::::

### TransientModel

::::: {.autoclass members="_transient_vacuum"}
odoo.models.TransientModel

::: autoattribute
[transient_max_count]{#transient_max_count}
:::

::: autoattribute
[transient_max_hours]{#transient_max_hours}
:::
:::::

## Fields[]{#reference/fields} {#reference/orm/fields}

::: currentmodule
odoo.fields
:::

::: autoclass
Field()
:::

### Basic Fields {#reference/fields/basic}

::: autoclass
Boolean()
:::

::: autoclass
Char()
:::

::: autoclass
Float()
:::

::: autoclass
Integer()
:::

### Advanced Fields {#reference/fields/advanced}

::: autoclass
Binary()
:::

::: autoclass
Html()
:::

::: autoclass
Image()
:::

::: autoclass
Monetary()
:::

::: autoclass
Selection()
:::

::: autoclass
Text()
:::

#### Date(time) Fields {#reference/fields/date}

`Dates <odoo.fields.Date>`{.interpreted-text role="class"} and
`Datetimes <odoo.fields.Datetime>`{.interpreted-text role="class"} are
very important fields in any kind of business application. Their misuse
can create invisible yet painful bugs, this section aims to provide Odoo
developers with the knowledge required to avoid misusing these fields.

When assigning a value to a Date/Datetime field, the following options
are valid:

- A [date]{.title-ref} or [datetime]{.title-ref} object.
- A string in the proper server format:
  - `YYYY-MM-DD` for `~odoo.fields.Date`{.interpreted-text role="class"}
    fields,
  - `YYYY-MM-DD HH:MM:SS` for `~odoo.fields.Datetime`{.interpreted-text
    role="class"} fields.
- [False]{.title-ref} or [None]{.title-ref}.

The Date and Datetime fields class have helper methods to attempt
conversion into a compatible type:

- `~odoo.fields.Date.to_date`{.interpreted-text role="func"} will
  convert to a `datetime.date`{.interpreted-text role="class"}
- `~odoo.fields.Datetime.to_datetime`{.interpreted-text role="func"}
  will convert to a `datetime.datetime`{.interpreted-text role="class"}.

::: example
To parse date/datetimes coming from external sources:

    fields.Date.to_date(self._context.get('date_from'))
:::

Date / Datetime comparison best practices:

- Date fields can **only** be compared to date objects.
- Datetime fields can **only** be compared to datetime objects.

:::: warning
::: title
Warning
:::

Strings representing dates and datetimes can be compared between each
other, however the result may not be the expected result, as a datetime
string will always be greater than a date string, therefore this
practice is **heavily** discouraged.
::::

Common operations with dates and datetimes such as addition, subtraction
or fetching the start/end of a period are exposed through both
`~odoo.fields.Date`{.interpreted-text role="class"} and
`~odoo.fields.Datetime`{.interpreted-text role="class"}. These helpers
are also available by importing [odoo.tools.date_utils]{.title-ref}.

:::: note
::: title
Note
:::

Timezones

Datetime fields are stored as [timestamp without timezone]{.title-ref}
columns in the database and are stored in the UTC timezone. This is by
design, as it makes the Odoo database independent from the timezone of
the hosting server system. Timezone conversion is managed entirely by
the client side.
::::

::: {.autoclass members="today, context_today, to_date, to_string, start_of, end_of, add, subtract"}
Date()
:::

::: {.autoclass members="now, today, context_timestamp, to_datetime, to_string, start_of, end_of, add, subtract"}
Datetime()
:::

#### Relational Fields {#reference/fields/relational}

::: autoclass
Many2one()
:::

::: autoclass
One2many()
:::

::: autoclass
Many2many()
:::

::: {.autoclass members="" undoc-members="" member-order="bysource"}
Command()
:::

#### Pseudo-relational fields

::: autoclass
Reference()
:::

::: autoclass
Many2oneReference()
:::

#### Computed Fields {#reference/fields/compute}

Fields can be computed (instead of read straight from the database)
using the `compute` parameter. **It must assign the computed value to
the field**. If it uses the values of other *fields*, it should specify
those fields using `~odoo.api.depends`{.interpreted-text role="func"}. :

    from odoo import api
    total = fields.Float(compute='_compute_total')

    @api.depends('value', 'tax')
    def _compute_total(self):
        for record in self:
            record.total = record.value + record.value * record.tax

- dependencies can be dotted paths when using sub-fields:

      @api.depends('line_ids.value')
      def _compute_total(self):
          for record in self:
              record.total = sum(line.value for line in record.line_ids)

- computed fields are not stored by default, they are computed and
  returned when requested. Setting `store=True` will store them in the
  database and automatically enable searching.

- searching on a computed field can also be enabled by setting the
  `search` parameter. The value is a method name returning a
  `reference/orm/domains`{.interpreted-text role="ref"}. :

      upper_name = field.Char(compute='_compute_upper', search='_search_upper')

      def _search_upper(self, operator, value):
          if operator == 'like':
              operator = 'ilike'
          return [('name', operator, value)]

  The search method is invoked when processing domains before doing an
  actual search on the model. It must return a domain equivalent to the
  condition: `field operator value`.

<!-- -->

- Computed fields are readonly by default. To allow *setting* values on
  a computed field, use the `inverse` parameter. It is the name of a
  function reversing the computation and setting the relevant fields:

      document = fields.Char(compute='_get_document', inverse='_set_document')

      def _get_document(self):
          for record in self:
              with open(record.get_document_path) as f:
                  record.document = f.read()
      def _set_document(self):
          for record in self:
              if not record.document: continue
              with open(record.get_document_path()) as f:
                  f.write(record.document)

- multiple fields can be computed at the same time by the same method,
  just use the same method on all fields and set all of them:

      discount_value = fields.Float(compute='_apply_discount')
      total = fields.Float(compute='_apply_discount')

      @api.depends('value', 'discount')
      def _apply_discount(self):
          for record in self:
              # compute actual discount from discount percentage
              discount = record.value * record.discount
              record.discount_value = discount
              record.total = record.value - discount

:::: warning
::: title
Warning
:::

While it is possible to use the same compute method for multiple fields,
it is not recommended to do the same for the inverse method.

During the computation of the inverse, **all** fields that use said
inverse are protected, meaning that they can\'t be computed, even if
their value is not in the cache.

If any of those fields is accessed and its value is not in cache, the
ORM will simply return a default value of [False]{.title-ref} for these
fields. This means that the value of the inverse fields (other than the
one triggering the inverse method) may not give their correct value and
this will probably break the expected behavior of the inverse method.
::::

#### Related fields {#reference/fields/related}

A special case of computed fields are *related* (proxy) fields, which
provide the value of a sub-field on the current record. They are defined
by setting the `related` parameter and like regular computed fields they
can be stored:

    nickname = fields.Char(related='user_id.partner_id.name', store=True)

The value of a related field is given by following a sequence of
relational fields and reading a field on the reached model. The complete
sequence of fields to traverse is specified by the `related` attribute.

Some field attributes are automatically copied from the source field if
they are not redefined: `string`, `help`, `required` (only if all fields
in the sequence are required), `groups`, `digits`, `size`, `translate`,
`sanitize`, `selection`, `comodel_name`, `domain`, `context`. All
semantic-free attributes are copied from the source field.

By default, related fields are:

- not stored
- not copied
- readonly
- computed in superuser mode

Add the attribute `store=True` to make it stored, just like computed
fields. Related fields are automatically recomputed when their
dependencies are modified.

:::: tip
::: title
Tip
:::

You can specify precise field dependencies if you don\'t want the
related field to be recomputed on any dependency change:

    nickname = fields.Char(
        related='partner_id.name', store=True,
        depends=['partner_id'])
    # The nickname will only be recomputed when the partner_id
    # is modified, not when the name is modified on the partner.
::::

:::: warning
::: title
Warning
:::

You cannot chain `~odoo.fields.Many2many`{.interpreted-text
role="class"} or `~odoo.fields.One2many`{.interpreted-text role="class"}
fields in `related` fields dependencies.

`related` can be used to refer to a
`~odoo.fields.One2many`{.interpreted-text role="class"} or
`~odoo.fields.Many2many`{.interpreted-text role="class"} field on
another model on the condition that it\'s done through a `Many2one`
relation on the current model. `One2many` and `Many2many` are not
supported and the results will not be aggregated correctly:

    m2o_id = fields.Many2one()
    m2m_ids = fields.Many2many()
    o2m_ids = fields.One2many()

    # Supported
    d_ids = fields.Many2many(related="m2o_id.m2m_ids")
    e_ids = fields.One2many(related="m2o_id.o2m_ids")

    # Won't work: use a custom Many2many computed field instead
    f_ids = fields.Many2many(related="m2m_ids.m2m_ids")
    g_ids = fields.One2many(related="o2m_ids.o2m_ids")
::::

::: currentmodule
odoo.models
:::

### Automatic fields {#reference/fields/automatic}

::: attribute
Model.id

Identifier `field <odoo.fields.Field>`{.interpreted-text role="class"}

If length of current recordset is 1, return id of unique record in it.

Raise an Error otherwise.
:::

#### Access Log fields {#reference/fields/automatic/log_access}

These fields are automatically set and updated if
`~odoo.models.BaseModel._log_access`{.interpreted-text role="attr"} is
enabled. It can be disabled to avoid creating or updating those fields
on tables for which they are not useful.

By default, `~odoo.models.BaseModel._log_access`{.interpreted-text
role="attr"} is set to the same value as
`~odoo.models.BaseModel._auto`{.interpreted-text role="attr"}

::: attribute
Model.create_date

Stores when the record was created,
`~odoo.fields.Datetime`{.interpreted-text role="class"}
:::

::: attribute
Model.create_uid

Stores *who* created the record,
`~odoo.fields.Many2one`{.interpreted-text role="class"} to a
`res.users`.
:::

::: attribute
Model.write_date

Stores when the record was last updated,
`~odoo.fields.Datetime`{.interpreted-text role="class"}
:::

::: attribute
Model.write_uid

Stores who last updated the record,
`~odoo.fields.Many2one`{.interpreted-text role="class"} to a
`res.users`.
:::

:::: warning
::: title
Warning
:::

`~odoo.models.BaseModel._log_access`{.interpreted-text role="attr"}
*must* be enabled on `~odoo.models.TransientModel`{.interpreted-text
role="class"}.
::::

### Reserved Field names {#reference/orm/fields/reserved}

A few field names are reserved for pre-defined behaviors beyond that of
automated fields. They should be defined on a model when the related
behavior is desired:

::: attribute
Model.name

default value for `~odoo.models.BaseModel._rec_name`{.interpreted-text
role="attr"}, used to display records in context where a representative
\"naming\" is necessary.

`~odoo.fields.Char`{.interpreted-text role="class"}
:::

:::::: attribute
Model.active

toggles the global visibility of the record, if `active` is set to
`False` the record is invisible in most searches and listing.

`~odoo.fields.Boolean`{.interpreted-text role="class"}

Special methods:

::: automethod
Model.toggle_active
:::

::: automethod
Model.action_archive
:::

::: automethod
Model.action_unarchive
:::
::::::

::: attribute
Model.state

lifecycle stages of the object, used by the `states` attribute on
`fields <odoo.fields.Field>`{.interpreted-text role="class"}.

`~odoo.fields.Selection`{.interpreted-text role="class"}
:::

::: attribute
Model.parent_id

default_value of `~._parent_name`{.interpreted-text role="attr"}, used
to organize records in a tree structure and enables the `child_of` and
`parent_of` operators in domains.

`~odoo.fields.Many2one`{.interpreted-text role="class"}
:::

::: attribute
Model.parent_path

When `~._parent_store`{.interpreted-text role="attr"} is set to True,
used to store a value reflecting the tree structure of
`~._parent_name`{.interpreted-text role="attr"}, and to optimize the
operators `child_of` and `parent_of` in search domains. It must be
declared with `index=True` for proper operation.

`~odoo.fields.Char`{.interpreted-text role="class"}
:::

::: attribute
Model.company_id

Main field name used for Odoo multi-company behavior.

Used by [:meth:\~odoo.models.\_check_company]{.title-ref} to check multi
company consistency. Defines whether a record is shared between
companies (no value) or only accessible by the users of a given company.

`~odoo.fields.Many2one`{.interpreted-text role="class"} :type:
`~odoo.addons.base.models.res_company`{.interpreted-text role="class"}
:::

## Recordsets

Interactions with models and records are performed through recordsets,
an ordered collection of records of the same model.

:::: warning
::: title
Warning
:::

Contrary to what the name implies, it is currently possible for
recordsets to contain duplicates. This may change in the future.
::::

Methods defined on a model are executed on a recordset, and their `self`
is a recordset:

    class AModel(models.Model):
        _name = 'a.model'
        def a_method(self):
            # self can be anything between 0 records and all records in the
            # database
            self.do_operation()

Iterating on a recordset will yield new sets of *a single record*
(\"singletons\"), much like iterating on a Python string yields strings
of a single characters:

    def do_operation(self):
        print(self) # => a.model(1, 2, 3, 4, 5)
        for record in self:
            print(record) # => a.model(1), then a.model(2), then a.model(3), ...

### Field access

Recordsets provide an \"Active Record\" interface: model fields can be
read and written directly from the record as attributes.

:::: note
::: title
Note
:::

When accessing non-relational fields on a recordset of potentially
multiple records, use `~odoo.models.BaseModel.mapped`{.interpreted-text
role="meth"}:

    total_qty = sum(self.mapped('qty'))
::::

Field values can also be accessed like dict items, which is more elegant
and safer than `getattr()` for dynamic field names. Setting a field\'s
value triggers an update to the database:

    >>> record.name
    Example Name
    >>> record.company_id.name
    Company Name
    >>> record.name = "Bob"
    >>> field = "name"
    >>> record[field]
    Bob

:::: warning
::: title
Warning
:::

Trying to read a field on multiple records will raise an error for non
relational fields.
::::

Accessing a relational field (`~odoo.fields.Many2one`{.interpreted-text
role="class"}, `~odoo.fields.One2many`{.interpreted-text role="class"},
`~odoo.fields.Many2many`{.interpreted-text role="class"}) *always*
returns a recordset, empty if the field is not set.

### Record cache and prefetching

Odoo maintains a cache for the fields of the records, so that not every
field access issues a database request, which would be terrible for
performance. The following example queries the database only for the
first statement:

    record.name             # first access reads value from database
    record.name             # second access gets value from cache

To avoid reading one field on one record at a time, Odoo *prefetches*
records and fields following some heuristics to get good performance.
Once a field must be read on a given record, the ORM actually reads that
field on a larger recordset, and stores the returned values in cache for
later use. The prefetched recordset is usually the recordset from which
the record comes by iteration. Moreover, all simple stored fields
(boolean, integer, float, char, text, date, datetime, selection,
many2one) are fetched altogether; they correspond to the columns of the
model\'s table, and are fetched efficiently in the same query.

Consider the following example, where `partners` is a recordset of 1000
records. Without prefetching, the loop would make 2000 queries to the
database. With prefetching, only one query is made:

    for partner in partners:
        print partner.name          # first pass prefetches 'name' and 'lang'
                                    # (and other fields) on all 'partners'
        print partner.lang

The prefetching also works on *secondary records*: when relational
fields are read, their values (which are records) are subscribed for
future prefetching. Accessing one of those secondary records prefetches
all secondary records from the same model. This makes the following
example generate only two queries, one for partners and one for
countries:

    countries = set()
    for partner in partners:
        country = partner.country_id        # first pass prefetches all partners
        countries.add(country.name)         # first pass prefetches all countries

## Method decorators {#reference/api/decorators}

::: {.automodule members="depends, depends_context, constrains, onchange, returns, autovacuum, model, model_create_multi, ondelete"}
odoo.api
:::

::: todo
With sphinx 2.0 : autodecorator
:::

::: todo
Add in Views reference \* It is possible to suppress the trigger from a
specific field by adding `on_change="0"` in a view:

    <field name="name" on_change="0"/>

will not trigger any interface update when the field is edited by the
user, even if there are function fields or explicit onchange depending
on that field.
:::

## Environment {#reference/orm/environment}

::: currentmodule
odoo.api
:::

::: autoclass
Environment
:::

``` bash
>>> records.env
<Environment object ...>
>>> records.env.uid
3
>>> records.env.user
res.user(3)
>>> records.env.cr
<Cursor object ...>
```

When creating a recordset from an other recordset, the environment is
inherited. The environment can be used to get an empty recordset in an
other model, and query that model:

``` bash
>>> self.env['res.partner']
res.partner()
>>> self.env['res.partner'].search([('is_company', '=', True), ('customer', '=', True)])
res.partner(7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74)
```

Some lazy properties are available to access the environment
(contextual) data:

::: autoattribute
Environment.lang
:::

::: autoattribute
Environment.user
:::

::: autoattribute
Environment.company
:::

::: autoattribute
Environment.companies
:::

### Useful environment methods

::: automethod
Environment.ref
:::

::: automethod
Environment.is_superuser
:::

::: automethod
Environment.is_admin
:::

::: automethod
Environment.is_system
:::

### Altering the environment

::: currentmodule
odoo.models
:::

::: automethod
Model.with_context
:::

::: automethod
Model.with_user
:::

::: automethod
Model.with_company
:::

::: automethod
Model.with_env
:::

::: automethod
Model.sudo
:::

### SQL Execution {#reference/orm/sql}

The `~odoo.api.Environment.cr`{.interpreted-text role="attr"} attribute
on environments is the cursor for the current database transaction and
allows executing SQL directly, either for queries which are difficult to
express using the ORM (e.g. complex joins) or for performance reasons:

    self.env.cr.execute("some_sql", params)

:::: warning
::: title
Warning
:::

Executing raw SQL bypasses the ORM and, by consequent, Odoo security
rules. Please make sure your queries are sanitized when using user input
and prefer using ORM utilities if you don\'t really need to use SQL
queries.
::::

One important thing to know about models is that they don\'t necessarily
perform database updates right away. Indeed, for performance reasons,
the framework delays the recomputation of fields after modifying
records. And some database updates are delayed, too. Therefore, before
querying the database, one has to make sure that it contains the
relevant data for the query. This operation is called *flushing* and
performs the expected database updates.

::: example
``` python
# make sure that 'partner_id' is up-to-date in database
self.env['model'].flush_model(['partner_id'])

self.env.cr.execute("SELECT id FROM model WHERE partner_id IN %s", [ids])
ids = [row[0] for row in self.env.cr.fetchall()]
```
:::

Before every SQL query, one has to flush the data needed for that query.
There are three levels for flushing, each with its own API. One can
flush either everything, all the records of a model, or some specific
records. Because delaying updates improves performance in general, we
recommend to be *specific* when flushing.

::: automethod
odoo.api.Environment.flush_all
:::

::: automethod
Model.flush_model
:::

::: automethod
Model.flush_recordset
:::

Because models use the same cursor and the
`~odoo.api.Environment`{.interpreted-text role="class"} holds various
caches, these caches must be invalidated when *altering* the database in
raw SQL, or further uses of models may become incoherent. It is
necessary to clear caches when using `CREATE`, `UPDATE` or `DELETE` in
SQL, but not `SELECT` (which simply reads the database).

::: example
``` python
# make sure 'state' is up-to-date in database
self.env['model'].flush_model(['state'])

self.env.cr.execute("UPDATE model SET state=%s WHERE state=%s", ['new', 'old'])

# invalidate 'state' from the cache
self.env['model'].invalidate_model(['state'])
```
:::

Just like flushing, one can invalidate either the whole cache, the cache
of all the records of a model, or the cache of specific records. One can
even invalidate specific fields on some records or all records of a
model. As the cache improves performance in general, we recommend to be
*specific* when invalidating.

::: automethod
odoo.api.Environment.invalidate_all
:::

::: automethod
Model.invalidate_model
:::

::: automethod
Model.invalidate_recordset
:::

The methods above keep the caches and the database consistent with each
other. However, if computed field dependencies have been modified in the
database, one has to inform the models for the computed fields to be
recomputed. The only thing the framework needs to know is *what* fields
have changed on *which* records.

::: example
``` python
# make sure 'state' is up-to-date in database
self.env['model'].flush_model(['state'])

# use the RETURNING clause to retrieve which rows have changed
self.env.cr.execute("UPDATE model SET state=%s WHERE state=%s RETURNING id", ['new', 'old'])
ids = [row[0] for row in self.env.cr.fetchall()]

# invalidate the cache, and notify the update to the framework
records = self.env['model'].browse(ids)
records.invalidate_recordset(['state'])
records.modified(['state'])
```
:::

One has to figure out which records have been modified. There are many
ways to do this, possibly involving extra SQL queries. In the example
above, we take advantage of the `RETURNING` clause of PostgreSQL to
retrieve the information without an extra query. After making the cache
consistent by invalidation, invoke the method `modified` on the modified
records with the fields that have been updated.

::: automethod
Model.modified
:::

## Common ORM methods {#reference/orm/models/crud}

::: currentmodule
odoo.models
:::

### Create/update

::: todo
api.model_create_multi information
:::

::: automethod
Model.create
:::

::: automethod
Model.copy
:::

::: automethod
Model.default_get
:::

::: automethod
Model.name_create
:::

::: automethod
Model.write
:::

### Search/Read

::: automethod
Model.browse
:::

::: automethod
Model.search
:::

::: automethod
Model.search_count
:::

::: automethod
Model.name_search
:::

::: automethod
Model.read
:::

::: automethod
Model.read_group
:::

#### Fields

::: automethod
Model.fields_get
:::

#### Search domains {#reference/orm/domains}

A domain is a list of criteria, each criterion being a triple (either a
`list` or a `tuple`) of `(field_name, operator, value)` where:

- 

  `field_name` (`str`)

  :   a field name of the current model, or a relationship traversal
      through a `~odoo.fields.Many2one`{.interpreted-text role="class"}
      using dot-notation e.g. `'street'` or `'partner_id.country'`

- 

  `operator` (`str`)

  :   an operator used to compare the `field_name` with the `value`.
      Valid operators are:

      `=`

      :   equals to

      `!=`

      :   not equals to

      `>`

      :   greater than

      `>=`

      :   greater than or equal to

      `<`

      :   less than

      `<=`

      :   less than or equal to

      `=?`

      :   unset or equals to (returns true if `value` is either `None`
          or `False`, otherwise behaves like `=`)

      `=like`

      :   matches `field_name` against the `value` pattern. An
          underscore `_` in the pattern stands for (matches) any single
          character; a percent sign `%` matches any string of zero or
          more characters.

      `like`

      :   matches `field_name` against the `%value%` pattern. Similar to
          `=like` but wraps `value` with \'%\' before matching

      `not like`

      :   doesn\'t match against the `%value%` pattern

      `ilike`

      :   case insensitive `like`

      `not ilike`

      :   case insensitive `not like`

      `=ilike`

      :   case insensitive `=like`

      `in`

      :   is equal to any of the items from `value`, `value` should be a
          list of items

      `not in`

      :   is unequal to all of the items from `value`

      `child_of`

      :   is a child (descendant) of a `value` record (value can be
          either one item or a list of items).

          Takes the semantics of the model into account (i.e following
          the relationship field named by
          `~odoo.models.Model._parent_name`{.interpreted-text
          role="attr"}).

      `parent_of`

      :   is a parent (ascendant) of a `value` record (value can be
          either one item or a list of items).

          Takes the semantics of the model into account (i.e following
          the relationship field named by
          `~odoo.models.Model._parent_name`{.interpreted-text
          role="attr"}).

- 

  `value`

  :   variable type, must be comparable (through `operator`) to the
      named field.

Domain criteria can be combined using logical operators in *prefix*
form:

`'&'`

:   logical *AND*, default operation to combine criteria following one
    another. Arity 2 (uses the next 2 criteria or combinations).

`'|'`

:   logical *OR*, arity 2.

`'!'`

:   logical *NOT*, arity 1.

    :::: note
    ::: title
    Note
    :::

    Mostly to negate combinations of criteria Individual criterion
    generally have a negative form (e.g. `=` -\> `!=`, `<` -\> `>=`)
    which is simpler than negating the positive.
    ::::

::: example
To search for partners named *ABC*, from belgium or germany, whose
language is not english:

    [('name','=','ABC'),
     ('language.code','!=','en_US'),
     '|',('country_id.code','=','be'),
         ('country_id.code','=','de')]

This domain is interpreted as:

``` text
(name is 'ABC')
AND (language is NOT english)
AND (country is Belgium OR Germany)
```
:::

### Unlink

::: automethod
Model.unlink
:::

### Record(set) information {#reference/orm/records/info}

::: autoattribute
Model.ids
:::

::: attribute
env

Returns the environment of the given recordset.

type
:   `~odoo.api.Environment`{.interpreted-text role="class"}
:::

::: todo
Environment documentation
:::

::: automethod
Model.exists
:::

::: automethod
Model.ensure_one
:::

::: automethod
Model.name_get
:::

::: automethod
Model.get_metadata
:::

### Operations {#reference/orm/records/operations}

Recordsets are immutable, but sets of the same model can be combined
using various set operations, returning new recordsets.

- `record in set` returns whether `record` (which must be a 1-element
  recordset) is present in `set`. `record not in set` is the inverse
  operation
- `set1 <= set2` and `set1 < set2` return whether `set1` is a subset of
  `set2` (resp. strict)
- `set1 >= set2` and `set1 > set2` return whether `set1` is a superset
  of `set2` (resp. strict)
- `set1 | set2` returns the union of the two recordsets, a new recordset
  containing all records present in either source
- `set1 & set2` returns the intersection of two recordsets, a new
  recordset containing only records present in both sources
- `set1 - set2` returns a new recordset containing only records of
  `set1` which are *not* in `set2`

Recordsets are iterable so the usual Python tools are available for
transformation (`python:map`{.interpreted-text role="func"},
`python:sorted`{.interpreted-text role="func"},
`~python:itertools.ifilter`{.interpreted-text role="func"}, \...)
however these return either a `python:list`{.interpreted-text
role="class"} or an `python:iterator`{.interpreted-text role="term"},
removing the ability to call methods on their result, or to use set
operations.

Recordsets therefore provide the following operations returning
recordsets themselves (when possible):

#### Filter

::: automethod
Model.filtered
:::

::: automethod
Model.filtered_domain
:::

#### Map

::: automethod
Model.mapped
:::

:::: note
::: title
Note
:::

Since V13, multi-relational field access is supported and works like a
mapped call:

``` python3
records.partner_id  # == records.mapped('partner_id')
records.partner_id.bank_ids  # == records.mapped('partner_id.bank_ids')
records.partner_id.mapped('name')  # == records.mapped('partner_id.name')
```
::::

#### Sort

::: automethod
Model.sorted
:::

## Inheritance and extension {#reference/orm/inheritance}

Odoo provides three different mechanisms to extend models in a modular
way:

- creating a new model from an existing one, adding new information to
  the copy but leaving the original module as-is
- extending models defined in other modules in-place, replacing the
  previous version
- delegating some of the model\'s fields to records it contains

![image](orm/inheritance_methods.png){.align-center}

### Classical inheritance

When using the `~odoo.models.Model._inherit`{.interpreted-text
role="attr"} and `~odoo.models.Model._name`{.interpreted-text
role="attr"} attributes together, Odoo creates a new model using the
existing one (provided via
`~odoo.models.Model._inherit`{.interpreted-text role="attr"}) as a base.
The new model gets all the fields, methods and meta-information
(defaults & al) from its base.

``` python
class Inheritance0(models.Model):
    _name = 'inheritance.0'
    _description = 'Inheritance Zero'

    name = fields.Char()

    def call(self):
        return self.check("model 0")

    def check(self, s):
        return "This is {} record {}".format(s, self.name)

class Inheritance1(models.Model):
    _name = 'inheritance.1'
    _inherit = 'inheritance.0'
    _description = 'Inheritance One'

    def call(self):
        return self.check("model 1")
```

and using them:

    a = env['inheritance.0'].create({'name': 'A'})
    b = env['inheritance.1'].create({'name': 'B'})

    a.call()
    b.call()

will yield:

> \"This is model 0 record A\" \"This is model 1 record B\"

the second model has inherited from the first model\'s `check` method
and its `name` field, but overridden the `call` method, as when using
standard `Python inheritance <python:tut-inheritance>`{.interpreted-text
role="ref"}.

### Extension

When using `~odoo.models.Model._inherit`{.interpreted-text role="attr"}
but leaving out `~odoo.models.Model._name`{.interpreted-text
role="attr"}, the new model replaces the existing one, essentially
extending it in-place. This is useful to add new fields or methods to
existing models (created in other modules), or to customize or
reconfigure them (e.g. to change their default sort order):

    class Extension0(models.Model):
    _name = 'extension.0'
    _description = 'Extension zero'

    name = fields.Char(default="A")

    class Extension1(models.Model):
    _inherit = 'extension.0'

    description = fields.Char(default="Extended")

``` python3
record = env['extension.0'].create({})
record.read()[0]
```

will yield:

    {'name': "A", 'description': "Extended"}

:::: note
::: title
Note
:::

It will also yield the various `automatic fields
<reference/fields/automatic>`{.interpreted-text role="ref"} unless
they\'ve been disabled
::::

### Delegation

The third inheritance mechanism provides more flexibility (it can be
altered at runtime) but less power: using the
`~odoo.models.Model._inherits`{.interpreted-text role="attr"} a model
*delegates* the lookup of any field not found on the current model to
\"children\" models. The delegation is performed via
`~odoo.fields.Reference`{.interpreted-text role="class"} fields
automatically set up on the parent model.

The main difference is in the meaning. When using Delegation, the model
**has one** instead of **is one**, turning the relationship in a
composition instead of inheritance:

    class Screen(models.Model):
        _name = 'delegation.screen'
        _description = 'Screen'

        size = fields.Float(string='Screen Size in inches')

    class Keyboard(models.Model):
        _name = 'delegation.keyboard'
        _description = 'Keyboard'

        layout = fields.Char(string='Layout')

    class Laptop(models.Model):
        _name = 'delegation.laptop'
        _description = 'Laptop'

        _inherits = {
            'delegation.screen': 'screen_id',
            'delegation.keyboard': 'keyboard_id',
        }

        name = fields.Char(string='Name')
        maker = fields.Char(string='Maker')

        # a Laptop has a screen
        screen_id = fields.Many2one('delegation.screen', required=True, ondelete="cascade")
        # a Laptop has a keyboard
        keyboard_id = fields.Many2one('delegation.keyboard', required=True, ondelete="cascade")

``` python3
record = env['delegation.laptop'].create({
    'screen_id': env['delegation.screen'].create({'size': 13.0}).id,
    'keyboard_id': env['delegation.keyboard'].create({'layout': 'QWERTY'}).id,
})
record.size
record.layout
```

will result in:

    13.0
    'QWERTY'

and it\'s possible to write directly on the delegated field:

    record.write({'size': 14.0})

:::: warning
::: title
Warning
:::

when using delegation inheritance, methods are *not* inherited, only
fields
::::

:::: warning
::: title
Warning
:::

- [\_inherits]{.title-ref} is more or less implemented, avoid it if you
  can;
- chained [\_inherits]{.title-ref} is essentially not implemented, we
  cannot guarantee anything on the final behavior.
::::

### Fields Incremental Definition

A field is defined as class attribute on a model class. If the model is
extended, one can also extend the field definition by redefining a field
with the same name and same type on the subclass. In that case, the
attributes of the field are taken from the parent class and overridden
by the ones given in subclasses.

For instance, the second class below only adds a tooltip on the field
`state`:

    class First(models.Model):
        _name = 'foo'
        state = fields.Selection([...], required=True)

    class Second(models.Model):
        _inherit = 'foo'
        state = fields.Selection(help="Blah blah blah")

## Error management {#reference/exceptions}

::: {.automodule members="AccessDenied, AccessError, CacheMiss, MissingError, RedirectWarning, UserError, ValidationError"}
odoo.exceptions
:::




--- SOURCE: developer/reference/backend/performance.md ---

custom-css
:   performance.css

# Performance

## Profiling {#performance/profiling}

::: currentmodule
odoo.tools.profiler
:::

Profiling is about analysing the execution of a program and measure
aggregated data. These data can be the elapsed time for each function,
the executed SQL queries\...

While profiling does not improve the performance of a program by itself,
it can prove very helpful in finding performance issues and identifying
which part of the program is responsible for them.

Odoo provides an integrated profiling tool that allows recording all
executed queries and stack traces during execution. It can be used to
profile either a set of requests of a user session, or a specific
portion of code. Profiling results can be either inspected with the
integrated [speedscope](https://github.com/jlfwong/speedscope)
`open source app allowing to visualize a flamegraph`{.interpreted-text
role="dfn"} view or analyzed with custom tools by first saving them in a
JSON file or in the database.

### Enable the profiler {#performance/profiling/enable}

The profiler can either be enabled from the user interface, which is the
easiest way to do so but allows profiling only web requests, or from
Python code, which allows profiling any piece of code including tests.

:::::::::::::::: tabs
::::: tab
Enable from the user interface

1.  `Enable the developer mode <developer-mode>`{.interpreted-text
    role="ref"}.

2.  Before starting a profiling session, the profiler must be enabled
    globally on the database. This can be done in two ways:

    - Open the
      `developer mode tools <developer-mode/tools>`{.interpreted-text
      role="ref"}, then toggle the `Enable profiling`{.interpreted-text
      role="guilabel"} button. A wizard suggests a set of expiry times
      for the profiling. Click on `ENABLE PROFILING`{.interpreted-text
      role="guilabel"} to enable the profiler globally.

      ![image](performance/enable_profiling_wizard.png)

    - Go to
      `Settings --> General Settings --> Performance`{.interpreted-text
      role="guilabel"} and set the desired time to the field
      `Enable profiling until`{.interpreted-text role="guilabel"}.

3.  After the profiler is enabled on the database, users can enable it
    on their session. To do so, toggle the
    `Enable profiling`{.interpreted-text role="guilabel"} button in the
    `developer mode tools
    <developer-mode/tools>`{.interpreted-text role="ref"} again. By
    default, the recommended options `Record
    sql`{.interpreted-text role="guilabel"} and
    `Record traces`{.interpreted-text role="guilabel"} are enabled. To
    learn more about the different options, head over to
    `performance/profiling/collectors`{.interpreted-text role="ref"}.

    ![image](performance/profiling_debug_menu.png)

When the profiler is enabled, all the requests made to the server are
profiled and saved into an [ir.profile]{.title-ref} record. Such records
are grouped into the current profiling session which spans from when the
profiler was enabled until it is disabled.

:::: note
::: title
Note
:::

Odoo Online databases cannot be profiled.
::::
:::::

:::::::::::: tab
Enable from Python code

Starting the profiler manually can be convenient to profile a specific
method or a part of the code. This code can be a test, a compute method,
the entire loading, etc.

To start the profiler from Python code, call it as a context manager.
You may specify *what* you want to record through the parameters. A
shortcut is available for profiling test classes: `self.profile()`. See
`performance/profiling/collectors`{.interpreted-text role="ref"} for
more information on the [collectors]{.title-ref} parameter.

::: example
``` python
with Profiler():
    do_stuff()
```
:::

::: example
``` python
with Profiler(collectors=['sql', PeriodicCollector(interval=0.1)]):
    do_stuff()
```
:::

::::: example
``` python
with self.profile():
    with self.assertQueryCount(__system__=1211):
        do_stuff()
```

:::: note
::: title
Note
:::

The profiler is called outside of the [assertQueryCount]{.title-ref} in
order to catch queries made when exiting the context manager (e.g.,
flush).
::::
:::::

::: {.autoclass special-members="__init__"}
Profiler()
:::

When the profiler is enabled, all executions of a test method are
profiled and saved into an [ir.profile]{.title-ref} record. Such records
are grouped into a single profiling session. This is especially useful
when using the `@warmup` and `@users` decorators.

::::: tip
::: title
Tip
:::

It can be complicated to analyze profiling results of a method that is
called several times because all the calls are grouped together in the
stack trace. Add an **execution context** as a context manager to break
down the results into multiple frames.

::: example
``` python
for index in range(max_index):
    with ExecutionContext(current_index=index):  # Identify each call in speedscope results.
        do_stuff()
```
:::
:::::
::::::::::::
::::::::::::::::

### Analyse the results {#performance/profiling/analyse}

To browse the profiling results, make sure that the
`profiler is enabled globally on the
database <performance/profiling/enable>`{.interpreted-text role="ref"},
then open the `developer mode tools
<developer-mode/tools>`{.interpreted-text role="ref"} and click on the
button in the top-right corner of the profiling section. A list view of
the [ir.profile]{.title-ref} records grouped by profiling session opens.

![image](performance/profiling_web.png){.align-center}

Each record has a clickable link that opens the speedscope results in a
new tab.

![image](performance/flamegraph_example.png){.align-center}

Speedscope falls out of the scope of this documentation but there are a
lot of tools to try: search, highlight of similar frames, zoom on frame,
timeline, left heavy, sandwich view\...

Depending on the profiling options that were activated, Odoo generates
different view modes that you can access from the top menu.

![image](performance/speedscope_modes.png){.align-center}

- The `Combined`{.interpreted-text role="guilabel"} view shows all the
  SQL queries and traces merged togethers.
- The `Combined no context`{.interpreted-text role="guilabel"} view
  shows the same result but ignores the saved execution context
  \<performance/profiling/enable\>\`.
- The `sql (no gap)`{.interpreted-text role="guilabel"} view shows all
  the SQL queries as if they were executed one after another, without
  any Python logic. This is useful for optimizing SQL only.
- The `sql (density)`{.interpreted-text role="guilabel"} view shows only
  all the SQL queries, leaving gap between them. This can be useful to
  spot if eiter SQL or Python code is the problem, and to identify zones
  in where many small queries could be batched.
- The `frames`{.interpreted-text role="guilabel"} view shows the results
  of only the `periodic collector
  <performance/profiling/collectors/periodic>`{.interpreted-text
  role="ref"}.

:::: important
::: title
Important
:::

Even though the profiler has been designed to be as light as possible,
it can still impact performance, especially when using the
`Sync collector
<performance/profiling/collectors/sync>`{.interpreted-text role="ref"}.
Keep that in mind when analyzing speedscope results.
::::

### Collectors {#performance/profiling/collectors}

Whereas the profiler is about the *when* of profiling, the collectors
take care of the *what*.

Each collector specializes in collecting profiling data in its own
format and manner. They can be individually enabled from the user
interface through their dedicated toggle button in the
`developer mode tools <developer-mode/tools>`{.interpreted-text
role="ref"}, or from Python code through their key or class.

There are currently four collectors available in Odoo:

  Name                                                                                             Toggle button                                        Python key                   Python class
  ------------------------------------------------------------------------------------------------ ---------------------------------------------------- ---------------------------- ---------------------------------
  `SQL collector <performance/profiling/collectors/sql>`{.interpreted-text role="ref"}             `Record sql`{.interpreted-text role="guilabel"}      [sql]{.title-ref}            [SqlCollector]{.title-ref}
  `Periodic collector <performance/profiling/collectors/periodic>`{.interpreted-text role="ref"}   `Record traces`{.interpreted-text role="guilabel"}   [traces_async]{.title-ref}   [PeriodicCollector]{.title-ref}
  `QWeb collector <performance/profiling/collectors/qweb>`{.interpreted-text role="ref"}           `Record qweb`{.interpreted-text role="guilabel"}     [qweb]{.title-ref}           [QwebCollector]{.title-ref}
  `Sync collector <performance/profiling/collectors/sync>`{.interpreted-text role="ref"}           No                                                   [traces_sync]{.title-ref}    [SyncCollector]{.title-ref}

By default, the profiler enables the SQL and the Periodic collectors.
Both when it is enabled from the user interface or Python code.

#### SQL collector {#performance/profiling/collectors/sql}

The SQL collector saves all the SQL queries made to the database in the
current thread (for all cursors), as well as the stack trace. The
overhead of the collector is added to the analysed thread for each
query, which means that using it on a lot of small queries may impact
execution time and other profilers.

It is especially useful to debug query counts, or to add information to
the `Periodic collector
<performance/profiling/collectors/periodic>`{.interpreted-text
role="ref"} in the combined speedscope view.

::: autoclass
SQLCollector
:::

#### Periodic collector {#performance/profiling/collectors/periodic}

This collector runs in a separate thread and saves the stack trace of
the analysed thread at every interval. The interval (by default 10 ms)
can be defined through the `Interval`{.interpreted-text role="guilabel"}
option in the user interface, or the [interval]{.title-ref} parameter in
Python code.

:::: warning
::: title
Warning
:::

If the interval is set at a very low value, profiling long requests will
generate memory issues. If the interval is set at a very high value,
information on short function executions will be lost.
::::

It is one of the best way to analyse performance as it should have a
very low impact on the execution time thanks to its separate thread.

::: autoclass
PeriodicCollector
:::

#### QWeb collector {#performance/profiling/collectors/qweb}

This collector saves the Python execution time and queries of all
directives. As for the `SQL
collector <performance/profiling/collectors/sql>`{.interpreted-text
role="ref"}, the overhead can be important when executing a lot of small
directives. The results are different from other collectors in terms of
collected data, and can be analysed from the [ir.profile]{.title-ref}
form view using a custom widget.

It is mainly useful for optimizing views.

::: autoclass
QwebCollector
:::

#### Sync collector {#performance/profiling/collectors/sync}

This collector saves the stack for every function\'s call and return and
runs on the same thread, which greatly impacts performance.

It can be useful to debug and understand complex flows, and follow their
execution in the code. It is however not recommended for performance
analysis because the overhead is high.

::: autoclass
SyncCollector
:::

### Performance pitfalls {#performance/profiling/pitfalls}

- Be careful with randomness. Multiple executions may lead to different
  results. E.g., a garbage collector being triggered during execution.
- Be careful with blocking calls. In some cases, external
  [c_call]{.title-ref} may take some time before releasing the GIL, thus
  leading to unexpected long frames with the `Periodic collector
  <performance/profiling/collectors/periodic>`{.interpreted-text
  role="ref"}. This should be detected by the profiler and give a
  warning. It is possible to trigger the profiler manually before such
  calls if needed.
- Pay attention to the cache. Profiling before that the
  [view]{.title-ref}/\`assets\`/\... are in cache can lead to different
  results.
- Be aware of the profiler\'s overhead. The `SQL collector
  <performance/profiling/collectors/sql>`{.interpreted-text
  role="ref"}\'s overhead can be important when a lot of small queries
  are executed. Profiling is practical to spot a problem but you may
  want to disable the profiler in order to measure the real impact of a
  code change.
- Profiling results can be memory intensive. In some cases (e.g.,
  profiling an install or a long request), it is possible that you reach
  memory limit, especially when rendering the speedscope results, which
  can lead to an HTTP 500 error. In this case, you may need to start the
  server with a higher memory limit: [\--limit-memory-hard
  \$((8\*1024\*\*3))]{.title-ref}.

## Database population {#reference/performance/populate}

Odoo CLI offers a
`database population <reference/cmdline/populate>`{.interpreted-text
role="ref"} feature through the CLI command
`odoo-bin populate`{.interpreted-text role="command"}.

Instead of the tedious manual, or programmatic, specification of test
data, one can use this feature to fill a database on demand with the
desired number of test data. This can be used to detect diverse bugs or
performance issues in tested flows.

::: {#reference/performance/populate/methods}
To populate a given model, the following methods and attributes can be
defined.
:::

::: currentmodule
odoo.models
:::

::: autoattribute
Model.\_populate_sizes
:::

::: autoattribute
Model.\_populate_dependencies
:::

::: automethod
Model.\_populate
:::

::: automethod
Model.\_populate_factories
:::

:::: note
::: title
Note
:::

You have to define at least
`~odoo.models.Model._populate`{.interpreted-text role="meth"} or
`~odoo.models.Model._populate_factories`{.interpreted-text role="meth"}
on the model to enable database population.
::::

::: example
.. code-block:: python

from odoo.tools import populate

class CustomModel(models.Model)

:   [inherit]{#inherit} = \"custom.some_model\"
    [populate_sizes]{#populate_sizes} = {\"small\": 100, \"medium\":
    2000, \"large\": 10000}
    [populate_dependencies]{#populate_dependencies} =
    \[\"custom.some_other_model\"\]

    def [populate_factories]{#populate_factories}(self):

    :   \# Record ids of previously populated models are accessible in
        the registry some_other_ids =
        self.env.registry.populated_models\[\"custom.some_other_model\"\]

        def get_some_field(values=None, random=None, \*\*kwargs):

        :   \"\"\" Choose a value for some_field depending on other
            fields values.

            param dict values

            :   

            param random
            :   seeded `random.Random`{.interpreted-text role="class"}
                object

            \"\"\" field_1 = values\[\'field_1\'\] if field_1 in
            \[value2, value3\]: return random.choice(some_field_values)
            return False

        return \[

        :   (\"field_1\", populate.randomize(\[value1, value2,
            value3\])), (\"field_2\", populate.randomize(\[value_a,
            value_b\], \[0.5, 0.5\])), (\"some_other_id\",
            populate.randomize(some_other_ids)), (\"some_field\",
            populate.compute(get_some_field, seed=\"some_field\")),
            (\'active\', populate.cartesian(\[True, False\])),

        \]

    def [populate]{#populate}(self, size):

    :   records = super().\_populate(size)

        \# If you want to update the generated records \# E.g setting
        the parent-child relationships records.do_something()

        return records
:::

### Population tools

Multiple population tools are available to easily create the needed data
generators.

::: {.automodule members="cartesian, compute, constant, iterate, randint, randomize"}
odoo.tools.populate
:::

## Good practices {#performance/good_practices}

### Batch operations {#performance/good_practices/batch}

When working with recordsets, it is almost always better to batch
operations.

::::::: example
Don\'t call a method that runs SQL queries while looping over a
recordset because it will do so for each record of the set.

::: rst-class
bad-example
:::

``` python
def _compute_count(self):
    for record in self:
        domain = [('related_id', '=', record.id)]
        record.count = other_model.search_count(domain)
```

Instead, replace the [search_count]{.title-ref} with a
[read_group]{.title-ref} to execute one SQL query for the entire batch
of records.

::: rst-class
good-example
:::

``` python
def _compute_count(self):
    if self.ids:
        domain = [('related_id', 'in', self.ids)]
        counts_data = other_model.read_group(domain, ['related_id'], ['related_id'])
        mapped_data = {
            count['related_id'][0]: count['related_id_count'] for count in counts_data
        }
    else:
        mapped_data = {}
    for record in self:
        record.count = mapped_data.get(record.id, 0)
```

:::: note
::: title
Note
:::

This example is not optimal nor correct in all cases. It is only a
substitute for a [search_count]{.title-ref}. Another solution could be
to prefetch and count the inverse [One2many]{.title-ref} field.
::::
:::::::

::::: example
Don\'t create records one after another.

::: rst-class
bad-example
:::

``` python
for name in ['foo', 'bar']:
    model.create({'name': name})
```

Instead, accumulate the create values and call the [create]{.title-ref}
method on the batch. Doing so has mostly no impact and helps the
framework optimize fields computation.

::: rst-class
good-example
:::

``` python
create_values = []
for name in ['foo', 'bar']:
    create_values.append({'name': name})
records = model.create(create_values)
```
:::::

::::: example
Fail to prefetch the fields of a recordset while browsing a single
record inside a loop.

::: rst-class
bad-example
:::

``` python
for record_id in record_ids:
    model.browse(record_id)
    record.foo  # One query is executed per record.
```

Instead, browse the entire recordset first.

::: rst-class
good-example
:::

``` python
records = model.browse(record_ids)
for record in records:
    record.foo  # One query is executed for the entire recordset.
```

We can verify that the records are prefetched in batch by reading the
field [prefetch_ids]{.title-ref} which includes each of the record
ids.browsing all records together is unpractical,

If needed, the [with_prefetch]{.title-ref} method can be used to disable
batch prefetching:

``` python
for values in values_list:
    message = self.browse(values['id']).with_prefetch(self.ids)
```
:::::

### Reduce the algorithmic complexity {#performance/good_practices/algorithmic_complexity}

Algorithmic complexity is a measure of how long an algorithm would take
to complete in regard to the size [n]{.title-ref} of the input. When the
complexity is high, the execution time can grow quickly as the input
becomes larger. In some cases, the algorithmic complexity can be reduced
by preparing the input\'s data correctly.

::::: example
For a given problem, let\'s consider a naive algorithm crafted with two
nested loops for which the complexity in in O(n²).

::: rst-class
bad-example
:::

``` python
for record in self:
    for result in results:
        if results['id'] == record.id:
            record.foo = results['foo']
            break
```

Assuming that all results have a different id, we can prepare the data
to reduce the complexity.

::: rst-class
good-example
:::

``` python
mapped_result = {result['id']: result['foo'] for result in results}
for record in self:
    record.foo = mapped_result.get(record.id)
```
:::::

:::::: example
Choosing the bad data structure to hold the input can lead to quadratic
complexity.

::: rst-class
bad-example
:::

``` python
invalid_ids = self.search(domain).ids
for record in self:
    if record.id in invalid_ids:
        ...
```

If [invalid_ids]{.title-ref} is a list-like data structure, the
complexity of the algorithm may be quadratic.

Instead, prefer using set operations like casting
[invalid_ids]{.title-ref} to a set.

::: rst-class
good-example
:::

``` python
invalid_ids = set(invalid_ids)
for record in self:
    if record.id in invalid_ids:
        ...
```

Depending on the input, recordset operations can also be used.

::: rst-class
good-example
:::

``` python
invalid_ids = self.search(domain)
for record in self - invalid_ids:
    ...
```
::::::

### Use indexes {#performance/good_practices/index}

Database indexes can help fasten search operations, be it from a search
in the or through the user interface.

``` python
name = fields.Char(string="Name", index=True)
```

:::: warning
::: title
Warning
:::

Be careful not to index every field as indexes consume space and impact
on performance when executing one of [INSERT]{.title-ref},
[UPDATE]{.title-ref}, and [DELETE]{.title-ref}.
::::




--- SOURCE: developer/reference/backend/reports.md ---

# QWeb Reports[]{#reference/reports} {#reference/reports/report}

Reports are written in HTML/QWeb, like website views in Odoo. You can
use the usual
`QWeb control flow tools <reference/qweb>`{.interpreted-text
role="ref"}. The PDF rendering itself is performed by
[wkhtmltopdf](https://wkhtmltopdf.org).

Reports are declared using a
`report action <reference/actions/report>`{.interpreted-text
role="ref"}, and a `reference/reports/templates`{.interpreted-text
role="ref"} for the action to use.

If useful or necessary, it is possible to specify a
`reference/reports/paper_formats`{.interpreted-text role="ref"} for the
report report.

## Report template {#reference/reports/templates}

Report templates will always provide the following variables:

`time`

:   a reference to `python:time`{.interpreted-text role="mod"} from the
    Python standard library

`user`

:   `res.user` record for the user printing the report

`res_company`

:   record for the current `user`\'s company

`website`

:   the current website object, if any (this item can be present but
    `None`)

`web_base_url`

:   the base url for the webserver

`context_timestamp`

:   a function taking `python:datetime.datetime`{.interpreted-text
    role="class"} in UTC[^1] and converting it to the timezone of the
    user printing the report

### Minimal viable template

A minimal template would look like:

``` xml
<template id="report_invoice">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="web.external_layout">
                <div class="page">
                    <h2>Report title</h2>
                    <p>This object's name is <span t-field="o.name"/></p>
                </div>
            </t>
        </t>
    </t>
</template>
```

Calling `external_layout` will add the default header and footer on your
report. The PDF body will be the content inside the
`<div class="page">`. The template\'s `id` must be the name specified in
the report declaration; for example `account.report_invoice` for the
above report. Since this is a QWeb template, you can access all the
fields of the `docs` objects received by the template.

By default, the rendering context will also expose the following items:

`docs`

:   records for the current report

`doc_ids`

:   list of ids for the `docs` records

`doc_model`

:   model for the `docs` records

If you wish to access other records/models in the template, you will
need
`a custom report <reference/reports/custom_reports>`{.interpreted-text
role="ref"}, however in that case you will have to provide the items
above if you need them.

### Translatable Templates

If you wish to translate reports (to the language of a partner, for
example), you need to define two templates:

- The main report template
- The translatable document

You can then call the translatable document from your main template with
the attribute `t-lang` set to a language code (for example `fr` or
`en_US`) or to a record field. You will also need to re-browse the
related records with the proper context if you use fields that are
translatable (like country names, sales conditions, etc.)

:::: warning
::: title
Warning
:::

If your report template does not use translatable record fields,
re-browsing the record in another language is *not* necessary and will
impact performances.
::::

For example, let\'s look at the Sale Order report from the Sale module:

``` xml
<!-- Main template -->
<template id="report_saleorder">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="doc">
            <t t-call="sale.report_saleorder_document" t-lang="doc.partner_id.lang"/>
        </t>
    </t>
</template>

<!-- Translatable template -->
<template id="report_saleorder_document">
    <!-- Re-browse of the record with the partner lang -->
    <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)" />
    <t t-call="web.external_layout">
        <div class="page">
            <div class="oe_structure"/>
            <div class="row">
                <div class="col-6">
                    <strong t-if="doc.partner_shipping_id == doc.partner_invoice_id">Invoice and shipping address:</strong>
                    <strong t-if="doc.partner_shipping_id != doc.partner_invoice_id">Invoice address:</strong>
                    <div t-field="doc.partner_invoice_id" t-options="{&quot;no_marker&quot;: True}"/>
                <...>
            <div class="oe_structure"/>
        </div>
    </t>
</template>
```

The main template calls the translatable template with
`doc.partner_id.lang` as a `t-lang` parameter, so it will be rendered in
the language of the partner. This way, each Sale Order will be printed
in the language of the corresponding customer. If you wish to translate
only the body of the document, but keep the header and footer in a
default language, you could call the report\'s external layout this way:

``` xml
<t t-call="web.external_layout" t-lang="en_US">
```

:::: tip
::: title
Tip
:::

Please take note that this works only when calling external templates,
you will not be able to translate part of a document by setting a
`t-lang` attribute on an xml node other than `t-call`. If you wish to
translate part of a template, you can create an external template with
this partial template and call it from the main one with the `t-lang`
attribute.
::::

### Barcodes

Barcodes are images returned by a controller and can easily be embedded
in reports thanks to the QWeb syntax (e.g. see
`reference/qweb/attributes`{.interpreted-text role="ref"}):

``` html
<img t-att-src="'/report/barcode/QR/%s' % 'My text in qr code'"/>
```

More parameters can be passed as a query string

``` html
<img t-att-src="'/report/barcode/?
    barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s'%('QR', 'text', 200, 200)"/>
```

### Useful Remarks

- Twitter Bootstrap and FontAwesome classes can be used in your report
  template

- Local CSS can be put directly in the template

- Global CSS can be inserted in the main report layout by inheriting its
  template and inserting your CSS:

  ``` xml
  <template id="report_saleorder_style" inherit_id="report.style">
    <xpath expr=".">
      <t>
        .example-css-class {
          background-color: red;
        }
      </t>
    </xpath>
  </template>
  ```

- If it appears that your PDF report is missing the styles, please check
  `these instructions <reference/backend/reporting/printed-reports/pdf-without-styles>`{.interpreted-text
  role="ref"}.

## Paper Format {#reference/reports/paper_formats}

Paper formats are records of `report.paperformat` and can contain the
following attributes:

`name` (mandatory)

:   only useful as a mnemonic/description of the report when looking for
    one in a list of some sort

`description`

:   a small description of your format

`format`

:   either a predefined format (A0 to A9, B0 to B10, Legal, Letter,
    Tabloid,\...) or `custom`; A4 by default. You cannot use a
    non-custom format if you define the page dimensions.

`dpi`

:   output DPI; 90 by default

`margin_top`, `margin_bottom`, `margin_left`, `margin_right`

:   margin sizes in mm

`page_height`, `page_width`

:   page dimensions in mm

`orientation`

:   Landscape or Portrait

`header_line`

:   boolean to display a header line

`header_spacing`

:   header spacing in mm

Example:

``` xml
<record id="paperformat_frenchcheck" model="report.paperformat">
    <field name="name">French Bank Check</field>
    <field name="default" eval="True"/>
    <field name="format">custom</field>
    <field name="page_height">80</field>
    <field name="page_width">175</field>
    <field name="orientation">Portrait</field>
    <field name="margin_top">3</field>
    <field name="margin_bottom">3</field>
    <field name="margin_left">3</field>
    <field name="margin_right">3</field>
    <field name="header_line" eval="False"/>
    <field name="header_spacing">3</field>
    <field name="dpi">80</field>
</record>
```

## Custom Reports {#reference/reports/custom_reports}

By default, the reporting system builds rendering values based on the
target model specified through the `model` field.

However, it will first look for a model named
`report.{module.report_name}`{.interpreted-text role="samp"} and call
that model\'s `_get_report_values(doc_ids, data)` in order to prepare
the rendering data for the template.

This can be used to include arbitrary items to use or display while
rendering the template, such as data from additional models:

``` python
from odoo import api, models

class ParticularReport(models.AbstractModel):
    _name = 'report.module.report_name'

    def _get_report_values(self, docids, data=None):
        # get the report action back as we will need its data
        report = self.env['ir.actions.report']._get_report_from_name('module.report_name')
        # get the records selected for this rendering of the report
        obj = self.env[report.model].browse(docids)
        # return a custom rendering context
        return {
            'lines': docids.get_lines()
        }
```

:::: warning
::: title
Warning
:::

When using a custom report, the \"default\" document-related items
(`doc_ids`, `doc_model` and `docs`) will *not* be included. If you want
them, you will need to include them yourself.

In the example above, the rendering context will contain the \"global\"
values as well as the `lines` we put in there but nothing else.
::::

## Custom fonts {#reference/reports/custom_fonts}

If you want to use custom fonts you will need to add your custom font
and the related less/CSS to the `web.reports_assets_common` assets
bundle. Adding your custom font(s) to `web.assets_common` or
`web.assets_backend` will not make your font available in QWeb reports.

Example:

``` xml
<template id="report_assets_common_custom_fonts" name="Custom QWeb fonts" inherit_id="web.report_assets_common">
    <xpath expr="." position="inside">
        <link href="/your_module/static/src/less/fonts.less" rel="stylesheet" type="text/less"/>
    </xpath>
</template>
```

You will need to define your `@font-face` within this less file, even if
you\'ve used in another assets bundle (other than
`web.reports_assets_common`).

Example:

``` xml
@font-face {
    font-family: 'MonixBold';
    src: local('MonixBold'), local('MonixBold'), url(/your_module/static/fonts/MonixBold-Regular.otf) format('opentype');
}

.h1-title-big {
    font-family: MonixBold;
    font-size: 60px;
    color: #3399cc;
}
```

After you\'ve added the less into your assets bundle you can use the
classes - in this example `h1-title-big` - in your custom QWeb report.

## Reports are web pages

Reports are dynamically generated by the report module and can be
accessed directly via URL:

For example, you can access a Sale Order report in html mode by going to
http://\<server-address\>/report/html/sale.report_saleorder/38

Or you can access the pdf version at
http://\<server-address\>/report/pdf/sale.report_saleorder/38

[^1]: it does not matter what timezone the
    `python:datetime`{.interpreted-text role="class"} object is actually
    in (including no timezone), its timezone will unconditionally be
    *set* to UTC before being adjusted to the user\'s




--- SOURCE: developer/reference/backend/security.md ---

# Security in Odoo {#reference/security}

Aside from manually managing access using custom code, Odoo provides two
main data-driven mechanisms to manage or restrict access to data.

Both mechanisms are linked to specific users through *groups*: a user
belongs to any number of groups, and security mechanisms are associated
to groups, thus applying security mechanisms to users.

:::::::: res.groups
::: attribute
name

serves as user-readable identification for the group (spells out the
role / purpose of the group)
:::

:::: attribute
category_id

The *module category*, serves to associate groups with an Odoo App (\~a
set of related business models) and convert them into an exclusive
selection in the user form.

::: todo
clarify & document special cases & relationship between groups &
categories better
:::
::::

::: attribute
implied_ids

Other groups to set on the user alongside this one. This is a
convenience pseudo-inheritance relationship: it\'s possible to
explicitly remove implied groups from a user without removing the
implier.
:::

::: attribute
comment

Additional notes on the group e.g.
:::
::::::::

## Access Rights {#reference/security/acl}

*Grants* access to an entire model for a given set of operations. If no
access rights matches an operation on a model for a user (through their
group), the user doesn\'t have access.

Access rights are additive, a user\'s accesses are the union of the
accesses they get through all their groups e.g. given a user who is part
of group A granting read and create access and a group B granting update
access, the user will have all three of create, read, and update.

:::::::::: ir.model.access
::: attribute
name

The purpose or role of the group.
:::

::: attribute
model_id

The model whose access the ACL controls.
:::

::: attribute
group_id

The `res.groups`{.interpreted-text role="class"} to which the accesses
are granted, an empty `group_id`{.interpreted-text role="attr"} means
the ACL is granted to *every user* (non-employees e.g. portal or public
users).
:::

The `perm_{method}`{.interpreted-text role="samp"} attributes grant the
corresponding CRUD access when set, they are all unset by default.

::: attribute
perm_create
:::

::: attribute
perm_read
:::

::: attribute
perm_write
:::

::: attribute
perm_unlink
:::
::::::::::

## Record Rules {#reference/security/rules}

Record rules are *conditions* which must be satisfied in order for an
operation to be allowed. Record rules are evaluated record-by-record,
following access rights.

Record rules are default-allow: if access rights grant access and no
rule applies to the operation and model for the user, the access is
granted.

:::::::::::: ir.rule
::: attribute
name

The description of the rule.
:::

::: attribute
model_id

The model to which the rule applies.
:::

::: attribute
groups

The `res.groups`{.interpreted-text role="class"} to which access is
granted (or not). Multiple groups can be specified. If no group is
specified, the rule is *global* which is treated differently than
\"group\" rules (see below).
:::

::: attribute
global

Computed on the basis of `groups`{.interpreted-text role="attr"},
provides easy access to the global status (or not) of the rule.
:::

::: attribute
domain_force

A predicate specified as a
`domain <reference/orm/domains>`{.interpreted-text role="ref"}, the rule
allows the selected operations if the domain matches the record, and
forbids it otherwise.

The domain is a *python expression* which can use the following
variables:

`time`

:   Python\'s `python:time`{.interpreted-text role="mod"} module.

`user`

:   The current user, as a singleton recordset.

`company_id`

:   The current user\'s currently selected company as a single company
    id (not a recordset).

`company_ids`

:   All the companies to which the current user has access as a list of
    company ids (not a recordset), see
    `howto/company/security`{.interpreted-text role="ref"} for more
    details.
:::

The `perm_{method}`{.interpreted-text role="samp"} have completely
different semantics than for `ir.model.access`{.interpreted-text
role="class"}: for rules, they specify which operation the rules applies
*for*. If an operation is not selected, then the rule is not checked for
it, as if the rule did not exist.

All operations are selected by default.

::: attribute
perm_create
:::

::: attribute
perm_read
:::

::: attribute
perm_write
:::

::: attribute
perm_unlink
:::
::::::::::::

### Global rules versus group rules {#reference/security/rules/global}

There is a large difference between global and group rules in how they
compose and combine:

- Global rules *intersect*, if two global rules apply then *both* must
  be satisfied for the access to be granted, this means adding global
  rules always restricts access further.
- Group rules *unify*, if two group rules apply then *either* can be
  satisfied for the access to be granted. This means adding group rules
  can expand access, but not beyond the bounds defined by global rules.
- The global and group rulesets *intersect*, which means the first group
  rule being added to a given global ruleset will restrict access.

:::: danger
::: title
Danger
:::

Creating multiple global rules is risky as it\'s possible to create
non-overlapping rulesets, which will remove all access.
::::

## Field Access {#reference/security/fields}

An ORM `~odoo.fields.Field`{.interpreted-text role="class"} can have a
`groups` attribute providing a list of groups (as a comma-separated
string of `external identifiers`{.interpreted-text role="term"}).

If the current user is not in one of the listed groups, he will not have
access to the field:

- restricted fields are automatically removed from requested views
- restricted fields are removed from
  `~odoo.models.Model.fields_get`{.interpreted-text role="meth"}
  responses
- attempts to (explicitly) read from or write to restricted fields
  results in an access error

::: todo
field access groups apply to the Superuser in fields_get but not in
read/write\...
:::

## Security Pitfalls {#reference/security/pitfalls}

As a developer, it is important to understand the security mechanisms
and avoid common mistakes leading to insecure code.

### Unsafe Public Methods

Any public method can be executed via a `RPC call
<api/external_api/calling_methods>`{.interpreted-text role="ref"} with
the chosen parameters. The methods starting with a `_` are not callable
from an action button or external API.

On public methods, the record on which a method is executed and the
parameters can not be trusted, ACL being only verified during CRUD
operations.

``` python
# this method is public and its arguments can not be trusted
def action_done(self):
    if self.state == "draft" and self.user_has_groups('base.manager'):
        self._set_state("done")

# this method is private and can only be called from other python methods
def _set_state(self, new_state):
    self.sudo().write({"state": new_state})
```

Making a method private is obviously not enough and care must be taken
to use it properly.

### Bypassing the ORM

You should never use the database cursor directly when the ORM can do
the same thing! By doing so you are bypassing all the ORM features,
possibly the automated behaviours like translations, invalidation of
fields, `active`, access rights and so on.

And chances are that you are also making the code harder to read and
probably less secure.

``` python
# very very wrong
self.env.cr.execute('SELECT id FROM auction_lots WHERE auction_id in (' + ','.join(map(str, ids))+') AND state=%s AND obj_price > 0', ('draft',))
auction_lots_ids = [x[0] for x in self.env.cr.fetchall()]

# no injection, but still wrong
self.env.cr.execute('SELECT id FROM auction_lots WHERE auction_id in %s '\
           'AND state=%s AND obj_price > 0', (tuple(ids), 'draft',))
auction_lots_ids = [x[0] for x in self.env.cr.fetchall()]

# better
auction_lots_ids = self.search([('auction_id','in',ids), ('state','=','draft'), ('obj_price','>',0)])
```

#### SQL injections

Care must be taken not to introduce SQL injections vulnerabilities when
using manual SQL queries. The vulnerability is present when user input
is either incorrectly filtered or badly quoted, allowing an attacker to
introduce undesirable clauses to a SQL query (such as circumventing
filters or executing `UPDATE` or `DELETE` commands).

The best way to be safe is to never, NEVER use Python string
concatenation (+) or string parameters interpolation (%) to pass
variables to a SQL query string.

The second reason, which is almost as important, is that it is the job
of the database abstraction layer (psycopg2) to decide how to format
query parameters, not your job! For example psycopg2 knows that when you
pass a list of values it needs to format them as a comma-separated list,
enclosed in parentheses !

``` python
# the following is very bad:
#   - it's a SQL injection vulnerability
#   - it's unreadable
#   - it's not your job to format the list of ids
self.env.cr.execute('SELECT distinct child_id FROM account_account_consol_rel ' +
           'WHERE parent_id IN ('+','.join(map(str, ids))+')')

# better
self.env.cr.execute('SELECT DISTINCT child_id '\
           'FROM account_account_consol_rel '\
           'WHERE parent_id IN %s',
           (tuple(ids),))
```

This is very important, so please be careful also when refactoring, and
most importantly do not copy these patterns!

Here is a memorable example to help you remember what the issue is about
(but do not copy the code there). Before continuing, please be sure to
read the online documentation of pyscopg2 to learn of to use it
properly:

- [The problem with query
  parameters](http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters)
- [How to pass parameters with
  psycopg2](http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries)
- [Advanced parameter
  types](http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types)
- [Psycopg documentation](https://www.psycopg.org/docs/sql.html)

### Unescaped field content

When rendering content using JavaScript and XML, one may be tempted to
use a `t-raw` to display rich-text content. This should be avoided as a
frequent [XSS](https://en.wikipedia.org/wiki/Cross-site_scripting)
vector.

It is very hard to control the integrity of the data from the
computation until the final integration in the browser DOM. A `t-raw`
that is correctly escaped at the time of introduction may no longer be
safe at the next bugfix or refactoring.

``` javascript
QWeb.render('insecure_template', {
    info_message: "You have an <strong>important</strong> notification",
})
```

``` xml
<div t-name="insecure_template">
    <div id="information-bar"><t t-raw="info_message" /></div>
</div>
```

The above code may feel safe as the message content is controlled but is
a bad practice that may lead to unexpected security vulnerabilities once
this code evolves in the future.

``` javascript
// XSS possible with unescaped user provided content !
QWeb.render('insecure_template', {
    info_message: "You have an <strong>important</strong> notification on " \
        + "the product <strong>" + product.name + "</strong>",
})
```

While formatting the template differently would prevent such
vulnerabilities.

``` javascript
QWeb.render('secure_template', {
    message: "You have an important notification on the product:",
    subject: product.name
})
```

``` xml
<div t-name="secure_template">
    <div id="information-bar">
        <div class="info"><t t-esc="message" /></div>
        <div class="subject"><t t-esc="subject" /></div>
    </div>
</div>
```

``` css
.subject {
    font-weight: bold;
}
```

### Escaping vs Sanitizing

:::: important
::: title
Important
:::

Escaping is always 100% mandatory when you mix data and code, no matter
how safe the data
::::

**Escaping** converts *TEXT* to *CODE*. It is absolutely mandatory to do
it every time you mix *DATA/TEXT* with *CODE* (e.g. generating HTML or
python code to be evaluated inside a [safe_eval]{.title-ref}), because
*CODE* always requires *TEXT* to be encoded. It is critical for
security, but it\'s also a question of correctness. Even when there is
no security risk (because the text is 100% guarantee to be safe or
trusted), it is still required (e.g. to avoid breaking the layout in
generated HTML).

Escaping will never break any feature, as long as the developer
identifies which variable contains *TEXT* and which contains *CODE*.

``` python
>>> from odoo.tools import html_escape, html_sanitize
>>> data = "<R&D>" # `data` is some TEXT coming from somewhere

# Escaping turns it into CODE, good!
>>> code = html_escape(data)
>>> code
'&lt;R&amp;D&gt;'

# Now you can mix it with other code...
>>> self.message_post(body="<strong>%s</strong>" % code)
```

**Sanitizing** converts *CODE* to *SAFER CODE* (but not necessary *safe*
code). It does not work on *TEXT*. Sanitizing is only necessary when
*CODE* is untrusted, because it comes in full or in part from some
user-provided data. If the user-provided data is in the form of *TEXT*
(e.g. the content from a form filled by a user), and if that data was
correctly escaped before putting it in *CODE*, then sanitizing is
useless (but can still be done). If however, the user-provided data was
**not escaped**, then sanitizing will **not** work as expected.

``` python
# Sanitizing without escaping is BROKEN: data is corrupted!
>>> html_sanitize(data)
''

# Sanitizing *after* escaping is OK!
>>> html_sanitize(code)
'<p>&lt;R&amp;D&gt;</p>'
```

Sanitizing can break features, depending on whether the *CODE* is
expected to contain patterns that are not safe. That\'s why
[fields.Html]{.title-ref} and [tools.html_sanitize()]{.title-ref} have
options to fine-tune the level of sanitization for styles, etc. Those
options have to be carefully considered depending on where the data
comes from, and the desired features. The sanitization safety is
balanced against sanitization breakages: the safer the sanitisation the
more likely it is to break things.

``` python
>>code = "<p class='text-warning'>Important Information</p>"
# this will remove the style, which may break features
# but is necessary if the source is untrusted
>> html_sanitize(code, strip_classes=True)
'<p>Important Information</p>'
```

### Evaluating content

Some may want to `eval` to parse user provided content. Using `eval`
should be avoided at all cost. A safer, sandboxed, method
`~odoo.tools.safe_eval`{.interpreted-text role="class"} can be used
instead but still gives tremendous capabilities to the user running it
and must be reserved for trusted privileged users only as it breaks the
barrier between code and data.

``` python
# very bad
domain = eval(self.filter_domain)
return self.search(domain)

# better but still not recommended
from odoo.tools import safe_eval
domain = safe_eval(self.filter_domain)
return self.search(domain)

# good
from ast import literal_eval
domain = literal_eval(self.filter_domain)
return self.search(domain)
```

Parsing content does not need `eval`

  Language     Data type            Suitable parser
  ------------ -------------------- ----------------------------------
  Python       int, float, etc.     int(), float()
  Javascript   int, float, etc.     parseInt(), parseFloat()
  Python       dict                 json.loads(), ast.literal_eval()
  Javascript   object, list, etc.   JSON.parse()

### Accessing object attributes

If the values of a record needs to be retrieved or modified dynamically,
one may want to use the `getattr` and `setattr` methods.

``` python
# unsafe retrieval of a field value
def _get_state_value(self, res_id, state_field):
    record = self.sudo().browse(res_id)
    return getattr(record, state_field, False)
```

This code is however not safe as it allows to access any property of the
record, including private attributes or methods.

The `__getitem__` of a recordset has been defined and accessing a
dynamic field value can be easily achieved safely:

``` python
# better retrieval of a field value
def _get_state_value(self, res_id, state_field):
    record = self.sudo().browse(res_id)
    return record[state_field]
```

The above method is obviously still too optimistic and additional
verifications on the record id and field value must be done.




--- SOURCE: developer/reference/backend/testing.md ---

# Testing Odoo {#reference/testing}

There are many ways to test an application. In Odoo, we have three kinds
of tests

- Python unit tests (see [Testing Python code](#testing-python-code)):
  useful for testing model business logic
- JS unit tests (see [Testing JS code](#testing-js-code)): useful to
  test the javascript code in isolation
- Tours (see [Integration Testing](#integration-testing)): tours
  simulate a real situation. They ensures that the python and the
  javascript parts properly talk to each other.

## Testing Python code {#testing/python}

Odoo provides support for testing modules using [Python\'s unittest
library](https://docs.python.org/3/library/unittest.html).

To write tests, simply define a `tests` sub-package in your module, it
will be automatically inspected for test modules. Test modules should
have a name starting with `test_` and should be imported from
`tests/__init__.py`, e.g.

``` text
your_module
├── ...
├── tests
|   ├── __init__.py
|   ├── test_bar.py
|   └── test_foo.py
```

and `__init__.py` contains:

    from . import test_foo, test_bar

:::: warning
::: title
Warning
:::

test modules which are not imported from `tests/__init__.py` will not be
run
::::

The test runner will simply run any test case, as described in the
official [unittest
documentation](https://docs.python.org/3/library/unittest.html), but
Odoo provides a number of utilities and helpers related to testing Odoo
content (modules, mainly):

::: {.autoclass members="browse_ref, ref"}
odoo.tests.common.TransactionCase
:::

::: {.autoclass members="browse_ref, ref"}
odoo.tests.common.SingleTransactionCase
:::

::: autoclass
odoo.tests.common.SavepointCase
:::

::: {.autoclass members="browse_ref, ref, url_open, browser_js"}
odoo.tests.common.HttpCase
:::

::: autofunction
odoo.tests.common.tagged
:::

By default, tests are run once right after the corresponding module has
been installed. Test cases can also be configured to run after all
modules have been installed, and not run right after the module
installation:

    # coding: utf-8
    from odoo.tests import HttpCase, tagged

    # This test should only be executed after all modules have been installed.
    @tagged('-at_install', 'post_install')
    class WebsiteVisitorTests(HttpCase):
      def test_create_visitor_on_tracked_page(self):
          Page = self.env['website.page']

The most common situation is to use
`~odoo.tests.common.TransactionCase`{.interpreted-text role="class"} and
test a property of a model in each method:

    class TestModelA(common.TransactionCase):
        def test_some_action(self):
            record = self.env['model.a'].create({'field': 'value'})
            record.some_action()
            self.assertEqual(
                record.field,
                expected_field_value)

        # other tests...

:::: note
::: title
Note
:::

Test methods must start with `test_`
::::

::: {.autoclass members=""}
odoo.tests.common.Form
:::

::: {.autoclass members="add, remove, clear"}
odoo.tests.common.M2MProxy
:::

::: {.autoclass members="new, edit, remove"}
odoo.tests.common.O2MProxy
:::

### Running tests

Tests are automatically run when installing or updating modules if
`--test-enable <odoo-bin --test-enable>`{.interpreted-text
role="option"} was enabled when starting the Odoo server.

### Test selection {#developer/reference/testing/selection}

In Odoo, Python tests can be tagged to facilitate the test selection
when running tests.

Subclasses of `odoo.tests.common.BaseCase`{.interpreted-text
role="class"} (usually through
`~odoo.tests.common.TransactionCase`{.interpreted-text role="class"},
`~odoo.tests.common.SavepointCase`{.interpreted-text role="class"} or
`~odoo.tests.common.HttpCase`{.interpreted-text role="class"}) are
automatically tagged with `standard` and `at_install` by default.

#### Invocation

`--test-tags <odoo-bin --test-tags>`{.interpreted-text role="option"}
can be used to select/filter tests to run on the command-line. It
implies `--test-enable <odoo-bin --test-enable>`{.interpreted-text
role="option"}, so it\'s not necessary to specify
`--test-enable <odoo-bin --test-enable>`{.interpreted-text
role="option"} when using
`--test-tags <odoo-bin --test-tags>`{.interpreted-text role="option"}.

This option defaults to `+standard` meaning tests tagged `standard`
(explicitly or implicitly) will be run by default when starting Odoo
with `--test-enable <odoo-bin --test-enable>`{.interpreted-text
role="option"}.

When writing tests, the `~odoo.tests.common.tagged`{.interpreted-text
role="func"} decorator can be used on **test classes** to add or remove
tags.

The decorator\'s arguments are tag names, as strings.

:::: danger
::: title
Danger
:::

`~odoo.tests.common.tagged`{.interpreted-text role="func"} is a class
decorator, it has no effect on functions or methods
::::

Tags can be prefixed with the minus (`-`) sign, to *remove* them instead
of add or select them e.g. if you don\'t want your test to be executed
by default you can remove the `standard` tag:

``` python
from odoo.tests import TransactionCase, tagged

@tagged('-standard', 'nice')
class NiceTest(TransactionCase):
    ...
```

This test will not be selected by default, to run it the relevant tag
will have to be selected explicitly:

``` console
$ odoo-bin --test-tags nice
```

Note that only the tests tagged `nice` are going to be executed. To run
*both* `nice` and `standard` tests, provide multiple values to
`--test-tags <odoo-bin --test-tags>`{.interpreted-text role="option"}:
on the command-line, values are *additive* (you\'re selecting all tests
with *any* of the specified tags)

``` console
$ odoo-bin --test-tags nice,standard
```

The config switch parameter also accepts the `+` and `-` prefixes. The
`+` prefix is implied and therefore, totally optional. The `-` (minus)
prefix is made to deselect tests tagged with the prefixed tags, even if
they are selected by other specified tags e.g. if there are `standard`
tests which are also tagged as `slow` you can run all standard tests
*except* the slow ones:

``` console
$ odoo-bin --test-tags 'standard,-slow'
```

When you write a test that does not inherit from the
`~odoo.tests.common.BaseCase`{.interpreted-text role="class"}, this test
will not have the default tags, you have to add them explicitly to have
the test included in the default test suite. This is a common issue when
using a simple `unittest.TestCase` as they\'re not going to get run:

``` python
import unittest
from odoo.tests import tagged

@tagged('standard', 'at_install')
class SmallTest(unittest.TestCase):
    ...
```

Besides tags you can also specify specific modules, classes or functions
to test. The full syntax of the format accepted by
`--test-tags <odoo-bin --test-tags>`{.interpreted-text role="option"}
is:

``` text
[-][tag][/module][:class][.method]
```

So if you want to test the [stock_account]{.title-ref} module, you can
use:

> ``` console
> $ odoo-bin --test-tags /stock_account
> ```

If you want to test a specific function with a unique name, it can be
specified directly:

> ``` console
> $ odoo-bin --test-tags .test_supplier_invoice_forwarded_by_internal_user_without_supplier
> ```

This is equivalent to

> ``` console
> $ odoo-bin --test-tags /account:TestAccountIncomingSupplierInvoice.test_supplier_invoice_forwarded_by_internal_user_without_supplier
> ```

if the name of the test is unambiguous. Multiple modules, classes and
functions can be specified at once separated by a [,]{.title-ref} like
with regular tags.

#### Special tags {#reference/testing/tags}

- `standard`: All Odoo tests that inherit from
  `~odoo.tests.common.BaseCase`{.interpreted-text role="class"} are
  implicitly tagged standard.
  `--test-tags <odoo-bin --test-tags>`{.interpreted-text role="option"}
  also defaults to `standard`.

  That means untagged test will be executed by default when tests are
  enabled.

- `at_install`: Means that the test will be executed right after the
  module installation and before other modules are installed. This is a
  default implicit tag.

- `post_install`: Means that the test will be executed after all the
  modules are installed. This is what you want for HttpCase tests most
  of the time.

  Note that this is *not exclusive* with `at_install`, however since you
  will generally not want both `post_install` is usually paired with
  `-at_install` when tagging a test class.

#### Examples

:::: important
::: title
Important
:::

Tests will be executed only in installed modules. If you\'re starting
from a clean database, you\'ll need to install the modules with the
`-i <odoo-bin -i>`{.interpreted-text role="option"} switch at least
once. After that it\'s no longer needed, unless you need to upgrade the
module, in which case `-u <odoo-bin -u>`{.interpreted-text
role="option"} can be used. For simplicity, those switches are not
specified in the examples below.
::::

Run only the tests from the sale module:

``` console
$ odoo-bin --test-tags /sale
```

Run the tests from the sale module but not the ones tagged as slow:

``` console
$ odoo-bin --test-tags '/sale,-slow'
```

Run only the tests from stock or tagged as slow:

``` console
$ odoo-bin --test-tags '-standard, slow, /stock'
```

:::: note
::: title
Note
:::

`-standard` is implicit (not required), and present for clarity
::::

## Testing JS code

Testing a complex system is an important safeguard to prevent
regressions and to guarantee that some basic functionality still works.
Since Odoo has a non trivial codebase in Javascript, it is necessary to
test it. In this section, we will discuss the practice of testing JS
code in isolation: these tests stay in the browser, and are not supposed
to reach the server.

### Qunit test suite {#reference/testing/qunit}

The Odoo framework uses the [QUnit](https://qunitjs.com/) library
testing framework as a test runner. QUnit defines the concepts of
*tests* and *modules* (a set of related tests), and gives us a web based
interface to execute the tests.

For example, here is what a pyUtils test could look like:

``` javascript
QUnit.module('py_utils');

QUnit.test('simple arithmetic', function (assert) {
    assert.expect(2);

    var result = pyUtils.py_eval("1 + 2");
    assert.strictEqual(result, 3, "should properly evaluate sum");
    result = pyUtils.py_eval("42 % 5");
    assert.strictEqual(result, 2, "should properly evaluate modulo operator");
});
```

The main way to run the test suite is to have a running Odoo server,
then navigate a web browser to `/web/tests`. The test suite will then be
executed by the web browser Javascript engine.

![image](testing/tests.png){.align-center}

The web UI has many useful features: it can run only some submodules, or
filter tests that match a string. It can show every assertions, failed
or passed, rerun specific tests, \...

:::: warning
::: title
Warning
:::

While the test suite is running, make sure that:

- your browser window is focused,
- it is not zoomed in/out. It needs to have exactly 100% zoom level.

If this is not the case, some tests will fail, without a proper
explanation.
::::

### Testing Infrastructure

Here is a high level overview of the most important parts of the testing
infrastructure:

- there is an asset bundle named
  [web.qunit_suite](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L660).
  This bundle contains the main code (assets common + assets backend),
  some libraries, the QUnit test runner and the test bundles listed
  below.
- a bundle named
  [web.tests_assets](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L594)
  includes most of the assets and utils required by the test suite:
  custom QUnit asserts, test helpers, lazy loaded assets, etc.
- another asset bundle,
  [web.qunit_suite_tests](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L680),
  contains all the test scripts. This is typically where the test files
  are added to the suite.
- there is a
  [controller](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/controllers/main.py#L637)
  in web, mapped to the route */web/tests*. This controller simply
  renders the *web.qunit_suite* template.
- to execute the tests, one can simply point its browser to the route
  */web/tests*. In that case, the browser will download all assets, and
  QUnit will take over.
- there is some code in
  [qunit_config.js](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_config.js#L49)
  which logs in the console some information when a test passes or
  fails.
- we want the runbot to also run these tests, so there is a test (in
  [test_js.py](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/tests/test_js.py#L13))
  which simply spawns a browser and points it to the *web/tests* url.
  Note that the browser_js method spawns a Chrome headless instance.

### Modularity and testing

With the way Odoo is designed, any addon can modify the behaviour of
other parts of the system. For example, the *voip* addon can modify the
*FieldPhone* widget to use extra features. This is not really good from
the perspective of the testing system, since this means that a test in
the addon web will fail whenever the voip addon is installed (note that
the runbot runs the tests with all addons installed).

At the same time, our testing system is good, because it can detect
whenever another module breaks some core functionality. There is no
complete solution to this issue. For now, we solve this on a case by
case basis.

Usually, it is not a good idea to modify some other behaviour. For our
voip example, it is certainly cleaner to add a new *FieldVOIPPhone*
widget and modify the few views that needs it. This way, the
*FieldPhone* widget is not impacted, and both can be tested.

### Adding a new test case

Let us assume that we are maintaining an addon *my_addon*, and that we
want to add a test for some javascript code (for example, some utility
function myFunction, located in *my_addon.utils*). The process to add a
new test case is the following:

1.  create a new file *my_addon/static/tests/utils_tests.js*. This file
    contains the basic code to add a QUnit module *my_addon \> utils*.

    > ``` javascript
    > odoo.define('my_addon.utils_tests', function (require) {
    > "use strict";
    >
    > var utils = require('my_addon.utils');
    >
    > QUnit.module('my_addon', {}, function () {
    >
    >     QUnit.module('utils');
    >
    > });
    > });
    > ```

2.  In *my_addon/assets.xml*, add the file to the main test assets:

    > ``` xml
    > <?xml version="1.0" encoding="utf-8"?>
    > <odoo>
    >     <template id="qunit_suite_tests" name="my addon tests" inherit_id="web.qunit_suite_tests">
    >         <xpath expr="//script[last()]" position="after">
    >             <script type="text/javascript" src="/my_addon/static/tests/utils_tests.js"/>
    >         </xpath>
    >     </template>
    > </odoo>
    > ```

3.  Restart the server and update *my_addon*, or do it from the
    interface (to make sure the new test file is loaded)

4.  Add a test case after the definition of the *utils* sub test suite:

    > ``` javascript
    > QUnit.test("some test case that we want to test", function (assert) {
    >     assert.expect(1);
    >
    >     var result = utils.myFunction(someArgument);
    >     assert.strictEqual(result, expectedResult);
    > });
    > ```

5.  Visit */web/tests/* to make sure the test is executed

### Helper functions and specialized assertions

Without help, it is quite difficult to test some parts of Odoo. In
particular, views are tricky, because they communicate with the server
and may perform many rpcs, which needs to be mocked. This is why we
developed some specialized helper functions, located in
[test_utils.js](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js).

- Mock test functions: these functions help setting up a test
  environment. The most important use case is mocking the answers given
  by the Odoo server. These functions use a [mock
  server](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/mock_server.js).
  This is a javascript class that simulates answers to the most common
  model methods: read, search_read, nameget, \...
- DOM helpers: useful to simulate events/actions on some specific
  target. For example, testUtils.dom.click performs a click on a target.
  Note that it is safer than doing it manually, because it also checks
  that the target exists, and is visible.
- create helpers: they are probably the most important functions
  exported by
  [test_utils.js](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js).
  These helpers are useful to create a widget, with a mock environment,
  and a lot of small detail to simulate as much as possible the real
  conditions. The most important is certainly
  [createView](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils_create.js#L267).
- [qunit
  assertions](https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_asserts.js):
  QUnit can be extended with specialized assertions. For Odoo, we
  frequently test some DOM properties. This is why we made some
  assertions to help with that. For example, the *containsOnce*
  assertion takes a widget/jQuery/HtmlElement and a selector, then
  checks if the target contains exactly one match for the css selector.

For example, with these helpers, here is what a simple form test could
look like:

``` javascript
QUnit.test('simple group rendering', function (assert) {
    assert.expect(1);

    var form = testUtils.createView({
        View: FormView,
        model: 'partner',
        data: this.data,
        arch: '<form string="Partners">' +
                '<group>' +
                    '<field name="foo"/>' +
                '</group>' +
            '</form>',
        res_id: 1,
    });

    assert.containsOnce(form, 'table.o_inner_group');

    form.destroy();
});
```

Notice the use of the testUtils.createView helper and of the
containsOnce assertion. Also, the form controller was properly destroyed
at the end of the test.

### Best Practices

In no particular order:

- all test files should be added in *some_addon/static/tests/*
- for bug fixes, make sure that the test fails without the bug fix, and
  passes with it. This ensures that it actually works.
- try to have the minimal amount of code necessary for the test to work.
- usually, two small tests are better than one large test. A smaller
  test is easier to understand and to fix.
- always cleanup after a test. For example, if your test instantiates a
  widget, it should destroy it at the end.
- no need to have full and complete code coverage. But adding a few
  tests helps a lot: it makes sure that your code is not completely
  broken, and whenever a bug is fixed, it is really much easier to add a
  test to an existing test suite.
- if you want to check some negative assertion (for example, that a
  HtmlElement does not have a specific css class), then try to add the
  positive assertion in the same test (for example, by doing an action
  that changes the state). This will help avoid the test to become dead
  in the future (for example, if the css class is changed).

### Tips

- running only one test: you can (temporarily!) change the
  *QUnit.test(\...)* definition into *QUnit.only(\...)*. This is useful
  to make sure that QUnit only runs this specific test.
- debug flag: most create utility functions have a debug mode (activated
  by the debug: true parameter). In that case, the target widget will be
  put in the DOM instead of the hidden qunit specific fixture, and more
  information will be logged. For example, all mocked network
  communications will be available in the console.
- when working on a failing test, it is common to add the debug flag,
  then comment the end of the test (in particular, the destroy call).
  With this, it is possible to see the state of the widget directly, and
  even better, to manipulate the widget by clicking/interacting with it.

## Integration Testing {#reference/testing/integration-testing}

Testing Python code and JS code separately is very useful, but it does
not prove that the web client and the server work together. In order to
do that, we can write another kind of test: tours. A tour is a mini
scenario of some interesting business flow. It explains a sequence of
steps that should be followed. The test runner will then create a
PhantomJs browser, point it to the proper url and simulate the click and
inputs, according to the scenario.

### Writing a test tour

#### Structure

To write a test tour for [your_module]{.title-ref}, start with creating
the required files:

``` text
your_module
├── ...
├── static
|   └── tests
|       └── tours
|           └── your_tour.js
├── tests
|   ├── __init__.py
|   └── test_calling_the_tour.py
└── __manifest__.py
```

You can then:

- update `__manifest__.py`{.interpreted-text role="file"} to add
  `your_tour.js`{.interpreted-text role="file"} in the assets.

  ``` python
  'assets': {
      'web.assets_tests': [
          'your_module/static/tests/tours/your_tour.js',
      ],
  },
  ```

- update `__init__.py`{.interpreted-text role="file"} in the folder
  `tests`{.interpreted-text role="file"} to import
  `test_calling_the_tour`{.interpreted-text role="file"}.

::: seealso
\- `Assets Bundle <reference/assets_bundle>`{.interpreted-text
role="ref"} - `testing/python`{.interpreted-text role="ref"}
:::

#### Javascript

1.  Setup your tour by registering it.

    ``` javascript
    /** @odoo-module **/
    import tour from 'web_tour.tour';
    tour.register('rental_product_configurator_tour', {
        url: '/web',  // Here, you can specify any other starting url
        test: true,
    }, [
        // Your sequence of steps
    ]);
    ```

2.  Add any step you want.

Every step contains at least a trigger. You can either use the
[predefined
steps]({GITHUB_PATH}/addons/web_tour/static/src/js/tour_step_utils.js)
or write your own personalized step.

Here are some example of steps:

::: example
``` javascript
// First step
tour.stepUtils.showAppsMenuItem(),
// Second step
{
    trigger: '.o_app[data-menu-xmlid="your_module.maybe_your_module_menu_root"]',
    edition: 'community'  // Optional
}, {
    // Third step
},
```
:::

::: example
``` javascript
{
    trigger: '.js_product:has(strong:contains(Chair floor protection)) .js_add',
    extra_trigger: '.oe_advanced_configurator_modal',  // This ensure we are in the wizard
},
```
:::

::: example
``` javascript
{
    trigger: 'a:contains("Add a product")',
    // Extra-trigger to make sure a line is added before trying to add another one
    extra_trigger: '.o_field_many2one[name="product_template_id"] .o_external_button',
},
```
:::

Here are some possible arguments for your personalized steps:

- **trigger**: Selector/element to `run` an action on. The tour will
  wait until the element exists and is visible before `run`-ing the
  action *on it*.

- **extra_trigger**: Optional secondary condition for the step to `run`.
  Will be waited for like the **trigger** element but the action will
  not run on the extra trigger.

  Useful to have a precondition, or two different and unrelated
  conditions.

- **run**: Action to perform on the *trigger* element.

  By default, tries to set the **trigger**\'s content to `Text` if it\'s
  an `input`, otherwise `click` it.

  The action can also be:

  - A function, synchronous, executed with the trigger\'s `Tip` as
    context (`this`) and the action helpers as parameter.

  - The name of one of the action helpers, which will be run on the
    trigger element:

    ::: rst-class
    o-definition-list
    :::

    `click`

    :   Clicks the element, performing all the relevant intermediate
        events.

    `text {content}`{.interpreted-text role="samp"}

    :   Clicks (focuses) the element then sets `content` as the
        element\'s value (if an input), option (if a select), or
        content.

    `dblclick`, `tripleclick`

    :   Same as `click` with multiple repetitions.

    `clicknoleave`

    :   By default, `click` (and variants) will trigger \"exit\" events
        on the trigger element (mouseout, mouseleave). This helper
        suppresses those (note: further clicks on other elements will
        not trigger those events implicitly).

    `text_blur`

    :   Similar to `text` but follows the edition with `focusout` and
        `blur` events.

    `drag_and_drop {target}`{.interpreted-text role="samp"}

    :   Simulates the dragging of the **trigger** element over to the
        `target`.

- **edition**: Optional,

  - If you don\'t specify an edition, the step will be active in both
    community and enterprise.
  - Sometimes, a step will be different in enterprise or in community.
    You can then write two steps, one for the enterprise edition and one
    for the community one.
  - Generally, you want to specify an edition for steps that use the
    main menu as the main menus are different in community and
    enterprise.

- **position**: Optional, `"top"`, `"right"`, `"bottom"`, or `"left"`.
  Where to position the tooltip relative to the **target** when running
  interactive tours.

- **content**: Optional but recommended, the content of the tooltip in
  interactive tours, also logged to the console so very useful to trace
  and debug automated tours.

- **auto**: Whether the tour manager should wait for the user to perform
  the action if the tour is interactive, defaults to `false`.

- **in_modal**: If set the **trigger** element will be searched only in
  the top modal window, defaults to `false`.

- **timeout**: How long to wait until the step can `run`, in
  milliseconds, 10000 (10 seconds).

:::: important
::: title
Important
:::

The last step(s) of a tour should always return the client to a
\"stable\" state (e.g. no ongoing editions) and ensure all side-effects
(network requests) have finished running to avoid race conditions or
errors during teardown.
::::

::: seealso
\- [jQuery documentation about find](https://api.jquery.com/find/)
:::

#### Python

To start a tour from a python test, make the class inherit from
`~odoo.tests.common.HTTPCase`{.interpreted-text role="class"}, and call
\`start_tour\`:

``` python
def test_your_test(self):
    # Optional Setup
    self.start_tour("/web", 'your_module.your_tour_name', login="admin")
    # Optional verifications
```

### Debugging tips

#### Observing tours in a browser

There are two ways with different tradeoffs:

##### `watch=True`

When running a tour locally via the test suite, the `watch=True`
parameter can be added to the `browser_js` or `start_tour` call:

    self.start_tour("/web", code, watch=True)

This will automatically open a Chrome window with the tour being run
inside it.

**Advantages**

:   - always works if the tour has Python setup / surrounding code, or
      multiple steps
    - runs entirely automatically (just select the test which launches
      the tour)
    - transactional (*should* always be runnable multiple times)

**Drawbacks**

:   - only works locally
    - only works if the test / tour can run correctly locally

##### Run via browser

Tours can also be launched via the browser UI, either by calling

``` javascript
odoo.startTour(tour_name);
```

in the javascript console, or by enabling `tests mode
<frontend/framework/tests_debug_mode>`{.interpreted-text role="ref"} by
setting `?debug=tests` in the URL, then selecting **Start Tour** in the
debug menu and picking a tour:

![image](testing/tours.png){.align-center}

**Advantages**

:   - easier to run
    - can be used on production or test sites, not just local instances
    - allows running in \"Onboarding\" mode (manual steps)

**Drawbacks**

:   - harder to use with test tours involving Python setup
    - may not work multiple times depending on tour side-effects

:::: tip
::: title
Tip
:::

It\'s possible to use this method to observe or interact with tours
which require Python setup:

- add a *python* breakpoint before the relevant tour is started
  (`start_tour` or `browser_js` call)
- when the breakpoint is hit, open the instance in your browser
- run the tour

At this point the Python setup will be visible to the browser, and the
tour will be able to run.

You may want to comment the `start_tour` or `browser_js` call if you
also want the test to continue afterwards, depending on the tour\'s
side-effects.
::::

#### Screenshots and screencasts during browser_js tests

When running tests that use `HttpCase.browser_js` from the command line,
the Chrome browser is used in headless mode. By default, if a test
fails, a PNG screenshot is taken at the moment of the failure and
written in

``` console
'/tmp/odoo_tests/{db_name}/screenshots/'
```

Two new command line arguments were added since Odoo 13.0 to control
this behavior:
`--screenshots <odoo-bin --screenshots>`{.interpreted-text
role="option"} and
`--screencasts <odoo-bin --screencasts>`{.interpreted-text
role="option"}

#### Introspecting / debugging steps

When trying to fix / debug a tour, the screenshots (on failure) are not
necessarily sufficient. In that case it can be useful to see what\'s
happening at some or each step.

While this is pretty easy when in an \"onboarding\" (as they\'re mostly
driven explicitly by the user) it\'s more complicated when running
\"test\" tours, or when running tours through the test suite. In that
case there are two main tricks:

- Have a step with a `run() { debugger; }` action.

  This can be added to an existing step, or can be a new dedicated step.
  Once the step\'s **trigger** is matched, the execution will stop all
  javascript execution.

  **Advantages**

  :   - very simple
      - the tour restarts as soon as you resume execution

  **Drawbacks**

  :   - page interaction is limited as all javascript is blocked
      - debugging the inside of the tour manager is not very useful

- Add a step with a trigger which never succeeds and a very long
  `timeout`.

  The browser will wait for the **trigger** until the `timeout` before
  it fails the tour, this allows inspecting and interacting with the
  page until the developer is ready to resume, by manually enabling the
  **trigger** (a nonsense class is useful there, as it can be triggered
  by adding the class to any visible element of the page).

  **Advantages**

  :   - allows interacting with the page
      - easy to apply to a step which times out (just add a long
        `timeout` then look around)
      - no useless (for this situation) debugger UI

  **Drawbacks**

  :   - more manual, especially when resuming

## Performance Testing

### Query counts

One of the ways to test performance is to measure database queries.
Manually, this can be tested with the [\--log-sql]{.title-ref} CLI
parameter. If you want to establish the maximum number of queries for an
operation, you can use the
`~odoo.tests.common.BaseCase.assertQueryCount`{.interpreted-text
role="meth"} method, integrated in Odoo test classes.

``` python
with self.assertQueryCount(11):
    do_something()
```




--- SOURCE: developer/reference/backend/views.md ---

# Views {#reference/views}

Views are what define how records should be displayed to end-users. They
are specified in XML which means that they can be edited independently
from the models that they represent. They are flexible and allow a high
level of customization of the screens that they control. There exist
various types of views. Each of them represents a mode of visualization:
*form*, *list*, *kanban*, etc.

::: todo
Build doc of ir_ui_view.py ?
:::

## Generic structure {#reference/views/structure}

Basic views generally share the common structure defined below.
Placeholders are denoted in all caps.

``` xml
<record id="MODEL_view_TYPE" model="ir.ui.view">
  <field name="name">NAME</field>
  <field name="model">MODEL</field>
  <field name="arch" type="xml">
    <VIEW_TYPE>
      <VIEW_SPECIFICATIONS/>
    </VIEW_TYPE>
  </field>
</record>
```

## Fields

View objects expose a number of fields. They are optional unless
specified otherwise.

- `name` (mandatory) `~odoo.fields.Char`{.interpreted-text role="class"}

  Only useful as a mnemonic/description of the view when looking for one
  in a list of some sort.

- `model` `~odoo.fields.Char`{.interpreted-text role="class"}

  The model linked to the view, if applicable.

- `priority` `~odoo.fields.Integer`{.interpreted-text role="class"}

  When a view is requested by `(model, type)`, the view matching the
  model and the type, with the lowest priority will be returned (it is
  the default view).

  It also defines the order of views application during `view
  inheritance <reference/views/inheritance>`{.interpreted-text
  role="ref"}.

- `groups_id` `~odoo.fields.Many2many`{.interpreted-text role="class"}
  -\> `odoo.addons.base.models.res_users.Groups`{.interpreted-text
  role="class"}

  The groups allowed to use/access the current view.

  If the view extends an existing view, the extension will only be
  applied for a given user if the user has access to the provided
  `groups_id`.

- `arch` `~odoo.fields.Text`{.interpreted-text role="class"}

  The description of the view layout.

## Attributes

::: todo
view attributes & view element attributes attrs & states attributes are
missing generic information
:::

The different view types have a wide variety of attributes allowing
customizations of the generic behaviors. Some main attributes will be
explained here. They do not all have an impact on all view types.

:::: note
::: title
Note
:::

The current context and user access rights may also impact the view
abilities.
::::

::: todo
info on create/\... in the context ?
:::

- `create`

  Disable/enable record creation on the view.

- `edit` (`form` & `list` & `gantt`)

  Disable/enable record editing on the view.

- `delete` (`form` & `list`)

  Disable/enable record deletion on the view through the **Action**
  dropdown.

- `duplicate` (`form`)

  Disable/enable record duplication on the view through the **Action**
  dropdown.

- `decoration-{$name}` (`list` & `gantt`)

  Define a conditional display of a record in the style of a row\'s text
  based on the corresponding record\'s attributes.

  Values are Python expressions. For each record, the expression is
  evaluated with the record\'s attributes as context values and if
  `true`, the corresponding style is applied to the row. Here are some
  of the other values available in the context:

  - `uid`: the id of the current user,
  - `today`: the current local date as a string of the form
    `YYYY-MM-DD`,
  - `now`: same as `today` with the addition of the current time. This
    value is formatted as `YYYY-MM-DD hh:mm:ss`.

  ``` xml
  <tree decoration-info="state == 'draft'"
      decoration-danger="state == 'help_needed'"
      decoration-bf="state='busy'">
      <!-- TREE_VIEW_CONTENT -->
  </tree>
  ```

  :::: warning
  ::: title
  Warning
  :::

  Supported values differ for the two view types. The Gantt view only
  supports `success`, `info`, `warning`, `danger` and `secondary`
  displays. The list view supports `bf`, `it`, `success`, `info`,
  `warning`, `danger`, `muted` and `primary` displays.
  ::::

- `sample` (`kanban` & `list` & `gantt` & `graph` & `pivot` & `cohort`)

  Populate the view with a set of sample records if none are found for
  the current model. This attribute is false by default.

  These fake records will have heuristics for certain field
  names/models. For example, a field \'display_name\' on the model
  \'res.users\' will be populated with sample people names while an
  \'email\' field will be in the form
  \'firstname.lastname@sample.demo\'.

  The user will not be able to interact with these data and they will be
  discarded as soon as an action is performed (record created, column
  added, etc.)

- `banner_route` a route address to be fetched and prepended to the
  view.

  If this attribute is set, the
  `controller route url<reference/controllers>`{.interpreted-text
  role="ref"} will be fetched and displayed above the view. The json
  response from the controller should contain an \"html\" key.

  If the html contains a stylesheet \<link\> tag, it will be removed and
  appended to \<head\>.

  To interact with the backend you can use \<a type=\"action\"\> tags.
  Please take a look at the documentation of the
  [onActionClicked]{#onactionclicked} method of AbstractController
  (*addons/web/static/src/js/views/abstract_controller.js*) for more
  details.

  Only views extending AbstractView and AbstractController can use this
  attribute, like `reference/views/form`{.interpreted-text role="ref"},
  `reference/views/kanban`{.interpreted-text role="ref"},
  `reference/views/list`{.interpreted-text role="ref"}, \...

  Example:

  ``` xml
  <tree banner_route="/module_name/hello" />
  ```

  ``` python
  class MyController(odoo.http.Controller):
      @http.route('/module_name/hello', auth='user', type='json')
      def hello(self):
          return {
              'html': """
                  <div>
                      <link href="/module_name/static/src/css/banner.css"
                          rel="stylesheet">
                      <h1>hello, world</h1>
                  </div> """
          }
  ```

::: todo
Views main content section, with field, group & separator ?
:::

## Inheritance {#reference/views/inheritance}

### Inheritance fields

The two following `~odoo.addons.base.ir_ui_view.View`{.interpreted-text
role="class"} fields are used to specify inherited views.

- `inherit_id` `~odoo.fields.Many2one`{.interpreted-text role="class"}

  the current view\'s parent view, unset by default. Specify the parent
  using the [ref]{.title-ref} attribute:

  ``` xml
  <field name="inherit_id" ref="library.view_book_form"/>
  ```

- `mode` `~odoo.fields.Selection`{.interpreted-text role="class"}:
  [extension / primary]{.title-ref}

  inheritance mode, `extension` by default if `inherit_id` is set,
  `primary` otherwise.

  An example of where you would want to override `mode` while using
  `inherit_id` is delegation inheritance. In that case your derived
  model will be separate from its parent and views matching with one
  won\'t match with the other. Suppose you inherit from a view
  associated with the parent model and want to customize the derived
  view to show data from the derived model. The `mode` of the derived
  view needs to be set to `primary`, because it\'s the base (and maybe
  only) view for that derived model. Otherwise the
  `view matching <reference/views/inheritance/view-matching>`{.interpreted-text
  role="ref"} rules won\'t apply.

### View matching {#reference/views/inheritance/view-matching}

- if a view is requested by `(model, type)`, the view with the right
  model and type, `mode=primary` and the lowest priority is matched.
- when a view is requested by `id`, if its mode is not `primary` its
  *closest* parent with mode `primary` is matched.

### View resolution

Resolution generates the final `arch` for a requested/matched `primary`
view:

1.  if the view has a parent, the parent is fully resolved then the
    current view\'s inheritance specs are applied
2.  if the view has no parent, its `arch` is used as-is
3.  the current view\'s children with mode `extension` are looked up and
    their inheritance specs are applied depth-first (a child view is
    applied, then its children, then its siblings)

The result of applying children views yields the final `arch`

::: todo
NOTE on fields_view_get and link to ORM ?
:::

### Inheritance specs

Inheritance specs are comprised of an element locator, to match the
inherited element in the parent view, and children element that will be
used to modify the inherited element.

There are three types of element locators for matching a target element:

- An `xpath` element with an `expr` attribute. `expr` is an
  [XPath](https://en.wikipedia.org/wiki/XPath) expression[^1] applied to
  the current `arch`, the first node it finds is the match
- a `field` element with a `name` attribute, matches the first `field`
  with the same `name`. All other attributes are ignored during matching
- any other element: the first element with the same name and identical
  attributes (ignoring `position` and `version` attributes) is matched

``` xml
<xpath expr="page[@name='pg']/group[@name='gp']/field" position="inside">
  <field name="description"/>
</xpath>

<field name="res_id" position="after"/>

<div name="name" position="replace">
  <div name="name2">
    <field name="name2"/>
  </div>
</div>
```

The inheritance spec may have an optional `position` attribute
specifying how the matched node should be altered:

::: rst-class
o-definition-list
:::

`inside` (default)

:   the content of the inheritance spec is appended to the matched node

`replace`

:   the content of the inheritance spec replaces the matched node. Any
    text node containing only `$0` within the contents of the spec will
    be replaced by a complete copy of the matched node, effectively
    wrapping the matched node.

`after`

:   the content of the inheritance spec is added to the matched node\'s
    parent, after the matched node

`before`

:   the content of the inheritance spec is added to the matched node\'s
    parent, before the matched node

`attributes`

:   the content of the inheritance spec should be `attribute` elements
    with a `name` attribute and an optional body:

    - if the `attribute` element has a body, a new attributed named
      after its `name` is created on the matched node with the
      `attribute` element\'s text as value
    - if the `attribute` element has no body, the attribute named after
      its `name` is removed from the matched node. If no such attribute
      exists, an error is raised
    - if the `attribute` element has an `add` attribute, a `remove`
      attribute, or both, the value of the matched node\'s attribute
      named after `name` is recomputed to include the value(s) of `add`
      (separated by `separator`) and delete the value(s) of `remove`
      (separated by `separator`). If `separator` is not provided, `,` is
      used instead.

    ``` xml
    <field name="sale_information" position="attributes">
      <attribute name="invisible">0</attribute>
      <attribute name="attrs">
        {'invisible': [('sale_ok', '=', False)], 'readonly': [('editable', '=', False)]}
      </attribute>
      <attribute name="class" add="mt-1 mb-1" remove="mt-2 mb-2" separator=" "/>
    </field>
    ```

`move`

:   can be used as a direct child of a inheritance spec with a `inside`,
    `replace`, `after` or `before` `position` attribute to move a node.

    ``` xml
    <xpath expr="//@target" position="after">
        <xpath expr="//@node" position="move"/>
    </xpath>

    <field name="target_field" position="after">
        <field name="my_field" position="move"/>
    </field>
    ```

A view\'s specs are applied sequentially.

## Model Commons

::: currentmodule
odoo.addons.base.models.ir_ui_view
:::

### Attributes

::: autoattribute
Model.\_date_name
:::

### Methods

::: automethod
Model.get_views
:::

::: automethod
Model.get_view
:::

## View types {#reference/views/types}

### Activity {#reference/views/activity}

The Activity view is used to display the activities linked to the
records. The data are displayed in a chart with the records forming the
rows and the activity types the columns. The first cell of each row
displays a (customizable, see `templates`, quite similarly to
`reference/views/kanban`{.interpreted-text role="ref"}) card
representing the corresponding record. When clicking on others cells, a
detailed description of all activities of the same type for the record
is displayed.

:::: warning
::: title
Warning
:::

The Activity view is only available when the `mail` module is installed,
and for the models that inherit from the `mail.activity.mixin`.
::::

The root element of the Activity view is `<activity>`, it accepts the
following attributes:

::: rst-class
o-definition-list
:::

`string` (mandatory)

:   A title, which should describe the view

Possible children of the view element are:

::: rst-class
o-definition-list
:::

`field`

:   declares fields to use in activity *logic*. If the field is simply
    displayed in the activity view, it does not need to be pre-declared.

    Possible attributes are:

    ::: rst-class
    o-definition-list
    :::

    `name` (required)

    :   the name of the field to fetch

`templates`

:   defines the `reference/qweb`{.interpreted-text role="ref"}
    templates. Cards definition may be split into multiple templates for
    clarity, but activity views *must* define at least one root template
    `activity-box`, which will be rendered once for each record.

    The activity view uses mostly-standard `javascript qweb
    <reference/qweb/javascript>`{.interpreted-text role="ref"} and
    provides the following context variables (see
    `reference/views/kanban`{.interpreted-text role="ref"} for more
    details):

    ::: rst-class
    o-definition-list
    :::

    `widget`

    :   the current `ActivityRecord`{.interpreted-text role="js:class"},
        can be used to fetch some meta-information. These methods are
        also available directly in the template context and don\'t need
        to be accessed via `widget`

    `record`

    :   an object with all the requested fields as its attributes. Each
        field has two attributes `value` and `raw_value`

### Calendar {#reference/views/calendar}

Calendar views display records as events in a daily, weekly, monthly or
yearly calendar.

:::: note
::: title
Note
:::

By default the calendar view will be centered around the current date
(today). You can pass a specific initial date to the context of the
action in order to set the initial focus of the calendar on the period
(see [mode]{.title-ref}) around this date (the context key to use being
[initial_date]{.title-ref})
::::

Their root element is `<calendar>`. Available attributes on the calendar
view are:

::: rst-class
o-definition-list
:::

`date_start` (required)

:   name of the record\'s field holding the start date for the event

`date_stop`

:   name of the record\'s field holding the end date for the event, if
    `date_stop` is provided records become movable (via drag and drop)
    directly in the calendar

`date_delay`

:   alternative to `date_stop`, provides the duration of the event
    instead of its end date (unit: day)

`color`

:   name of a record field to use for *color segmentation*. Records in
    the same color segment are allocated the same highlight color in the
    calendar, colors are allocated semi-randomly. Displayed the
    display_name/avatar of the visible record in the sidebar

`form_view_id`

:   view to open when the user create or edit an event. Note that if
    this attribute is not set, the calendar view will fall back to the
    id of the form view in the current action, if any.

`event_open_popup`

:   If the option \'event_open_popup\' is set to true, then the calendar
    view will open events (or records) in a FormViewDialog. Otherwise,
    it will open events in a new form view (with a do_action)

`quick_add`

:   enables quick-event creation on click: only asks the user for a
    `name` (the field to which this values is saved can be controlled
    through `rec_name`) and tries to create a new event with just that
    and the clicked event time. Falls back to a full form dialog if the
    quick creation fails

`create_name_field`

:   name of the record\'s field holding the textual representation of
    the record, this is used when creating records through the \'quick
    create\' mechanism

`all_day`

:   name of a boolean field on the record indicating whether the
    corresponding event is flagged as day-long (and duration is
    irrelevant)

`mode`

:   Default display mode when loading the calendar. Possible attributes
    are: `day`, `week`, `month`, `year`

`scales`

:   Comma-separated list of scales to provide. By default, all scales
    are available. See mode for possible scale values.

`create`, `delete`

:   allows disabling the corresponding action in the view by setting the
    corresponding attribute to `false`

`<field>`

:   declares fields to aggregate or to use in kanban *logic*. If the
    field is simply displayed in the calendar cards.

    Fields can have additional attributes:

    ::: rst-class
    o-definition-list
    :::

    `invisible`

    :   use \"True\" to hide the value in the cards

    `avatar_field`

    :   only for x2many field, to display the avatar instead of the
        display_name in the cards

    `write_model` and `write_field` and `filter_field`

    :   you can add a filter and save the result in the defined model,
        the filter is added in the sidebar. The `filter_field` is
        optional and allows you to specify the field that will hold the
        status of the filter.

    `filters` and `color`

    :   use \"True\" to add this field in filter in the sidebar. You can
        specify a `color` field used to colorize the checkbox.

### Cohort {#reference/views/cohort}

<span class="badge" style="background-color:#AD5E99">Enterprise feature</span>

The cohort view is used to display and understand the way some data
changes over a period of time. For example, imagine that for a given
business, clients can subscribe to some service. The cohort view can
then display the total number of subscriptions each month, and study the
rate at which client leave the service (churn). When clicking on a cell,
the cohort view will redirect you to a new action in which you will only
see the records contained in the cell\'s time interval; this action
contains a list view and a form view.

:::: note
::: title
Note
:::

By default the cohort view will use the same list and form views as
those defined on the action. You can pass a list view and a form view to
the context of the action in order to set/override the views that will
be used (the context keys to use being [form_view_id]{.title-ref} and
[list_view_id]{.title-ref})
::::

For example, here is a very simple cohort view:

``` xml
<cohort string="Subscription" date_start="date_start" date_stop="date" interval="month"/>
```

The root element of the Cohort view is \<cohort\>, it accepts the
following attributes:

::: rst-class
o-definition-list
:::

`string` (mandatory)

:   A title, which should describe the view

`date_start` (mandatory)

:   A valid date or datetime field. This field is understood by the view
    as the beginning date of a record

`date_stop` (mandatory)

:   A valid date or datetime field. This field is understood by the view
    as the end date of a record. This is the field that will determine
    the churn.

`mode` (optional)

:   A string to describe the mode. It should be either \'churn\' or
    \'retention\' (default). Churn mode will start at 0% and accumulate
    over time whereas retention will start at 100% and decrease over
    time.

`timeline` (optional)

:   A string to describe the timeline. It should be either \'backward\'
    or \'forward\' (default). Forward timeline will display data from
    date_start to date_stop, whereas backward timeline will display data
    from date_stop to date_start (when the date_start is in future /
    greater than date_stop).

`interval` (optional)

:   A string to describe a time interval. It should be \'day\',
    \'week\', \'month\'\' (default) or \'year\'.

`measure` (optional)

:   A field that can be aggregated. This field will be used to compute
    the values for each cell. If not set, the cohort view will count the
    number of occurrences.

`<field>` (optional)

:   allows to specify a particular field in order to manage it from the
    available measures, it\'s main use is for hiding a field from the
    selectable measures:

    ::: rst-class
    o-definition-list
    :::

    `name` (mandatory)

    :   the name of the field to use in the view.

    `string` (optional)

    :   the name that would be used to display the field in the cohort
        view, overrides the default python String attribute of the
        field.

    `invisible` (optional)

    :   if true, the field will not appear either in the active measures
        nor in the selectable measures (useful for fields that do not
        make sense aggregated, such as fields in different units, e.g. €
        and \$).

### Form {#reference/views/form}

Form views are used to display the data from a single record. Their root
element is `<form>`. They are composed of regular
[HTML](https://en.wikipedia.org/wiki/HTML) with additional structural
and semantic components.

#### Structural components

Structural components provide structure or \"visual\" features with
little logic. They are used as elements or sets of elements in form
views.

::: rst-class
o-definition-list
:::

`notebook`

:   defines a tabbed section. Each tab is defined through a `page` child
    element. Pages can have the following attributes:

    ::: rst-class
    o-definition-list
    :::

    `string` (required)

    :   the title of the tab

    `accesskey`

    :   an HTML
        [accesskey](https://www.w3.org/TR/html5/editing.html#the-accesskey-attribute)

    `attrs`

    :   standard dynamic attributes based on record values

    :::: note
    ::: title
    Note
    :::

    Note that `notebook` should not be placed within `group`
    ::::

`group`

:   used to define column layouts in forms. By default, groups define 2
    columns and most direct children of groups take a single column.
    `field` direct children of groups display a label by default, and
    the label and the field itself have a colspan of 1 each.

    The number of columns in a `group` can be customized using the `col`
    attribute, the number of columns taken by an element can be
    customized using `colspan`.

    Children are laid out horizontally (tries to fill the next column
    before changing row).

    Groups can have a `string` attribute, which is displayed as the
    group\'s title

`newline`

:   only useful within `group` elements, ends the current row early and
    immediately switches to a new row (without filling any remaining
    column beforehand)

`separator`

:   small horizontal spacing, with a `string` attribute behaves as a
    section title

`sheet`

:   can be used as a direct child to `form` for a narrower and more
    responsive form layout

`header`

:   combined with `sheet`, provides a full-width location above the
    sheet itself, generally used to display workflow buttons and status
    widgets

#### Semantic components

Semantic components tie into and allow interaction with the Odoo system.
Available semantic components are:

::: rst-class
o-definition-list
:::

`button`

:   call into the Odoo system, similar to `list view buttons
    <reference/views/list/button>`{.interpreted-text role="ref"}. In
    addition, the following attribute can be specified:

    ::: rst-class
    o-definition-list
    :::

    `special`

    :   for form views opened in dialogs: `save` to save the record and
        close the dialog, `cancel` to close the dialog without saving.

    `confirm`

    :   confirmation message to display (and for the user to accept)
        before performing the button\'s Odoo call (also works in Kanban
        views).

`field`

:   renders (and allow editing of, possibly) a single field of the
    current record. Using several times a field in a form view is
    supported and the fields can receive different values for modifiers
    \'invisible\' and \'readonly\'. However, the behavior is not
    guaranteed when several fields exist with different values for
    modifier \'required\'. Possible attributes of the field node are:

    ::: rst-class
    o-definition-list
    :::

    `name` (mandatory)

    :   the name of the field to render

    `id`

    :   the node id. Useful when there are several occurrences of the
        same field in the view (see `label` component below). Default is
        the field name.

    `widget`

    :   fields have a default rendering based on their type (e.g.
        `~odoo.fields.Char`{.interpreted-text role="class"},
        `~odoo.fields.Many2one`{.interpreted-text role="class"}). The
        `widget` attributes allows using a different rendering method
        and context.

        ::: todo
        list of widgets

        & options & specific attributes (e.g. widget=statusbar
        statusbar_visible clickable)
        :::

    `options`

    :   JSON object specifying configuration option for the field\'s
        widget (including default widgets)

    `class`

    :   HTML class to set on the generated element, common field classes
        are:

        ::: rst-class
        o-definition-list
        :::

        `oe_inline`

        :   prevent the usual line break following fields and limit
            their span.

        `oe_left`, `oe_right`

        :   [floats](https://developer.mozilla.org/en-US/docs/Web/CSS/float)
            the field to the corresponding direction

        `oe_read_only`, `oe_edit_only`

        :   only displays the field in the corresponding form mode

        `oe_avatar`

        :   for image fields, displays images as \"avatar\" (square,
            90x90 maximum size, some image decorations)

    `groups`

    :   only displays the field for specific users

    `on_change`

    :   calls the specified method when this field\'s value is edited,
        can generate update other fields or display warnings for the
        user

        ::: deprecated
        8.0

        Use `odoo.api.onchange`{.interpreted-text role="func"} on the
        model
        :::

    `attrs`

    :   dynamic meta-parameters based on record values

    `domain`

    :   for relational fields only, filters to apply when displaying
        existing records for selection

    `context`

    :   for relational fields only, context to pass when fetching
        possible values

    `readonly`

    :   display the field in both readonly and edit mode, but never make
        it editable

    `required`

    :   generates an error and prevents saving the record if the field
        doesn\'t have a value

    `nolabel`

    :   don\'t automatically display the field\'s label, only makes
        sense if the field is a direct child of a `group` element

    `placeholder`

    :   help message to display in *empty* fields. Can replace field
        labels in complex forms. *Should not* be an example of data as
        users are liable to confuse placeholder text with filled fields

    `mode`

    :   for `~odoo.fields.One2many`{.interpreted-text role="class"},
        display mode (view type) to use for the field\'s linked records.
        One of `tree`, `form`, `kanban` or `graph`. The default is
        `tree` (a list display)

    `help`

    :   tooltip displayed for users when hovering the field or its label

    `filename`

    :   for binary fields, name of the related field providing the name
        of the file

    `password`

    :   indicates that a `~odoo.fields.Char`{.interpreted-text
        role="class"} field stores a password and that its data
        shouldn\'t be displayed

    `kanban_view_ref`

    :   for opening specific kanban view when selecting records from
        m2o/m2m in mobile environment

`label`

:   when a `field` component isn\'t placed directly inside a `group`, or
    when its `nolabel` attribute is set, the field\'s label isn\'t
    automatically displayed alongside its value. The `label` component
    is the manual alternative of displaying the label of a field.
    Possible attributes are:

    ::: rst-class
    o-definition-list
    :::

    `for` (mandatory)

    :   the reference to the field associated with the label. Can be
        either the name of a field, or its id (`id` attribute set on the
        `field`). When there are several occurrences of the same field
        in the view, and there are several `label` components associated
        with these `field` nodes, those labels must have unique `for`
        attributes (in this case referencing the `id` attribute of the
        corresponding `field` nodes).

    `string`

    :   the label to display. Display the field\'s label (coming from
        the field definition in the model) by default.

    `class`

    :   same as for `field` component.

    `attrs`

    :   same as for `field` component.

#### Generic structure

``` xml
<form>
  <header>
    <field name="state" widget="statusbar"/>
  </header>
  <sheet>
    <div class="oe_button_box">
      <BUTTONS/>
    </div>
    <group>
      <group>
        <field name="fname"/>
      </group>
    </group>
    <notebook>
      <page string="Page1">
        <group>
          <CONTENT/>
        </group>
      </page>
      <page string="Page2">
        <group>
          <CONTENT/>
        </group>
      </page>
    </notebook>
  </sheet>
</form>
```

::: todo
classes for forms
:::

::: todo
widgets?
:::

### Gantt {#reference/views/gantt}

<span class="badge" style="background-color:#AD5E99">Enterprise feature</span>

Gantt views appropriately display Gantt charts (for scheduling).

The root element of gantt views is `<gantt/>`, it has no children but
can take the following attributes:

::: rst-class
o-definition-list
:::

`date_start` (required)

:   name of the field providing the start datetime of the event for each
    record.

`date_stop` (required)

:   name of the field providing the end duration of the event for each
    record.

`dependency_field`

:   name of the `many2many` field that provides the dependency relation
    between two records. If B depends on A, `dependency_field` is the
    field that allows getting A from B. Both this field and
    `dependency_inverted_field` field are used to draw dependency arrows
    between pills and reschedule them.

`dependency_inverted_field` (required if `dependency_field` is provided)

:   name of the `many2many` field that provides the invert dependency
    relation than `dependency_field`. If B depends on A,
    `dependency_inverted_field` is the field that allows getting B from
    A.

`color`

:   name of the field used to color the pills according to its value

`decoration-{$name}`

:   allow changing the style of a row\'s text based on the corresponding
    record\'s attributes.

    Values are Python expressions. For each record, the expression is
    evaluated with the record\'s attributes as context values and if
    `true`, the corresponding style is applied to the row. Here are some
    of the other values available in the context:

    - `uid`: the id of the current user,
    - `today`: the current local date as a string of the form
      `YYYY-MM-DD`,
    - `now`: same as `today` with the addition of the current time. This
      value is formatted as `YYYY-MM-DD hh:mm:ss`.

    `{$name}` can be one of the following [bootstrap contextual
    color](https://getbootstrap.com/docs/3.3/components/#available-variations)
    (`danger`, `info`, `secondary`, `success` or `warning`).

`default_group_by`

:   name of a field to group tasks by

`disable_drag_drop`

:   if set to true, the gantt view will not have any drag&drop support

`consolidation`

:   field name to display consolidation value in record cell

`consolidation_max`

:   dictionary with the \"group by\" field as key and the maximum
    consolidation value that can be reached before displaying the cell
    in red (e.g. `{"user_id": 100}`)

`consolidation_exclude`

:   name of the field that describes if the task has to be excluded from
    the consolidation if set to true it displays a striped zone in the
    consolidation line

`create`, `cell_create`, `edit`, `delete`, `plan`

:   allows *dis*abling the corresponding action in the view by setting
    the corresponding attribute to `false` (default: `true`).

    - `create`: If enabled, an `Add` button will be available in the
      control panel to create records.
    - `cell_create`: If enabled and `create` enabled, a \"\*\*+\*\*\"
      button will be displayed while hovering on a time slot cell to
      create a new record on that slot.
    - `edit`: If enabled, the opened records will be in edit mode (thus
      editable).
    - `plan`: If enabled and `edit` enabled, a \"magnifying glass\"
      button will be displayed on time slots to plan unassigned records
      into that time slot.

    ::: example
    When you do not want to create records on the gantt view and the
    beginning and end dates are required on the model, the planning
    feature should be disabled because no record will ever be found.
    :::

`offset`

:   Depending on the scale, the number of units to add to today to
    compute the default period. Examples: An offset of +1 in
    default_scale week will open the gantt view for next week, and an
    offset of -2 in default_scale month will open the gantt view of 2
    months ago.

`progress`

:   name of a field providing the completion percentage for the
    record\'s event, between 0 and 100

`string`

:   title of the gantt view

`precision`

:   JSON object specifying snapping precisions for the pills in each
    scale.

    Possible values for scale `day` are (default: `hour`):

    - `hour`: records times snap to full hours (ex: 7:12 becomes 8:00)
    - `hour:half`: records times snap to half hours (ex: 7:12 becomes
      7:30)
    - `hour:quarter`: records times snap to half hours (ex: 7:12 becomes
      7:15)

    Possible values for scale `week` are (default: `day:half`):

    - `day`: records times snap to full days (ex: 7:28 AM becomes
      11:59:59 PM of the previous day, 10:32 PM becomes 12:00 PM of the
      current day)
    - `day:half`: records times snap to half hours (ex: 7:28 AM becomes
      12:00 PM)

    Possible values for scale `month` are (default: `day:half`):

    - `day`: records times snap to full days (ex: 7:28 AM becomes
      11:59:59 PM of the previous day, 10:32 PM becomes 12:00 PM of the
      current day)
    - `day:half`: records times snap to half hours (ex: 7:28 AM becomes
      12:00 PM)

    Scale `year` always snap to full day.

    Example of precision attribute:
    `{"day": "hour:quarter", "week": "day:half", "month": "day"}`

`total_row`

:   boolean to control whether the row containing the total count of
    records should be displayed. (default: `false`)

`collapse_first_level`

:   boolean to control whether it is possible to collapse each row if
    grouped by one field. (default: `false`, the collapse starts when
    grouping by two fields)

`display_unavailability`

:   boolean to mark the dates returned by the `gantt_unavailability`
    function of the model as available inside the gantt view. Records
    can still be scheduled in them, but their unavailability is visually
    displayed. (default: `false`)

`default_scale`

:   default scale when rendering the view. Possible values are (default:
    `month`):

    - `day`
    - `week`
    - `month`
    - `year`

`scales`

:   comma-separated list of allowed scales for this view. By default,
    all scales are allowed. For possible scale values to use in this
    list, see `default_scale`.

`templates`

:   defines the `reference/qweb`{.interpreted-text role="ref"} template
    `gantt-popover` which is used when the user hovers over one of the
    records in the gantt view.

    The gantt view uses mostly-standard `javascript qweb
    <reference/qweb/javascript>`{.interpreted-text role="ref"} and
    provides the following context variables:

    ::: rst-class
    o-definition-list
    :::

    `widget`

    :   the current `GanttRow`{.interpreted-text role="js:class"}, can
        be used to fetch some meta-information. The `getColor` method to
        convert in a color integer is also available directly in the
        template context without using `widget`.

    `on_create`

    :   If specified when clicking the add button on the view, instead
        of opening a generic dialog, launch a client action. this should
        hold the xmlid of the action (eg:
        `on_create="%(my_module.my_wizard)d"`

`form_view_id`

:   view to open when the user create or edit a record. Note that if
    this attribute is not set, the gantt view will fall back to the id
    of the form view in the current action, if any.

`dynamic_range`

:   if set to true, the gantt view will start at the first record,
    instead of starting at the beginning of the year/month/day.

`pill_label`

:   If set to true, the time appears in the pill label when the scale is
    set on week or month. (e.g. [7:00 AM - 11:00 AM (4h) - DST Task
    1]{.title-ref})

`thumbnails`

:   This allows to display a thumbnail next to groups name if the group
    is a relationnal field. This expects a python dict which keys are
    the name of the field on the active model. Values are the names of
    the field holding the thumbnail on the related model.

    Example: tasks have a field user_id that reference res.users. The
    res.users model has a field image that holds the avatar, then:

    ``` xml
    <gantt
       date_start="date_start"
       date_stop="date_stop"
       thumbnails="{'user_id': 'image_128'}"
     >
     </gantt>
    ```

    will display the users avatars next to their names when grouped by
    user_id.

### Graph {#reference/views/graph}

The graph view is used to visualize aggregations over a number of
records or record groups. Its root element is `<graph>` which can take
the following attributes:

::: rst-class
o-definition-list
:::

`type` (optional)

:   one of `bar` (default), `pie` and `line`, the type of graph to use

`stacked` (optional)

:   only used for `bar` charts. Set to `0` to prevent the bars within a
    group to be stacked initially.

`disable_linking` (optional)

:   set to `1` to prevent from redirecting clicks on graph to list view

`order` (optional)

:   if set, x-axis values will be sorted by default according their
    measure with respect to the given order (`asc` or `desc`). Only used
    for `bar` and `pie` charts.

`string` (optional)

:   string displayed in the breadcrumbs when redirecting to list view.

The only allowed element within a graph view is `field` which can have
the following attributes:

::: rst-class
o-definition-list
:::

`name` (mandatory)

:   the name of a field to use in the view. If used for grouping (rather
    than aggregating)

`invisible` (optional)

:   if true, the field will not appear either in the active measures nor
    in the selectable measures.

`type` (optional)

:   if set to `measure`, the field will be used as an aggregated value
    within a group instead of a grouping criteria. It only works for the
    last field with that attribute but it is useful for other fields
    with string attribute (see below).

`interval` (optional)

:   on date and datetime fields, groups by the specified interval
    (`day`, `week`, `month`, `quarter` or `year`) instead of grouping on
    the specific datetime (fixed second resolution) or date (fixed day
    resolution). Default is `month`.

`string` (optional)

:   only used for field with `type="measure"`. The name that will be
    used to display the field in the graph view, overrides the default
    python String attribute of the field.

The measures are automatically generated from the model fields; only the
aggregatable fields are used. Those measures are also alphabetically
sorted on the string of the field.

:::: warning
::: title
Warning
:::

graph view aggregations are performed on database content, non-stored
function fields can not be used in graph views
::::

### Grid {#reference/views/grid}

<span class="badge" style="background-color:#AD5E99">Enterprise feature</span>

#### Limitations

This view is a work in progress and may have to be expanded or altered.

- only `date` column fields have been tested, `selection` and `many2one`
  are nominally implemented and supported but have not been tested,
  `datetime` is not implemented at all.
- column cells are hardly configurable and must be numerical
- cell adjustment is disabled by default and must be configured to be
  enabled
- `create`, `edit` and `delete` ACL metadata doesn\'t get automatically
  set on the view root due to limitations in `fields_view_get`
  post-processing (there\'s a fixed explicit list of the view types
  getting those attributes)

#### Schema

The grid view has its own schema and additional validation in this
module. The view architecture is:

`<grid>` (1)

:   architecture root element

    - mandatory `string` attribute

    - optional `create`, `edit` and `delete` attributes

    - optional `adjustment` and `adjust_name` attributes

      `adjustment` can be either `object` or `action` to indicate
      whether a cell\'s adjustment should be performed through a method
      call or an action execution. `adjust_name` provides respectively
      the method name and the action id.

      In both cases, the adjustment parameters are provided as a
      `grid_adjust` context member, in the `object` case, the parameters
      are also provided as positional function parameters (next to an
      empty list of ids):

      `row_domain`

      :   the domain matching the entire row of the adjusted cell

      `column_field`

      :   the name of the column for the adjusted cell

      `column_value`

      :   the value of the column for the adjusted cell

      `cell_field`

      :   the measure field of the adjusted cell

      `change`

      :   the difference between the old value of the cell and the
          adjusted one, may be positive or negative

    - optional `hide_line_total` and `hide_column_total` attributes

      `hide_line_total`

      :   set to true to hide total line (default false)

      `hide_column_total`

      :   set to true to hide total column (default false)

    - optional `barchart_total` attribute

      `barchart_total`

      :   set to `true` in order to display a bar chart at the bottom of
          the grid, based on the totals of the columns (default false).

    - optional `create_inline` and `display_empty` attributes

      `create_inline`

      :   set to `true` in order to display an additional row at bottom
          of the grid with an `Add a line` button (default false). When
          this option is set to `true`, the `Add a line` button from the
          control panel is hidden. When no data is available and when
          `display_empty` is not set (so when the help content is
          displayed), the the `Add a line` button from the control panel
          is shown in order to let the user create a first record.

      `display_empty`

      :   set to `true` in order to keep displaying the grid when there
          is no data (default false). This can be useful when you want
          the user to be able to keep track of the current period (as
          dates are displayed in the columns headers). As a reminder,
          when no data are present and when this attribute is no set,
          the help content is displayed instead of the grid.

`<button>` (0+)

:   Regular Odoo action buttons, displayed in the view header

    - mandatory `string` attribute (the button label)

    - mandatory `type` attribute, either `object` or `action`

      :::: note
      ::: title
      Note
      :::

      workflow buttons are not supported
      ::::

    - mandatory `name` attribute, either the name of the method to call,
      or the ID of the action to execute

    - optional `context`

    The server callback is provided with all the record ids displayed in
    the view, either as the ids passed to the method (`object` button)
    or as the context\'s `active_ids` (`action` buttons)

`<field type="row">` (1+)

:   Row grouping fields, will be replaced by the search view\'s groupby
    filter if any.

    The order of `row` fields in the view provides their grouping depth:
    if the first field is `school` and the second is `age` the records
    will be grouped by `school` first and by `age` within each school.

`<field type="col">` (1)

:   Column grouping field.

    The col field can contain 0+ `<range>` elements which specify
    customisable column ranges. `range` elements have the following
    mandatory attributes

    `name`

    :   can be used to override the default range (the first one by
        default) through the `grid_range` context value

    `string`

    :   the range button\'s label (user-visible)

    `span`

    :   symbolic name of the span of all columns to display at once in
        the view, may trigger pagination.

        For `date` fields, valid spans are currently `week` and `month`.

    `step`

    :   symbolic name of the step between one column and the
        previous/next

        For `date` fields, the only valid span is currently `day`.

`<field type="measure">` (1)

:   Cell field, automatically accumulated (by `read_group`).

    The measure field can take a `widget` attribute to customise its
    display.

#### Server interactions

Aside from optional buttons, the grid view currently calls two methods:

- `read_grid` (provided on all models by the module) returns almost the
  entirety of the grid\'s content as a dict:
  - the row titles is a list of dictionaries with the following keys:

    `values` (required)

    :   this maps to a dictionary with a key per `row` field, the values
        are *always* of the form `[value, label]`.

    `domain` (required)

    :   the domain of any record at the source of this row, in case
        it\'s necessary to copy a record during cell adjustment

  - the column titles is a list of dictionaries with at least one key:

    `values` (required)

    :   see row title values

    `domain` (required)

    :   see column domain value

    `current` (optional)

    :   boolean, marks/highlights a column

  - the grid data as a list (of rows) of list (of cells) of cell dicts
    each with the following keys:

    `value`

    :   the numeric value associated with the cell

    `domain`

    :   the domain matching the cell\'s records (should be assumed
        opaque)

    `size`

    :   the number of records grouped in the cell

    `readonly` (optional)

    :   a boolean indicating that this specific cell should not be
        client-editable

    `classes` (optional)

    :   a list of classes (as strings) to add on the cell\'s container
        (between the cell\'s TD and the cell\'s potentially-editable
        element).

        In case of conflicts between this list and the base classes
        (prefixed with `o_grid_cell_`), the classes in this list are
        ignored.

    Note that the grid data is *dense*, if querying the database yields
    no group matching a cell a cell will generate an \"empty\" cell with
    default values for required keys.

  - `prev` and `next` which can be either falsy (no pagination) or a
    context item to merge into the view\'s own context to `read_grid`
    the previous or next page, it should be assumed to be opaque
- `read_grid_domain(field, range)` (provided on al models by the module)
  returns the domain matching the current configured \"span\" of the
  grid. This is also done internally by `read_grid`, but can be useful
  or necessary to call independently to use with separate e.g.
  `search_count` or `read_group`.
- `adjust_grid`, for which there currently isn\'t a blanket
  implementation and whose semantics are likely to evolve with time and
  use cases

#### Server Hooks

`read_grid` calls a number of hooks allowing the customisation of its
operations from within without having to override the entire method:

`_grid_format_cell(group, cell_field)`

:   converts the output of a read_group (group-by-group) into cells in
    the format described above (as part of \"the grid data\")

`_grid_make_empty_cell(row_domain, column_domain, view_domain)`

:   generates an empty version of a cell (if there is no corresponding
    group)

`_grid_column_info(name, range)`

:   generates a ColumnMetadata object based on the column type, storing
    values either returned directly (as part of `read_grid`) or used
    query and reformat `read_group` into `read_grid`:

    `grouping`

    :   the actual grouping field/query for the columns

    `domain`

    :   domain to apply to `read_group` in case the column field is
        paginated, can be an empty list

    `prev` and `next`

    :   context segments which will be sent to `read_grid` for pages
        before and after the current one. If `False`, disables
        pagination in that direction

    `values`

    :   column values to display on the \"current page\", each value is
        a dictionary with the following keys:

        `values`

        :   dictionary mapping field names to values for the entire
            column, usually just `name` -\> a value

        `domain`

        :   domain matching this specific column

        `is_current`

        :   `True` if the current column should be specifically outlined
            in the grid, `False` otherwise

        `format`

        :   how to format the values of that column/type from
            `read_group` formatting to `read_grid` formatting (matching
            `values` in ColumnInfo)

#### ACL

- if the view is not editable, individual cells won\'t be editable
- if the view is not creatable, the `Add a Line` button will not be
  displayed (it currently creates a new empty record)

#### Context Keys

`grid_range`

:   selects which range should be used by default if the view has
    multiple ranges

`grid_anchor`

:   if applicable, used as the default anchor of column ranges instead
    of whatever `read_grid` defines as its default.

    For date fields, the reference date around which the initial span
    will be computed. The default date anchor is \"today\" (in the
    user\'s timezone)

### Kanban {#reference/views/kanban}

The kanban view is a [kanban
board](https://en.wikipedia.org/wiki/Kanban_board) visualisation: it
displays records as \"cards\", halfway between a
`list view <reference/views/list>`{.interpreted-text role="ref"} and a
non-editable `form view <reference/views/form>`{.interpreted-text
role="ref"}. Records may be grouped in columns for use in workflow
visualisation or manipulation (e.g. tasks or work-progress management),
or ungrouped (used simply to visualize records).

:::: note
::: title
Note
:::

The kanban view will load and display a maximum of ten columns. Any
column after that will be closed (but can still be opened by the user).
::::

The root element of the Kanban view is `<kanban>`, it can use the
following attributes:

::: rst-class
o-definition-list
:::

`default_group_by`

:   whether the kanban view should be grouped if no grouping is
    specified via the action or the current search. Should be the name
    of the field to group by when no grouping is otherwise specified

`default_order`

:   cards sorting order used if the user has not already sorted the
    records (via the list view)

`class`

:   adds HTML classes to the root HTML element of the Kanban view

`examples`

:   if set to a key in the
    [KanbanExamplesRegistry](https://github.com/odoo/odoo/blob/99821fdcf89aa66ac9561a972c6823135ebf65c0/addons/web/static/src/js/views/kanban/kanban_examples_registry.js),
    examples on column setups will be available in the grouped kanban
    view.
    [Here](https://github.com/odoo/odoo/blob/99821fdcf89aa66ac9561a972c6823135ebf65c0/addons/project/static/src/js/project_task_kanban_examples.js#L27)
    is an example of how to define those setups.

`group_create`

:   whether the \"Add a new column\" bar is visible or not. Default:
    true.

`group_delete`

:   whether groups can be deleted via the context menu. Default: true.

`group_edit`

:   whether groups can be edited via the context menu. Default: true.

`archivable`

:   whether records belonging to a column can be archived / restored if
    an `active` field is defined on the model. Default: true.

`quick_create`

:   whether it should be possible to create records without switching to
    the form view. By default, `quick_create` is enabled when the Kanban
    view is grouped by many2one, selection, char or boolean fields, and
    disabled when not.

`quick_create_view`

:   `form` view reference, specifying the view used for records quick
    creation.

`records_draggable`

:   whether it should be possible to drag records when kanban is
    grouped. Default: true.

    Set to `true` to always enable it, and to `false` to always disable
    it.

`groups_draggable`

:   whether it should be possible to resequence colunms when kanban is
    grouped. Default: true.

    Set to `true` to always enable it, and to `false` to always disable
    it.

::: todo
VFE missing information on on_create attribute of kanban views.
:::

Possible children of the view element are:

::: rst-class
o-definition-list
:::

`field`

:   declares fields to use in kanban *logic*. If the field is simply
    displayed in the kanban view, it does not need to be pre-declared.

    Possible attributes are:

    ::: rst-class
    o-definition-list
    :::

    `name` (required)

    :   the name of the field to fetch

    `allow_group_range_value` (optional)

    :   whether a `date` or `datetime` field allows a value computed
        from a group range (which consists of the first and last dates
        of the group). Enables the \'quick create\' and \'drag and
        drop\' features when the kanban view is grouped by that field.
        Default: false.

`progressbar`

:   declares a progressbar element to put on top of kanban columns.

    Possible attributes are:

    ::: rst-class
    o-definition-list
    :::

    `field` (required)

    :   the name of the field whose values are used to subgroup
        column\'s records in the progressbar

    `colors` (required)

    :   JSON mapping the above field values to either \"danger\",
        \"warning\", \"success\" or \"muted\" colors

    `sum_field` (optional)

    :   the name of the field whose column\'s records\' values will be
        summed and displayed next to the progressbar (if omitted,
        displays the total number of records)

`templates`

:   defines a list of `reference/qweb`{.interpreted-text role="ref"}
    templates. Cards definition may be split into multiple templates for
    clarity, but kanban views *must* define at least one root template
    `kanban-box`, which will be rendered once for each record.

    The kanban view uses mostly-standard `javascript qweb
    <reference/qweb/javascript>`{.interpreted-text role="ref"} and
    provides the following context variables:

    ::: rst-class
    o-definition-list
    :::

    `widget`

    :   the current `KanbanRecord`{.interpreted-text role="js:class"},
        can be used to fetch some meta-information. These methods are
        also available directly in the template context and don\'t need
        to be accessed via `widget`

    `record`

    :   an object with all the requested fields as its attributes. Each
        field has two attributes `value` and `raw_value`, the former is
        formatted according to current user parameters, the latter is
        the direct value from a
        `~odoo.models.Model.read`{.interpreted-text role="meth"} (except
        for date and datetime fields that are [formatted according to
        user\'s
        locale](https://github.com/odoo/odoo/blob/a678bd4e/addons/web_kanban/static/src/js/kanban_record.js#L102))

    `context`

    :   the current context, coming from the action, and the one2many or
        many2many field in the case of a Kanban view embedded in a Form
        view

    `user_context`

    :   self-explanatory

    `read_only_mode`

    :   self-explanatory

    `selection_mode`

    :   set to true when kanban view is opened in mobile environment
        from m2o/m2m field for selecting records.

        :::: note
        ::: title
        Note
        :::

        clicking on m2o/m2m field in mobile environment opens kanban
        view
        ::::

        **buttons and fields**

        While most of the Kanban templates are standard
        `reference/qweb`{.interpreted-text role="ref"}, the Kanban view
        processes `field`, `button` and `a` elements specially:

        - by default fields are replaced by their formatted value,
          unless the `widget` attribute is specified, in which case
          their rendering and behavior depends on the corresponding
          widget. Possible values are (among others):

          ::: rst-class
          o-definition-list
          :::

          `handle`

          :   for `sequence` (or `integer`) fields by which records are
              sorted, allows to drag&drop records to reorder them.

          ::: todo
          list widgets?
          :::

        - buttons and links with a `type` attribute become perform
          Odoo-related operations rather than their standard HTML
          function. Possible types are:

          ::: rst-class
          o-definition-list
          :::

          `action`, `object`

          :   standard behavior for `Odoo buttons
              <reference/views/list/button>`{.interpreted-text
              role="ref"}, most attributes relevant to standard Odoo
              buttons can be used.

          `open`

          :   opens the card\'s record in the form view in read-only
              mode

          `edit`

          :   opens the card\'s record in the form view in editable mode

          `delete`

          :   deletes the card\'s record and removes the card

        ::: todo
        - kanban-specific CSS
        - kanban structures/widgets (vignette, details, \...)
        :::

If you need to extend the Kanban view, see
`KanbanRecord`{.interpreted-text role="js:class"}.

### List {#reference/views/list}

The root element of list views is `<tree>`[^2]. The list view\'s root
can have the following attributes:

::: rst-class
o-definition-list
:::

`editable`

:   by default, selecting a list view\'s row opens the corresponding
    `form view <reference/views/form>`{.interpreted-text role="ref"}.
    The `editable` attributes makes the list view itself editable
    in-place.

    Valid values are `top` and `bottom`, making *new* records appear
    respectively at the top or bottom of the list.

    The architecture for the inline
    `form view <reference/views/form>`{.interpreted-text role="ref"} is
    derived from the list view. Most attributes valid on a `form view
    <reference/views/form>`{.interpreted-text role="ref"}\'s fields and
    buttons are thus accepted by list views although they may not have
    any meaning if the list view is non-editable

    :::: note
    ::: title
    Note
    :::

    if the `edit` attribute is set to `false`, the `editable` option
    will be ignored.
    ::::

`multi_edit`

:   editable or not editable list can activate the multi-editing feature
    by defining the [multi_edit=1]{.title-ref}

`default_order`

:   overrides the ordering of the view, replacing the model\'s order
    (`~odoo.models.BaseModel._order`{.interpreted-text role="attr"}
    model attribute). The value is a comma-separated list of fields,
    postfixed by `desc` to sort in reverse order:

    ``` xml
    <tree default_order="sequence,name desc">
        ...
    </tree>
    ```

`decoration-{$name}`

:   allow changing the style of a row\'s text based on the corresponding
    record\'s attributes.

    `{$name}` can be `bf` (`font-weight: bold`), `it`
    (`font-style: italic`), or any [bootstrap contextual
    color](https://getbootstrap.com/docs/3.3/components/#available-variations)
    (`danger`, `info`, `muted`, `primary`, `success` or `warning`).

`create`, `edit`, `delete`, `import`, `export_xlsx`

:   allows *dis*abling the corresponding action in the view by setting
    the corresponding attribute to `false`

`limit`

:   the default size of a page. It must be a positive integer

`groups_limit`

:   when the list view is grouped, the default number of groups of a
    page. It must be a position integer

`expand`

:   when the list view is grouped, automatically open the first level of
    groups if set to true (default: false)

Possible children elements of the list view are:

:::: {#reference/views/list/button}
::: rst-class
o-definition-list
:::
::::

`button`

:   displays a button in a list cell

    ::: rst-class
    o-definition-list
    :::

    `icon`

    :   icon to use to display the button

    `string`

    :   - if there is no `icon`, the button\'s text
        - if there is an `icon`, `alt` text for the icon

    `type`

    :   type of button, indicates how it clicking it affects Odoo:

        ::: rst-class
        o-definition-list
        :::

        `object`

        :   call a method on the list\'s model. The button\'s `name` is
            the method, which is called with the current row\'s record
            id and the current context.

        `action`

        :   load an execute an `ir.actions`, the button\'s `name` is the
            database id of the action. The context is expanded with the
            list\'s model (as `active_model`), the current row\'s record
            (`active_id`) and all the records currently loaded in the
            list (`active_ids`, may be just a subset of the database
            records matching the current search)

    `name`

    :   see `type`

    `args`

    :   see `type`

    `attrs`

    :   dynamic attributes based on record values.

        A mapping of attributes to domains, domains are evaluated in the
        context of the current row\'s record, if `True` the
        corresponding attribute is set on the cell.

        Possible attribute is `invisible` (hides the button).

    `states`

    :   shorthand for `invisible` `attrs`: a list of states, comma
        separated, requires that the model has a `state` field and that
        it is used in the view.

        Makes the button `invisible` if the record is *not* in one of
        the listed states

        :::: danger
        ::: title
        Danger
        :::

        Using `states` in combination with `attrs` may lead to
        unexpected results as domains are combined with a logical AND.
        ::::

    `context`

    :   merged into the view\'s context when performing the button\'s
        Odoo call

    ::: todo
    declared but unused: help
    :::

`field`

:   defines a column where the corresponding field should be displayed
    for each record. Can use the following attributes:

    ::: rst-class
    o-definition-list
    :::

    `name`

    :   the name of the field to display in the current model. A given
        name can only be used once per view

    `string`

    :   the title of the field\'s column (by default, uses the `string`
        of the model\'s field)

    `invisible`

    :   fetches and stores the field, but doesn\'t display the column in
        the table. Necessary for fields which shouldn\'t be displayed
        but are used by e.g. `@colors`

    `groups`

    :   lists the groups which should be able to see the field

    `widget`

    :   alternate representations for a field\'s display. Possible list
        view values are (among others):

        ::: rst-class
        o-definition-list
        :::

        `progressbar`

        :   displays `float` fields as a progress bar.

        `handle`

        :   for `sequence` (or `integer`) fields by which records are
            sorted, instead of displaying the field\'s value just
            displays a drag&drop icon to reorder records.

    `sum`, `avg`

    :   displays the corresponding aggregate at the bottom of the
        column. The aggregation is only computed on *currently
        displayed* records. The aggregation operation must match the
        corresponding field\'s `group_operator`

    `attrs`

    :   dynamic attributes based on record values. Only effects the
        current field, so e.g. `invisible` will hide the field but leave
        the same field of other records visible, it will not hide the
        column itself

    `width` (for `editable`)

    :   when there is no data in the list, the width of a column can be
        forced by setting this attribute. The value can be an absolute
        width (e.g. \'100px\'), or a relative weight (e.g. \'3\',
        meaning that this column will be 3 times larger than the
        others). Note that when there are records in the list, we let
        the browser automatically adapt the column\'s widths according
        to their content, and this attribute is thus ignored.

    `decoration-{$name}`

    :   allow changing the style of a cell\'s text based on the
        corresponding record\'s attributes.

        `{$name}` can be `bf` (`font-weight: bold`), `it`
        (`font-style: italic`), or any [bootstrap contextual
        color](https://getbootstrap.com/docs/3.3/components/#available-variations)
        (`danger`, `info`, `muted`, `primary`, `success` or `warning`).

    `nolabel`

    :   if set to \"1\", the column header will remain empty. Also, the
        column won\'t be sortable.

    `optional`

    :   makes the column optional. If set to \"hide\", the column is
        hidden by default. If set to \"show\", the column is visible by
        default. User visibility choices are stored in the browser local
        storage.

    :::: note
    ::: title
    Note
    :::

    if the list view is `editable`, any field attribute from the
    `form view <reference/views/form>`{.interpreted-text role="ref"} is
    also valid and will be used when setting up the inline form view.
    ::::

    :::: note
    ::: title
    Note
    :::

    In case of list sub-views (One2many/Many2many display in a form
    view), The attribute `column_invisible` can be useful to hide a
    column depending on the parent object.

    ``` xml
    <field name="product_is_late" attrs="{'column_invisible': [('parent.has_late_products', '=', False)]}"/>
    ```
    ::::

    :::: note
    ::: title
    Note
    :::

    When a list view is grouped, numeric fields are aggregated and
    displayed for each group. Also, if there are too many records in a
    group, a pager will appear on the right of the group row. For this
    reason, it is not a good practice to have a numeric field in the
    last column, when the list view is in a situation where it can be
    grouped (it is however fine for x2manys field in a form view: they
    cannot be grouped).
    ::::

`groupby`

:   defines custom headers (with buttons) for the current view when
    grouping records on many2one fields. It is also possible to add
    [field]{.title-ref}, inside the [groupby]{.title-ref} which can be
    used for modifiers. These fields thus belong on the many2one
    comodel. These extra fields will be fetched in batch.

    ::: rst-class
    o-definition-list
    :::

    `name`

    :   the name of a many2one field (on the current model). Custom
        header will be displayed when grouping the view on this field
        name.

    ``` xml
    <groupby name="partner_id">
      <field name="name"/> <!-- name of partner_id -->
      <button type="edit" name="edit" string="Edit"/>
      <button type="object" name="my_method" string="Button1"
        attrs="{'invisible': [('name', '=', 'Georges')]}"/>
    </groupby>
    ```

    A special button ([type=\"edit\"]{.title-ref}) can be defined to
    open the many2one form view.

`control`

:   defines custom controls for the current view.

    This makes sense if the parent `tree` view is inside a One2many
    field.

    Does not support any attribute, but can have children:

    ::: rst-class
    o-definition-list
    :::

    `create`

    :   adds a button to create a new element on the current list.

        ::: rst-class
        o-definition-list
        :::

        :::: note
        ::: title
        Note
        :::

        If any `create` is defined, it will overwrite the default \"add
        a line\" button.
        ::::

        The following attributes are supported:

        ::: rst-class
        o-definition-list
        :::

        `string` (required)

        :   The text displayed on the button.

        `context`

        :   This context will be merged into the existing context when
            retrieving the default value of the new record.

            For example it can be used to override default values.

    The following example will override the default \"add a line\"
    button by replacing it with 3 new buttons: \"Add a product\", \"Add
    a section\" and \"Add a note\".

    \"Add a product\" will set the field \'display_type\' to its default
    value.

    The two other buttons will set the field \'display_type\' to be
    respectively \'line_section\' and \'line_note\'.

    ``` xml
    <control>
      <create
        string="Add a product"
      />
      <create
        string="Add a section"
        context="{'default_display_type': 'line_section'}"
      />
      <create
        string="Add a note"
        context="{'default_display_type': 'line_note'}"
      />
    </control>
    ```

### Map {#reference/views/map}

<span class="badge" style="background-color:#AD5E99">Enterprise feature</span>

This view is able to display records on a map and the routes between
them. The records are represented by pins. It also allows the
visualization of fields from the model in a popup tied to the record\'s
pin.

:::: note
::: title
Note
:::

The model on which the view is applied should contain a
[res.partner]{.title-ref} many2one since the view relies on the
[res.partner]{.title-ref}\'s address and coordinates fields to localize
the records.
::::

#### API {#reference/views/map/api}

The view uses location data platforms\' API to fetch the tiles (the
map\'s background), do the geoforwarding (converting addresses to a set
of coordinates) and fetch the routes. The view implements two API,
OpenStreetMap and MapBox. OpenStreetMap is used by default and is able
to fetch [tiles](https://wiki.openstreetmap.org/wiki/Tile_data_server)
and do [geoforwarding](https://nominatim.org/release-docs/develop/).
This API does not require a token. As soon as a valid
[MapBox](https://docs.mapbox.com/api/) token is provided in the general
settings the view switches to the MapBox API. This API is faster and
allows the computation of routes. A token can be obtained by [signing
up](https://account.mapbox.com/auth/signup/) to MapBox.

#### Structural components {#reference/views/structural components}

The view\'s root element is `<map>`. It can have the following
attributes:

::: rst-class
o-definition-list
:::

`res_partner`

:   Contains the [res.partner]{.title-ref} many2one. If not provided the
    view resorts to create an empty map.

`default_order`

:   If a field is provided the view overrides the model\'s default
    order. The field must be part of the model on which the view is
    applied, not from [res.partner]{.title-ref}.

`routing`

:   if `1` display the routes between the records. The view needs a
    valid MapBox token and at least two located records (i.e the records
    have a [res.partner]{.title-ref} many2one and the partner has an
    address or valid coordinates).

`hide_name`

:   if `1` hide the name from the pin\'s popup (default: `0`).

`hide_address`

:   if `1` hide the address from the pin\'s popup (default: `0`).

`hide_title`

:   if `1` hide the title from the pin list (default: `0`).

`panel_title`

:   String to display as title of the pin list. If not provided, the
    title is the action\'s name or \"Items\" if the view is not in an
    action.

`limit`

:   Maximum number of records to fetch (default: 80). It must be a
    positive integer.

The `<map>` element can contain multiple `<field>` elements. Each
`<field>` element is interpreted as a line in the pin\'s popup. The
field\'s attributes are the following:

::: rst-class
o-definition-list
:::

`name`

:   The field to display.

`string`

:   String to display before the field\'s content. It can be used as a
    description.

For example here is a map:

:   ``` xml
    <map res_partner="partner_id" default_order="date_begin" routing="1" hide_name="1">
        <field name="partner_id" string="Customer Name"/>
    </map>
    ```

### Pivot {#reference/views/pivot}

The pivot view is used to visualize aggregations as a [pivot
table](https://en.wikipedia.org/wiki/Pivot_table). Its root element is
`<pivot>` which can take the following attributes:

::: rst-class
o-definition-list
:::

`disable_linking` (optional)

:   Set to `1` to remove table cell\'s links to list view.

`display_quantity` (optional)

:   Set to `1` to display the Quantity column by default.

`default_order` (optional)

:   The name of the measure and the order (asc or desc) to use as
    default order in the view.

    ``` xml
    <pivot default_order="foo asc">
       <field name="foo" type="measure"/>
    </pivot>
    ```

The only allowed element within a pivot view is `field` which can have
the following attributes:

::: rst-class
o-definition-list
:::

`name` (mandatory)

:   the name of a field to use in the view. If used for grouping (rather
    than aggregating)

`string` (optional)

:   the name that will be used to display the field in the pivot view,
    overrides the default python String attribute of the field.

`type` (optional)

:   indicates whether the field should be used as a grouping criteria or
    as an aggregated value within a group. Possible values are:

    ::: rst-class
    o-definition-list
    :::

    `row` (default)

    :   groups by the specified field, each group gets its own row.

    `col`

    :   creates column-wise groups

    `measure`

    :   field to aggregate within a group

    `interval`

    :   on date and datetime fields, groups by the specified interval
        (`day`, `week`, `month`, `quarter` or `year`) instead of
        grouping on the specific datetime (fixed second resolution) or
        date (fixed day resolution).

`invisible` (optional)

:   if true, the field will not appear either in the active measures nor
    in the selectable measures (useful for fields that do not make sense
    aggregated, such as fields in different units, e.g. € and \$).

The measures are automatically generated from the model fields; only the
aggregatable fields are used. Those measures are also alphabetically
sorted on the string of the field.

:::: warning
::: title
Warning
:::

like the graph view, the pivot aggregates data on database content which
means that non-stored function fields can not be used in pivot views
::::

In Pivot view a `field` can have a `widget` attribute to dictate its
format. The widget should be a field formatter, of which the most
interesting are `date`, `datetime`, `float_time`, and `monetary`.

For instance a timesheet pivot view could be defined as:

    <pivot string="Timesheet">
        <field name="employee_id" type="row"/>
        <field name="date" interval="month" type="col"/>
        <field name="unit_amount" type="measure" widget="float_time"/>
    </pivot>

### QWeb {#reference/views/qweb}

QWeb views are standard `reference/qweb`{.interpreted-text role="ref"}
templates inside a view\'s `arch`. They don\'t have a specific root
element. Because QWeb views don\'t have a specific root element, their
type must be specified explicitly (it can not be inferred from the root
element of the `arch` field).

QWeb views have two use cases:

- they can be used as frontend templates, in which case
  `reference/data/template`{.interpreted-text role="ref"} should be used
  as a shortcut.
- they can be used as actual qweb views (opened inside an action), in
  which case they should be defined as regular view with an explicit
  `type` (it can not be inferred) and a model.

The main additions of qweb-as-view to the basic qweb-as-template are:

- qweb-as-view has a special case for a `<nav>` element bearing the CSS
  class `o_qweb_cp_buttons`: its contents should be buttons and will be
  extracted and moved to the control panel\'s button area, the `<nav>`
  itself will be removed, this is a work-around to control panel views
  not existing yet

- qweb-as-view rendering adds several items to the standard qweb
  rendering context:

  ::: rst-class
  o-definition-list
  :::

  `model`

  :   the model to which the qweb view is bound

  `domain`

  :   the domain provided by the search view

  `context`

  :   the context provided by the search view

  `records`

  :   a lazy proxy to `model.search(domain)`, this can be used if you
      just want to iterate the records and not perform more complex
      operations (e.g. grouping)

- qweb-as-view also provides additional rendering hooks:

  - `_qweb_prepare_context(view_id, domain)` prepares the rendering
    context specific to qweb-as-view
  - `qweb_render_view(view_id, domain)` is the method called by the
    client and will call the context-preparation methods and ultimately
    `env['ir.qweb'].render()`.

### Search {#reference/views/search}

Search views are a break from previous view types in that they don\'t
display *content*: although they apply to a specific model, they are
used to filter other view\'s content (generally aggregated views e.g.
`reference/views/list`{.interpreted-text role="ref"} or
`reference/views/graph`{.interpreted-text role="ref"}). Beyond that
difference in use case, they are defined the same way.

The root element of search views is `<search>`. It takes no attributes.

Possible children elements of the search view are:

::: rst-class
o-definition-list
:::

`field`

:   fields define domains or contexts with user-provided values. When
    search domains are generated, field domains are composed with one
    another and with filters using **AND**.

    Fields can have the following attributes:

    ::: rst-class
    o-definition-list
    :::

    `name`

    :   the name of the field to filter on

    `string`

    :   the field\'s label

    `operator`

    :   by default, fields generate domains of the form `[({name},
        {operator}, {provided_value})]`{.interpreted-text role="samp"}
        where `name` is the field\'s name and `provided_value` is the
        value provided by the user, possibly filtered or transformed
        (e.g. a user is expected to provide the *label* of a selection
        field\'s value, not the value itself).

        The `operator` attribute allows overriding the default operator,
        which depends on the field\'s type (e.g. `=` for float fields
        but `ilike` for char fields)

    `filter_domain`

    :   complete domain to use as the field\'s search domain, can use a
        `self` variable to inject the provided value in the custom
        domain. Can be used to generate significantly more flexible
        domains than `operator` alone (e.g. searches on multiple fields
        at once)

        If both `operator` and `filter_domain` are provided,
        `filter_domain` takes precedence.

    `context`

    :   allows adding context keys, including the user-provided values
        (which as for `domain` are available as a `self` variable, an
        array of values e.g. `[id_1, id_2]` for a
        `~odoo.fields.Many2one`{.interpreted-text role="class"} field).
        By default, fields don\'t generate domains.

        :::: note
        ::: title
        Note
        :::

        the domain and context are inclusive and both are generated if a
        `context` is specified. To only generate context values, set
        `filter_domain` to an empty list: `filter_domain="[]"`
        ::::

    `groups`

    :   make the field only available to specific users

    `domain`

    :   if the field can provide an auto-completion (e.g.
        `~odoo.fields.Many2one`{.interpreted-text role="class"}),
        filters the possible completion results.

`filter`

:   a filter is a predefined toggle in the search view, it can only be
    enabled or disabled. Its main purposes are to add data to the search
    context (the context passed to the data view for
    searching/filtering), or to append new sections to the search
    filter.

    Filters can have the following attributes:

    ::: rst-class
    o-definition-list
    :::

    `string` (required)

    :   the label of the filter

    `domain` (optional)

    :   an Odoo `domain <reference/orm/domains>`{.interpreted-text
        role="ref"}, will be appended to the action\'s domain as part of
        the search domain.

    `date` (optional)

    :   the name of a field of type `date` or `datetime`. Using this
        attribute has the effect to create a set of filters available in
        a submenu of the filters menu. The filters proposed are time
        dependent but not dynamic in the sense that their domains are
        evaluated at the time of the control panel instantiation.

        Example:

        ``` xml
        <filter name="filter_create_date" date="create_date" string="Creation Date"/>
        ```

        The example above allows to easily search for records with
        creation date field values in one of the periods below (if the
        current month is August 2019).

        ``` text
        Create Date >
          August
          July
          June
          Q4
          Q3
          Q2
          Q1
        --------------
          2019
          2018
          2017
        ```

        Multi selection of options is allowed.

    `default_period` (optional)

    :   only makes sense for a filter with non empty `date` attribute.
        determines which periods are activated if the filter is in the
        default set of filters activated at the view initialization. If
        not provided, \'this_month\' is used by default.

        To choose among the following options: today, this_week,
        this_month, last_month, antepenultimate_month, fourth_quarter,
        third_quarter, second_quarter, first_quarter, this_year,
        last_year, antepenultimate_year.

        The attribute accepts comma separated values.

        Examples:

        ``` xml
        <filter name="filter_create_date" date="create_date" string="Creation Date" default_period="this_week"/>
        <filter name="filter_create_date" date="create_date" string="Creation Date" default_period="this_year,last_year"/>
        ```

    `context`

    :   a Python dictionary, merged into the action\'s domain to
        generate the search domain

        The key `group_by` can be used to define a groupby available in
        the \'Group By\' menu. The \'group_by\' value can be a valid
        field name.

        ``` xml
        <filter name="groupby_category" string="Category" context="{'group_by': 'category_id'}"/>
        ```

        The groupby defined above allows to group data by category.

        When the field is of type `date` or `datetime`, the filter
        generates a submenu of the Group By menu in which the following
        interval options are available: day, week, month, quarter, year.

        In case the filter is in the default set of filters activated at
        the view initialization, the records are grouped by month by
        default. This can be changed by using the syntax
        \'date_field:interval\' as in the following example.

        Example:

        ``` xml
        <filter name="groupby_create_date" string="Creation Date" context="{'group_by': 'create_date:week'}"/>
        ```

        :::: note
        ::: title
        Note
        :::

        The results of read_groups grouped on a field may be influenced
        by its group_expand attribute, allowing to display empty groups
        when needed. For more information, please refer to
        `~odoo.fields.Field`{.interpreted-text role="class"} attributes
        documentation.
        ::::

    `name`

    :   logical name for the filter, can be used to
        `enable it by default
        <reference/views/search/defaults>`{.interpreted-text
        role="ref"}, can also be used as
        `inheritance hook <reference/views/inheritance>`{.interpreted-text
        role="ref"}

    `help`

    :   a longer explanatory text for the filter, may be displayed as a
        tooltip

    `groups`

    :   makes a filter only available to specific users

    ::::::: tip
    ::: title
    Tip
    :::

    ::: versionadded
    7.0
    :::

    Sequences of filters (without non-filters separating them) are
    treated as inclusively composited: they will be composed with `OR`
    rather than the usual `AND`, e.g.

        <filter domain="[('state', '=', 'draft')]"/>
        <filter domain="[('state', '=', 'done')]"/>

    if both filters are selected, will select the records whose `state`
    is `draft` or `done`, but

        <filter domain="[('state', '=', 'draft')]"/>
        <separator/>
        <filter domain="[('delay', '&lt;', 15)]"/>

    if both filters are selected, will select the records whose `state`
    is `draft` **and** `delay` is below 15.

    :::: note
    ::: title
    Note
    :::

    XML does not allow `<` to be used within XML elements, an entity
    reference (`&lt;`) should be used instead.
    ::::
    :::::::

`separator`

:   can be used to separates groups of filters in simple search views

`group`

:   can be used to separate groups of filters, more readable than
    `separator` in complex search views

`searchpanel`

:   allows to display a search panel on the left of any multi records
    view. By default, the list and kanban views have the searchpanel
    enabled. The search panel can be activated on other views with the
    attribute:

    ::: rst-class
    o-definition-list
    :::

    `view_types`

    :   a comma separated list of view types on which to enable the
        search panel default: \'tree,kanban\'

    This tool allows to quickly filter data on the basis of given
    fields. The fields are specified as direct children of the
    `searchpanel` with tag name `field`, and the following attributes:

    ::: rst-class
    o-definition-list
    :::

    `name` (mandatory)

    :   the name of the field to filter on

    `select`

    :   determines the behavior and display. Possible values are

        - `one` (default) at most one value can be selected. Supported
          field types are many2one and selection.
        - `multi` several values can be selected (checkboxes). Supported
          field types are many2one, many2many and selection.

    `groups`

    :   restricts to specific users

    `string`

    :   determines the label to display

    `icon`

    :   specifies which icon is used

    `color`

    :   determines the icon color

    Additional optional attributes are available in the `multi` case:

    ::: rst-class
    o-definition-list
    :::

    `enable_counters`

    :   default is false. If set to true the record counters will be
        computed and displayed if non-zero.

        This feature has been implemented in case performances would be
        too bad.

        Another way to solve performance issues is to properly override
        the `search_panel_select_range` and
        `search_panel_select_multi_range` methods.

    `expand`

    :   default is false. If set to false categories or filters with 0
        records will be hidden.

    `limit`

    :   default is 200. Integer determining the maximal number of values
        to fetch for the field. If the limit is reached, no values will
        be displayed in the search panel and an error message will
        appear instead because we consider that is useless / bad
        performance-wise. All values will be fetched if set to 0.

    Additional optional attributes are available according to the chosen
    case:

    - For the `one` case:

      ::: rst-class
      o-definition-list
      :::

      `hierarchize`

      :   (only available for many2one fields) default is true. Handles
          the display style of categories :

          If set to true child categories will appear under their
          related parent. If not, all categories will be displayed on
          the same level.

    - For the `multi` case:

      ::: rst-class
      o-definition-list
      :::

      `domain`:

      :   determines conditions that the comodel records have to
          satisfy.

    A domain might be used to express a dependency on another field
    (with select=\"one\") of the search panel. Consider /!This attribute
    is incompatible with a select=\"one\" with enabled counters; if a
    select=\"multi\" has a [domain]{.title-ref} attribute, all
    select=\"one\" will have their counters disabled.

    ``` xml
    <searchpanel>
      <field name="department_id"/>
      <field name="manager_id" select="multi" domain="[('department_id', '=', department_id)]"/>
    </searchpanel>
    ```

    In the above example, the range of values for manager_id (manager
    names) available at screen will depend on the value currently
    selected for the field `department_id`.

    - `groupby`: field name of the comodel (only available for many2one
      and many2many fields). Values will be grouped by that field.

#### Search defaults {#reference/views/search/defaults}

Search fields and filters can be configured through the action\'s
`context` using `search_default_{name}`{.interpreted-text role="samp"}
keys. For fields, the value should be the value to set in the field, for
filters it\'s a boolean value or a number. For instance, assuming `foo`
is a field and `bar` is a filter an action context of:

``` python
{
  'search_default_foo': 'acro',
  'search_default_bar': 1
}
```

will automatically enable the `bar` filter and search the `foo` field
for *acro*.

A numeric value (between 1 and 99) can be used to describe the order of
default groupbys. For instance if `foo` and `bar` refer to two groupbys

``` python
{
  'search_default_foo': 2,
  'search_default_bar': 1
}
```

has the effect to activate first `bar` then `foo`.

[^1]: an extension function is added for simpler matching in QWeb views:
    `hasclass(*classes)` matches if the context node has all the
    specified classes

[^2]: for historical reasons, it has its origin in tree-type views later
    repurposed to a more table/list-type display




--- SOURCE: developer/reference/backend.md ---

nosearch

:   

# Python framework

::: {.toctree titlesonly=""}
backend/orm backend/data backend/actions backend/views backend/module
backend/reports backend/security backend/performance backend/testing
backend/http backend/mixins
:::




--- SOURCE: developer/reference/cli.md ---

# Command-line interface (CLI) {#reference/cmdline}

The CLI `command-line interface`{.interpreted-text role="dfn"} offers
several functionalities related to Odoo. You can use it to
`run the server <reference/cmdline/server>`{.interpreted-text
role="ref"}, `launch Odoo as a Python console
environment <reference/cmdline/shell>`{.interpreted-text role="ref"},
`scaffold an Odoo module <reference/cmdline/scaffold>`{.interpreted-text
role="ref"},
`populate a database <reference/cmdline/populate>`{.interpreted-text
role="ref"}, or `count the number of lines of code
<reference/cmdline/cloc>`{.interpreted-text role="ref"}.

:::::::: important
::: title
Important
:::

The command to use to call the CLI depends on how you installed Odoo. In
the examples below, we assume that you are
`running Odoo from source </administration/on_premise/source>`{.interpreted-text
role="doc"} with the `odoo-bin`{.interpreted-text role="file"} file. If
you installed Odoo `from a distribution package
</administration/on_premise/packages>`{.interpreted-text role="doc"} or
with [Docker](https://hub.docker.com/_/odoo/), you must adapt the
command.

:::::: tabs
::: tab
Run Odoo from source

1.  Navigate to the root of the directory where you downloaded the
    source files of Odoo Community.
2.  Run all CLI commands with `./odoo-bin`{.interpreted-text
    role="command"}
:::

::: tab
Odoo was installed from a distribution package

When Odoo was installed, an executable named [odoo]{.title-ref} was
added to your user\'s PATH. Replace all occurrences of
`odoo-bin`{.interpreted-text role="command"} with
`odoo`{.interpreted-text role="command"} in the examples below.
:::

::: tab
Odoo was installed with Docker

Please refer to the [documentation of the official Docker image of
Odoo](https://hub.docker.com/_/odoo/).
:::
::::::
::::::::

## Help & version {#reference/cmdline/help}

::: program
odoo-bin
:::

::: option

`-h, --help`

:   

shows help text with all available options
:::

::: option

`--version`

:   

shows Odoo version e.g. \"Odoo Server {BRANCH}\"
:::

:::: tip
::: title
Tip
:::

You can enable auto-completion in your shell by running

``` bash
echo "complete -W '`./odoo-bin --help | \
  sed -e 's/[^a-z_-]\(-\+[a-z0-9_-]\+\)/\n\1\n/' | \
  grep -- '^-' | sort | uniq | tr '\n' ' '`' odoo-bin" >> ~/.bash_completion
```
::::

## Running the server {#reference/cmdline/server}

::: program
odoo-bin
:::

::: option

`-d <database>, --database <database>`

:   

database(s) used when installing or updating modules. Providing a
comma-separated list restrict access to databases provided in list.

For advanced database options, take a look
`below <reference/cmdline/server/database>`{.interpreted-text
role="ref"}.
:::

::: option

`-i <modules>, --init <modules>`

:   

comma-separated list of modules to install before running the server
(requires `-d`{.interpreted-text role="option"}).
:::

::: option

`-u <modules>, --update <modules>`

:   

comma-separated list of modules to update before running the server. Use
`all` for all modules. (requires `-d`{.interpreted-text role="option"}).
:::

::: option

`--addons-path <directories>`

:   

comma-separated list of directories in which modules are stored. These
directories are scanned for modules.
:::

::: option

`--upgrade-path <upgrade_path>`

:   

comma-separated list of directories from which additional upgrade
scripts are loaded.
:::

::: option

`--pre-upgrade-scripts <pre_upgrade_scripts>`

:   

comma-separated list of paths to upgrade scripts. The scripts are run
before loading base module when an upgrade of any module is requested.
This is useful to perform some actions during custom modules upgrade
after a major upgrade.
:::

::: option

`--load <modules>`

:   

list of server-wide modules to load. Those modules are supposed to
provide features not necessarily tied to a particular database. This is
in contrast to modules that are always bound to a specific database when
they are installed (i.e. the majority of Odoo addons). Default is
`base,web`.
:::

::: option

`-c <config>, --config <config>`

:   

path to an alternate
`configuration file <reference/cmdline/config>`{.interpreted-text
role="ref"}. If not defined, Odoo checks `ODOO_RC` environmental
variable and default location `{$HOME}/.odoorc`{.interpreted-text
role="file"}. See configuration file section
`below <reference/cmdline/config>`{.interpreted-text role="ref"}.
:::

::: option

`-D <data-dir-path>, --data-dir <data-dir-path>`

:   

directory path where to store Odoo data (eg. filestore, sessions). If
not specified, Odoo will fallback to a predefined path. On Unix systems
its one defined in `$XDG_DATA_HOME` environmental variable or
`~/.local/share/Odoo`{.interpreted-text role="file"} or
`/var/lib/Odoo`{.interpreted-text role="file"}.
:::

::: option

`-s, --save`

:   

saves the server configuration to the current configuration file
(`{$HOME}/.odoorc`{.interpreted-text role="file"} by default, and can be
overridden using `-c`{.interpreted-text role="option"}).
:::

::: option

`--without-demo`

:   

disables demo data loading for modules installed comma-separated, use
`all` for all modules. Requires `-d`{.interpreted-text role="option"}
and `-i`{.interpreted-text role="option"}.
:::

::: option

`--pidfile=<pidfile>`

:   

path to a file where the server pid will be stored
:::

::: option

`--stop-after-init`

:   

stops the server after its initialization.
:::

::: option

`--geoip-db <path>`

:   

Absolute path to the GeoIP database file.
:::

## Testing Configuration {#reference/cmdline/testing}

::: option

`--test-enable`

:   

runs tests after module installation
:::

::: option

`--test-file <file>`

:   

runs a python test file
:::

::: option
\--test-tags \[-\]\[tag\]\[/module\]\[:class\]\[.method\]

Comma-separated list of specs to filter which tests to execute. Enable
unit tests if set.

Example: [\--test-tags
:TestClass.test_func,/test_module,external]{.title-ref}

- The [-]{.title-ref} specifies if we want to include or exclude tests
  matching this spec.
- The tag will match tags added on a class with a
  `~odoo.tests.common.tagged`{.interpreted-text role="func"} decorator
  (all `test classes <reference/testing>`{.interpreted-text role="ref"}
  have [standard]{.title-ref} and [at_install]{.title-ref} tags until
  explicitly removed, see the decorator documentation).
- [\*]{.title-ref} will match all tags.
- If tag is omitted on include mode, its value is
  [standard]{.title-ref}.
- If tag is omitted on exclude mode, its value is [\*]{.title-ref}.
- The module, class, and method will respectively match the module name,
  test class name and test method name.

Filtering and executing the tests happens twice: right after each module
installation/update and at the end of the modules loading. At each stage
tests are filtered by [\--test-tags]{.title-ref} specs and additionally
by dynamic specs [at_install]{.title-ref} and [post_install]{.title-ref}
correspondingly.
:::

::: option

`--screenshots`

:   

Specify directory where to write screenshots when an HttpCase.browser_js
test fails. It defaults to
`/tmp/odoo_tests/{db_name}/screenshots`{.interpreted-text role="file"}
:::

::: option

`--screencasts`

:   

Enable screencasts and specify directory where to write screencasts
files. The `ffmpeg` utility needs to be installed to encode frames into
a video file. Otherwise frames will be kept instead of the video file.
:::

### Database {#reference/cmdline/server/database}

::: option

`-r <user>, --db_user <user>`

:   

database username, used to connect to PostgreSQL.
:::

::: option

`-w <password>, --db_password <password>`

:   

database password, if using [password
authentication](https://www.postgresql.org/docs/12/static/auth-methods.html#AUTH-PASSWORD).
:::

::: option

`--db_host <hostname>`

:   

host for the database server

- `localhost` on Windows
- UNIX socket otherwise
:::

::: option

`--db_port <port>`

:   

port the database listens on, defaults to 5432
:::

::: option

`--db-filter <filter>`

:   

hides databases that do not match `<filter>`. The filter is a [regular
expression](https://docs.python.org/3/library/re.html), with the
additions that:

- `%h` is replaced by the whole hostname the request is made on.

- `%d` is replaced by the subdomain the request is made on, with the
  exception of `www` (so domain `odoo.com` and `www.odoo.com` both match
  the database `odoo`).

  These operations are case sensitive. Add option `(?i)` to match all
  databases (so domain `odoo.com` using `(?i)%d` matches the database
  `Odoo`).

Since version 11, it\'s also possible to restrict access to a given
database listen by using the \--database parameter and specifying a
comma-separated list of databases

When combining the two parameters, db-filter supersedes the
comma-separated database list for restricting database list, while the
comma-separated list is used for performing requested operations like
upgrade of modules.

``` bash
$ odoo-bin --db-filter ^11.*$
```

Restrict access to databases whose name starts with 11

``` bash
$ odoo-bin --database 11firstdatabase,11seconddatabase
```

Restrict access to only two databases, 11firstdatabase and
11seconddatabase

``` bash
$ odoo-bin --database 11firstdatabase,11seconddatabase -u base
```

Restrict access to only two databases, 11firstdatabase and
11seconddatabase, and update base module on one database:
11firstdatabase. If database 11seconddatabase doesn\'t exist, the
database is created and base modules is installed

``` bash
$ odoo-bin --db-filter ^11.*$ --database 11firstdatabase,11seconddatabase -u base
```

Restrict access to databases whose name starts with 11, and update base
module on one database: 11firstdatabase. If database 11seconddatabase
doesn\'t exist, the database is created and base modules is installed
:::

::: option

`--db-template <template>`

:   

when creating new databases from the database-management screens, use
the specified [template
database](https://www.postgresql.org/docs/12/static/manage-ag-templatedbs.html).
Defaults to `template0`.
:::

::: option

`--pg_path </path/to/postgresql/binaries>`

:   

Path to the PostgreSQL binaries that are used by the database manager to
dump and restore databases. You have to specify this option only if
these binaries are located in a non-standard directory.
:::

::: option

`--no-database-list`

:   

Suppresses the ability to list databases available on the system
:::

::: option

`--db_sslmode`

:   

Control the SSL security of the connection between Odoo and PostgreSQL.
Value should be one of \'disable\', \'allow\', \'prefer\', \'require\',
\'verify-ca\' or \'verify-full\' Default value is \'prefer\'
:::

::: option

`--unaccent`

:   

Try to enable the unaccent extension when creating new databases
:::

### Emails {#reference/cmdline/server/emails}

::: option

`--email-from <address>`

:   

Email address used as \<FROM\> when Odoo needs to send mails
:::

::: option

`--from-filter <address or domain>`

:   

Define which email address the SMTP configuration will apply to. The
field can be a domain name or an entire email address, or it can remain
empty. If the sender\'s email address does not match this set filter,
then the email will be encapsulated using a combination of the two
system parameters: `mail.default.from` and `mail.catchall.domain`. For
example, \"Admin\" \<admin@example.com\> =\> \"Admin\"
\<notifications@mycompany.com\>.
:::

::: option

`--smtp <server>`

:   

Address of the SMTP server to connect to in order to send mails
:::

::: option

`--smtp-port <port>`

:   
:::

::: option

`--smtp-ssl`

:   

If set, odoo should use SSL/STARTSSL SMTP connections
:::

::: option

`--smtp-user <name>`

:   

Username to connect to the SMTP server
:::

::: option

`--smtp-password <password>`

:   

Password to connect to the SMTP server
:::

::: option

`--smtp-ssl-certificate-filename <path/to/cert.pem>`

:   

An SSL certificate is to be used for authentication. If set, then
[smtp-ssl-private-key]{.title-ref} is required.
:::

::: option

`--smtp-ssl-private-key-filename <path/to/key.pem>`

:   

An SSL private key is used for authentication. If set, then
[smtp-ssl-certificate]{.title-ref} is required.
:::

### Internationalisation {#reference/cmdline/server/internationalisation}

Use these options to translate Odoo to another language. See i18n
section of the user manual. Option \'-d\' is mandatory. Option \'-l\' is
mandatory in case of importation

::: option

`--load-language <languages>`

:   

specifies the languages (separated by commas) for the translations you
want to be loaded
:::

::: option

`-l, --language <language>`

:   

specify the language of the translation file. Use it with \--i18n-export
or \--i18n-import
:::

::: option

`--i18n-export <filename>`

:   

export all sentences to be translated to a CSV file, a PO file or a TGZ
archive and exit.
:::

::: option

`--i18n-import <filename>`

:   

import a CSV or a PO file with translations and exit. The \'-l\' option
is required.
:::

::: option

`--i18n-overwrite`

:   

overwrites existing translation terms on updating a module or importing
a CSV or a PO file.
:::

::: option

`--modules`

:   

specify modules to export. Use in combination with \--i18n-export
:::

### Advanced Options {#reference/cmdline/advanced}

#### Developer features {#reference/cmdline/dev}

::: option

`--dev <feature,feature,...,feature>`

:   

comma-separated list of features. For development purposes only. Do not
use it in production. Possible features are:

- `all`: all the features below are activated
- `xml`: read QWeb template from xml file directly instead of database.
  Once a template has been modified in database, it will be not be read
  from the xml file until the next update/init. Particularly, templates
  are not translated on using this option.
- `reload`: restart server when python file are updated (may not be
  detected depending on the text editor used)
- `qweb`: break in the evaluation of QWeb template when a node contains
  `t-debug='debugger'`
- `(i)p(u)db`: start the chosen python debugger in the code when an
  unexpected error is raised before logging and returning the error.
- `werkzeug`: display the full traceback on the frontend page in case of
  exception
:::

#### HTTP {#reference/cmdline/server/http}

::::: option

`--no-http`

:   

do not start the HTTP or long-polling workers (may still start
`cron <reference/actions/cron>`{.interpreted-text role="ref"} workers)

:::: warning
::: title
Warning
:::

has no effect if `--test-enable`{.interpreted-text role="option"} is
set, as tests require an accessible HTTP server
::::
:::::

::: option

`--http-interface <interface>`

:   

TCP/IP address on which the HTTP server listens, defaults to `0.0.0.0`
(all addresses)
:::

::: option

`-p <port>`

:   
:::

::: option

`--http-port <port>`

:   

Port on which the HTTP server listens, defaults to 8069.
:::

::: option

`--gevent-port <port>`

:   

TCP port for websocket connections in multiprocessing or gevent mode,
defaults to 8072. Not used in default (threaded) mode.
:::

::::: option

`--proxy-mode`

:   

enables the use of `X-Forwarded-*` headers through [Werkzeug\'s proxy
support](https://werkzeug.palletsprojects.com/en/0.16.x/middleware/proxy_fix/#module-werkzeug.middleware.proxy_fix).

It ignores all `X-Forwarded-*` headers in case `X-Forwarded-Host` is
missing from the request.

It always gets the real IP from the last entry of the `X-Forwarded-For`
chain. Configure your web server accordingly using directives such as
nginx\'s
[set_real_ip_from](https://nginx.org/en/docs/http/ngx_http_realip_module.html)
in case there are other trusted proxies along the chain that must be
ignored.

`X-Forwarded-Proto` and `X-Forwarded-Host` are used to update the
request root URL, which in turn is used to update the `web.base.url`
system parameter upon a successful admin authentication. This system
parameter is used to generate all links for the current database; see
`domain-name/web-base-url`{.interpreted-text role="ref"}.

:::: warning
::: title
Warning
:::

proxy mode *must not* be enabled outside of a reverse proxy scenario
::::
:::::

::: option

`--x-sendfile`

:   

delegates serving attachments files to the static web server and sets
both `X-Sendfile` (apache) and `X-Accel-*` (nginx) http headers on
stream responses. See `deploy/streaming`{.interpreted-text role="ref"}
for web server configuration.
:::

#### Logging {#reference/cmdline/server/logging}

By default, Odoo displays all logging of
[level](https://docs.python.org/3/library/logging.html#logging.Logger.setLevel)
`INFO`, `WARNING` and `ERROR`. All logs independently of the level are
output on `stderr`. Various options are available to redirect logging to
other destinations and to customize the verbosity.

::: option

`--logfile <file>`

:   

sends logging output to the specified file instead of `stderr`. On Unix,
the file [can be managed by external log rotation
programs](https://docs.python.org/3/library/logging.handlers.html#watchedfilehandler)
and will automatically be reopened when replaced
:::

::: option

`--syslog`

:   

logs to the system\'s event logger: [syslog on
unices](https://docs.python.org/3/library/logging.handlers.html#sysloghandler)
and [the Event Log on
Windows](https://docs.python.org/3/library/logging.handlers.html#nteventloghandler).

Neither is configurable
:::

::: option

`--log-db <dbname>`

:   

logs to the `ir.logging` model (`ir_logging` table) of the specified
database. The database can be the name of a database in the \"current\"
PostgreSQL, or [a PostgreSQL
URI](https://www.postgresql.org/docs/12/static/libpq-connect.html#AEN38208)
for e.g. log aggregation.
:::

::: option

`--log-handler <handler-spec>`

:   

`{LOGGER}:{LEVEL}`{.interpreted-text role="samp"}, enables `LOGGER` at
the provided `LEVEL` e.g. `odoo.models:DEBUG` will enable all logging
messages at or above `DEBUG` level in the models.

- The colon `:` is mandatory
- The logger can be omitted to configure the root (default) handler
- If the level is omitted, the logger is set to `INFO`

The option can be repeated to configure multiple loggers e.g.

``` console
$ odoo-bin --log-handler :DEBUG --log-handler werkzeug:CRITICAL --log-handler odoo.fields:WARNING
```
:::

::: option

`--log-web`

:   

enables DEBUG logging of HTTP requests and responses, equivalent to
`--log-handler=odoo.http:DEBUG`
:::

::: option

`--log-sql`

:   

enables DEBUG logging of SQL querying, equivalent to
`--log-handler=odoo.sql_db:DEBUG`
:::

::::: option

`--log-level <level>`

:   

Shortcut to more easily set predefined levels on specific loggers.
\"real\" levels (`critical`, `error`, `warn`, `debug`) are set on the
`odoo` and `werkzeug` loggers (except for `debug` which is only set on
`odoo`).

Odoo also provides debugging pseudo-levels which apply to different sets
of loggers:

`debug_sql`

:   sets the SQL logger to `debug`

    equivalent to `--log-sql`

`debug_rpc`

:   sets the `odoo` and HTTP request loggers to `debug`

    equivalent to `--log-level debug --log-request`

`debug_rpc_answer`

:   sets the `odoo` and HTTP request and response loggers to `debug`

    equivalent to `--log-level debug --log-request --log-response`

:::: note
::: title
Note
:::

In case of conflict between `--log-level`{.interpreted-text
role="option"} and `--log-handler`{.interpreted-text role="option"}, the
latter is used
::::
:::::

#### Multiprocessing {#reference/cdmline/workers}

:::::::::: option

`--workers <count>`

:   

if `count` is not 0 (the default), enables multiprocessing and sets up
the specified number of HTTP workers (sub-processes processing HTTP and
RPC requests).

:::: note
::: title
Note
:::

multiprocessing mode is only available on Unix-based systems
::::

A number of options allow limiting and recycling workers:

::: option

`--limit-request <limit>`

:   

Number of requests a worker will process before being recycled and
restarted.

Defaults to *8196*.
:::

::: option

`--limit-memory-soft <limit>`

:   

Maximum allowed virtual memory per worker in bytes. If the limit is
exceeded, the worker is killed and recycled at the end of the current
request.

Defaults to *2048MiB (2048\*1024\*1024B)*.
:::

::: option

`--limit-memory-hard <limit>`

:   

Hard limit on virtual memory in bytes, any worker exceeding the limit
will be immediately killed without waiting for the end of the current
request processing.

Defaults to *2560MiB (2560\*1024\*1024B)*.
:::

::: option

`--limit-time-cpu <limit>`

:   

Prevents the worker from using more than \<limit\> CPU seconds for each
request. If the limit is exceeded, the worker is killed.

Defaults to *60*.
:::

::: option

`--limit-time-real <limit>`

:   

Prevents the worker from taking longer than \<limit\> seconds to process
a request. If the limit is exceeded, the worker is killed.

Differs from `--limit-time-cpu`{.interpreted-text role="option"} in that
this is a \"wall time\" limit including e.g. SQL queries.

Defaults to *120*.
:::
::::::::::

::: option

`--max-cron-threads <count>`

:   

number of workers dedicated to
`cron <reference/actions/cron>`{.interpreted-text role="ref"} jobs.
Defaults to *2*. The workers are threads in multi-threading mode and
processes in multi-processing mode.

For multi-processing mode, this is in addition to the HTTP worker
processes.
:::

::: option

`--limit-time-worker-cron <limit>`

:   

Soft limit on how long a
`cron <reference/actions/cron>`{.interpreted-text role="ref"}
thread/worker is allowed to live before is is restarted, in seconds.

Set to 0 to disable.

Defaults to *0*.
:::

## Configuration file {#reference/cmdline/config}

::: program
odoo-bin
:::

Most of the command-line options can also be specified via a
configuration file. Most of the time, they use similar names with the
prefix `-` removed and other `-` are replaced by `_` e.g.
`--db-template`{.interpreted-text role="option"} becomes `db_template`.

Some conversions don\'t match the pattern:

- `--db-filter`{.interpreted-text role="option"} becomes `dbfilter`
- `--no-http`{.interpreted-text role="option"} corresponds to the
  `http_enable` boolean
- logging presets (all options starting with `--log-` except for
  `--log-handler`{.interpreted-text role="option"} and
  `--log-db`{.interpreted-text role="option"}) just add content to
  `log_handler`, use that directly in the configuration file
- `--smtp`{.interpreted-text role="option"} is stored as `smtp_server`
- `--database`{.interpreted-text role="option"} is stored as `db_name`
- `--i18n-import`{.interpreted-text role="option"} and
  `--i18n-export`{.interpreted-text role="option"} aren\'t available at
  all from configuration files

::: {#reference/cmdline/config_file}
The default configuration file is `{$HOME}/.odoorc`{.interpreted-text
role="file"} which can be overridden using
`--config <odoo-bin -c>`{.interpreted-text role="option"}. Specifying
`--save <odoo-bin -s>`{.interpreted-text role="option"} will save the
current configuration state back to that file. The configuration items
relative to the command-line are to be specified in the section
`[options]`.
:::

Here is a sample file:

``` ini
[options]
db_user=odoo
dbfilter=odoo
```

## Shell {#reference/cmdline/shell}

The Odoo command line also allows launching Odoo as a Python console
environment, enabling direct interaction with the
`orm <reference/orm>`{.interpreted-text role="ref"} and its
functionalities.

``` console
$ odoo-bin shell
```

::::: example
Adding an exclamation mark to all contacts\' names:

``` python
In [1]: records = env["res.partner"].search([])

In [2]: records
Out[2]: res.partner(14, 26, 33, 21, 10)

In [3]: for partner in records:
   ...:     partner.name = "%s !" % partner.name
   ...:

In [4]: env.cr.commit()
```

:::: important
::: title
Important
:::

By default, the shell is running in transaction mode. This means that
any change made to the database is rolled back when exiting the shell.
To commit changes, use [env.cr.commit()]{.title-ref}.
::::
:::::

::: option
\--shell-interface
(ipython[\|ptpython\|](##SUBST##|ptpython|)bpython\|python)

Specify a preferred REPL to use in shell mode. This shell is started
with the [env]{.title-ref} variable already initialized to be able to
access the ORM and other Odoo modules.
:::

::: seealso
`reference/orm/environment`{.interpreted-text role="ref"}
:::

## Neutralize {#reference/cmdline/scaffold}

::: program
odoo-bin neutralize
:::

The Odoo command line allows for neutralizing a database as well. The
command must be run with a database option.

``` console
$ odoo-bin --addons-path <PATH,...>  neutralize -d <database>
```

::: option
-d \<database, \--database \<database\>

Specify the database name that you would like to neutralize.
:::

::: option

`--stdout`

:   

Output the neutralization SQL instead of applying it
:::

::: seealso
`../../administration/neutralized_database`{.interpreted-text
role="doc"}
:::

## Scaffolding

::: program
odoo-bin scaffold
:::

Scaffolding is the automated creation of a skeleton structure to
simplify bootstrapping (of new modules, in the case of Odoo). While not
necessary it avoids the tedium of setting up basic structures and
looking up what all starting requirements are.

Scaffolding is available via the `odoo-bin scaffold`{.interpreted-text
role="command"} subcommand.

``` console
$ odoo-bin scaffold my_module /addons/
```

::: option
name (required)

the name of the module to create, may munged in various manners to
generate programmatic names (e.g. module directory name, model names,
...)
:::

::: option
destination (default=current directory)

directory in which to create the new module, defaults to the current
directory
:::

::: option

`-t <template>`

:   

a template directory, files are passed through
[jinja2](https://jinja.palletsprojects.com/) then copied to the
`destination` directory
:::

This will create module *my_module* in directory */addons/*.

## Database Population {#reference/cmdline/populate}

::: program
odoo-bin populate
:::

Odoo CLI supports database population features. If the feature is
`implemented on a given model <reference/performance/populate/methods>`{.interpreted-text
role="ref"}, it allows automatic data generation of the model\'s records
to test your modules in databases containing non-trivial amounts of
records.

``` console
$ odoo-bin populate
```

::: option

`--models`

:   

list of models for which the database should be filled
:::

::: option
\--size (small[\|medium\|](##SUBST##|medium|)large)

population size, the actual records number depends on the model\'s
[\_populate_sizes]{.title-ref} attribute. The generated records content
is specified by the `~odoo.models._populate_factories`{.interpreted-text
role="meth"} method of a given model (cf. the
`populate`{.interpreted-text role="file"} folder of modules for further
details).
:::

::: seealso
`reference/performance/populate`{.interpreted-text role="ref"}
:::

## Cloc {#reference/cmdline/cloc}

::: program
odoo-bin cloc
:::

Odoo Cloc is a tool to count the number of relevant lines written in
Python, Javascript, CSS, SCSS, or XML. This can be used as a rough
metric for pricing maintenance of extra modules.

### Command-line options

::: option

`-d <database>, --database <database>`

:   
:::

| Process the code of all extra modules installed on the provided
  database, and of all server actions and computed fields manually
  created in the provided database.
| The `--addons-path`{.interpreted-text role="option"} option is
  required to specify the path(s) to the module folder(s).
| If combined with `--path`{.interpreted-text role="option"}, the count
  will be that of the sum of both options\' results (with possible
  overlaps). At least one of these two options is required to specify
  which code to process.

``` console
$ odoo-bin cloc --addons-path=addons -d my_database
```

::: seealso
\- `reference/cmdline/cloc/database-option`{.interpreted-text
role="ref"}
:::

::: option

`-p <path>, --path <path>`

:   
:::

| Process the files in the provided path.
| If combined with `--database`{.interpreted-text role="option"}, the
  count will be that of the sum of both options\' results (with possible
  overlaps). At least one of these two options is required to specify
  which code to process.

``` console
$ odoo-bin cloc -p addons/account
```

Multiple paths can be provided by repeating the option.

``` console
$ odoo-bin cloc -p addons/account -p addons/sale
```

::: seealso
\- `reference/cmdline/cloc/path-option`{.interpreted-text role="ref"}
:::

::: option

`--addons-path <directories>`

:   
:::

| Comma-separated list of directories in which modules are stored. These
  directories are scanned for modules.
| Required if the `--database`{.interpreted-text role="option"} option
  is used.

::: option

`-c <directories>`

:   
:::

Specify a configuration file to use in place of the
`--addons-path`{.interpreted-text role="option"} option.

``` console
$ odoo-bin cloc -c config.conf -d my_database
```

::: option

`-v, --verbose`

:   
:::

Show the details of lines counted for each file.

### Processed files

#### With the `--database`{.interpreted-text role="option"} option {#reference/cmdline/cloc/database-option}

Odoo Cloc counts the lines in each file of extra installed modules in a
given database. In addition, it counts the Python lines of server
actions and custom computed fields that have been directly created in
the database or imported. Finally, it counts the lines of code of
Javascript, CSS, and SCSS files, and of QWeb views from imported
modules.

Some files are excluded from the count by default:

- The manifest (`__manifest__.py`{.interpreted-text role="file"} or
  `__openerp__.py`{.interpreted-text role="file"})
- The contents of the folder `static/lib`{.interpreted-text role="file"}
- The tests defined in the folder `tests`{.interpreted-text role="file"}
  and `static/tests`{.interpreted-text role="file"}
- The migrations scripts defined in the folder
  `migrations`{.interpreted-text role="file"} and [upgrades]{.title-ref}
- The XML files declared in the `demo` or `demo_xml` sections of the
  manifest

For special cases, a list of files that should be ignored by Odoo Cloc
can be defined per module. This is specified by the `cloc_exclude` entry
of the manifest:

``` python
"cloc_exclude": [
    "lib/common.py", # exclude a single file
    "data/*.xml",    # exclude all XML files in a specific folder
    "example/**/*",  # exclude all files in a folder hierarchy recursively
    "**/*.scss",     # exclude all scss file from the module
]
```

| The pattern `**/*` can be used to ignore an entire module. This can be
  useful to exclude a module from maintenance service costs.
| For more information about the pattern syntax, see
  [glob](https://docs.python.org/3/library/pathlib.html#pathlib.Path.glob).

#### With the `--path`{.interpreted-text role="option"} option {#reference/cmdline/cloc/path-option}

This method works the same as with the `--database option
<reference/cmdline/cloc/database-option>`{.interpreted-text role="ref"}
if a manifest file is present in the given folder. Otherwise, it counts
all files.

### Identifying Extra Modules

To distinguish between standard and extra modules, Odoo Cloc uses the
following heuristic: modules that are located (real file system path,
after following symbolic links) in the same parent directory as the
`base`, `web` or `web_enterprise` standard modules are considered
standard. Other modules are treated as extra modules.

### Error Handling

Some file cannot be counted by Odoo Cloc. Those file are reported at the
end of the output.

#### Max file size exceeded

Odoo Cloc rejects any file larger than 25MB. Usually, source files are
smaller than 1 MB. If a file is rejected, it may be:

- A generated XML file that contains lots of data. It should be excluded
  in the manifest.
- A JavaScript library that should be placed in the
  `static/lib`{.interpreted-text role="file"} folder.

#### Syntax Error

Odoo Cloc cannot count the lines of code of a Python file with a syntax
problem. If an extra module contains such files, they should be fixed to
allow the module to load. If the module works despite the presence of
those files, they are probably not loaded and should therefore be
removed from the module, or at least excluded in the manifest via
`cloc_exclude`.

## TSConfig Generator

::: program
odoo-bin tsconfig
:::

When working on javascript, there are ways to help your editor providing
you with powerful auto-completion. One of those ways is the use of a
tsconfig.json file. Originally meant for typescript, editors can use its
information with plain javascript also. With this config file, you will
now have full auto-completion across modules.

The command to generate this files takes as many unnamed arguments as
you need. Those are relative paths to your addon directories. In the
example below, we move up one folder to save the tsconfig file in the
folder containing community and enterprise.

``` console
$ community/odoo-bin tsconfig --addons-path community/addons,community/odoo/addons,enterprise > tsconfig.json
```




--- SOURCE: developer/reference/external_api.md ---

# External API

Odoo is usually extended internally via modules, but many of its
features and all of its data are also available from the outside for
external analysis or integration with various tools. Part of the
`reference/orm/model`{.interpreted-text role="ref"} API is easily
available over [XML-RPC](https://en.wikipedia.org/wiki/XML-RPC) and
accessible from a variety of languages.

:::: important
::: title
Important
:::

Starting with PHP8, the XML-RPC extension may not be available by
default. Check out the
[manual](https://www.php.net/manual/en/xmlrpc.installation.php) for the
installation steps.
::::

:::: note
::: title
Note
:::

Access to data via the external API is only available on *Custom* Odoo
pricing plans. Access to the external API is not available on *One App
Free* or *Standard* plans. For more information visit the [Odoo pricing
page](https://www.odoo.com/pricing-plan) or reach out to your Customer
Success Manager.
::::

::: seealso
\- `Tutorial on web services <../howtos/web_services>`{.interpreted-text
role="doc"}
:::

## Connection

### Configuration

If you already have an Odoo server installed, you can just use its
parameters.

:::: important
::: title
Important
:::

For Odoo Online instances (\<domain\>.odoo.com), users are created
without a *local* password (as a person you are logged in via the Odoo
Online authentication system, not by the instance itself). To use
XML-RPC on Odoo Online instances, you will need to set a password on the
user account you want to use:

- Log in your instance with an administrator account.
- Go to `Settings --> Users & Companies --> Users`{.interpreted-text
  role="menuselection"}.
- Click on the user you want to use for XML-RPC access.
- Click on `Action`{.interpreted-text role="guilabel"} and select
  `Change Password`{.interpreted-text role="guilabel"}.
- Set a `New Password`{.interpreted-text role="guilabel"} value then
  click `Change Password`{.interpreted-text role="guilabel"}.

The *server url* is the instance\'s domain (e.g.
*https://mycompany.odoo.com*), the *database name* is the name of the
instance (e.g. *mycompany*). The *username* is the configured user\'s
login as shown by the *Change Password* screen.
::::

:::::::: tabs
::: code-tab
python

url = \<insert server URL\> db = \<insert database name\> username =
\'admin\' password = \<insert password for your admin user (default:
admin)\>
:::

::: code-tab
ruby

url = \<insert server URL\> db = \<insert database name\> username =
\"admin\" password = \<insert password for your admin user (default:
admin)\>
:::

::: code-tab
php

\$url = \<insert server URL\>; \$db = \<insert database name\>;
\$username = \"admin\"; \$password = \<insert password for your admin
user (default: admin)\>;
:::

::: code-tab
java

final String url = \<insert server URL\>,

:   db = \<insert database name\>, username = \"admin\", password =
    \<insert password for your admin user (default: admin)\>;
:::

::: code-tab
go

var (

:   url = \<insert server URL\> db = \<insert database name\> username =
    \"admin\" password = \<insert password for your admin user (default:
    admin)\>

)
:::
::::::::

#### API Keys {#api/external_api/keys}

::: versionadded
14.0
:::

Odoo has support for **api keys** and (depending on modules or settings)
may **require** these keys to perform webservice operations.

The way to use API Keys in your scripts is to simply replace your
**password** by the key. The login remains in-use. You should store the
API Key as carefully as the password as they essentially provide the
same access to your user account (although they can not be used to
log-in via the interface).

In order to add a key to your account, simply go to your
`Preferences`{.interpreted-text role="guilabel"} (or
`My Profile`{.interpreted-text role="guilabel"}):

![image](external_api/preferences.png){.align-center}

then open the `Account Security`{.interpreted-text role="guilabel"} tab,
and click `New API Key`{.interpreted-text role="guilabel"}:

![image](external_api/account-security.png){.align-center}

Input a description for the key, **this description should be as clear
and complete as possible**: it is the only way you will have to identify
your keys later and know whether you should remove them or keep them
around.

Click `Generate Key`{.interpreted-text role="guilabel"}, then copy the
key provided. **Store this key carefully**: it is equivalent to your
password, and just like your password the system will not be able to
retrieve or show the key again later on. If you lose this key, you will
have to create a new one (and probably delete the one you lost).

Once you have keys configured on your account, they will appear above
the `New API Key`{.interpreted-text role="guilabel"} button, and you
will be able to delete them:

![image](external_api/delete-key.png){.align-center}

**A deleted API key can not be undeleted or re-set**. You will have to
generate a new key and update all the places where you used the old one.

#### Test database

To make exploration simpler, you can also ask <https://demo.odoo.com>
for a test database:

:::::::::::::: tabs
::: code-tab
python

import xmlrpc.client info =
xmlrpc.client.ServerProxy(\'https://demo.odoo.com/start\').start() url,
db, username, password = info\[\'host\'\], info\[\'database\'\],
info\[\'user\'\], info\[\'password\'\]
:::

::: code-tab
ruby

require \"xmlrpc/client\" info =
XMLRPC::Client.new2(\'https://demo.odoo.com/start\').call(\'start\')
url, db, username, password = info\[\'host\'\], info\[\'database\'\],
info\[\'user\'\], info\[\'password\'\]
:::

::::: group-tab
PHP

``` php
require_once('ripcord.php');
$info = ripcord::client('https://demo.odoo.com/start')->start();
list($url, $db, $username, $password) = array($info['host'], $info['database'], $info['user'], $info['password']);
```

:::: note
::: title
Note
:::

These examples use the [Ripcord](https://code.google.com/p/ripcord/)
library, which provides a simple XML-RPC API. Ripcord requires that
[XML-RPC support be
enabled](https://php.net/manual/en/xmlrpc.installation.php) in your PHP
installation.

Since calls are performed over
[HTTPS](https://en.wikipedia.org/wiki/HTTP_Secure), it also requires
that the [OpenSSL
extension](https://php.net/manual/en/openssl.installation.php) be
enabled.
::::
:::::

::::: group-tab
Java

``` java
final XmlRpcClient client = new XmlRpcClient();

final XmlRpcClientConfigImpl start_config = new XmlRpcClientConfigImpl();
start_config.setServerURL(new URL("https://demo.odoo.com/start"));
final Map<String, String> info = (Map<String, String>)client.execute(
    start_config, "start", emptyList());

final String url = info.get("host"),
              db = info.get("database"),
        username = info.get("user"),
        password = info.get("password");
```

:::: note
::: title
Note
:::

These examples use the [Apache XML-RPC
library](https://ws.apache.org/xmlrpc/).

The examples do not include imports as these imports couldn\'t be pasted
in the code.
::::
:::::

::::: group-tab
Go

``` go
client, err := xmlrpc.NewClient("https://demo.odoo.com/start", nil)
if err != nil {
    log.Fatal(err)
}
info := map[string]string{}
client.Call("start", nil, &info)
url = info["host"].(string)
db = info["database"].(string)
username = info["user"].(string)
password = info["password"].(string)
```

:::: note
::: title
Note
:::

These examples use the [github.com/kolo/xmlrpc
library](https://github.com/kolo/xmlrpc).

The examples do not include imports as these imports couldn\'t be pasted
in the code.
::::
:::::
::::::::::::::

### Logging in

Odoo requires users of the API to be authenticated before they can query
most data.

The `xmlrpc/2/common` endpoint provides meta-calls which don\'t require
authentication, such as the authentication itself or fetching version
information. To verify if the connection information is correct before
trying to authenticate, the simplest call is to ask for the server\'s
version. The authentication itself is done through the `authenticate`
function and returns a user identifier (`uid`) used in authenticated
calls instead of the login.

:::::::: tabs
::: code-tab
python

common = xmlrpc.client.ServerProxy(\'{}/xmlrpc/2/common\'.format(url))
common.version()
:::

::: code-tab
ruby

common = XMLRPC::Client.new2(\"#{url}/xmlrpc/2/common\")
common.call(\'version\')
:::

::: code-tab
php

\$common = ripcord::client(\"\$url/xmlrpc/2/common\");
\$common-\>version();
:::

::: code-tab
java

final XmlRpcClientConfigImpl common_config = new
XmlRpcClientConfigImpl(); common_config.setServerURL(new
URL(String.format(\"%s/xmlrpc/2/common\", url)));
client.execute(common_config, \"version\", emptyList());
:::

::: code-tab
go

client, err := xmlrpc.NewClient(fmt.Sprintf(\"%s/xmlrpc/2/common\",
url), nil) if err != nil { log.Fatal(err) } common := map\[string\]any{}
if err := client.Call(\"version\", nil, &common); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
{
    "server_version": "13.0",
    "server_version_info": [13, 0, 0, "final", 0],
    "server_serie": "13.0",
    "protocol_version": 1,
}
```

:::::::: tabs
::: code-tab
python

uid = common.authenticate(db, username, password, {})
:::

::: code-tab
ruby

uid = common.call(\'authenticate\', db, username, password, {})
:::

::: code-tab
php

\$uid = \$common-\>authenticate(\$db, \$username, \$password, array());
:::

::: code-tab
java

int uid = (int)client.execute(common_config, \"authenticate\",
asList(db, username, password, emptyMap()));
:::

::: code-tab
go

var uid int64 if err := client.Call(\"authenticate\", \[\]any{ db,
username, password, map\[string\]any{}, }, &uid); err != nil {
log.Fatal(err) }
:::
::::::::

## Calling methods {#api/external_api/calling_methods}

The second endpoint is `xmlrpc/2/object`. It is used to call methods of
odoo models via the `execute_kw` RPC function.

Each call to `execute_kw` takes the following parameters:

- the database to use, a string
- the user id (retrieved through `authenticate`), an integer
- the user\'s password, a string
- the model name, a string
- the method name, a string
- an array/list of parameters passed by position
- a mapping/dict of parameters to pass by keyword (optional)

::::::::: example
For instance, to see if we can read the `res.partner` model, we can call
`check_access_rights` with `operation` passed by position and
`raise_exception` passed by keyword (in order to get a true/false result
rather than true/error):

:::::::: tabs
::: code-tab
python

models = xmlrpc.client.ServerProxy(\'{}/xmlrpc/2/object\'.format(url))
models.execute_kw(db, uid, password, \'res.partner\',
\'check_access_rights\', \[\'read\'\], {\'raise_exception\': False})
:::

::: code-tab
ruby

models = XMLRPC::Client.new2(\"#{url}/xmlrpc/2/object\").proxy
models.execute_kw(db, uid, password, \'res.partner\',
\'check_access_rights\', \[\'read\'\], {raise_exception: false})
:::

::: code-tab
php

\$models = ripcord::client(\"\$url/xmlrpc/2/object\");
\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'check_access_rights\', array(\'read\'), array(\'raise_exception\' =\>
false));
:::

::: code-tab
java

final XmlRpcClient models = new XmlRpcClient() {{

:   

    setConfig(new XmlRpcClientConfigImpl() {{

    :   setServerURL(new URL(String.format(\"%s/xmlrpc/2/object\",
        url)));

    }});

}}; models.execute(\"execute_kw\", asList( db, uid, password,
\"res.partner\", \"check_access_rights\", asList(\"read\"), new
HashMap() {{ put(\"raise_exception\", false); }} ));
:::

::: code-tab
go

models, err := xmlrpc.NewClient(fmt.Sprintf(\"%s/xmlrpc/2/object\",
url), nil) if err != nil { log.Fatal(err) } var result bool if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"res.partner\",
\"check_access_rights\", \[\]string{\"read\"},
map\[string\]bool{\"raise_exception\": false}, }, &result); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
true
```
:::::::::

### List records

Records can be listed and filtered via
`~odoo.models.Model.search`{.interpreted-text role="meth"}.

`~odoo.models.Model.search`{.interpreted-text role="meth"} takes a
mandatory `domain <reference/orm/domains>`{.interpreted-text role="ref"}
filter (possibly empty), and returns the database identifiers of all
records matching the filter.

::::::::: example
To list customer companies, for instance:

:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', True\]\]\])
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', true\]\]\])
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'search\', array(array(array(\'is_company\', \'=\', true))));
:::

::: code-tab
java

asList((Object\[\])models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"search\", asList(asList(
    asList(\"is_company\", \"=\", true)))

)));
:::

::: code-tab
go

var records \[\]int64 if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"res.partner\", \"search\", \[\]any{\[\]any{
\[\]any{\"is_company\", \"=\", true}, }}, }, &records); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
[7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74]
```
:::::::::

#### Pagination

By default a search will return the ids of all records matching the
condition, which may be a huge number. `offset` and `limit` parameters
are available to only retrieve a subset of all matched records.

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', True\]\]\], {\'offset\': 10, \'limit\': 5})
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', true\]\]\], {offset: 10, limit: 5})
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'search\', array(array(array(\'is_company\', \'=\', true))),
array(\'offset\'=\>10, \'limit\'=\>5));
:::

::: code-tab
java

asList((Object\[\])models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"search\", asList(asList(
    asList(\"is_company\", \"=\", true))), new HashMap() {{
    put(\"offset\", 10); put(\"limit\", 5); }}

)));
:::

::: code-tab
go

var records \[\]int64 if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"res.partner\", \"search\", \[\]any{\[\]any{
\[\]any{\"is_company\", \"=\", true}, }}, map\[string\]int64{\"offset\":
10, \"limit\": 5}, }, &records); err != nil { log.Fatal(err) }
:::
::::::::

Result:

``` json
[13, 20, 30, 22, 29]
```
:::::::::

### Count records

Rather than retrieve a possibly gigantic list of records and count them,
`~odoo.models.Model.search_count`{.interpreted-text role="meth"} can be
used to retrieve only the number of records matching the query. It takes
the same `domain <reference/orm/domains>`{.interpreted-text role="ref"}
filter as `~odoo.models.Model.search`{.interpreted-text role="meth"} and
no other parameter.

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'search_count\',
\[\[\[\'is_company\', \'=\', True\]\]\])
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'search_count\',
\[\[\[\'is_company\', \'=\', true\]\]\])
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'search_count\', array(array(array(\'is_company\', \'=\', true))));
:::

::: code-tab
java

(Integer)models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"search_count\", asList(asList(
    asList(\"is_company\", \"=\", true)))

));
:::

::: code-tab
go

var counter int64 if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"res.partner\", \"search_count\", \[\]any{\[\]any{
\[\]any{\"is_company\", \"=\", true}, }}, }, &counter); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
19
```
:::::::::

:::: note
::: title
Note
:::

Calling `search` then `search_count` (or the other way around) may not
yield coherent results if other users are using the server: stored data
could have changed between the calls.
::::

### Read records

Record data are accessible via the
`~odoo.models.Model.read`{.interpreted-text role="meth"} method, which
takes a list of ids (as returned by
`~odoo.models.Model.search`{.interpreted-text role="meth"}), and
optionally a list of fields to fetch. By default, it fetches all the
fields the current user can read, which tends to be a huge amount.

::::::::::::::: example
:::::::: tabs
::: code-tab
python

ids = models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', True\]\]\], {\'limit\': 1}) \[record\] =
models.execute_kw(db, uid, password, \'res.partner\', \'read\', \[ids\])
\# count the number of fields fetched by default len(record)
:::

::: code-tab
ruby

ids = models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'is_company\', \'=\', true\]\]\], {limit: 1}) record =
models.execute_kw(db, uid, password, \'res.partner\', \'read\',
\[ids\]).first \# count the number of fields fetched by default
record.length
:::

::: code-tab
php

\$ids = \$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'search\', array(array(array(\'is_company\', \'=\', true))),
array(\'limit\'=\>1)); \$records = \$models-\>execute_kw(\$db, \$uid,
\$password, \'res.partner\', \'read\', array(\$ids)); // count the
number of fields fetched by default count(\$records\[0\]);
:::

::: code-tab
java

final List ids = asList((Object\[\])models.execute(

:   

    \"execute_kw\", asList(

    :   db, uid, password, \"res.partner\", \"search\", asList(asList(
        asList(\"is_company\", \"=\", true))), new HashMap() {{
        put(\"limit\", 1); }})));

final Map record = (Map)((Object\[\])models.execute(

:   

    \"execute_kw\", asList(

    :   db, uid, password, \"res.partner\", \"read\", asList(ids)

    )

))\[0\]; // count the number of fields fetched by default record.size();
:::

::: code-tab
go

var ids \[\]int64 if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"res.partner\", \"search\", \[\]any{\[\]any{
\[\]any{\"is_company\", \"=\", true}, }}, map\[string\]int64{\"limit\":
1}, }, &ids); err != nil { log.Fatal(err) } var records \[\]any if err
:= models.Call(\"execute_kw\", \[\]any{ db, uid, password,
\"res.partner\", \"read\", ids, }, &records); err != nil {
log.Fatal(err) } // count the number of fields fetched by default count
:= len(records)
:::
::::::::

Result:

``` json
121
```

Conversely, picking only three fields deemed interesting.

:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'read\', \[ids\],
{\'fields\': \[\'name\', \'country_id\', \'comment\'\]})
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'read\', \[ids\],
{fields: %w(name country_id comment)})
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'read\', array(\$ids), array(\'fields\'=\>array(\'name\',
\'country_id\', \'comment\')));
:::

::: code-tab
java

asList((Object\[\])models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"read\", asList(ids), new
    HashMap() {{ put(\"fields\", asList(\"name\", \"country_id\",
    \"comment\")); }}

)));
:::

::: code-tab
go

var recordFields \[\]map\[string\]any if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"res.partner\",
\"read\", ids, map\[string\]\[\]string{ \"fields\": {\"name\",
\"country_id\", \"comment\"}, }, }, &recordFields); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
[{"comment": false, "country_id": [21, "Belgium"], "id": 7, "name": "Agrolait"}]
```
:::::::::::::::

:::: note
::: title
Note
:::

Even if the `id` field is not requested, it is always returned.
::::

### List record fields

`~odoo.models.Model.fields_get`{.interpreted-text role="meth"} can be
used to inspect a model\'s fields and check which ones seem to be of
interest.

Because it returns a large amount of meta-information (it is also used
by client programs) it should be filtered before printing, the most
interesting items for a human user are `string` (the field\'s label),
`help` (a help text if available) and `type` (to know which values to
expect, or to send when updating a record).

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'fields_get\',
\[\], {\'attributes\': \[\'string\', \'help\', \'type\'\]})
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'fields_get\',
\[\], {attributes: %w(string help type)})
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'fields_get\', array(), array(\'attributes\' =\> array(\'string\',
\'help\', \'type\')));
:::

::: code-tab
java

(Map\<String, Map\<String, Object\>\>)models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"fields_get\", emptyList(), new
    HashMap() {{ put(\"attributes\", asList(\"string\", \"help\",
    \"type\")); }}

));
:::

::: code-tab
go

recordFields := map\[string\]string{} if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"res.partner\",
\"fields_get\", \[\]any{}, map\[string\]\[\]string{ \"attributes\":
{\"string\", \"help\", \"type\"}, }, }, &recordFields); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
{
    "ean13": {
        "type": "char",
        "help": "BarCode",
        "string": "EAN13"
    },
    "property_account_position_id": {
        "type": "many2one",
        "help": "The fiscal position will determine taxes and accounts used for the partner.",
        "string": "Fiscal Position"
    },
    "signup_valid": {
        "type": "boolean",
        "help": "",
        "string": "Signup Token is Valid"
    },
    "date_localization": {
        "type": "date",
        "help": "",
        "string": "Geo Localization Date"
    },
    "ref_company_ids": {
        "type": "one2many",
        "help": "",
        "string": "Companies that refers to partner"
    },
    "sale_order_count": {
        "type": "integer",
        "help": "",
        "string": "# of Sales Order"
    },
    "purchase_order_count": {
        "type": "integer",
        "help": "",
        "string": "# of Purchase Order"
    },
```
:::::::::

### Search and read

Because it is a very common task, Odoo provides a
`~odoo.models.Model.search_read`{.interpreted-text role="meth"} shortcut
which, as its name suggests, is equivalent to a
`~odoo.models.Model.search`{.interpreted-text role="meth"} followed by a
`~odoo.models.Model.read`{.interpreted-text role="meth"}, but avoids
having to perform two requests and keep ids around.

Its arguments are similar to
`~odoo.models.Model.search`{.interpreted-text role="meth"}\'s, but it
can also take a list of `fields` (like
`~odoo.models.Model.read`{.interpreted-text role="meth"}, if that list
is not provided it will fetch all fields of matched records).

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'search_read\',
\[\[\[\'is_company\', \'=\', True\]\]\], {\'fields\': \[\'name\',
\'country_id\', \'comment\'\], \'limit\': 5})
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'search_read\',
\[\[\[\'is_company\', \'=\', true\]\]\], {fields: %w(name country_id
comment), limit: 5})
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'search_read\', array(array(array(\'is_company\', \'=\', true))),
array(\'fields\'=\>array(\'name\', \'country_id\', \'comment\'),
\'limit\'=\>5));
:::

::: code-tab
java

asList((Object\[\])models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"search_read\", asList(asList(
    asList(\"is_company\", \"=\", true))), new HashMap() {{
    put(\"fields\", asList(\"name\", \"country_id\", \"comment\"));
    put(\"limit\", 5); }}

)));
:::

::: code-tab
go

var recordFields \[\]map\[string\]any if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"res.partner\",
\"search_read\", \[\]any{\[\]any{ \[\]any{\"is_company\", \"=\", true},
}}, map\[string\]any{ \"fields\": \[\]string{\"name\", \"country_id\",
\"comment\"}, \"limit\": 5, }, }, &recordFields); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
[
    {
        "comment": false,
        "country_id": [ 21, "Belgium" ],
        "id": 7,
        "name": "Agrolait"
    },
    {
        "comment": false,
        "country_id": [ 76, "France" ],
        "id": 18,
        "name": "Axelor"
    },
    {
        "comment": false,
        "country_id": [ 233, "United Kingdom" ],
        "id": 12,
        "name": "Bank Wealthy and sons"
    },
    {
        "comment": false,
        "country_id": [ 105, "India" ],
        "id": 14,
        "name": "Best Designers"
    },
    {
        "comment": false,
        "country_id": [ 76, "France" ],
        "id": 17,
        "name": "Camptocamp"
    }
]
```
:::::::::

### Create records

Records of a model are created using
`~odoo.models.Model.create`{.interpreted-text role="meth"}. The method
creates a single record and returns its database identifier.

`~odoo.models.Model.create`{.interpreted-text role="meth"} takes a
mapping of fields to values, used to initialize the record. For any
field which has a default value and is not set through the mapping
argument, the default value will be used.

::::::::: example
:::::::: tabs
::: code-tab
python

id = models.execute_kw(db, uid, password, \'res.partner\', \'create\',
\[{\'name\': \"New Partner\"}\])
:::

::: code-tab
ruby

id = models.execute_kw(db, uid, password, \'res.partner\', \'create\',
\[{name: \"New Partner\"}\])
:::

::: code-tab
php

\$id = \$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'create\', array(array(\'name\'=\>\"New Partner\")));
:::

::: code-tab
java

final Integer id = (Integer)models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"create\", asList(new HashMap()
    {{ put(\"name\", \"New Partner\"); }})

));
:::

::: code-tab
go

var id int64 if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"res.partner\", \"create\", \[\]map\[string\]string{
{\"name\": \"New Partner\"}, }, }, &id); err != nil { log.Fatal(err) }
:::
::::::::

Result:

``` json
78
```
:::::::::

:::: warning
::: title
Warning
:::

While most value types are what would expect (integer for
`~odoo.fields.Integer`{.interpreted-text role="class"}, string for
`~odoo.fields.Char`{.interpreted-text role="class"} or
`~odoo.fields.Text`{.interpreted-text role="class"}),

- `~odoo.fields.Date`{.interpreted-text role="class"},
  `~odoo.fields.Datetime`{.interpreted-text role="class"} and
  `~odoo.fields.Binary`{.interpreted-text role="class"} fields use
  string values
- `~odoo.fields.One2many`{.interpreted-text role="class"} and
  `~odoo.fields.Many2many`{.interpreted-text role="class"} use a special
  command protocol detailed in `the documentation to
  the write method <odoo.models.Model.write>`{.interpreted-text
  role="meth"}.
::::

### Update records

Records can be updated using
`~odoo.models.Model.write`{.interpreted-text role="meth"}. It takes a
list of records to update and a mapping of updated fields to values
similar to `~odoo.models.Model.create`{.interpreted-text role="meth"}.

Multiple records can be updated simultaneously, but they will all get
the same values for the fields being set. It is not possible to perform
\"computed\" updates (where the value being set depends on an existing
value of a record).

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'write\',
\[\[id\], {\'name\': \"Newer partner\"}\]) \# get record name after
having changed it models.execute_kw(db, uid, password, \'res.partner\',
\'name_get\', \[\[id\]\])
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'write\',
\[\[id\], {name: \"Newer partner\"}\]) \# get record name after having
changed it models.execute_kw(db, uid, password, \'res.partner\',
\'name_get\', \[\[id\]\])
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'write\', array(array(\$id), array(\'name\'=\>\"Newer partner\"))); //
get record name after having changed it \$models-\>execute_kw(\$db,
\$uid, \$password, \'res.partner\', \'name_get\', array(array(\$id)));
:::

::: code-tab
java

models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"write\", asList( asList(id),
    new HashMap() {{ put(\"name\", \"Newer Partner\"); }} )

)); // get record name after having changed it
asList((Object\[\])models.execute(\"execute_kw\", asList( db, uid,
password, \"res.partner\", \"name_get\", asList(asList(id)) )));
:::

::: code-tab
go

var result bool if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"res.partner\", \"write\", \[\]any{ \[\]int64{id},
map\[string\]string{\"name\": \"Newer partner\"}, }, }, &result); err !=
nil { log.Fatal(err) } // get record name after having changed it var
record \[\]any if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"res.partner\", \"name_get\", \[\]any{ \[\]int64{id}, }, },
&record); err != nil { log.Fatal(err) }
:::
::::::::

Result:

``` json
[[78, "Newer partner"]]
```
:::::::::

### Delete records

Records can be deleted in bulk by providing their ids to
`~odoo.models.Model.unlink`{.interpreted-text role="meth"}.

::::::::: example
:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'res.partner\', \'unlink\',
\[\[id\]\]) \# check if the deleted record is still in the database
models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'id\', \'=\', id\]\]\])
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'res.partner\', \'unlink\',
\[\[id\]\]) \# check if the deleted record is still in the database
models.execute_kw(db, uid, password, \'res.partner\', \'search\',
\[\[\[\'id\', \'=\', id\]\]\])
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'res.partner\',
\'unlink\', array(array(\$id))); // check if the deleted record is still
in the database \$models-\>execute_kw( \$db, \$uid, \$password,
\'res.partner\', \'search\', array(array(array(\'id\', \'=\', \$id))) );
:::

::: code-tab
java

models.execute(\"execute_kw\", asList(

:   db, uid, password, \"res.partner\", \"unlink\",
    asList(asList(id))));

// check if the deleted record is still in the database
asList((Object\[\])models.execute(\"execute_kw\", asList( db, uid,
password, \"res.partner\", \"search\", asList(asList(asList(\"id\",
\"=\", 78))) )));
:::

::: code-tab
go

var result bool if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"res.partner\", \"unlink\", \[\]any{ \[\]int64{id}, }, },
&result); err != nil { log.Fatal(err) } // check if the deleted record
is still in the database var record \[\]any if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"res.partner\",
\"search\", \[\]any{\[\]any{ \[\]any{\"id\", \"=\", id}, }}, },
&record); err != nil { log.Fatal(err) }
:::
::::::::

Result:

``` json
[]
```
:::::::::

### Inspection and introspection

While we previously used
`~odoo.models.Model.fields_get`{.interpreted-text role="meth"} to query
a model and have been using an arbitrary model from the start, Odoo
stores most model metadata inside a few meta-models which allow both
querying the system and altering models and fields (with some
limitations) on the fly over XML-RPC.

#### `ir.model` {#reference/webservice/inspection/models}

Provides information about Odoo models via its various fields.

`name`

:   a human-readable description of the model

`model`

:   the name of each model in the system

`state`

:   whether the model was generated in Python code (`base`) or by
    creating an `ir.model` record (`manual`)

`field_id`

:   list of the model\'s fields through a
    `~odoo.fields.One2many`{.interpreted-text role="class"} to
    `reference/webservice/inspection/fields`{.interpreted-text
    role="ref"}

`view_ids`

:   `~odoo.fields.One2many`{.interpreted-text role="class"} to the
    `reference/views`{.interpreted-text role="ref"} defined for the
    model

`access_ids`

:   `~odoo.fields.One2many`{.interpreted-text role="class"} relation to
    the `reference/security/acl`{.interpreted-text role="ref"} set on
    the model

`ir.model` can be used to

- Query the system for installed models (as a precondition to operations
  on the model or to explore the system\'s content).
- Get information about a specific model (generally by listing the
  fields associated with it).
- Create new models dynamically over RPC.

:::: important
::: title
Important
:::

\* Custom model names must start with `x_`. \* The `state` must be
provided and set to `manual`, otherwise the model will not be loaded. \*
It is not possible to add new *methods* to a custom model, only fields.
::::

::::::::: example
A custom model will initially contain only the \"built-in\" fields
available on all models:

:::::::: tabs
::: code-tab
python

models.execute_kw(db, uid, password, \'ir.model\', \'create\', \[{

:   \'name\': \"Custom Model\", \'model\': \"x_custom_model\",
    \'state\': \'manual\',

}\]) models.execute_kw(db, uid, password, \'x_custom_model\',
\'fields_get\', \[\], {\'attributes\': \[\'string\', \'help\',
\'type\'\]})
:::

::: code-tab
php

\$models-\>execute_kw(\$db, \$uid, \$password, \'ir.model\', \'create\', array(array(

:   \'name\' =\> \"Custom Model\", \'model\' =\> \'x_custom_model\',
    \'state\' =\> \'manual\'

))); \$models-\>execute_kw(\$db, \$uid, \$password, \'x_custom_model\',
\'fields_get\', array(), array(\'attributes\' =\> array(\'string\',
\'help\', \'type\')));
:::

::: code-tab
ruby

models.execute_kw(db, uid, password, \'ir.model\', \'create\', \[{

:   name: \"Custom Model\", model: \'x_custom_model\', state: \'manual\'

}\]) fields = models.execute_kw(db, uid, password, \'x_custom_model\',
\'fields_get\', \[\], {attributes: %w(string help type)})
:::

::: code-tab
java

models.execute(

:   

    \"execute_kw\", asList(

    :   db, uid, password, \"ir.model\", \"create\", asList(new
        HashMap\<String, Object\>() {{ put(\"name\", \"Custom Model\");
        put(\"model\", \"x_custom_model\"); put(\"state\", \"manual\");
        }})

)); final Object fields = models.execute( \"execute_kw\", asList( db,
uid, password, \"x_custom_model\", \"fields_get\", emptyList(), new
HashMap\<String, Object\> () {{ put(\"attributes\", asList( \"string\",
\"help\", \"type\")); }} ));
:::

::: code-tab
go

var id int64 if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"ir.model\", \"create\", \[\]map\[string\]string{ { \"name\":
\"Custom Model\", \"model\": \"x_custom_model\", \"state\": \"manual\",
}, }, }, &id); err != nil { log.Fatal(err) } recordFields :=
map\[string\]string{} if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"x_custom_model\", \"fields_get\", \[\]any{},
map\[string\]\[\]string{ \"attributes\": {\"string\", \"help\",
\"type\"}, }, }, &recordFields); err != nil { log.Fatal(err) }
:::
::::::::

Result:

``` json
{
    "create_uid": {
        "type": "many2one",
        "string": "Created by"
    },
    "create_date": {
        "type": "datetime",
        "string": "Created on"
    },
    "__last_update": {
        "type": "datetime",
        "string": "Last Modified on"
    },
    "write_uid": {
        "type": "many2one",
        "string": "Last Updated by"
    },
    "write_date": {
        "type": "datetime",
        "string": "Last Updated on"
    },
    "display_name": {
        "type": "char",
        "string": "Display Name"
    },
    "id": {
        "type": "integer",
        "string": "Id"
    }
}
```
:::::::::

#### `ir.model.fields` {#reference/webservice/inspection/fields}

Provides information about the fields of Odoo models and allows adding
custom fields without using Python code.

`model_id`

:   `~odoo.fields.Many2one`{.interpreted-text role="class"} to
    `reference/webservice/inspection/models`{.interpreted-text
    role="ref"} to which the field belongs

`name`

:   the field\'s technical name (used in `read` or `write`)

`field_description`

:   the field\'s user-readable label (e.g. `string` in `fields_get`)

`ttype`

:   the `type <reference/orm/fields>`{.interpreted-text role="ref"} of
    field to create

`state`

:   whether the field was created via Python code (`base`) or via
    `ir.model.fields` (`manual`)

`required`, `readonly`, `translate`

:   enables the corresponding flag on the field

`groups`

:   `field-level access control <reference/security/fields>`{.interpreted-text
    role="ref"}, a `~odoo.fields.Many2many`{.interpreted-text
    role="class"} to `res.groups`

`selection`, `size`, `on_delete`, `relation`, `relation_field`, `domain`

:   type-specific properties and customizations, see `the fields
    documentation <reference/orm/fields>`{.interpreted-text role="ref"}
    for details

:::: important
::: title
Important
:::

\- Like custom models, only new fields created with `state="manual"` are
activated as actual fields on the model. - Computed fields can not be
added via `ir.model.fields`, some field meta-information (defaults,
onchange) can not be set either.
::::

::::::::: example
:::::::: tabs
::: code-tab
python

id = models.execute_kw(db, uid, password, \'ir.model\', \'create\', \[{

:   \'name\': \"Custom Model\", \'model\': \"x_custom\", \'state\':
    \'manual\',

}\]) models.execute_kw(db, uid, password, \'ir.model.fields\',
\'create\', \[{ \'model_id\': id, \'name\': \'x_name\', \'ttype\':
\'char\', \'state\': \'manual\', \'required\': True, }\]) record_id =
models.execute_kw(db, uid, password, \'x_custom\', \'create\',
\[{\'x_name\': \"test record\"}\]) models.execute_kw(db, uid, password,
\'x_custom\', \'read\', \[\[record_id\]\])
:::

::: code-tab
php

\$id = \$models-\>execute_kw(\$db, \$uid, \$password, \'ir.model\', \'create\', array(array(

:   \'name\' =\> \"Custom Model\", \'model\' =\> \'x_custom\', \'state\'
    =\> \'manual\'

))); \$models-\>execute_kw(\$db, \$uid, \$password, \'ir.model.fields\',
\'create\', array(array( \'model_id\' =\> \$id, \'name\' =\> \'x_name\',
\'ttype\' =\> \'char\', \'state\' =\> \'manual\', \'required\' =\> true
))); \$record_id = \$models-\>execute_kw(\$db, \$uid, \$password,
\'x_custom\', \'create\', array(array(\'x_name\' =\> \"test record\")));
\$models-\>execute_kw(\$db, \$uid, \$password, \'x_custom\', \'read\',
array(array(\$record_id)));
:::

::: code-tab
ruby

id = models.execute_kw(db, uid, password, \'ir.model\', \'create\', \[{

:   name: \"Custom Model\", model: \"x_custom\", state: \'manual\'

}\]) models.execute_kw(db, uid, password, \'ir.model.fields\',
\'create\', \[{ model_id: id, name: \"x_name\", ttype: \"char\", state:
\"manual\", required: true }\]) record_id = models.execute_kw(db, uid,
password, \'x_custom\', \'create\', \[{x_name: \"test record\"}\])
models.execute_kw(db, uid, password, \'x_custom\', \'read\',
\[\[record_id\]\])
:::

::: code-tab
java

final Integer id = (Integer)models.execute(

:   

    \"execute_kw\", asList(

    :   db, uid, password, \"ir.model\", \"create\", asList(new
        HashMap\<String, Object\>() {{ put(\"name\", \"Custom Model\");
        put(\"model\", \"x_custom\"); put(\"state\", \"manual\"); }})

)); models.execute( \"execute_kw\", asList( db, uid, password,
\"ir.model.fields\", \"create\", asList(new HashMap\<String, Object\>()
{{ put(\"model_id\", id); put(\"name\", \"x_name\"); put(\"ttype\",
\"char\"); put(\"state\", \"manual\"); put(\"required\", true); }}) ));
final Integer record_id = (Integer)models.execute( \"execute_kw\",
asList( db, uid, password, \"x_custom\", \"create\", asList(new
HashMap\<String, Object\>() {{ put(\"x_name\", \"test record\"); }}) ));

client.execute(

:   

    \"execute_kw\", asList(

    :   db, uid, password, \"x_custom\", \"read\",
        asList(asList(record_id))

));
:::

::: code-tab
go

var id int64 if err := models.Call(\"execute_kw\", \[\]any{ db, uid,
password, \"ir.model\", \"create\", \[\]map\[string\]string{ { \"name\":
\"Custom Model\", \"model\": \"x_custom\", \"state\": \"manual\", }, },
}, &id); err != nil { log.Fatal(err) } var fieldId int64 if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password,
\"ir.model.fields\", \"create\", \[\]map\[string\]any{ { \"model_id\":
id, \"name\": \"x_name\", \"ttype\": \"char\", \"state\": \"manual\",
\"required\": true, }, }, }, &fieldId); err != nil { log.Fatal(err) }
var recordId int64 if err := models.Call(\"execute_kw\", \[\]any{ db,
uid, password, \"x_custom\", \"create\", \[\]map\[string\]string{
{\"x_name\": \"test record\"}, }, }, &recordId); err != nil {
log.Fatal(err) } var recordFields \[\]map\[string\]any if err :=
models.Call(\"execute_kw\", \[\]any{ db, uid, password, \"x_custom\",
\"read\", \[\]\[\]int64{{recordId}}, }, recordFields); err != nil {
log.Fatal(err) }
:::
::::::::

Result:

``` json
[
    {
        "create_uid": [1, "Administrator"],
        "x_name": "test record",
        "__last_update": "2014-11-12 16:32:13",
        "write_uid": [1, "Administrator"],
        "write_date": "2014-11-12 16:32:13",
        "create_date": "2014-11-12 16:32:13",
        "id": 1,
        "display_name": "test record"
    }
]
```
:::::::::




--- SOURCE: developer/reference/extract_api.md ---

# Extract API

Odoo provides a service to automate the processing of documents of type
**invoices**, **bank statements**, **expenses** or **resumes**.

The service scans documents using an
`OCR (Optical Character Recognition)`{.interpreted-text role="abbr"}
engine and then uses `AI(Artificial Intelligence)`{.interpreted-text
role="abbr"}-based algorithms to extract fields of interest such as the
total, due date, or invoice lines for *invoices*, the initial and final
balances, the date for *bank statements*, the total, date for
*expenses*, or the name, email, phone number for *resumes*.

This service is a paid service. Each document processing will cost you
one credit from your document digitization
`IAP (In-app purchases)`{.interpreted-text role="abbr"} account. More
information about `IAP (In-app purchases)`{.interpreted-text
role="abbr"} accounts can be found
`here </applications/essentials/in_app_purchase>`{.interpreted-text
role="doc"}.

You can either use this service directly in the Accounting, Expense, or
Recruitment App or through the API. The Extract API, which is detailed
in the next section, allows you to integrate our service directly into
your own projects.

## Overview

The extract API uses the
[JSON-RPC2](https://www.jsonrpc.org/specification) protocol; its
endpoint routes are located at
[https://extract.api.odoo.com]{.title-ref}.

### Version {#extract_api/version}

The version of the Extract API is specified in the route.

The latest versions are:

:   - invoices: 123
    - bank statements: 100
    - expenses: 132
    - applicant: 102

### Flow

The flow is the same for each document type.

1.  | Call `/parse <extract_api/parse>`{.interpreted-text role="ref"} to
      submit your documents (one call for each document). On success,
      you receive a [document_token]{.title-ref} in the response.

2.  | You then have to regularly poll
      `/get_result <extract_api/get_result>`{.interpreted-text
      role="ref"} to get the document\'s parsing status.
    | Alternatively, you can provide a [webhook_url]{.title-ref} at the
      time of the call to `/parse <extract_api/parse>`{.interpreted-text
      role="ref"} and you will be notified (via a POST request) when the
      result is ready.

The HTTP POST method should be used for all of them. A python
implementation of the full flow for invoices can be found
`here <extract_api/implementation.py>`{.interpreted-text
role="download"} and a token for integration testing is provided in the
`integration testing section <latestextract_api/integration_testing>`{.interpreted-text
role="ref"}.

## Parse

Request the digitization of a document. The route will return a
[document_token]{.title-ref} that you can use to fetch the result of
your request.

### Routes {#extract_api/parse}

> - /api/extract/invoice/2/parse
> - /api/extract/bank_statement/1/parse
> - /api/extract/expense/2/parse
> - /api/extract/applicant/2/parse

### Request

::: rst-class
o-definition-list
:::

`jsonrpc` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`method` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`id` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`params`

:   ::: rst-class
    o-definition-list
    :::

    `account_token` (required)

    :   The token of the
        `IAP </applications/essentials/in_app_purchase>`{.interpreted-text
        role="doc"} account from which credits will be charged. Each
        successful call costs one credit.

    `version` (required)

    :   The version will determine the format of your requests and the
        format of the server response. You should use the
        `latest version available <extract_api/version>`{.interpreted-text
        role="ref"}.

    `documents` (required)

    :   The document must be provided as a Base64 string in the ASCII
        encoding. The list should contain only one document. This field
        is a list only for legacy reasons. The supported formats are
        *pdf*, *png* and *jpg*.

    `dbuuid` (optional)

    :   Unique identifier of the Odoo database.

    `webhook_url` (optional)

    :   A webhook URL can be provided. An empty POST request will be
        sent to `webhook_url/document_token` when the result is ready.

    `user_infos` (optional)

    :   Information concerning the person sending the document to the
        extract service. It can be the client or the supplier (depending
        on the `perspective`). This information is not required in order
        for the service to work but it greatly improves the quality of
        the result.

        ::: rst-class
        o-definition-list
        :::

        `user_company_vat` (optional)

        :   VAT number of the user.

        `user_company_name` (optional)

        :   Name of the user's company.

        `user_company_country_code` (optional)

        :   Country code of the user. Format: [ISO3166
            alpha-2](https://www.iban.com/country-codes).

        `user_lang` (optional)

        :   The user language. Format: *language_code + \_ + locale*
            (e.g. fr_FR, en_US).

        `user_email` (optional)

        :   The user email.

        `purchase_order_regex` (optional)

        :   Regex for purchase order identification. Will default to
            Odoo PO format if not provided.

        `perspective` (optional)

        :   ::: rst-class
            o-definition-list
            :::

            Can be `client` or `supplier`. This field is useful for
            invoices only. `client` means that the user information
            provided are related to the client of the invoice.
            `supplier` means that it\'s related to the supplier. If not
            provided, client will be used.

``` js
{
    "jsonrpc": "2.0",
    "method": "call",
    "params": {
        "account_token": string,
        "version": int,
        "documents": [string],
        "dbuuid": string,
        "webhook_url": string,
        "user_infos": {
            "user_company_vat": string,
            "user_company_name": string,
            "user_company_country_code": string,
            "user_lang": string,
            "user_email": string,
            "purchase_order_regex": string,
            "perspective": string,
        },
    },
    "id": string,
}
```

:::: note
::: title
Note
:::

The `user_infos` parameter is optional but it greatly improves the
quality of the result, especially for invoices. The more information you
can provide, the better.
::::

### Response

::: rst-class
o-definition-list
:::

`jsonrpc`

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`id`

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`result`

:   ::: rst-class
    o-definition-list
    :::

    `status`

    :   The code indicating the status of the request. See the table
        below.

    `status_msg`

    :   A string giving verbose details about the request status.

    `document_token`

    :   Only present if the request is successful.

  status                                    status_msg
  ----------------------------------------- ---------------------------------------------------------------
  [success]{.title-ref}                     Success
  [error_unsupported_version]{.title-ref}   Unsupported version
  [error_internal]{.title-ref}              An error occurred
  [error_no_credit]{.title-ref}             You don\'t have enough credit
  [error_unsupported_format]{.title-ref}    Unsupported file format
  [error_maintenance]{.title-ref}           Server is currently under maintenance, please try again later

``` js
{
    "jsonrpc": "2.0",
    "id": string,
    "result": {
        "status": string,
        "status_msg": string,
        "document_token": string,
    }
}
```

:::: note
::: title
Note
:::

The API does not actually use the JSON-RPC error scheme. Instead the API
has its own error scheme bundled inside a successful JSON-RPC result.
::::

## Get results

### Routes {#extract_api/get_result}

> - /api/extract/invoice/2/get_result
> - /api/extract/bank_statement/1/get_result
> - /api/extract/expense/2/get_result
> - /api/extract/applicant/2/get_result

### Request

::: rst-class
o-definition-list
:::

`jsonrpc` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`method` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`id` (required)

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`params`

:   ::: rst-class
    o-definition-list
    :::

    `version` (required)

    :   The version should match the version passed to the
        `/parse <extract_api/parse>`{.interpreted-text role="ref"}
        request.

    `document_token` (required)

    :   The `document_token` for which you want to get the current
        parsing status.

    `account_token` (required)

    :   The token of the `IAP (In-app purchases)`{.interpreted-text
        role="abbr"} account that was used to submit the document.

``` js
{
    "jsonrpc": "2.0",
    "method": "call",
    "params": {
        "version": int,
        "document_token": int,
        "account_token": string,
    },
    "id": string,
}
```

### Response

When getting the results from the parse, the detected field vary a lot
depending on the type of document. Each response is a list of
dictionaries, one for each document. The keys of the dictionary are the
name of the field and the value is the value of the field.

::: rst-class
o-definition-list
:::

`jsonrpc`

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`id`

:   see [JSON-RPC2](https://www.jsonrpc.org/specification)

`result`

:   ::: rst-class
    o-definition-list
    :::

    `status`

    :   The code indicating the status of the request. See the table
        below.

    `status_msg`

    :   A string giving verbose details about the request status.

    `results`

    :   Only present if the request is successful.

        ::: rst-class
        o-definition-list
        :::

        `full_text_annotation`

        :   Contains the unprocessed full result from the
            `OCR (Optical Character Recognition)`{.interpreted-text
            role="abbr"} for the document.

  status                                         status_msg
  ---------------------------------------------- ---------------------------------------------------------------
  [success]{.title-ref}                          Success
  [error_unsupported_version]{.title-ref}        Unsupported version
  [error_internal]{.title-ref}                   An error occurred
  [error_maintenance]{.title-ref}                Server is currently under maintenance, please try again later
  [error_document_not_found]{.title-ref}         The document could not be found
  [error_unsupported_size]{.title-ref}           The document has been rejected because it is too small
  [error_no_page_count]{.title-ref}              Unable to get page count of the PDF file
  [error_pdf_conversion_to_images]{.title-ref}   Couldn\'t convert the PDF to images
  [error_password_protected]{.title-ref}         The PDF file is protected by a password
  [error_too_many_pages]{.title-ref}             The document contains too many pages

``` js
{
    "jsonrpc": "2.0",
    "id": string,
    "result": {
        "status": string,
        "status_msg": string,
        "results": [
            {
                "full_text_annotation": string,
                "feature_1_name": feature_1_result,
                "feature_2_name": feature_2_result,
                ...
            },
            ...
        ]
    }
}
```

#### Common fields

##### `feature_result` {#latestextract_api/get_result/feature_result}

Each field of interest we want to extract from the document such as the
total or the due date are also called **features**. An exhaustive list
of all the extracted features associated to a type of document can be
found in the sections below.

For each feature, we return a list of candidates and we spotlight the
candidate our model predicts to be the best fit for the feature.

::: rst-class
o-definition-list
:::

`selected_value` (optional)

:   The best candidate for this feature.

`selected_values` (optional)

:   The best candidates for this feature.

`candidates` (optional)

:   List of all the candidates for this feature ordered by decreasing
    confidence score.

``` js
"feature_name": {
    "selected_value": candidate_12,
    "candidates": [candidate_12, candidate_3, candidate_4, ...]
}
```

##### candidate

For each candidate we give its representation and position in the
document. Candidates are sorted by decreasing order of suitability.

::: rst-class
o-definition-list
:::

`content`

:   Representation of the candidate.

`coords`

:   ::: rst-class
    o-definition-list
    :::

    `[center_x, center_y, width, height, rotation_angle]`. The position
    and dimensions are relative to the size of the page and are
    therefore between 0 and 1. The angle is a clockwise rotation
    measured in degrees.

`page`

:   Page of the original document on which the candidate is located
    (starts at 0).

``` js
"candidate": [
    {
        "content": string|float,
        "coords": [float, float, float, float, float],
        "page": int
    },
    ...
]
```

#### Invoices

Invoices are complex and can have a lot of different fields. The
following table gives an exhaustive list of all the fields we can
extract from an invoice.

+--------------------+-------------------------------------------------------+
| Feature name       | Specificities                                         |
+====================+=======================================================+
| `SWIFT_code`       | `content` is a dictionary encoded as a string.        |
|                    |                                                       |
|                    | It contains information about the detected SWIFT code |
|                    | (or                                                   |
|                    | [BIC](https://www.iso9362.org/isobic/overview.html)). |
|                    |                                                       |
|                    | Keys:                                                 |
|                    |                                                       |
|                    | ::: rst-class                                         |
|                    | o-definition-list                                     |
|                    | :::                                                   |
|                    |                                                       |
|                    | `bic`                                                 |
|                    |                                                       |
|                    | :   detected BIC (string).                            |
|                    |                                                       |
|                    | `name` (optional)                                     |
|                    |                                                       |
|                    | :   bank name (string).                               |
|                    |                                                       |
|                    | `country_code`                                        |
|                    |                                                       |
|                    | :   ISO3166 alpha-2 country code of the bank          |
|                    |     (string).                                         |
|                    |                                                       |
|                    | `city` (optional)                                     |
|                    |                                                       |
|                    | :   city of the bank (string).                        |
|                    |                                                       |
|                    | `verified_bic`                                        |
|                    |                                                       |
|                    | :   True if the BIC has been found in our DB (bool).  |
|                    |                                                       |
|                    | Name and city are present only if verified_bic is     |
|                    | true.                                                 |
+--------------------+-------------------------------------------------------+
| `iban`             | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `aba`              | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `VAT_Number`       | `content` is a string                                 |
|                    |                                                       |
|                    | Depending on the value of perspective in the          |
|                    | user_infos, this will be the VAT number of the        |
|                    | supplier or the client. If perspective is client,     |
|                    | it\'ll be the supplier\'s VAT number. If it\'s        |
|                    | supplier, it\'s the client\'s VAT number.             |
+--------------------+-------------------------------------------------------+
| `qr-bill`          | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `payment_ref`      | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `purchase_order`   | `content` is a string                                 |
|                    |                                                       |
|                    | Uses `selected_values` instead of `selected_value`    |
+--------------------+-------------------------------------------------------+
| `country`          | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `currency`         | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `date`             | `content` is a string                                 |
|                    |                                                       |
|                    | Format : *YYYY-MM-DD*                                 |
+--------------------+-------------------------------------------------------+
| `due_date`         | Same as for `date`                                    |
+--------------------+-------------------------------------------------------+
| `total_tax_amount` | `content` is a float                                  |
+--------------------+-------------------------------------------------------+
| `invoice_id`       | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `subtotal`         | `content` is a float                                  |
+--------------------+-------------------------------------------------------+
| `total`            | `content` is a float                                  |
+--------------------+-------------------------------------------------------+
| `supplier`         | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `client`           | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `email`            | `content` is a string                                 |
+--------------------+-------------------------------------------------------+
| `website`          | `content` is a string                                 |
+--------------------+-------------------------------------------------------+

##### `invoice_lines` feature

It is returned as a list of dictionaries where each dictionary
represents an invoice line.

``` js
"invoice_lines": [
    {
        "description": string,
        "quantity": float,
        "subtotal": float,
        "total": float,
        "taxes": list[float],
        "total": float,
        "unit_price": float
    },
    ...
]
```

#### Bank statements

The following table gives a list of all the fields that are extracted
from bank statements.

  -----------------------------------------------------------------------
  Feature name       Specificities
  ------------------ ----------------------------------------------------
  `balance_start`    `content` is a float

  `balance_end`      `content` is a float

  `date`             `content` is a string
  -----------------------------------------------------------------------

##### `bank_statement_lines` feature

It is returned as a list of dictionaries where each dictionary
represents a bank statement line.

``` js
"bank_statement_lines": [
    {
        "amount": float,
        "description": string,
        "date": string,
    },
    ...
]
```

#### Expense

The expenses are less complex than invoices. The following table gives
an exhaustive list of all the fields we can extract from an expense
report.

  -----------------------------------------------------------------------
  Feature name       Specificities
  ------------------ ----------------------------------------------------
  `description`      `content` is a string

  `country`          `content` is a string

  `date`             `content` is a string

  `total`            `content` is a float

  `currency`         `content` is a string
  -----------------------------------------------------------------------

#### Applicant

This third type of document is meant for processing resumes. The
following table gives an exhaustive list of all the fields we can
extract from a resume.

  -----------------------------------------------------------------------
  Feature name       Specificities
  ------------------ ----------------------------------------------------
  `name`             `content` is a string

  `email`            `content` is a string

  `phone`            `content` is a string

  `mobile`           `content` is a string
  -----------------------------------------------------------------------

## Integration Testing {#latestextract_api/integration_testing}

You can test your integration by using *integration_token* as
`account_token` in the `/parse <extract_api/parse>`{.interpreted-text
role="ref"} request.

Using this token put you in test mode and allows you to simulate the
entire flow without really parsing a document and without being billed
one credit for each successful **document** parsing.

The only technical differences in test mode is that the document you
send is not parsed by the system and that the response you get from
`/get_result <extract_api/get_result>`{.interpreted-text role="ref"} is
a hard-coded one.

A python implementation of the full flow for invoices can be found
`here <extract_api/implementation.py>`{.interpreted-text
role="download"}.




--- SOURCE: developer/reference/frontend/assets.md ---

# Assets {#reference/assets}

Managing assets in Odoo is not as straightforward as it is in some other
apps. One of the reasons is that we have a variety of situations where
some, but not all of the assets are required. For example, the needs of
the web client, the point of sale app, the website or even the mobile
application are different. Also, some assets may be large, but are
seldom needed: in that case we may want them to be
`loaded lazily (on demand) <frontend/assets/lazy_loading>`{.interpreted-text
role="ref"}.

## Asset types

There are three different asset types: code ([js]{.title-ref} files),
style ([css]{.title-ref} or [scss]{.title-ref} files) and templates
([xml]{.title-ref} files).

Code

:   Odoo supports
    `three different kinds of javascript files<frontend/js_modules>`{.interpreted-text
    role="ref"}. All these files are then processed (native JS modules
    are transformed into odoo modules), then minified (if not in
    [debug=assets]{.title-ref}
    `mode <frontend/framework/assets_debug_mode>`{.interpreted-text
    role="ref"}) and concatenated. The result is then saved as a file
    attachment. These file attachments are usually loaded via a
    [\<script\>]{.title-ref} tag in the [\<head\>]{.title-ref} part of
    the page (as a static file).

Style

:   Styling can be done with either [css]{.title-ref} or
    [scss](https://sass-lang.com/). Like the javascript files, these
    files are processed ([scss]{.title-ref} files are converted into
    [css]{.title-ref}), then minified (again, if not in
    [debug=assets]{.title-ref}
    `mode <frontend/framework/assets_debug_mode>`{.interpreted-text
    role="ref"}) and concatenated. The result is then saved as a file
    attachment. They are then usually loaded via a
    [\<link\>]{.title-ref} tag in the [\<head\>]{.title-ref} part of the
    page (as a static file).

Template

:   Templates (static [xml]{.title-ref} files) are handled in a
    different way: they are simply read from the file system whenever
    they are needed, and concatenated.

    Whenever the browser loads odoo, it calls the
    [/web/webclient/qweb/]{.title-ref} controller to fetch the
    `templates <reference/qweb>`{.interpreted-text role="ref"}.

It is useful to know that in most cases, a browser only performs a
request the first time it loads a page. This is because each of these
assets are associated with a checksum, which is injected into the page
source. The checksum is then added to the url, which means that it is
possible to safely set the cache headers to a long period.

## Bundles {#reference/assets_bundle}

Odoo assets are grouped by *bundles*. Each bundle (a *list of file
paths* of specific types: [xml]{.title-ref}, [js]{.title-ref},
[css]{.title-ref} or [scss]{.title-ref}) is listed in the
`module manifest <reference/module/manifest>`{.interpreted-text
role="ref"}. Files can be declared using
[glob](https://en.wikipedia.org/wiki/Glob_(programming)) syntax, meaning
that you can declare several asset files using a single line.

The bundles are defined in each module\'s
`__manifest__.py`{.interpreted-text role="file"}, with a dedicated
[assets]{.title-ref} key which contains a dictionary. The dictionary
maps bundle names (keys) to the list of files they contain (values). It
looks like this:

``` python
'assets': {
    'web.assets_backend': [
        'web/static/src/xml/**/*',
    ],
    'web.assets_common': [
        'web/static/lib/bootstrap/**/*',
        'web/static/src/js/boot.js',
        'web/static/src/js/webclient.js',
    ],
    'web.qunit_suite_tests': [
        'web/static/src/js/webclient_tests.js',
    ],
},
```

Here is a list of some important bundles that most odoo developers will
need to know:

- \`web.assets_common\`: this bundle contains most assets which are
  common to the web client, the website and also the point of sale. This
  is supposed to contain lower level building blocks for the odoo
  framework. Note that it contains the `boot.js`{.interpreted-text
  role="file"} file, which defines the odoo module system.
- \`web.assets_backend\`: this bundle contains the code specific to the
  web client (notably the web client/action manager/views/static XML
  templates)
- \`web.assets_frontend\`: this bundle is about all that is specific to
  the public website: ecommerce, portal, forum, blog, \...
- \`web.qunit_suite_tests\`: all javascript qunit testing code (tests,
  helpers, mocks)
- \`web.qunit_mobile_suite_tests\`: mobile specific qunit testing code

### Operations

Typically, handling assets is simple: you just need to add some new
files to a frequently used bundle like [assets_common]{.title-ref} or
[assets_backend]{.title-ref}. But there are other operations available
to cover some more specific use cases.

Note that all directives targeting a certain asset file (i.e.
[before]{.title-ref}, [after]{.title-ref}, [replace]{.title-ref} and
[remove]{.title-ref}) need that file to be declared beforehand, either
in manifests higher up in the hierarchy or in `ir.asset` records with a
lower sequence.

#### [append]{.title-ref}

This operation adds one or multiple file(s). Since it is the most common
operation, it can be done by simply using the file name:

``` python
'web.assets_common': [
    'my_addon/static/src/js/**/*',
],
```

By default, adding a simple string to a bundle will append the files
matching the glob pattern at the end of the bundle. Obviously, the
pattern may also be directly a single file path.

#### [prepend]{.title-ref}

Add one or multiple file(s) at the beginning of the bundle.

Useful when you need to put a certain file before the others in a bundle
(for example with css files). The [prepend]{.title-ref} operation is
invoked with the following syntax: [(\'prepend\',
\<path\>)]{.title-ref}.

``` python
'web.assets_common': [
    ('prepend', 'my_addon/static/src/css/bootstrap_overridden.scss'),
],
```

#### [before]{.title-ref}

Add one or multiple file(s) before a specific file.

Prepending a file at the beginning of a bundle might not be precise
enough. The [before]{.title-ref} directive can be used to add the given
file(s) right *before* the target file. It is declared by replacing the
normal path with a 3-element tuple [(\'before\', \<target\>,
\<path\>)]{.title-ref}.

``` python
'web.assets_common': [
    ('before', 'web/static/src/css/bootstrap_overridden.scss', 'my_addon/static/src/css/bootstrap_overridden.scss'),
],
```

#### [after]{.title-ref}

Add one or multiple file(s) after a specific file.

Same as [before]{.title-ref}, with the matching file(s) appended right
*after* the target file. It is declared by replacing the normal path
with a 3-element tuple [(\'after\', \<target\>, \<path\>)]{.title-ref}.

``` python
'web.assets_common': [
    ('after', 'web/static/src/css/list_view.scss', 'my_addon/static/src/css/list_view.scss'),
],
```

#### [include]{.title-ref}

Use nested bundles.

The [include]{.title-ref} directive is a way to use a bundle in other
bundles to minimize the size of your manifest. In Odoo we use sub
bundles (prefixed with an underscore by convention) to batch files used
in multiple other bundles. You can then specify the sub bundle as a pair
[(\'include\', \<bundle\>)]{.title-ref} like this:

``` python
'web.assets_common': [
    ('include', 'web._primary_variables'),
],
```

#### [remove]{.title-ref}

Remove one or multiple file(s).

In some cases, you may want to remove one or multiple files from a
bundle. This can be done using the [remove]{.title-ref} directive by
specifying a pair \`(\'remove\', \<target\>)\`:

``` python
'web.assets_common': [
    ('remove', 'web/static/src/js/boot.js'),
],
```

#### [replace]{.title-ref}

Replace an asset file with one or multiple file(s).

Let us say that an asset needs not only to be removed, but you also want
to insert your new version of that asset at the same exact position.
This can be done with the [replace]{.title-ref} directive, using a
3-element tuple \`(\'replace\', \<target\>, \<path\>)\`:

``` python
'web.assets_common': [
    ('replace', 'web/static/src/js/boot.js', 'my_addon/static/src/js/boot.js'),
],
```

### Loading order

The order in which assets are loaded is sometimes critical and must be
deterministic, mostly for stylesheets priorities and setup scripts.
Assets in Odoo are processed as follows:

1.  When an asset bundle is called (e.g.
    [t-call-assets=\"web.assets_common\"]{.title-ref}), an empty list of
    assets is generated
2.  All records of type [ir.asset]{.title-ref} matching the bundle are
    fetched and sorted by sequence number. Then all records with a
    sequence strictly less than 16 are processed and applied to the
    current list of assets.
3.  All modules declaring assets for said bundle in their manifest apply
    their assets operations to this list. This is done following the
    order of modules dependencies (e.g. [web]{.title-ref} assets is
    processed before [website]{.title-ref}). If a directive tries to add
    a file already present in the list, nothing is done for that file.
    In other word, only the first occurrence of a file is kept in the
    list.
4.  The remaining [ir.asset]{.title-ref} records (those with a sequence
    greater than or equal to 16) are then processed and applied as well.

Assets declared in the manifest may need to be loaded in a particular
order, for example `jquery.js`{.interpreted-text role="file"} must be
loaded before all other jquery scripts when loading the lib folder. One
solution would be to create an
`ir.asset <frontend/assets/ir_asset>`{.interpreted-text role="ref"}
record with a lower sequence or a \'prepend\' directive, but there is
another simpler way to do so.

Since the unicity of each file path in the list of assets is guaranteed,
you can mention any specific file before a glob that includes it. That
file will thus appear in the list before all the others included in the
glob.

``` python
'web.assets_common': [
    'my_addon/static/lib/jquery/jquery.js',
    'my_addon/static/lib/jquery/**/*',
],
```

:::: note
::: title
Note
:::

A module *b* removing/replacing the assets declared in a module *a* will
have to depend on it. Trying to operate on assets that have yet to be
declared will result in an error.
::::

## Lazy loading {#frontend/assets/lazy_loading}

It is sometimes useful to load files and/or asset bundles dynamically,
for example to only load a library once it is needed. To do that, the
Odoo framework provides a few helper functions, located in
`@web/core/assets`{.interpreted-text role="file"}.

``` javascript
await loadAssets({
    jsLibs: ["/web/static/lib/stacktracejs/stacktrace.js"],
});
```

> 
>
> param Object assets
> :   a description of various assets that should be loaded
>
> returns
> :   Promise\<void\>
>
> Load the assets described by the [assets]{.title-ref} parameter. It is
> an object that may contain the following keys:
>
>   ---------------------------------------------------------------------------------------------
>   Key                     Type                       Description
>   ----------------------- -------------------------- ------------------------------------------
>   [jsLibs]{.title-ref}    [string\[\]]{.title-ref}   a list of urls of javascript files
>
>   [cssLibs]{.title-ref}   [string\[\]]{.title-ref}   a list of urls of css files
>   ---------------------------------------------------------------------------------------------

> 
>
> param Object assets
> :   a description of various assets that should be loaded
>
> This hook is useful when components need to load some assets in their
> [onWillStart]{.title-ref} method. It internally calls
> [loadAssets]{.title-ref}.

## The asset model ([ir.asset]{.title-ref}) {#frontend/assets/ir_asset}

In most cases the assets declared in the manifest will largely suffice.
Yet for more flexibility, the framework also supports dynamic assets
declared in the database.

This is done by creating [ir.asset]{.title-ref} records. Those will be
processed as if they were found in a module manifest, and they give the
same expressive power as their manifest counterparts.

::: autoclass
odoo.addons.base.models.ir_asset.IrAsset
:::

::: rst-class
o-definition-list
:::

[name]{.title-ref}

:   Name of the asset record (for identification purpose).

[bundle]{.title-ref}

:   Bundle in which the asset will be applied.

[directive]{.title-ref} (default= [append]{.title-ref})

:   This field determines how the [path]{.title-ref} (and
    [target]{.title-ref} if needed) will be interpreted. Here is the
    list of available directives along with their required arguments:

    - **append**: [path]{.title-ref}
    - **prepend**: [path]{.title-ref}
    - **before**: [target]{.title-ref}, [path]{.title-ref}
    - **after**: [target]{.title-ref}, [path]{.title-ref}
    - **include**: [path]{.title-ref} (interpreted as a **bundle name**)
    - **remove**: [path]{.title-ref} (interpreted as a **target asset**
      to remove)
    - **replace**: [target]{.title-ref}, [path]{.title-ref}

[path]{.title-ref}

:   A string defining one of the following:

    - a **relative path** to an asset file in the addons file system;
    - a **glob pattern** to a set of asset files in the addons file
      system;
    - a **URL** to an attachment or external asset file;
    - a **bundle name**, when using the [include]{.title-ref} directive.

[target]{.title-ref}

:   Target file to specify a position in the bundle. Can only be used
    with the directives [replace]{.title-ref}, [before]{.title-ref} and
    [after]{.title-ref}.

[active]{.title-ref} (default= [True]{.title-ref})

:   Whether the record is active

[sequence]{.title-ref} (default= [16]{.title-ref})

:   Loading order of the asset records (ascending). A sequence lower
    than 16 means that the asset will be processed *before* the ones
    declared in the manifest.




--- SOURCE: developer/reference/frontend/framework_overview.md ---

# Framework Overview

## Introduction

The Odoo Javascript framework is a set of features/building blocks
provided by the `web/` addon to help build odoo applications running in
the browser. At the same time, the Odoo Javascript framework is a single
page application, usually known as the *web client* (available at the
url `/web`).

The web client started as an application made with a custom class and
widget system, but it is now transitioning to using native javascript
classes instead, and Owl as a component system. This explains why both
systems are currently in use in the codebase.

From a high-level perspective, the web client is a single-page
application: it does not need to request a full page from the server
each time the user performs an action. Instead, it only requests what it
needs and then replaces/updates the current screen accordingly. Also, it
manages the url to keep it in sync with the current state.

The javascript framework (all or some parts) is also used in other
situations, such as the Odoo website or the point of sale. This
reference is mostly focused on the web client.

:::: note
::: title
Note
:::

It is common in the Odoo ecosystem to see the words *frontend* and
*backend* as synonyms for the odoo website (public) and the web client,
respectively. This terminology is not to be confused with the more
common use of browser-code (frontend) and server (backend).
::::

:::: note
::: title
Note
:::

In this documentation, the word *component* always refers to new Owl
components, and *widget* refers to old Odoo widgets.
::::

:::: note
::: title
Note
:::

All new development should be done in Owl, if possible!
::::

## Code structure

The `web/static/src` folder contains all the `web/` javascript (and css
and templates) codebase. Here is a list of the most important folders:

- `core/` most of the low level features
- `fields/` all field components
- `views/` all javascript views components (`form`, `list`, \...)
- `search/` control panel, search bar, search panel, \...
- `webclient/` the web client specific code: navbar, user menu, action
  service, \...

The `web/static/src` is the root folder. Everything inside can simply be
imported by using the `@web` prefix. For example, here is how one can
import the `memoize` function located in
`web/static/src/core/utils/functions`:

``` javascript
import { memoize } from "@web/core/utils/functions";
```

## WebClient Architecture

As mentioned above, the web client is an owl application. Here is a
slightly simplified version of its template:

``` xml
<t t-name="web.WebClient" owl="1">
    <body class="o_web_client">
        <NavBar/>
        <ActionContainer/>
        <MainComponentsContainer/>
    </body>
</t>
```

As we can see, it basically is a wrapper for a navbar, the current
action and some additional components. The `ActionContainer` is a higher
order component that will display the current action controller (so, a
client action, or a specific view in the case of actions of type
`act_window`). Managing actions is a huge part of its work: the action
service keeps in memory a stack of all active actions (represented in
the breadcrumbs), and coordinates each change.

Another interesting thing to note is the `MainComponentsContainer`: it
is simply a component that displays all components registered in the
`main_components` registry. This is how other parts of the system can
extend the web client.

## Environment {#frontend/framework/environment}

As an Owl application, the Odoo web client defines its own environment
(components can access it using `this.env`). Here is a description of
what Odoo adds to the shared `env` object:

  -----------------------------------------------------------------------------------------
  Key                      Value
  ------------------------ ----------------------------------------------------------------
  [qweb]{.title-ref}       required by Owl (contains all templates)

  [bus]{.title-ref}        `main bus <frontend/framework/bus>`{.interpreted-text
                           role="ref"}, used to coordinate some generic events

  [services]{.title-ref}   all deployed `services <frontend/services>`{.interpreted-text
                           role="ref"} (should usually be accessed with the
                           [useService]{.title-ref} hook)

  [debug]{.title-ref}      string. If non empty, the web client is in
                           `debug mode <frontend/framework/debug_mode>`{.interpreted-text
                           role="ref"}

  [\_t]{.title-ref}        translation function

  [isSmall]{.title-ref}    boolean. If true, the web client is currently in mobile mode
                           (screen width \<= 767px)
  -----------------------------------------------------------------------------------------

So, for example, to translate a string in a component (note: templates
are automatically translated, so no specific action is required in that
case), one can do this:

``` javascript
const someString = this.env._t('some text');
```

:::: note
::: title
Note
:::

Having a reference to the environment is quite powerful, because it
provides access to all services. This is useful in many cases: for
example, user menu items are mostly defined as a string, and a function
taking the [env]{.title-ref} as unique argument. This is enough to
express all user menu needs.
::::

## Building Blocks

Most of the web client is built with a few types of abstractions:
registries, services, components and hooks.

### Registries

`Registries <frontend/registries>`{.interpreted-text role="ref"} are
basically a simple key/value mapping that stores some specific kind of
objects. They are an important part of the extensibility of the UI: once
some object is registered, the rest of the web client can use it. For
example, the field registry contains all field components (or widgets)
that can be used in views.

``` javascript
import { registry } from "./core/registry";

class MyFieldChar extends owl.Component {
    // some code
}

registry.category("fields").add("my_field_char", MyFieldChar);
```

Note that we import the main registry from `@web/core/registry` then
open the sub registry `fields`.

### Services

`Services <frontend/services>`{.interpreted-text role="ref"} are long
lived pieces of code that provide a feature. They may be imported by
components (with `useService`) or by other services. Also, they can
declare a set of dependencies. In that sense, services are basically a
DI (dependency injection) system. For example, the `notification`
service provides a way to display a notification, or the `rpc` service
is the proper way to perform a request to the Odoo server.

The following example registers a simple service that displays a
notification every 5 second:

``` javascript
import { registry } from "./core/registry";

const myService = {
    dependencies: ["notification"],
    start(env, { notification }) {
        let counter = 1;
        setInterval(() => {
            notification.add(`Tick Tock ${counter++}`);
        }, 5000);
    }
};

serviceRegistry.add("myService", myService);
```

### Components and Hooks

`Components <frontend/components>`{.interpreted-text role="ref"} and
`hooks <frontend/hooks>`{.interpreted-text role="ref"} are ideas coming
from the [Owl component
system](https://github.com/odoo/owl/blob/master/doc/readme.md). Odoo
components are simply owl components that are part of the web client.

[Hooks](https://github.com/odoo/owl/blob/master/doc/reference/hooks.md)
are a way to factorize code, even if it depends on lifecycle. This is a
composable/functional way to inject a feature in a component. They can
be seen as a kind of mixin.

``` javascript
function useCurrentTime() {
    const state = useState({ now: new Date() });
    const update = () => state.now = new Date();
    let timer;
    onWillStart(() => timer = setInterval(update, 1000));
    onWillUnmount(() => clearInterval(timer));
    return state;
}
```

## Context

An important concept in the Odoo javascript is the *context*: it
provides a way for code to give more context to a function call or a
rpc, so other parts of the system can properly react to that
information. In some way, it is like a bag of information that is
propagated everywhere. It is useful in some situations, such as letting
the Odoo server know that a model rpc comes from a specific form view,
or activating/disabling some features in a component.

There are two different contexts in the Odoo web client: the *user
context* and the *action context* (so, we should be careful when using
the word *context*: it could mean a different thing depending on the
situation).

:::: note
::: title
Note
:::

The [context]{.title-ref} object may be useful in many cases, but one
should be careful not to overuse it! Many problems can be solved in a
standard way without modifying the context.
::::

### User Context {#frontend/framework/user_context}

The *user context* is a small object containing various informations
related to the current user. It is available through the
[user]{.title-ref} service:

``` javascript
class MyComponent extends Component {
    setup() {
        const user = useService("user");
        console.log(user.context);
    }
}
```

It contains the following information:

  ---------------------------------------------------------------------------------------------------------
  Name                                Type                       Description
  ----------------------------------- -------------------------- ------------------------------------------
  [allowed_company_ids]{.title-ref}   [number\[\]]{.title-ref}   the list of active company ids for the
                                                                 user

  [lang]{.title-ref}                  [string]{.title-ref}       the user language code (such as \"en_us\")

  [tz]{.title-ref}                    [string]{.title-ref}       the user current timezone (for example
                                                                 \"Europe/Brussels\")
  ---------------------------------------------------------------------------------------------------------

In practice, the [orm]{.title-ref} service automatically adds the user
context to each of its requests. This is why it is usually not necessary
to import it directly in most cases.

:::: note
::: title
Note
:::

The first element of the [allowed_company_ids]{.title-ref} is the main
company of the user.
::::

### Action Context

The `ir.actions.act_window<reference/actions/window>`{.interpreted-text
role="ref"} and
`ir.actions.client<reference/actions/client>`{.interpreted-text
role="ref"} support an optional [context]{.title-ref} field. This field
is a [char]{.title-ref} that represents an object. Whenever the
corresponding action is loaded in the web client, this context field
will be evaluated as an object and given to the component that
corresponds to the action.

``` xml
<field name="context">{'search_default_customer': 1}</field>
```

It can be used in many different ways. For example, the views add the
action context to every requests made to the server. Another important
use is to activate some search filter by default (see example above).

Sometimes, when we execute new actions manually (so, programmatically,
in javascript), it is useful to be able to extend the action context.
This can be done with the [additional_context]{.title-ref} argument.

``` javascript
// in setup
let actionService = useService("action");

// in some event handler
actionService.doAction("addon_name.something", {
    additional_context:{
        default_period_id: defaultPeriodId
    }
});
```

In this example, the action with xml_id
[addon_name.something]{.title-ref} will be loaded, and its context will
be extended with the [default_period_id]{.title-ref} value. This is a
very important usecase that lets developers combine actions together by
providing some information to the next action.

## Python Interpreter {#frontend/framework/pyjs}

The Odoo framework features a built-in small python interpreter. Its
purpose is to evaluate small python expressions. This is important,
because views in Odoo have modifiers written in python, but they need to
be evaluated by the browser.

Example:

``` javascript
import { evaluateExpr } from "@web/core/py_js/py";

evaluateExpr("1 + 2*{'a': 1}.get('b', 54) + v", { v: 33 }); // returns 142
```

The `py` javascript code exports 5 functions:

> 
>
> param string expr
> :   the expression to tokenize
>
> returns
> :   Token\[\] a list of token

> 
>
> param Token\[\] tokens
> :   a list of tokens
>
> returns
> :   AST an abstract syntax tree structure representing the expression

> 
>
> param string expr
> :   a string representing a valid python expression
>
> returns
> :   AST an abstract syntax tree structure representing the expression

> 
>
> param AST ast
> :   a AST structure that represents an expression
>
> param Object context
> :   an object that provides an additional evaluation context
>
> returns
> :   any the resulting value of the expression, with respect to the
>     context

> 
>
> param string expr
> :   a string representing a valid python expression
>
> param Object context
> :   an object that provides an additional evaluation context
>
> returns
> :   any the resulting value of the expression, with respect to the
>     context

## Domains {#frontend/framework/domains}

Broadly speaking, domains in Odoo represent a set of records that
matches some specified conditions. In javascript, they are usually
represented either as a list of conditions (or of operators:
[\|]{.title-ref}, [&]{.title-ref} or [!]{.title-ref} in prefix
notation), or as string expressions. They don\'t have to be normalized
(the [&]{.title-ref} operator is implied if necessary). For example:

``` javascript
// list of conditions
[]
[["a", "=", 3]]
[["a", "=", 1], ["b", "=", 2], ["c", "=", 3]]
["&", "&", ["a", "=", 1], ["b", "=", 2], ["c", "=", 3]]
["&", "!", ["a", "=", 1], "|", ["a", "=", 2], ["a", "=", 3]]

// string expressions
"[('some_file', '>', a)]"
"[('date','>=', (context_today() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]"
"[('date', '!=', False)]"
```

String expressions are more powerful than list expressions: they can
contain python expressions and unevaluated values, that depends on some
evaluation context. However, manipulating string expressions is more
difficult.

Since domains are quite important in the web client, Odoo provides a
[Domain]{.title-ref} class:

``` javascript
new Domain([["a", "=", 3]]).contains({ a: 3 }) // true

const domain = new Domain(["&", "&", ["a", "=", 1], ["b", "=", 2], ["c", "=", 3]]);
domain.contains({ a: 1, b: 2, c: 3 }); // true
domain.contains({ a: -1, b: 2, c: 3 }); // false

// next expression returns ["|", ("a", "=", 1), ("b", "<=", 3)]
Domain.or([[["a", "=", 1]], "[('b', '<=', 3)]"]).toString();
```

Here is the [Domain]{.title-ref} class description:

> 
>
> param descr
> :   a domain description
>
> type descr
> :   string \| any\[\] \| Domain
>
> > 
> >
> > param Object record
> > :   a record object
> >
> > returns
> > :   boolean
> >
> > Returns true if the record matches all the condition specified by
> > the domain
>
> > 
> >
> > returns
> > :   string
> >
> > Returns a string description for the domain
>
> > 
> >
> > param Object context
> > :   evaluation context
> >
> > returns
> > :   any\[\]
> >
> > Returns a list description for the domain. Note that this method
> > takes an optional [context]{.title-ref} object that will be used to
> > replace all free variables.
> >
> > ``` javascript
> > new Domain(`[('a', '>', b)]`).toList({ b:3 }); // [['a', '>', 3]]
> > ```

The [Domain]{.title-ref} class also provides 4 useful static methods to
combine domains:

``` javascript
// ["&", ("a", "=", 1), ("uid", "<=", uid)]
Domain.and([[["a", "=", 1]], "[('uid', '<=', uid)]"]).toString();

// ["|", ("a", "=", 1), ("uid", "<=", uid)]
Domain.or([[["a", "=", 1]], "[('uid', '<=', uid)]"]).toString();

// ["!", ("a", "=", 1)]
Domain.not([["a", "=", 1]]).toString();

// ["&", ("a", "=", 1), ("uid", "<=", uid)]
Domain.combine([[["a", "=", 1]], "[('uid', '<=', uid)]"], "AND").toString();
```

::: staticmethod
Domain.and(domains)

param domains
:   a list of domain representations

type domains
:   string\[\] \| any\[\]\[\] \| Domain\[\]

returns
:   Domain

Returns a domain representing the intersection of all domains.
:::

::: staticmethod
Domain.or(domains)

param domains
:   a list of domain representations

type domains
:   string\[\] \| any\[\]\[\] \| Domain\[\]

returns
:   Domain

Returns a domain representing the union of all domains.
:::

::: staticmethod
Domain.not(domain)

param domain
:   a domain representation

type domain
:   string \| any\[\] \| Domain

returns
:   Domain

Returns a domain representing the negation of the domain argument
:::

::: staticmethod
Domain.combine(domains, operator)

param domains
:   a list of domain representations

type domains
:   string\[\] \| any\[\]\[\] \| Domain\[\]

param operator
:   an operator

type operator
:   \'AND\' or \'OR\'

returns
:   Domain

Returns a domain representing either the intersection or the union of
all the domains, depending on the value of the operator argument.
:::

## Bus {#frontend/framework/bus}

The web client
`environment <frontend/framework/environment>`{.interpreted-text
role="ref"} object contains an event bus, named [bus]{.title-ref}. Its
purpose is to allow various parts of the system to properly coordinate
themselves, without coupling them. The [env.bus]{.title-ref} is an owl
[EventBus](https://github.com/odoo/owl/blob/master/doc/reference/event_bus.md),
that should be used for global events of interest.

``` javascript
// for example, in some service code:
env.bus.on("WEB_CLIENT_READY", null, doSomething);
```

Here is a list of the events that can be triggered on this bus:

  Message                       Payload                                                                                           Trigger
  ----------------------------- ------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------
  `ACTION_MANAGER:UI-UPDATED`   a mode indicating what part of the ui has been updated (\'current\', \'new\' or \'fullscreen\')   the rendering of the action requested to the action manager is done
  `ACTION_MANAGER:UPDATE`       next rendering info                                                                               the action manager has finished computing the next interface
  `MENUS:APP-CHANGED`           none                                                                                              the menu service\'s current app has changed
  `ROUTE_CHANGE`                none                                                                                              the url hash was changed
  `RPC:REQUEST`                 rpc id                                                                                            a rpc request has just started
  `RPC:RESPONSE`                rpc id                                                                                            a rpc request is completed
  `WEB_CLIENT_READY`            none                                                                                              the web client has been mounted
  `FOCUS-VIEW`                  none                                                                                              the main view should focus itself
  `CLEAR-CACHES`                none                                                                                              all internal caches should be cleared
  `CLEAR-UNCOMMITTED-CHANGES`   list of functions                                                                                 all views with uncommitted changes should clear them, and push a callback in the list

## Browser Object

The javascript framework also provides a special object `browser` that
provides access to many browser APIs, like `location`, `localStorage` or
`setTimeout`. For example, here is how one could use the
`browser.setTimeout` function:

``` javascript
import { browser } from "@web/core/browser/browser";

// somewhere in code
browser.setTimeout(someFunction, 1000);
```

It is mostly interesting for testing purposes: all code using the
browser object can be tested easily by mocking the relevant functions
for the duration of the test.

It contains the following content:

  -------------------------------- ------------------------------------ -------------------------------------
  [addEventListener]{.title-ref}   [cancelAnimationFrame]{.title-ref}   [clearInterval]{.title-ref}
  [clearTimeout]{.title-ref}       [console]{.title-ref}                [Date]{.title-ref}
  [fetch]{.title-ref}              [history]{.title-ref}                [localStorage]{.title-ref}
  [location]{.title-ref}           [navigator]{.title-ref}              [open]{.title-ref}
  [random]{.title-ref}             [removeEventListener]{.title-ref}    [requestAnimationFrame]{.title-ref}
  [sessionStorage]{.title-ref}     [setInterval]{.title-ref}            [setTimeout]{.title-ref}
  [XMLHttpRequest]{.title-ref}                                          
  -------------------------------- ------------------------------------ -------------------------------------

## Debug mode {#frontend/framework/debug_mode}

Odoo can sometimes operate in a special mode called the
[debug]{.title-ref} mode. It is used for two main purposes:

- display additional information/fields for some particular screens,
- provide some additional tools to help developer debug the Odoo
  interface.

The [debug]{.title-ref} mode is described by a string. An empty string
means that the [debug]{.title-ref} mode is not active. Otherwise, it is
active. If the string contains [assets]{.title-ref} or
[tests]{.title-ref}, then the corresponding specific sub modes are
activated (see below). Both modes can be active at the same time, for
example with the string [assets,tests]{.title-ref}.

The [debug]{.title-ref} mode current value can be read in the
`environment<frontend/framework/environment>`{.interpreted-text
role="ref"}: [env.debug]{.title-ref}.

:::: tip
::: title
Tip
:::

To show menus, fields or view elements only in debug mode, you should
target the group \`base.group_no_one\`:

``` xml
<field name="fname" groups="base.group_no_one"/>
```
::::

::: seealso
\- `Activate the debug mode <developer-mode>`{.interpreted-text
role="ref"}
:::

### Assets mode {#frontend/framework/assets_debug_mode}

The [debug=assets]{.title-ref} sub mode is useful to debug javascript
code: once activated, the `assets<reference/assets>`{.interpreted-text
role="ref"} bundles are no longer minified, and source-maps are
generated as well. This makes it useful to debug all kind of javascript
code.

### Tests mode {#frontend/framework/tests_debug_mode}

There is another sub mode named \`tests\`: if enabled, the server
injects the bundle [web.assets_tests]{.title-ref} in the page. This
bundle contains mostly test tours (tours whose purpose is to test a
feature, not to show something interesting to users). The
[tests]{.title-ref} mode is then useful to be able to run these tours.

::: seealso
\- [Owl Repository](https://github.com/odoo/owl)
:::




--- SOURCE: developer/reference/frontend/hooks.md ---

# Hooks {#frontend/hooks}

[Owl
hooks](https://github.com/odoo/owl/blob/master/doc/reference/hooks.md)
are a way to factorize code, even if it depends on some component
lifecycle. Most hooks provided by Owl are related to the lifecycle of a
component, but some of them (such as
[useComponent](https://github.com/odoo/owl/blob/master/doc/reference/hooks.md#usecomponent))
provide a way to build specific hooks.

Using these hooks, it is possible to build many customized hooks that
help solve a specific problem, or make some common tasks easier. The
rest of this page documents the list of hooks provided by the Odoo web
framework.

  ------------------------------------------------------------------------------------------------------------------
  Name                                                             Short Description
  ---------------------------------------------------------------- -------------------------------------------------
  `useAssets <frontend/hooks/useassets>`{.interpreted-text         load assets
  role="ref"}                                                      

  `useAutofocus <frontend/hooks/useAutofocus>`{.interpreted-text   focus automatically an element referenced by
  role="ref"}                                                      autofocus

  `useBus <frontend/hooks/usebus>`{.interpreted-text role="ref"}   subscribe and unsubscribe to a bus

  `usePager <frontend/hooks/usepager>`{.interpreted-text           Display the pager of the control panel of a view.
  role="ref"}                                                      

  `usePosition <frontend/hooks/useposition>`{.interpreted-text     position an element relative to a target
  role="ref"}                                                      
  ------------------------------------------------------------------------------------------------------------------

## useAssets {#frontend/hooks/useassets}

### Location

[\@web/core/assets]{.title-ref}

### Description

See the section on
`lazy loading assets <frontend/assets/lazy_loading>`{.interpreted-text
role="ref"} for more details.

## useAutofocus {#frontend/hooks/useAutofocus}

### Location

[\@web/core/utils/hooks]{.title-ref}

### Description

Focus an element referenced by a t-ref=\"autofocus\" in the current
component as soon as it appears in the DOM and if it was not displayed
before.

``` javascript
import { useAutofocus } from "@web/core/utils/hooks";

class Comp {
  setup() {
    this.inputRef = useAutofocus();
  }
  static template = "Comp";
}
```

``` xml
<t t-name="Comp" owl="1">
  <input t-ref="autofocus" type="text"/>
</t>
```

### API

> 
>
> returns
> :   the element reference.

## useBus {#frontend/hooks/usebus}

### Location

[\@web/core/utils/hooks]{.title-ref}

### Description

Add and clear an event listener to a bus. This hook ensures that the
listener is properly cleared when the component is unmounted.

``` javascript
import { useBus } from "@web/core/utils/hooks";

class MyComponent {
  setup() {
    useBus(this.env.bus, "some-event", event => {
      console.log(event);
    });
  }
}
```

### API

> 
>
> param EventBus bus
> :   the target event bus
>
> param string eventName
> :   the name of the event that we want to listen to
>
> param function callback
> :   listener callback

## usePager {#frontend/hooks/usepager}

### Location

[\@web/search/pager_hook]{.title-ref}

### Description

Display the `Pager <frontend/pager>`{.interpreted-text role="ref"} of
the control panel of a view. This hooks correctly sets
[env.config]{.title-ref} to provide the props to the pager.

``` javascript
import { usePager } from "@web/search/pager_hook";

class CustomView {
  setup() {
    const state = owl.hooks.useState({
      offset: 0,
      limit: 80,
      total: 50,
    });
    usePager(() => {
      return {
        offset: this.state.offset,
        limit: this.state.limit,
        total: this.state.total,
        onUpdate: (newState) => {
          Object.assign(this.state, newState);
        },
      };
    });
  }
}
```

### API

> 
>
> param function getPagerProps
> :   function that returns the pager props.

## usePosition {#frontend/hooks/useposition}

### Location

[\@web/core/position_hook]{.title-ref}

### Description

Helps positioning an HTMLElement (the [popper]{.title-ref}) relatively
to another HTMLElement (the [reference]{.title-ref}). This hook ensures
the positioning is updated when the window is resized/scrolled.

``` javascript
import { usePosition } from "@web/core/position_hook";

class MyPopover extends owl.Component {
  setup() {
    // Here, the reference is the target props, which is an HTMLElement
    usePosition(this.props.target);
  }
}
MyPopover.template = owl.tags.xml`
  <div t-ref="popper">
    I am positioned through a wonderful hook!
  </div>
`;
```

:::: important
::: title
Important
:::

You should indicate your [popper]{.title-ref} element using a [t-ref
directive](https://github.com/odoo/owl/blob/master/doc/reference/hooks.md#useref).
::::

### API

> 
>
> param reference
> :   the target HTMLElement to be positioned from
>
> type reference
> :   HTMLElement or ()=\>HTMLElement
>
> param Options options
> :   the positioning options (see table below)

  ----------------------------------------------------------------------------------------------------------------------------------------
  Option                       Type                    Description
  ---------------------------- ----------------------- -----------------------------------------------------------------------------------
  [popper]{.title-ref}         string                  this is a [useRef
                                                       reference](https://github.com/odoo/owl/blob/master/doc/reference/hooks.md#useref)
                                                       for the element that will get positioned. Default is [\"popper\"]{.title-ref}.

  [container]{.title-ref}      HTMLElement             the container from which the popper is expected not to overflow. If overflowing
                                                       occurs, other popper positions are tried until a not overflowing one is found.
                                                       (default: the [\<html/\>]{.title-ref} node)

  [margin]{.title-ref}         number                  added margin between popper and reference elements (default: [0]{.title-ref})

  [position]{.title-ref}       Direction\[-Variant\]   the desired position. It is a string composed of one [Direction]{.title-ref} and
                                                       one [Variant]{.title-ref} separated by a dash character. [Direction]{.title-ref}
                                                       could be: [top]{.title-ref}, [bottom]{.title-ref}, [right]{.title-ref},
                                                       [left]{.title-ref}. [Variant]{.title-ref} could be: [start]{.title-ref},
                                                       [middle]{.title-ref}, [end]{.title-ref}. The variant can be omitted (default
                                                       variant is [middle]{.title-ref}). Examples of valid positions:
                                                       [right-end]{.title-ref}, [top-start]{.title-ref}, [left-middle]{.title-ref},
                                                       [left]{.title-ref}. (default position: [bottom]{.title-ref})

  [onPositioned]{.title-ref}   (el: HTMLElement,       a callback that will be called everytime a positioning occurs (e.g. on component
                               position:               mounted/patched, document scroll, window resize\...). Can be used i.e. for dynamic
                               PositioningSolution)    styling regarding the current position. The [PositioningSolution]{.title-ref} is an
                               =\> void                object having the following type: [{ direction: Direction, variant: Variant, top:
                                                       number, left: number }]{.title-ref}.
  ----------------------------------------------------------------------------------------------------------------------------------------

::: example
``` javascript
import { usePosition } from "@web/core/position_hook";

class DropMenu extends owl.Component {
  setup() {
    const toggler = owl.useRef("toggler");
    usePosition(
      () => toggler.el,
      {
        popper: "menu",
        position: "right-start",
        onPositioned: (el, { direction, variant }) => {
          el.classList.add(`dm-${direction}`); // -> "dm-top" "dm-right" "dm-bottom" "dm-left"
          el.style.backgroundColor = variant === "middle" ? "red" : "blue";
        },
      },
    );
  }
}
DropMenu.template = owl.tags.xml`
  <button t-ref="toggler">Toggle Menu</button>
  <div t-ref="menu">
    <t t-slot="default">
      This is the menu default content.
    </t>
  </div>
`;
```
:::




--- SOURCE: developer/reference/frontend/javascript_modules.md ---

# Javascript Modules {#frontend/js_modules}

Odoo supports three different kinds of javascript files:

- `plain javascript files <frontend/modules/plain_js>`{.interpreted-text
  role="ref"} (no module system),
- `native javascript module <frontend/modules/native_js>`{.interpreted-text
  role="ref"}.
- `Odoo modules <frontend/modules/odoo_module>`{.interpreted-text
  role="ref"} (using a custom module system),

As described in the
`assets management page <reference/assets>`{.interpreted-text
role="ref"}, all javascript files are bundled together and served to the
browser. Note that native javascript files are processed by the Odoo
server and transformed into Odoo custom modules.

Let us briefly explain the purpose behind each kind of javascript file.
Plain javascript files should be reserved only for external libraries
and some small specific low level purposes. All new javascript files
should be created in the native javascript module system. The custom
module system is only useful for old, not yet converted files.

## Plain Javascript files {#frontend/modules/plain_js}

Plain javascript files can contain arbitrary content. It is advised to
use the *iife*
`immediately invoked function execution`{.interpreted-text role="dfn"}
style when writing such a file:

``` javascript
(function () {
  // some code here
  let a = 1;
  console.log(a);
})();
```

The advantages of such files is that we avoid leaking local variables to
the global scope.

Clearly, plain javascript files do not offer the benefits of a module
system, so one needs to be careful about the order in the bundle (since
the browser will execute them precisely in that order).

:::: note
::: title
Note
:::

In Odoo, all external libraries are loaded as plain javascript files.
::::

## Native Javascript Modules {#frontend/modules/native_js}

Most new Odoo javascript code should use the native javascript module
system. This is simpler, and brings the benefits of a better developer
experience with a better integration with the IDE.

There is a very important point to know: Odoo needs to know which files
should be translated into
`Odoo modules <frontend/modules/odoo_module>`{.interpreted-text
role="ref"} and which files should not be translated. This is an opt-in
system: Odoo will look at the first line of a JS file and check if it
contains the string *\@odoo-module*. If so, it will automatically be
converted to an Odoo module.

For example, let us consider the following module, located in
`web/static/src/file_a.js`{.interpreted-text role="file"}:

``` javascript
/** @odoo-module **/
import { someFunction } from './file_b';

export function otherFunction(val) {
    return someFunction(val + 3);
}
```

Note the comment in the first line: it describes that this file should
be converted. Any file without this comment will be kept as-is (which
will most likely be an error). This file will then be translated into an
Odoo module that look like this:

``` javascript
odoo.define('@web/file_a', function (require) {
'use strict';
let __exports = {};

const { someFunction } = require("@web/file_b");

__exports.otherFunction = function otherFunction(val) {
    return someFunction(val + 3);
};

return __exports;
)};
```

So, as you can see, the transformation is basically adding
[odoo.define]{.title-ref} on top, and updating the import/export
statements.

Another important point is that the translated module has an official
name: *\@web/file_a*. This is the actual name of the module. Every
relative imports will be converted as well. Every file located in an
Odoo addon `some_addon/static/src/path/to/file.js`{.interpreted-text
role="file"} will be assigned a name prefixed by the addon name like
this: *\@some_addon/path/to/file*.

Relative imports work, but only if the modules are in the same Odoo
addon. So, imagine that we have the following file structure:

    addons/
        web/
            static/
                src/
                    file_a.js
                    file_b.js
        stock/
            static/
                src/
                    file_c.js

The file `file_b`{.interpreted-text role="file"} can import
`file_a`{.interpreted-text role="file"} like this:

``` javascript
/** @odoo-module **/
import {something} from `./file_a`
```

But `file_c`{.interpreted-text role="file"} need to use the full name:

``` javascript
/** @odoo-module **/
import {something} from `@web/file_a`
```

### Aliased modules

Because `Odoo modules <frontend/modules/odoo_module>`{.interpreted-text
role="ref"} follow a different module naming pattern, a system exists to
allow a smooth transition towards the new system. Currently, if a file
is converted to a module (and therefore follow the new naming
convention), other files not yet converted to ES6-like syntax in the
project won\'t be able to require the module. Aliases are here to map
old names with new ones by creating a small proxy function. The module
can then be called by its new *and* old name.

To add such alias, the comment tag on top of the file should look like
this:

``` javascript
/** @odoo-module alias=web.someName**/
import { someFunction } from './file_b';

export default function otherFunction(val) {
    return someFunction(val + 3);
}
```

Then, the translated module will also create an alias with the requested
name:

``` javascript
odoo.define(`web.someName`, function(require) {
    return require('@web/file_a')[Symbol.for("default")];
});
```

The default behaviour of aliases is to re-export the `default` value of
the module they alias. This is because \"classic\" modules generally
export a single value which would be used directly, roughly matching the
semantics of default exports. However it is also possible to delegate
more directly, and follow the exact behaviour of the aliased module:

``` javascript
/** @odoo-module alias=web.someName default=0**/
import { someFunction } from './file_b';

export function otherFunction(val) {
    return someFunction(val + 3);
}
```

In that case, this will define an alias with exactly the values exported
by the original module:

``` javascript
odoo.define(`web.someName`, function(require) {
    return require('@web/file_a');
});
```

:::: note
::: title
Note
:::

Only one alias can be defined using this method. If you were to need
another one to have, for example, three names to call the same module,
you would have to add a proxy manually. This is not good practice and
should be avoided unless there is no other options.
::::

### Limitations

For performance reasons, Odoo does not use a full javascript parser to
transform native modules. There are, therefore, a number of limitations
including but not limited to:

- an [import]{.title-ref} or [export]{.title-ref} keyword cannot be
  preceded by a non-space character,

- a multiline comment or string cannot have a line starting by
  [import]{.title-ref} or [export]{.title-ref}

  ``` javascript
  // supported
  import X from "xxx";
  export X;
    export default X;
      import X from "xxx";

  /*
   * import X ...
   */

  /*
   * export X
   */


  // not supported

  var a= 1;import X from "xxx";
  /*
    import X ...
  */
  ```

- when you export an object, it can\'t contain a comment

  ``` javascript
  // supported
  export {
    a as b,
    c,
    d,
  }

  export {
    a
  } from "./file_a"


  // not supported
  export {
    a as b, // this is a comment
    c,
    d,
  }

  export {
    a /* this is a comment */
  } from "./file_a"
  ```

- Odoo needs a way to determine if a module is described by a path (like
  `./views/form_view`{.interpreted-text role="file"}) or a name (like
  [web.FormView]{.title-ref}). It has to use a heuristic to do just
  that: if there is a [/]{.title-ref} in the name, it is considered a
  path. This means that Odoo does not really support module names with a
  [/]{.title-ref} anymore.

As \"classic\" modules are not deprecated and there is currently no plan
to remove them, you can and should keep using them if you encounter
issues with, or are constrained by the limitations of, native modules.
Both styles can coexist within the same Odoo addon.

## Odoo Module System {#frontend/modules/odoo_module}

Odoo has defined a small module system (located in the file
`addons/web/static/src/js/boot.js`{.interpreted-text role="file"}, which
needs to be loaded first). The Odoo module system, inspired by AMD,
works by defining the function [define]{.title-ref} on the global odoo
object. We then define each javascript module by calling that function.
In the Odoo framework, a module is a piece of code that will be executed
as soon as possible. It has a name and potentially some dependencies.
When its dependencies are loaded, a module will then be loaded as well.
The value of the module is then the return value of the function
defining the module.

As an example, it may look like this:

``` javascript
// in file a.js
odoo.define('module.A', function (require) {
    "use strict";

    var A = ...;

    return A;
});

// in file b.js
odoo.define('module.B', function (require) {
    "use strict";

    var A = require('module.A');

    var B = ...; // something that involves A

    return B;
});
```

An alternative way to define a module is to give explicitly a list of
dependencies in the second argument.

``` javascript
odoo.define('module.Something', ['module.A', 'module.B'], function (require) {
    "use strict";

    var A = require('module.A');
    var B = require('module.B');

    // some code
});
```

If some dependencies are missing/non ready, then the module will simply
not be loaded. There will be a warning in the console after a few
seconds.

Note that circular dependencies are not supported. It makes sense, but
it means that one needs to be careful.

### Defining a module

The [odoo.define]{.title-ref} method is given three arguments:

- \`moduleName\`: the name of the javascript module. It should be a
  unique string. The convention is to have the name of the odoo addon
  followed by a specific description. For example,
  [web.Widget]{.title-ref} describes a module defined in the
  [web]{.title-ref} addon, which exports a [Widget]{.title-ref} class
  (because the first letter is capitalized)

  If the name is not unique, an exception will be thrown and displayed
  in the console.

- \`dependencies\`: the second argument is optional. If given, it should
  be a list of strings, each corresponding to a javascript module. This
  describes the dependencies that are required to be loaded before the
  module is executed. If the dependencies are not explicitly given here,
  then the module system will extract them from the function by calling
  toString on it, then using a regexp to find all the
  [require]{.title-ref} statements.

  ``` javascript
  odoo.define('module.Something', ['web.ajax'], function (require) {
      "use strict";

      var ajax = require('web.ajax');

      // some code here
      return something;
  });
  ```

- finally, the last argument is a function which defines the module. Its
  return value is the value of the module, which may be passed to other
  modules requiring it. Note that there is a small exception for
  asynchronous modules, see the next section.

If an error happens, it will be logged (in debug mode) in the console:

- \`Missing dependencies\`: These modules do not appear in the page. It
  is possible that the JavaScript file is not in the page or that the
  module name is wrong
- \`Failed modules\`: A javascript error is detected
- \`Rejected modules\`: The module returns a rejected Promise. It (and
  its dependent modules) is not loaded.
- \`Rejected linked modules\`: Modules who depend on a rejected module
- \`Non loaded modules\`: Modules who depend on a missing or a failed
  module

### Asynchronous modules

It can happen that a module needs to perform some work before it is
ready. For example, it could do an rpc to load some data. In that case,
the module can simply return a promise. The module system will simply
wait for the promise to complete before registering the module.

``` javascript
odoo.define('module.Something', function (require) {
    "use strict";

    var ajax = require('web.ajax');

    return ajax.rpc(...).then(function (result) {
        // some code here
        return something;
    });
});
```




--- SOURCE: developer/reference/frontend/javascript_reference.md ---

::: default-domain
js
:::

# Javascript Reference

This document presents the Odoo Javascript framework. This framework is
not a large application in term of lines of code, but it is quite
generic, because it is basically a machine to turn a declarative
interface description into a live application, able to interact with
every model and records in the database. It is even possible to use the
web client to modify the interface of the web client.

## Overview

The Javascript framework is designed to work with three main use cases:

- the *web client*: this is the private web application, where one can
  view and edit business data. This is a single page application (the
  page is never reloaded, only the new data is fetched from the server
  whenever it is needed)
- the *website*: this is the public part of Odoo. It allows an
  unidentified user to browse some content, to shop or to perform many
  actions, as a client. This is a classical website: various routes with
  controllers and some javascript to make it work.
- the *point of sale*: this is the interface for the point of sale. It
  is a specialized single page application.

Some javascript code is common to these three use cases, and is bundled
together (see below in the assets section). This document will focus
mostly on the web client design.

## Web client

### Single Page Application

In short, the *webClient*, instance of *WebClient* is the root component
of the whole user interface. Its responsibility is to orchestrate all
various subcomponents, and to provide services, such as rpcs, local
storage and more.

In runtime, the web client is a single page application. It does not
need to request a full page from the server each time the user perform
an action. Instead, it only requests what it needs, and then
replaces/updates the view. Also, it manages the url: it is kept in sync
with the web client state.

It means that while a user is working on Odoo, the web client class (and
the action manager) actually creates and destroys many sub components.
The state is highly dynamic, and each widget could be destroyed at any
time.

### Overview of web client JS code

Here, we give a very quick overview on the web client code, in the
*web/static/src/js* addon. Note that it is deliberately not exhaustive.
We only cover the most important files/folders.

- *boot.js*: this is the file that defines the module system. It needs
  to be loaded first.
- *core/*: this is a collection of lower level building blocks. Notably,
  it contains the class system, the widget system, concurrency
  utilities, and many other class/functions.
- *chrome/*: in this folder, we have most large widgets which make up
  most of the user interface.
- *chrome/abstract_web_client.js* and *chrome/web_client.js*: together,
  these files define the WebClient widget, which is the root widget for
  the web client.
- *chrome/action_manager.js*: this is the code that will convert an
  action into a widget (for example a kanban or a form view)
- *chrome/search_X.js* all these files define the search view (it is not
  a view in the point of view of the web client, only from the server
  point of view)
- *fields*: all main view field widgets are defined here
- *views*: this is where the views are located

### What to do if a file is not loaded/updated

There are many different reasons why a file may not be properly loaded.
Here are a few things you can try to solve the issue:

- once the server is started, it does not know if an asset file has been
  modified. So, you can simply restart the server to regenerate the
  assets.
- check the console (in the dev tools, usually opened with F12) to make
  sure there are no obvious errors
- try to add a [console.log()]{.title-ref} at the beginning of your file
  (before any module definition), so you can see if a file has been
  loaded or not
- when in any debug mode, there is an option in the debug manager menu
  (bug icon) to force the server to update its assets files.
- use the *debug=assets* mode. This will actually bypass the asset
  bundles (note that it does not actually solve the issue. The server
  still uses outdated bundles)
- finally, the most convenient way to do it, for a developer, is to
  start the server with the *\--dev=all* option. This activates the file
  watcher options, which will automatically invalidate assets when
  necessary. Note that it does not work very well if the OS is Windows.
- remember to refresh your page!
- or maybe to save your code file\...

:::: note
::: title
Note
:::

Once an asset file has been recreated, you need to refresh the page, to
reload the proper files (if that does not work, the files may be
cached).
::::

## Loading Javascript Code

Large applications are usually broken up into smaller files, that need
to be connected together. Some file may need to use some part of code
defined in another file. There are two ways of sharing code between
files:

- use the global scope (the *window* object) to write/read references to
  some objects or functions,
- use a module system that will provide a way for each modules to export
  or import values, and will make sure that they are loaded in a proper
  order.

While it\'s possible to work in the global scope, this has a number of
issues:

It is difficult to ensure that implementation details are not exposed by
work done in the global scope directly.

- Dependencies are implicit, leading to fragile and unreliable load
  ordering.
- The lack of insight into execution means it\'s impossible to use
  various optimisations (e.g. deferred and asynchronous loading).
- Module systems help resolve these issues: because modules specify
  their dependencies the module system can ensure the necessary order of
  loading is respected, and because modules can precisely specify their
  exports it is less likely that they will leak implementation details.

For most Odoo code, we want to use a module system. Because of the way
assets work in Odoo (and in particular, the fact that each installed
odoo addon can modify the list of files contained in a bundle), Odoo has
to resolve modules browser side. To do that, Odoo provides a small
module system described just below (see
`frontend/modules/odoo_module`{.interpreted-text role="ref"}).

However, Odoo also provides support for native javascript modules (see
`frontend/modules/native_js`{.interpreted-text role="ref"}). These
modules will simply be translated by the server into odoo modules. It is
encouraged to write all javascript code as a native module, for a better
IDE integration. In the future, the Odoo module system should be
considered an implementation detail, not the primary way to write
javascript code.

:::: note
::: title
Note
:::

Native javascript modules are the primary way to define javascript code.
::::

## Class System

Odoo was developed before ECMAScript 6 classes were available. In
Ecmascript 5, the standard way to define a class is to define a function
and to add methods on its prototype object. This is fine, but it is
slightly complex when we want to use inheritance, mixins.

For these reasons, Odoo decided to use its own class system, inspired by
John Resig. The base Class is located in *web.Class*, in the file
*class.js*.

> Note that the custom class system should be avoided for creating new
> code. It will be deprecated at some point, and then removed. New
> classes should use the standard ES6 class system.

### Creating a subclass

Let us discuss how classes are created. The main mechanism is to use the
*extend* method (this is more or less the equivalent of *extend* in ES6
classes).

``` javascript
var Class = require('web.Class');

var Animal = Class.extend({
    init: function () {
        this.x = 0;
        this.hunger = 0;
    },
    move: function () {
        this.x = this.x + 1;
        this.hunger = this.hunger + 1;
    },
    eat: function () {
        this.hunger = 0;
    },
});
```

In this example, the *init* function is the constructor. It will be
called when an instance is created. Making an instance is done by using
the *new* keyword.

### Inheritance

It is convenient to be able to inherit an existing class. This is simply
done by using the *extend* method on the superclass. When a method is
called, the framework will secretly rebind a special method: *\_super*
to the currently called method. This allows us to use *this.\_super*
whenever we need to call a parent method.

``` javascript
var Animal = require('web.Animal');

var Dog = Animal.extend({
    move: function () {
        this.bark();
        this._super.apply(this, arguments);
    },
    bark: function () {
        console.log('woof');
    },
});

var dog = new Dog();
dog.move()
```

### Mixins

The odoo Class system does not support multiple inheritance, but for
those cases when we need to share some behaviour, we have a mixin
system: the *extend* method can actually take an arbitrary number of
arguments, and will combine all of them in the new class.

``` javascript
var Animal = require('web.Animal');
var DanceMixin = {
    dance: function () {
        console.log('dancing...');
    },
};

var Hamster = Animal.extend(DanceMixin, {
    sleep: function () {
        console.log('sleeping');
    },
});
```

In this example, the *Hamster* class is a subclass of Animal, but it
also mix the DanceMixin in.

### Patching an existing class

It is not common, but we sometimes need to modify another class *in
place*. The goal is to have a mechanism to change a class and all
future/present instances. This is done by using the *include* method:

``` javascript
var Hamster = require('web.Hamster');

Hamster.include({
    sleep: function () {
        this._super.apply(this, arguments);
        console.log('zzzz');
    },
});
```

This is obviously a dangerous operation and should be done with care.
But with the way Odoo is structured, it is sometimes necessary in one
addon to modify the behavior of a widget/class defined in another addon.
Note that it will modify all instances of the class, even if they have
already been created.

## Widgets

The *Widget* class is really an important building block of the user
interface. Pretty much everything in the user interface is under the
control of a widget. The Widget class is defined in the module
*web.Widget*, in *widget.js*.

In short, the features provided by the Widget class include:

- parent/child relationships between widgets (*PropertiesMixin*)
- extensive lifecycle management with safety features (e.g.
  automatically destroying children widgets during the destruction of a
  parent)
- automatic rendering with `qweb <reference/qweb>`{.interpreted-text
  role="ref"}
- various utility functions to help interacting with the outside
  environment.

Here is an example of a basic counter widget:

``` javascript
var Widget = require('web.Widget');

var Counter = Widget.extend({
    template: 'some.template',
    events: {
        'click button': '_onClick',
    },
    init: function (parent, value) {
        this._super(parent);
        this.count = value;
    },
    _onClick: function () {
        this.count++;
        this.$('.val').text(this.count);
    },
});
```

For this example, assume that the template *some.template* (and is
properly loaded: the template is in a file, which is properly defined in
the assets of the module manifest
`'assets': {'web.assets_qweb': [...]}`, see
`assets <reference/assets>`{.interpreted-text role="ref"}.) is given by:

``` xml
<div t-name="some.template">
    <span class="val"><t t-esc="widget.count"/></span>
    <button>Increment</button>
</div>
```

This example widget can be used in the following manner:

``` javascript
// Create the instance
var counter = new Counter(this, 4);
// Render and insert into DOM
counter.appendTo(".some-div");
```

This example illustrates a few of the features of the *Widget* class,
including the event system, the template system, the constructor with
the initial *parent* argument.

### Widget Lifecycle

Like many component systems, the widget class has a well defined
lifecycle. The usual lifecycle is the following: *init* is called, then
*willStart*, then the rendering takes place, then *start* and finally
*destroy*.

::: function
Widget.init(parent)

this is the constructor. The init method is supposed to initialize the
base state of the widget. It is synchronous and can be overridden to
take more parameters from the widget\'s creator/parent

param parent
:   the new widget\'s parent, used to handle automatic destruction and
    event propagation. Can be `null` for the widget to have no parent.

type parent
:   `~Widget`{.interpreted-text role="class"}
:::

::: function
Widget.willStart()

this method will be called once by the framework when a widget is
created and in the process of being appended to the DOM. The *willStart*
method is a hook that should return a promise. The JS framework will
wait for this promise to complete before moving on to the rendering
step. Note that at this point, the widget does not have a DOM root
element. The *willStart* hook is mostly useful to perform some
asynchronous work, such as fetching data from the server
:::

::: function
\[Rendering\]

This step is automatically done by the framework. What happens is that
the framework checks if a template key is defined on the widget. If that
is the case, then it will render that template with the *widget* key
bound to the widget in the rendering context (see the example above: we
use *widget.count* in the QWeb template to read the value from the
widget). If no template is defined, we read the *tagName* key and create
a corresponding DOM element. When the rendering is done, we set the
result as the \$el property of the widget. After this, we automatically
bind all events in the events and custom_events keys.
:::

::: function
Widget.start()

when the rendering is complete, the framework will automatically call
the *start* method. This is useful to perform some specialized
post-rendering work. For example, setting up a library.

Must return a promise to indicate when its work is done.

returns
:   promise
:::

::: function
Widget.destroy()

This is always the final step in the life of a widget. When a widget is
destroyed, we basically perform all necessary cleanup operations:
removing the widget from the component tree, unbinding all events, \...

Automatically called when the widget\'s parent is destroyed, must be
called explicitly if the widget has no parent or if it is removed but
its parent remains.
:::

Note that the willStart and start method are not necessarily called. A
widget can be created (the *init* method will be called) and then
destroyed (*destroy* method) without ever having been appended to the
DOM. If that is the case, the willStart and start will not even be
called.

### Widget API

::: attribute
Widget.tagName

Used if the widget has no template defined. Defaults to `div`, will be
used as the tag name to create the DOM element to set as the widget\'s
DOM root. It is possible to further customize this generated DOM root
with the following attributes:
:::

::: attribute
Widget.id

Used to generate an `id` attribute on the generated DOM root. Note that
this is rarely needed, and is probably not a good idea if a widget can
be used more than once.
:::

::: attribute
Widget.className

Used to generate a `class` attribute on the generated DOM root. Note
that it can actually contain more than one css class: *\'some-class
other-class\'*
:::

::: attribute
Widget.attributes

Mapping (object literal) of attribute names to attribute values. Each of
these k:v pairs will be set as a DOM attribute on the generated DOM
root.
:::

::: attribute
Widget.el

raw DOM element set as root to the widget (only available after the
start lifecycle method)
:::

::: attribute
Widget.\$el

jQuery wrapper around `~Widget.el`{.interpreted-text role="attr"}. (only
available after the start lifecycle method)
:::

::: attribute
Widget.template

Should be set to the name of a
`QWeb template <reference/qweb>`{.interpreted-text role="ref"}. If set,
the template will be rendered after the widget has been initialized but
before it has been started. The root element generated by the template
will be set as the DOM root of the widget.
:::

::: attribute
Widget.xmlDependencies

List of paths to xml files that need to be loaded before the widget can
be rendered. This will not induce loading anything that has already been
loaded. This is useful when you want to load your templates lazily, or
if you want to share a widget between the website and the web client
interface.

``` javascript
var EditorMenuBar = Widget.extend({
    xmlDependencies: ['/web_editor/static/src/xml/editor.xml'],
    ...
```
:::

::: attribute
Widget.events

Events are a mapping of an event selector (an event name and an optional
CSS selector separated by a space) to a callback. The callback can be
the name of a widget\'s method or a function object. In either case, the
`this` will be set to the widget:

``` javascript
events: {
    'click p.oe_some_class a': 'some_method',
    'change input': function (e) {
        e.stopPropagation();
    }
},
```

The selector is used for jQuery\'s event delegation, the callback will
only be triggered for descendants of the DOM root matching the selector.
If the selector is left out (only an event name is specified), the event
will be set directly on the widget\'s DOM root.

Note: the use of an inline function is discouraged, and will probably be
removed sometimes in the future.
:::

::: attribute
Widget.custom_events

this is almost the same as the *events* attribute, but the keys are
arbitrary strings. They represent business events triggered by some sub
widgets. When an event is triggered, it will \'bubble up\' the widget
tree (see the section on component communication for more details).
:::

::: function
Widget.isDestroyed()

returns
:   `true` if the widget is being or has been destroyed, `false`
    otherwise
:::

::::: function
Widget.\$(selector)

Applies the CSS selector specified as parameter to the widget\'s DOM
root:

``` javascript
this.$(selector);
```

is functionally identical to:

``` javascript
this.$el.find(selector);
```

param String selector
:   CSS selector

returns
:   jQuery object

:::: note
::: title
Note
:::

this helper method is similar to `Backbone.View.$`
::::
:::::

::: function
Widget.setElement(element)

Re-sets the widget\'s DOM root to the provided element, also handles
re-setting the various aliases of the DOM root as well as unsetting and
re-setting delegated events.

param Element element
:   a DOM element or jQuery object to set as the widget\'s DOM root
:::

### Inserting a widget in the DOM

::: function
Widget.appendTo(element)

Renders the widget and inserts it as the last child of the target, uses
[.appendTo()](https://api.jquery.com/appendTo/)
:::

::: function
Widget.prependTo(element)

Renders the widget and inserts it as the first child of the target, uses
[.prependTo()](https://api.jquery.com/prependTo/)
:::

::: function
Widget.insertAfter(element)

Renders the widget and inserts it as the preceding sibling of the
target, uses [.insertAfter()](https://api.jquery.com/insertAfter/)
:::

::: function
Widget.insertBefore(element)

Renders the widget and inserts it as the following sibling of the
target, uses [.insertBefore()](https://api.jquery.com/insertBefore/)
:::

All of these methods accept whatever the corresponding jQuery method
accepts (CSS selectors, DOM nodes or jQuery objects). They all return a
promise and are charged with three tasks:

- rendering the widget\'s root element via
  `~Widget.renderElement`{.interpreted-text role="func"}
- inserting the widget\'s root element in the DOM using whichever jQuery
  method they match
- starting the widget, and returning the result of starting it

### Widget Guidelines

- Identifiers (`id` attribute) should be avoided. In generic
  applications and modules, `id` limits the re-usability of components
  and tends to make code more brittle. Most of the time, they can be
  replaced with nothing, classes or keeping a reference to a DOM node or
  jQuery element.

  If an `id` is absolutely necessary (because a third-party library
  requires one), the id should be partially generated using
  `_.uniqueId()` e.g.:

  ``` javascript
  this.id = _.uniqueId('my-widget-');
  ```

- Avoid predictable/common CSS class names. Class names such as
  \"content\" or \"navigation\" might match the desired
  meaning/semantics, but it is likely an other developer will have the
  same need, creating a naming conflict and unintended behavior. Generic
  class names should be prefixed with e.g. the name of the component
  they belong to (creating \"informal\" namespaces, much as in C or
  Objective-C).

- Global selectors should be avoided. Because a component may be used
  several times in a single page (an example in Odoo is dashboards),
  queries should be restricted to a given component\'s scope. Unfiltered
  selections such as `$(selector)` or
  `document.querySelectorAll(selector)` will generally lead to
  unintended or incorrect behavior. Odoo Web\'s
  `~Widget`{.interpreted-text role="class"} has an attribute providing
  its DOM root (`~Widget.$el`{.interpreted-text role="attr"}), and a
  shortcut to select nodes directly (`~Widget.$`{.interpreted-text
  role="func"}).

- More generally, never assume your components own or controls anything
  beyond its own personal `~Widget.$el`{.interpreted-text role="attr"}
  (so, avoid using a reference to the parent widget)

- Html templating/rendering should use QWeb unless absolutely trivial.

- All interactive components (components displaying information to the
  screen or intercepting DOM events) must inherit from
  `~Widget`{.interpreted-text role="class"} and correctly implement and
  use its API and life cycle.

- Make sure to wait for start to be finished before using \$el e.g.:

  > ``` javascript
  > var Widget = require('web.Widget');
  >
  > var AlmostCorrectWidget = Widget.extend({
  >     start: function () {
  >         this.$el.hasClass(....) // in theory, $el is already set, but you don't know what the parent will do with it, better call super first
  >         return this._super.apply(arguments);
  >     },
  > });
  >
  > var IncorrectWidget = Widget.extend({
  >     start: function () {
  >         this._super.apply(arguments); // the parent promise is lost, nobody will wait for the start of this widget
  >         this.$el.hasClass(....)
  >     },
  > });
  >
  > var CorrectWidget = Widget.extend({
  >     start: function () {
  >         var self = this;
  >         return this._super.apply(arguments).then(function() {
  >             self.$el.hasClass(....) // this works, no promise is lost and the code executes in a controlled order: first super, then our code.
  >         });
  >     },
  > });
  > ```

## QWeb Template Engine {#reference/javascript_reference/qweb}

The web client uses the `qweb`{.interpreted-text role="doc"} template
engine to render widgets (unless they override the *renderElement*
method to do something else). The Qweb JS template engine is based on
XML, and is mostly compatible with the python implementation.

Now, let us explain how the templates are loaded. Whenever the web
client starts, a rpc is made to the */web/webclient/qweb* route. The
server will then return a list of all templates defined in data files
for each installed modules. The correct files are listed in the
*web.assets_qweb* entry in each module manifest. It is also possible to
lazy-load another bundle\'s templates by calling this same route and
giving it the corresponding \"bundle\" query parameter.

The web client will wait for that list of template to be loaded, before
starting its first widget.

This mechanism works quite well for our needs, but sometimes, we want to
lazy load a template. For example, imagine that we have a widget which
is rarely used. In that case, maybe we prefer to not load its template
in the main file, in order to make the web client slightly lighter. In
that case, we can use the *xmlDependencies* key of the Widget:

``` javascript
var Widget = require('web.Widget');

var Counter = Widget.extend({
    template: 'some.template',
    xmlDependencies: ['/myaddon/path/to/my/file.xml'],

    ...

});
```

With this, the *Counter* widget will load the xmlDependencies files in
its *willStart* method, so the template will be ready when the rendering
is performed.

## Event system

There are currently two event systems supported by Odoo: a simple system
which allows adding listeners and triggering events, and a more complete
system that also makes events \'bubble up\'.

Both of these event systems are implemented in the
*EventDispatcherMixin*, in the file *mixins.js*. This mixin is included
in the *Widget* class.

### Base Event system

This event system was historically the first. It implements a simple bus
pattern. We have 4 main methods:

- *on*: this is used to register a listener on an event.
- *off*: useful to remove events listener.
- *once*: this is used to register a listener that will only be called
  once.
- *trigger*: trigger an event. This will cause each listeners to be
  called.

Here is an example on how this event system could be used:

``` javascript
var Widget = require('web.Widget');
var Counter = require('myModule.Counter');

var MyWidget = Widget.extend({
    start: function () {
        this.counter = new Counter(this);
        this.counter.on('valuechange', this, this._onValueChange);
        var def = this.counter.appendTo(this.$el);
        return Promise.all([def, this._super.apply(this, arguments)]);
    },
    _onValueChange: function (val) {
        // do something with val
    },
});

// in Counter widget, we need to call the trigger method:

... this.trigger('valuechange', someValue);
```

:::: warning
::: title
Warning
:::

the use of this event system is discouraged, we plan to replace each
*trigger* method by the *trigger_up* method from the extended event
system
::::

### Extended Event System

The custom event widgets is a more advanced system, which mimic the DOM
events API. Whenever an event is triggered, it will \'bubble up\' the
component tree, until it reaches the root widget, or is stopped.

- *trigger_up*: this is the method that will create a small *OdooEvent*
  and dispatch it in the component tree. Note that it will start with
  the component that triggered the event
- *custom_events*: this is the equivalent of the *event* dictionary, but
  for odoo events.

The OdooEvent class is very simple. It has three public attributes:
*target* (the widget that triggered the event), *name* (the event name)
and *data* (the payload). It also has 2 methods: *stopPropagation* and
*is_stopped*.

The previous example can be updated to use the custom event system:

``` javascript
var Widget = require('web.Widget');
var Counter = require('myModule.Counter');

var MyWidget = Widget.extend({
    custom_events: {
        valuechange: '_onValueChange'
    },
    start: function () {
        this.counter = new Counter(this);
        var def = this.counter.appendTo(this.$el);
        return Promise.all([def, this._super.apply(this, arguments)]);
    },
    _onValueChange: function(event) {
        // do something with event.data.val
    },
});

// in Counter widget, we need to call the trigger_up method:

... this.trigger_up('valuechange', {value: someValue});
```

## Registries

A common need in the Odoo ecosystem is to extend/change the behaviour of
the base system from the outside (by installing an application, i.e. a
different module). For example, one may need to add a new widget type in
some views. In that case, and many others, the usual process is to
create the desired component, then add it to a registry (registering
step), to make the rest of the web client aware of its existence.

There are a few registries available in the system:

field registry (exported by `web.field_registry`{.interpreted-text role="js:data"})

:   The field registry contains all field widgets known to the web
    client. Whenever a view (typically form or list/kanban) needs a
    field widget, this is where it will look. A typical use case look
    like this:

    ``` javascript
    var fieldRegistry = require('web.field_registry');

    var FieldPad = ...;

    fieldRegistry.add('pad', FieldPad);
    ```

    Note that each value should be a subclass of *AbstractField*

view registry

:   This registry contains all JS views known to the web client (and in
    particular, the view manager). Each value of this registry should be
    a subclass of *AbstractView*.

action registry

:   We keep track of all client actions in this registry. This is where
    the action manager looks up whenever it needs to create a client
    action. In version 11, each value should simply be a subclass of
    *Widget*. However, in version 12, the values are required to be
    *AbstractAction*.

## Communication between widgets

There are many ways to communicate between components.

From a parent to its child

:   This is a simple case. The parent widget can simply call a method on
    its child:

    ``` javascript
    this.someWidget.update(someInfo);
    ```

From a widget to its parent/some ancestor

:   In this case, the widget\'s job is simply to notify its environment
    that something happened. Since we do not want the widget to have a
    reference to its parent (this would couple the widget with its
    parent\'s implementation), the best way to proceed is usually to
    trigger an event, which will bubble up the component tree, by using
    the `trigger_up` method:

    ``` javascript
    this.trigger_up('open_record', { record: record, id: id});
    ```

    This event will be triggered on the widget, then will bubble up and
    be eventually caught by some upstream widget:

    ``` javascript
    var SomeAncestor = Widget.extend({
        custom_events: {
            'open_record': '_onOpenRecord',
        },
        _onOpenRecord: function (event) {
            var record = event.data.record;
            var id = event.data.id;
            // do something with the event.
        },
    });
    ```

Cross component

:   Cross component communication can be achieved by using a bus. This
    is not the preferred form of communication, because it has the
    disadvantage of making the code harder to maintain. However, it has
    the advantage of decoupling the components. In that case, this is
    simply done by triggering and listening to events on a bus. For
    example:

    ``` javascript
    // in WidgetA
    var core = require('web.core');

    var WidgetA = Widget.extend({
        ...
        start: function () {
            core.bus.on('barcode_scanned', this, this._onBarcodeScanned);
        },
    });

    // in WidgetB
    var WidgetB = Widget.extend({
        ...
        someFunction: function (barcode) {
            core.bus.trigger('barcode_scanned', barcode);
        },
    });

    In this example, we use the bus exported by *web.core*, but this is not
    required. A bus could be created for a specific purpose.
    ```

## Services

In version 11.0, we introduced the notion of *service*. The main idea is
to give to sub components a controlled way to access their environment,
in a way that allow the framework enough control, and which is testable.

The service system is organized around three ideas: services, service
providers and widgets. The way it works is that widgets trigger (with
*trigger_up*) events, these events bubble up to a service provider,
which will ask a service to perform a task, then maybe return an answer.

### Service

A service is an instance of the *AbstractService* class. It basically
only has a name and a few methods. Its job is to perform some work,
typically something depending on the environment.

For example, we have the *ajax* service (job is to perform a rpc), the
*localStorage* (interact with the browser local storage) and many
others.

Here is a simplified example on how the ajax service is implemented:

``` javascript
var AbstractService = require('web.AbstractService');

var AjaxService = AbstractService.extend({
    name: 'ajax',
    rpc: function (...) {
        return ...;
    },
});
```

This service is named \'ajax\' and define one method, *rpc*.

### Service Provider

For services to work, it is necessary that we have a service provider
ready to dispatch the custom events. In the *backend* (web client), this
is done by the main web client instance. Note that the code for the
service provider comes from the *ServiceProviderMixin*.

### Widget

The widget is the part that requests a service. In order to do that, it
simply triggers an event *call_service* (typically by using the helper
function *call*). This event will bubble up and communicate the intent
to the rest of the system.

In practice, some functions are so frequently called that we have some
helpers functions to make them easier to use. For example, the *\_rpc*
method is a helper that helps making a rpc.

``` javascript
var SomeWidget = Widget.extend({
    _getActivityModelViewID: function (model) {
        return this._rpc({
            model: model,
            method: 'get_activity_view_id'
        });
    },
});
```

:::: warning
::: title
Warning
:::

If a widget is destroyed, it will be detached from the main component
tree and will not have a parent. In that case, the events will not
bubble up, which means that the work will not be done. This is usually
exactly what we want from a destroyed widget.
::::

### RPCs

The rpc functionality is supplied by the ajax service. But most people
will probably only interact with the *\_rpc* helpers.

There are typically two usecases when working on Odoo: one may need to
call a method on a (python) model (this goes through a controller
*call_kw*), or one may need to directly call a controller (available on
some route).

- Calling a method on a python model:

``` javascript
return this._rpc({
    model: 'some.model',
    method: 'some_method',
    args: [some, args],
});
```

- Directly calling a controller:

``` javascript
return this._rpc({
    route: '/some/route/',
    params: { some: kwargs},
});
```

## Notifications

The Odoo framework has a standard way to communicate various information
to the user: notifications, which are displayed on the top right of the
user interface.

There are two types of notifications:

- *notification*: useful to display some feedback. For example, whenever
  a user unsubscribed to a channel.
- *warning*: useful to display some important/urgent information.
  Typically most kind of (recoverable) errors in the system.

Also, notifications can be used to ask a question to the user without
disturbing its workflow. Imagine a phone call received through VOIP: a
sticky notification could be displayed with two buttons *Accept* and
*Decline*.

### Notification system

The notification system in Odoo is designed with the following
components:

- a *Notification* widget: this is a simple widget that is meant to be
  created and displayed with the desired information
- a *NotificationService*: a service whose responsibility is to create
  and destroy notifications whenever a request is done (with a
  custom_event). Note that the web client is a service provider.
- a client action *display_notification*: this allows to trigger the
  display of a notification from python (e.g. in the method called when
  the user clicked on a button of type object).
- an helper function in *ServiceMixin*: *displayNotification*

### Displaying a notification

The most common way to display a notification is by using the method
that come from the *ServiceMixin*:

- 

  *displayNotification(options)*:

  :   Display a notification with the following *options*:

      - *title*: string, optional. This will be displayed on the top as
        a title.
      - *subtitle*: string, optional. This will be displayed on the top
        as a subtitle.
      - *message*: string, optional. The content of the notification. Do
        not forget to escape your message via the markup function if
        needed.
      - *sticky*: boolean, optional (default false). If true, the
        notification will stay until the user dismisses it. Otherwise,
        the notification will be automatically closed after a short
        delay.
      - *type*: string, optional (default \'warning\'). Determines the
        style of the notification. Possible values: \'info\',
        \'success\', \'warning\', \'danger\', \'\'.
      - *className*: string, optional. This is a css class name that
        will be automatically added to the notification. This could be
        useful for styling purpose, even though its use is discouraged.

Here are two examples on how to use these methods:

``` javascript
// note that we call _t on the text to make sure it is properly translated.
this.displayNotification({
    title: _t("Success"),
    message: _t("Your signature request has been sent.")
});
this.displayNotification({
    title: _t("Error"),
    message: _t("Filter name is required."),
    type: 'danger',
});
```

Here an example in python:

``` python
# note that we call _(string) on the text to make sure it is properly translated.
def show_notification(self):
    return {
        'type': 'ir.actions.client',
        'tag': 'display_notification',
        'params': {
            'title': _('Success'),
            'message': _('Your signature request has been sent.'),
            'sticky': False,
        }
    }
```

## Systray

The Systray is the right part of the menu bar in the interface, where
the web client displays a few widgets, such as a messaging menu.

When the SystrayMenu is created by the menu, it will look for all
registered widgets and add them as a sub widget at the proper place.

There is currently no specific API for systray widgets. They are
supposed to be simple widgets, and can communicate with their
environment just like other widgets with the *trigger_up* method.

### Adding a new Systray Item

There is no systray registry. The proper way to add a widget is to add
it to the class variable SystrayMenu.items.

``` javascript
var SystrayMenu = require('web.SystrayMenu');

var MySystrayWidget = Widget.extend({
    ...
});

SystrayMenu.Items.push(MySystrayWidget);
```

### Ordering

Before adding the widget to himself, the Systray Menu will sort the
items by a sequence property. If that property is not present on the
prototype, it will use 50 instead. So, to position a systray item to be
on the right, one can set a very high sequence number (and conversely, a
low number to put it on the left).

``` javascript
MySystrayWidget.prototype.sequence = 100;
```

## Translation management

Some translations are made on the server side (basically all text
strings rendered or processed by the server), but there are strings in
the static files that need to be translated. The way it currently works
is the following:

- each translatable string is tagged with the special function *\_t*
  (available in the JS module *web.core*
- these strings are used by the server to generate the proper PO files
- whenever the web client is loaded, it will call the route
  */web/webclient/translations*, which returns a list of all
  translatable terms
- in runtime, whenever the function *\_t* is called, it will look up in
  this list in order to find a translation, and return it or the
  original string if none is found.

Note that translations are explained in more details, from the server
point of view, in the document
`/developer/howtos/translations`{.interpreted-text role="doc"}.

There are two important functions for the translations in javascript:
*\_t* and *\_lt*. The difference is that *\_lt* is lazily evaluated.

``` javascript
var core = require('web.core');

var _t = core._t;
var _lt = core._lt;

var SomeWidget = Widget.extend({
    exampleString: _lt('this should be translated'),
    ...
    someMethod: function () {
        var str = _t('some text');
        ...
    },
});
```

In this example, the *\_lt* is necessary because the translations are
not ready when the module is loaded.

Note that translation functions need some care. The string given in
argument should not be dynamic.

## Session

There is a specific module provided by the web client which contains
some information specific to the user current *session*. Some notable
keys are

- uid: the current user ID (its ID as a *res.users*)
- user_name: the user name, as a string
- the user context (user ID, language and timezone)
- partner_id: the ID of the partner associated to the current user
- db: the name of the database currently being in use

### Adding information to the session

When the /web route is loaded, the server will inject some session
information in the template a script tag. The information will be read
from the method *session_info* of the model *ir.http*. So, if one wants
to add a specific information, it can be done by overriding the
session_info method and adding it to the dictionary.

``` python
from odoo import models
from odoo.http import request


class IrHttp(models.AbstractModel):
    _inherit = 'ir.http'

    def session_info(self):
        result = super(IrHttp, self).session_info()
        result['some_key'] = get_some_value_from_db()
        return result
```

Now, the value can be obtained in javascript by reading it in the
session:

``` javascript
var session = require('web.session');
var myValue = session.some_key;
...
```

Note that this mechanism is designed to reduce the amount of
communication needed by the web client to be ready. It is more
appropriate for data which is cheap to compute (a slow session_info call
will delay the loading for the web client for everyone), and for data
which is required early in the initialization process.

## Views

The word \'view\' has more than one meaning. This section is about the
design of the javascript code of the views, not the structure of the
*arch* or anything else.

In 2017, Odoo replaced the previous view code with a new architecture.
The main need was to separate the rendering logic from the model logic.

Views (in a generic sense) are now described with 4 pieces: a View, a
Controller, a Renderer and a Model. The API of these 4 pieces is
described in the AbstractView, AbstractController, AbstractRenderer and
AbstractModel classes.

<svg width="550" height="173">
    <!-- Created with Method Draw - https://github.com/duopixel/Method-Draw/ -->
    <path id="svg_1" d="m147.42498,79.79206c0.09944,-8.18859 -0.06363,-16.38812 0.81774,-24.5623c21.65679,2.68895 43.05815,7.08874 64.35,11.04543c1.14304,-4.01519 0.60504,-7.34585 1.59817,-11.05817c13.67878,7.81176 27.23421,15.73476 40.23409,24.03505c-12.47212,9.41539 -26.77809,17.592 -40.82272,25.96494c-0.4548,-3.89916 -0.90967,-7.79828 -1.36448,-11.69744c-20.69972,3.77225 -42.59036,7.6724 -63.42391,11.12096c-1.41678,-7.95741 -1.37514,-16.62327 -1.38888,-24.84846z" stroke-width="1.5" stroke="#000" fill="#fff"/>
    <rect id="svg_3" height="41" width="110" y="57.5" x="7" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#fff"/>
    <rect stroke="#000" id="svg_5" height="41" width="135" y="20.5" x="328" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <rect stroke="#000" id="svg_6" height="41" width="128" y="102.5" x="262" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <rect stroke="#000" id="svg_7" height="41" width="119" y="100.5" x="417" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" fill="#fff"/>
    <line stroke-linecap="null" stroke-linejoin="null" id="svg_8" y2="96.5" x2="317" y1="65.5" x1="364" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
    <line stroke-linecap="null" stroke-linejoin="null" id="svg_9" y2="96.5" x2="467" y1="63.5" x1="425" fill-opacity="null" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="none"/>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_10" y="83.5" x="38" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">View</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_11" y="44.5" x="346" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Controller</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_12" y="128.5" x="276" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Renderer</text>
    <text xml:space="preserve" text-anchor="start" font-family="Helvetica, Arial, sans-serif" font-size="24" id="svg_13" y="127.5" x="442" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#000000">Model</text>
</svg>

- the View is the factory. Its job is to get a set of fields, arch,
  context and some other parameters, then to construct a
  Controller/Renderer/Model triplet.

  The view\'s role is to properly setup each piece of the MVC pattern,
  with the correct information. Usually, it has to process the arch
  string and extract the data necessary for each other parts of the
  view.

  Note that the view is a class, not a widget. Once its job has been
  done, it can be discarded.

- the Renderer has one job: representing the data being viewed in a DOM
  element. Each view can render the data in a different way. Also, it
  should listen on appropriate user actions and notify its parent (the
  Controller) if necessary.

  The Renderer is the V in the MVC pattern.

- the Model: its job is to fetch and hold the state of the view.
  Usually, it represents in some way a set of records in the database.
  The Model is the owner of the \'business data\'. It is the M in the
  MVC pattern.

- the Controller: its job is to coordinate the renderer and the model.
  Also, it is the main entry point for the rest of the web client. For
  example, when the user changes something in the search view, the
  *update* method of the controller will be called with the appropriate
  information.

  It is the C in the MVC pattern.

:::: note
::: title
Note
:::

The JS code for the views has been designed to be usable outside of the
context of a view manager/action manager. They could be used in a client
action, or, they could be displayed in the public website (with some
work on the assets).
::::

## Field Widgets {#reference/js/widgets}

A good part of the web client experience is about editing and creating
data. Most of that work is done with the help of field widgets, which
are aware of the field type and of the specific details on how a value
should be displayed and edited.

### AbstractField

The *AbstractField* class is the base class for all widgets in a view,
for all views that support them (currently: Form, List, Kanban).

There are many differences between the v11 field widgets and the
previous versions. Let us mention the most important ones:

- the widgets are shared between all views (well, Form/List/Kanban). No
  need to duplicate the implementation anymore. Note that it is possible
  to have a specialized version of a widget for a view, by prefixing it
  with the view name in the view registry: *list.many2one* will be
  chosen in priority over *many2one*.
- the widgets are no longer the owner of the field value. They only
  represent the data and communicate with the rest of the view.
- the widgets do no longer need to be able to switch between edit and
  readonly mode. Now, when such a change is necessary, the widget will
  be destroyed and rerendered again. It is not a problem, since they do
  not own their value anyway
- the field widgets can be used outside of a view. Their API is slightly
  awkward, but they are designed to be standalone.

### Decorations

Like the list view, field widgets have a simple support for decorations.
The goal of decorations is to have a simple way to specify a text color
depending on the record current state. For example,

``` xml
<field name="state" decoration-danger="amount &lt; 10000"/>
```

The valid decoration names are:

- decoration-bf
- decoration-it
- decoration-danger
- decoration-info
- decoration-muted
- decoration-primary
- decoration-success
- decoration-warning

Each decoration *decoration-X* will be mapped to a css class *text-X*,
which is a standard bootstrap css class (except for *text-it* and
*text-bf*, which are handled by odoo and correspond to italic and bold,
respectively). Note that the value of the decoration attribute should be
a valid python expression, which will be evaluated with the record as
evaluation context.

### Non relational fields

We document here all non relational fields available by default, in no
particular order.

integer (FieldInteger)

:   This is the default field type for fields of type *integer*.

    - Supported field types: *integer*

      Options:

      - type: setting the input type (*text* by default, can be set on
        *number*)

      On edit mode, the field is rendered as an input with the HTML
      attribute type set on *number* (so user can benefit the native
      support, especially on mobile). In this case, the default
      formatting is disabled to avoid incompability.

      ``` xml
      <field name="int_value" options='{"type": "number"}'/>
      ```

      - step: set the step to the value up and down when the user click
        on buttons (only for input of type number, 1 by default)

      ``` xml
      <field name="int_value" options='{"type": "number", "step": 100}'/>
      ```

      - format: should the number be formatted. (true by default)

      By default, numbers are formatted according to locale parameters.

      :   This option will prevent the field\'s value from being
          formatted.

      ``` xml
      <field name="int_value" options='{"format": false}'/>
      ```

float (FieldFloat)

:   This is the default field type for fields of type *float*.

    - Supported field types: *float*

    Attributes:

    - digits: displayed precision

    ``` xml
    <field name="factor" digits="[42,5]"/>
    ```

    Options:

    - type: setting the input type (*text* by default, can be set on
      *number*)

    On edit mode, the field is rendered as an input with the HTML
    attribute type set on *number* (so user can benefit the native
    support, especially on mobile). In this case, the default formatting
    is disabled to avoid incompability.

    ``` xml
    <field name="int_value" options='{"type": "number"}'/>
    ```

    - 

      step: set the step to the value up and down when the user click on buttons

      :   (only for input of type number, 1 by default)

    ``` xml
    <field name="int_value" options='{"type": "number", "step": 0.1}'/>
    ```

    - format: should the number be formatted. (true by default)

    By default, numbers are formatted according to locale parameters.

    :   This option will prevent the field\'s value from being
        formatted.

    ``` xml
    <field name="int_value" options='{"format": false}'/>
    ```

float_time (FieldFloatTime)

:   The goal of this widget is to display properly a float value that
    represents a time interval (in hours). So, for example, 0.5 should
    be formatted as 0:30, or 4.75 correspond to 4:45.

    - Supported field types: *float*

float_factor (FieldFloatFactor)

:   This widget aims to display properly a float value that converted
    using a factor given in its options. So, for example, the value
    saved in database is 0.5 and the factor is 3, the widget value
    should be formatted as 1.5.

    - Supported field types: *float*

float_toggle (FieldFloatToggle)

:   The goal of this widget is to replace the input field by a button
    containing a range of possible values (given in the options). Each
    click allows the user to loop in the range. The purpose here is to
    restrict the field value to a predefined selection. Also, the widget
    support the factor conversion as the *float_factor* widget (Range
    values should be the result of the conversion).

    - Supported field types: *float*

    ``` xml
    <field name="days_to_close" widget="float_toggle" options='{"factor": 2, "range": [0, 4, 8]}'/>
    ```

boolean (FieldBoolean)

:   This is the default field type for fields of type *boolean*.

    - Supported field types: *boolean*

char (FieldChar)

:   This is the default field type for fields of type *char*.

    - Supported field types: *char*

date (FieldDate)

:   This is the default field type for fields of type *date*. Note that
    it also works with datetime fields. It uses the session timezone
    when formatting dates.

    - Supported field types: *date*, *datetime*

    Options:

    - datepicker: extra settings for the
      [datepicker](https://github.com/Eonasdan/bootstrap-datetimepicker)
      widget.

    ``` xml
    <field name="datefield" options='{"datepicker": {"daysOfWeekDisabled": [0, 6]}}'/>
    ```

datetime (FieldDateTime)

:   This is the default field type for fields of type *datetime*.

    - Supported field types: *date*, *datetime*

    Options:

    - datepicker: extra settings for the
      [datepicker](https://github.com/Eonasdan/bootstrap-datetimepicker)
      widget.

    ``` xml
    <field name="datetimefield" options='{"datepicker": {"daysOfWeekDisabled": [0, 6]}}'/>
    ```

daterange (FieldDateRange)

:   This widget allows the user to select start and end date into a
    single picker.

    - Supported field types: *date*, *datetime*

    Options:

    - related_start_date: apply on end date field to get start date
      value which is used to display range in the picker.
    - related_end_date: apply on start date field to get end date value
      which is used to display range in the picker.
    - picker_options: extra settings for picker.

    ``` xml
    <field name="start_date" widget="daterange" options='{"related_end_date": "end_date"}'/>
    ```

remaining_days (RemainingDays)

:   This widget can be used on date and datetime fields. In readonly, it
    displays the delta (in days) between the value of the field and
    today. The widget is intended to be used for informative purpose:
    therefore the value cannot be modified in edit mode.

    - Supported field types: *date*, *datetime*

monetary (FieldMonetary)

:   This is the default field type for fields of type \'monetary\'. It
    is used to display a currency. If there is a currency fields given
    in option, it will use that, otherwise it will fall back to the
    default currency (in the session)

    - Supported field types: *monetary*, *float*

    Options:

    - currency_field: another field name which should be a many2one on
      currency.

    ``` xml
    <field name="value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
    ```

text (FieldText)

:   This is the default field type for fields of type *text*.

    - Supported field types: *text*

handle (HandleWidget)

:   This field\'s job is to be displayed as a *handle*, and allows
    reordering the various records by drag and dropping them.

    :::: warning
    ::: title
    Warning
    :::

    It has to be specified on the field by which records are sorted.
    ::::

    :::: warning
    ::: title
    Warning
    :::

    Having more than one field with a handle widget on the same list is
    not supported.
    ::::

    - Supported field types: *integer*

email (FieldEmail)

:   This field displays email address. The main reason to use it is that
    it is rendered as an anchor tag with the proper href, in readonly
    mode.

    - Supported field types: *char*

phone (FieldPhone)

:   This field displays a phone number. The main reason to use it is
    that it is rendered as an anchor tag with the proper href, in
    readonly mode, but only in some cases: we only want to make it
    clickable if the device can call this particular number.

    - Supported field types: *char*

url (UrlWidget)

:   This field displays an url (in readonly mode). The main reason to
    use it is that it is rendered as an anchor tag with the proper css
    classes and href.

    Also, the text of the anchor tag can be customized with the *text*
    attribute (it won\'t change the href value).

    ``` xml
    <field name="foo" widget="url" text="Some URL"/>
    ```

    Options:

    - website_path: (default:false) by default, the widget forces (if
      not already the case) the href value to begin with <http://>
      except if this option is set to true, thus allowing redirections
      to the database\'s own website.
    - Supported field types: *char*

domain (FieldDomain)

:   The \"Domain\" field allows the user to construct a technical-prefix
    domain thanks to a tree-like interface and see the selected records
    in real time. In debug mode, an input is also there to be able to
    enter the prefix char domain directly (or to build advanced domains
    the tree-like interface does not allow to).

    Note that this is limited to \'static\' domain (no dynamic
    expression, or access to context variable).

    - Supported field types: *char*

link_button (LinkButton)

:   The LinkButton widget actually simply displays a span with an icon
    and the text value as content. The link is clickable and will open a
    new browser window with its value as url.

    - Supported field types: *char*

image (FieldBinaryImage)

:   This widget is used to represent a binary value as an image. In some
    cases, the server returns a \'bin_size\' instead of the real image
    (a bin_size is a string representing a file size, such as 6.5kb). In
    that case, the widget will make an image with a source attribute
    corresponding to an image on the server.

    - Supported field types: *binary*

    Options:

    - preview_image: if the image is only loaded as a \'bin_size\', then
      this option is useful to inform the web client that the default
      field name is not the name of the current field, but the name of
      another field.
    - accepted_file_extensions: the file extension the user can pick
      from the file input dialog box (default value is
      [image/\*]{.title-ref}) (cf: `accept` attribute on \<input
      type=\"file\"/\>)

    ``` xml
    <field name="image" widget='image' options='{"preview_image":"image_128"}'/>
    ```

binary (FieldBinaryFile)

:   Generic widget to allow saving/downloading a binary file.

    - Supported field types: *binary*

    Options:

    - accepted_file_extensions: the file extension the user can pick
      from the file input dialog box (cf: `accept` attribute on \<input
      type=\"file\"/\>)

    Attribute:

    - filename: saving a binary file will lose its file name, since it
      only saves the binary value. The filename can be saved in another
      field. To do that, an attribute filename should be set to a field
      present in the view.

    ``` xml
    <field name="datas" filename="datas_fname"/>
    ```

priority (PriorityWidget)

:   This widget is rendered as a set of stars, allowing the user to
    click on it to select a value or not. This is useful for example to
    mark a task as high priority.

    Note that this widget also works in \'readonly\' mode, which is
    unusual.

    - Supported field types: *selection*

attachment_image (AttachmentImage)

:   Image widget for many2one fields. If the field is set, this widget
    will be rendered as an image with the proper src url. This widget
    does not have a different behaviour in edit or readonly mode, it is
    only useful to view an image.

    - Supported field types: *many2one*

    ``` xml
    <field name="displayed_image_id" widget="attachment_image"/>
    ```

image_selection (ImageSelection)

:   Allow the user to select a value by clicking on an image.

    - Supported field types: *selection*

    Options: a dictionary with a mapping from a selection value to an
    object with the url for an image (*image_link*) and a preview image
    (*preview_link*).

    Note that this option is not optional!

    ``` xml
    <field name="external_report_layout" widget="image_selection" options="{
        'background': {
            'image_link': '/base/static/img/preview_background.png',
            'preview_link': '/base/static/pdf/preview_background.pdf'
        },
        'standard': {
            'image_link': '/base/static/img/preview_standard.png',
            'preview_link': '/base/static/pdf/preview_standard.pdf'
        }
    }"/>
    ```

label_selection (LabelSelection)

:   This widget renders a simple non-editable label. This is only useful
    to display some information, not to edit it.

    - Supported field types: *selection*

    Options:

    - classes: a mapping from a selection value to a css class

    ``` xml
    <field name="state" widget="label_selection" options="{
        'classes': {'draft': 'default', 'cancel': 'default', 'none': 'danger'}
    }"/>
    ```

state_selection (StateSelectionWidget)

:   This is a specialized selection widget. It assumes that the record
    has some hardcoded fields, present in the view: *stage_id*,
    *legend_normal*, *legend_blocked*, *legend_done*. This is mostly
    used to display and change the state of a task in a project, with
    additional information displayed in the dropdown.

    - Supported field types: *selection*

    ``` xml
    <field name="kanban_state" widget="state_selection"/>
    ```

kanban_state_selection (StateSelectionWidget)

:   This is exactly the same widget as state_selection

    - Supported field types: *selection*

list.state_selection (ListStateSelectionWidget)

:   In list views, the state_selection widget displays by default the
    label next to the icon.

    - Supported field types: *selection*

    Options:

    - hide_label: hide the label next to the icon

    ``` xml
    <field name="kanban_state" widget="state_selection" options="{'hide_label': True}"/>
    ```

boolean_favorite (FavoriteWidget)

:   This widget is displayed as an empty (or not) star, depending on a
    boolean value. Note that it also can be edited in readonly mode.

    - Supported field types: *boolean*

boolean_button (FieldBooleanButton)

:   The Boolean Button widget is meant to be used in a stat button in a
    form view. The goal is to display a nice button with the current
    state of a boolean field (for example, \'Active\'), and allow the
    user to change that field when clicking on it.

    Note that it also can be edited in readonly mode.

    - Supported field types: *boolean*

    Options:

    - terminology: it can be either \'active\', \'archive\', \'close\'
      or a customized mapping with the keys *string_true*,
      *string_false*, *hover_true*, *hover_false*

    ``` xml
    <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
    ```

boolean_toggle (BooleanToggle)

:   Displays a toggle switch to represent a boolean. This is a subfield
    of FieldBoolean, mostly used to have a different look.

statinfo (StatInfo)

:   This widget is meant to represent statistical information in a *stat
    button*. It is basically just a label with a number.

    - Supported field types: *integer, float*

    Options:

    - label_field: if given, the widget will use the value of the
      label_field as text.

    ``` xml
    <button name="%(act_payslip_lines)d"
        icon="fa-money"
        type="action">
        <field name="payslip_count" widget="statinfo"
            string="Payslip"
            options="{'label_field': 'label_tasks'}"/>
    </button>
    ```

percentpie (FieldPercentPie)

:   This widget is meant to represent statistical information in a *stat
    button*. This is similar to a statinfo widget, but the information
    is represented in a *pie* chart (empty to full). Note that the value
    is interpreted as a percentage (a number between 0 and 100).

    - Supported field types: *integer, float*

    ``` xml
    <field name="replied_ratio" string="Replied" widget="percentpie"/>
    ```

progressbar (FieldProgressBar)

:   Represent a value as a progress bar (from 0 to some value)

    - Supported field types: *integer, float*

    Options:

    - editable: boolean if value is editable
    - current_value: get the current_value from the field that must be
      present in the view
    - max_value: get the max_value from the field that must be present
      in the view
    - edit_max_value: boolean if the max_value is editable
    - title: title of the bar, displayed on top of the bar \--\> not
      translated, use parameter (not option) \"title\" instead

    ``` xml
    <field name="absence_of_today" widget="progressbar"
        options="{'current_value': 'absence_of_today', 'max_value': 'total_employee', 'editable': false}"/>
    ```

toggle_button (FieldToggleBoolean)

:   This widget is intended to be used on boolean fields. It toggles a
    button switching between a green bullet / gray bullet. It also set
    up a tooltip, depending on the value and some options.

    - Supported field types: *boolean*

    Options:

    - active: the string for the tooltip that should be set when boolean
      is true
    - inactive: the tooltip that should be set when boolean is false

    ``` xml
    <field name="payslip_status" widget="toggle_button"
        options='{"active": "Reported in last payslips", "inactive": "To Report in Payslip"}'
    />
    ```

dashboard_graph (JournalDashboardGraph)

:   This is a more specialized widget, useful to display a graph
    representing a set of data. For example, it is used in the
    accounting dashboard kanban view.

    It assumes that the field is a JSON serialization of a set of data.

    - Supported field types: *char*

    Attribute

    - graph_type: string, can be either \'line\' or \'bar\'

    ``` xml
    <field name="dashboard_graph_data"
        widget="dashboard_graph"
        graph_type="line"/>
    ```

ace (AceEditor)

:   This widget is intended to be used on Text fields. It provides Ace
    Editor for editing XML and Python.

    - Supported field types: *char, text*

\- badge (FieldBadge)

:   Displays the value inside a bootstrap badge pill.

    - Supported field types: *char*, *selection*, *many2one*

    By default, the badge has a lightgrey background, but it can be
    customized by using the decoration-X mechanism. For instance, to
    display a red badge under a given condition:

    ``` xml
    <field name="foo" widget="badge" decoration-danger="state == 'cancel'"/>
    ```

### Relational fields

:::: web.relational_fields.FieldSelection
Supported field types: *selection*

::: attribute
placeholder

a string which is used to display some info when no value is selected
:::

``` xml
<field name="tax_id" widget="selection" placeholder="Select a tax"/>
```
::::

radio (FieldRadio)

:   This is a subfield of FielSelection, but specialized to display all
    the valid choices as radio buttons.

    Note that if used on a many2one records, then more rpcs will be done
    to fetch the name_gets of the related records.

    - Supported field types: *selection, many2one*

    Options:

    - horizontal: if true, radio buttons will be displayed horizontally.

    ``` xml
    <field name="recommended_activity_type_id" widget="radio"
        options="{'horizontal':true}"/>
    ```

selection_badge (FieldSelectionBadge)

:   This is a subfield of FieldSelection, but specialized to display all
    the valid choices as rectangular badges.

    - Supported field types: *selection, many2one*

    ``` xml
    <field name="recommended_activity_type_id" widget="selection_badge"/>
    ```

many2one (FieldMany2One)

:   Default widget for many2one fields.

    - Supported field types: *many2one*

    Attributes:

    - can_create: allow the creation of related records (take precedence
      over no_create option)
    - can_write: allow the editing of related records (default: true)

    Options:

    - quick_create: allow the quick creation of related records
      (default: true)
    - no_create: prevent the creation of related records - hide both the
      \'Create \"xxx\"\' and \"Create and Edit\...\" dropdown menu items
      (default: false)
    - no_quick_create: prevent the quick creation of related records -
      hide the \'Create \"xxx\"\' dropdown menu item (default: false)
    - no_create_edit: hide the \"Create and Edit\...\" dropdown menu
      item (default: false)
    - create_name_field: when creating a related record, if this option
      is set, the value of the *create_name_field* will be filled with
      the value of the input (default: *name*)
    - always_reload: boolean, default to false. If true, the widget will
      always do an additional name_get to fetch its name value. This is
      used for the situations where the name_get method is overridden
      (please do not do that)
    - no_open: boolean, default to false. If set to true, the many2one
      will not redirect on the record when clicking on it (in readonly
      mode)

    ``` xml
    <field name="currency_id" options="{'no_create': True, 'no_open': True}"/>
    ```

list.many2one (ListFieldMany2One)

:   Default widget for many2one fields (in list view).

    Specialization of many2one field for list views. The main reason is
    that we need to render many2one fields (in readonly mode) as a text,
    which does not allow opening the related records.

    - Supported field types: *many2one*

many2one_barcode (FieldMany2OneBarcode)

:   Widget for many2one fields allows to open the camera from a mobile
    device (Android/iOS) to scan a barcode.

    Specialization of many2one field where the user is allowed to use
    the native camera to scan a barcode. Then it uses name_search to
    search this value.

    If this widget is set and user is not using the mobile application,
    it will fallback to regular many2one (FieldMany2One)

    - Supported field types: *many2one*

many2one_avatar (Many2OneAvatar)

:   This widget is only supported on many2one fields pointing to a model
    which inherits from \'image.mixin\'. In readonly, it displays the
    image of the related record next to its display_name. Note that the
    display_name isn\'t a clickable link in this case. In edit, it
    behaves exactly like the regular many2one.

    - Supported field types: *many2one*

many2one_avatar_user (Many2OneAvatarUser)

:   This widget is a specialization of the Many2OneAvatar. When the
    avatar is clicked, we open a chat window with the corresponding
    user. This widget can only be set on many2one fields pointing to the
    \'res.users\' model.

    - Supported field types: *many2one* (pointing to \'res.users\')

many2one_avatar_employee (Many2OneAvatarEmployee)

:   Same as Many2OneAvatarUser, but for many2one fields pointing to
    \'hr.employee\'.

    - Supported field types: *many2one* (pointing to \'hr.employee\')

kanban.many2one (KanbanFieldMany2One)

:   Default widget for many2one fields (in kanban view). We need to
    disable all editing in kanban views.

    - Supported field types: *many2one*

many2many (FieldMany2Many)

:   Default widget for many2many fields.

    - Supported field types: *many2many*

    Attributes:

    - mode: string, default view to display
    - domain: restrict the data to a specific domain

    Options:

    - create_text: allow the customization of the text displayed when
      adding a new record
    - link: domain determining whether or not records can be added to
      the relation (default: True).
    - unlink: domain determining whether or not records can be removed
      from the relation (default: True).

many2many_binary (FieldMany2ManyBinaryMultiFiles)

:   This widget helps the user to upload or delete one or more files at
    the same time.

    Note that this widget is specific to the model \'ir.attachment\'.

    - Supported field types: *many2many*

    Options:

    - accepted_file_extensions: the file extension the user can pick
      from the file input dialog box (cf: `accept` attribute on \<input
      type=\"file\"/\>)

many2many_tags (FieldMany2ManyTags)

:   Display many2many as a list of tags.

    - Supported field types: *many2many*

    Options:

    - create: domain determining whether or not new tags can be created
      (default: True).

    ``` xml
    <field name="category_id" widget="many2many_tags" options="{'create': [['some_other_field', '>', 24]]}"/>
    ```

    - color_field: the name of a numeric field, which should be present
      in the view. A color will be chosen depending on its value.

    ``` xml
    <field name="category_id" widget="many2many_tags" options="{'color_field': 'color'}"/>
    ```

    - no_edit_color: set to True to remove the possibility to change the
      color of the tags (default: False).

    ``` xml
    <field name="category_id" widget="many2many_tags" options="{'color_field': 'color', 'no_edit_color': True}"/>
    ```

form.many2many_tags (FormFieldMany2ManyTags)

:   Specialization of many2many_tags widget for form views. It has some
    extra code to allow editing the color of a tag.

    - Supported field types: *many2many*

kanban.many2many_tags (KanbanFieldMany2ManyTags)

:   Specialization of many2many_tags widget for kanban views.

    - Supported field types: *many2many*

many2many_checkboxes (FieldMany2ManyCheckBoxes)

:   This field displays a list of checkboxes and allows the user to
    select a subset of the choices. Note that the number of displayed
    values is limited to 100. This limit isn\'t customizable. It simply
    allows to handle extreme cases where this widget is wrongly set on a
    field with a huge comodel. In those cases, a list view is more
    adequate as it allows pagination and filtering.

    - Supported field types: *many2many*

one2many (FieldOne2Many)

:   Default widget for one2many fields.

    It usually displays data in a sub list view, or a sub kanban view.

    - Supported field types: *one2many*

    Options:

    - create: domain determining whether or not related records can be
      created (default: True).
    - delete: domain determining whether or not related records can be
      deleted (default: True).

    ``` xml
    <field name="turtles" options="{'create': [['some_other_field', '>', 24]]}"/>
    ```

    - create_text: a string that is used to customize the \'Add\'
      label/text.

    ``` xml
    <field name="turtles" options="{\'create_text\': \'Add turtle\'}"/>
    ```

statusbar (FieldStatus)

:   This is a really specialized widget for the form views. It is the
    bar on top of many forms which represent a flow, and allow selecting
    a specific state.

    - Supported field types: *selection, many2one*

reference (FieldReference)

:   The FieldReference is a combination of a select (for the model) and
    a FieldMany2One (for its value). It allows the selection of a record
    on an arbitrary model.

    - Supported field types: *char, reference*

      Options:

      - 

        model_field: name of a FieldMany2One(\'ir.model\') containing the model of the records that can be selected.

        :   When this option is set, the select part of the
            FieldReference isn\'t displayed.

### Widgets

week_days (WeekDays)

:   This field displays a list of checkboxes for week days, 1 checkbox
    for each day and allow the user to select a subset of the choices.

    ``` xml
    <widget name="week_days"/>
    ```

## Client actions

The idea of a client action is a customized widget that is integrated
into the web client interface, just like an *act_window_action*. This is
useful when you need a component that is not closely linked to an
existing view or a specific model. For example, the Discuss application
is actually a client action.

A client action is a term that has various meanings, depending on the
context:

- from the perspective of the server, it is a record of the model
  *ir_action*, with a field *tag* of type char
- from the perspective of the web client, it is a widget, which inherits
  from the class AbstractAction, and is supposed to be registered in the
  action registry under the corresponding key (from the field char)

Whenever a menu item is associated with a client action, opening it will
simply fetch the action definition from the server, then lookup into its
action registry to get the Widget definition at the appropriate key, and
finally, it will instantiate and append the widget to the proper place
in the DOM.

### Adding a client action

A client action is a widget that will control the part of the screen
below the menu bar. It can have a control panel, if necessary. Defining
a client action can be done in two steps: implementing a new widget and
registering the widget in the action registry.

Implementing a new client action.

:   This is done by creating a widget:

    ``` javascript
    var AbstractAction = require('web.AbstractAction');

    var ClientAction = AbstractAction.extend({
        hasControlPanel: true,
        ...
    });
    ```

Registering the client action:

:   As usual, we need to make the web client aware of the mapping
    between client actions and the actual class:

    ``` javascript
    var core = require('web.core');

    core.action_registry.add('my-custom-action', ClientAction);
    ```

    Then, to use the client action in the web client, we need to create
    a client action record (a record of the model `ir.actions.client`)
    with the proper `tag` attribute:

    ``` xml
    <record id="my_client_action" model="ir.actions.client">
        <field name="name">Some Name</field>
        <field name="tag">my-custom-action</field>
    </record>
    ```

### Using the control panel

By default, the client action does not display a control panel. To do
that, several steps should be done.

- Set the *hasControlPanel* to *true*. In the widget code:

  ``` javascript
  var MyClientAction = AbstractAction.extend({
      hasControlPanel: true,
      loadControlPanel: true, // default: false
      ...
  });
  ```

  :::: warning
  ::: title
  Warning
  :::

  When the `loadControlPanel` is set to true, the client action will
  automatically get the content of a search view or a control panel
  view. In this case, a model name should be specified like this:

  ``` javascript
  init: function (parent, action, options) {
      ...
      this.controlPanelParams.modelName = 'model.name';
      ...
  }
  ```
  ::::

- Call the method *updateControlPanel* whenever we need to update the
  control panel. For example:

  ``` javascript
  var SomeClientAction = Widget.extend({
      hasControlPanel: true,
      ...
      start: function () {
          this._renderButtons();
          this._update_control_panel();
          ...
      },
      do_show: function () {
           ...
           this._update_control_panel();
      },
      _renderButtons: function () {
          this.$buttons = $(QWeb.render('SomeTemplate.Buttons'));
          this.$buttons.on('click', ...);
      },
      _update_control_panel: function () {
          this.updateControlPanel({
              cp_content: {
                 $buttons: this.$buttons,
              },
          });
      }
  ```

The `updateControlPanel` is the main method to customize the content in
the control panel. For more information, look into the
[control_panel_renderer.js]({GITHUB_PATH}/addons/web/static/src/js/views/control_panel/control_panel_renderer.js#L130)
file.




--- SOURCE: developer/reference/frontend/mobile.md ---

# Mobile JavaScript {#reference/mobile}

## Introduction

In Odoo 10.0 we released a mobile app which allows you to access all
**Odoo apps** (even your customized modules).

The application is a combination of **Odoo Web** and **Native Mobile
components**. In other words it is a Odoo Web instance loaded inside a
native, mobile, WebView container.

This page documents how you can access mobile native components like
Camera, Vibration, Notification and Toast through Odoo Web (via
JavaScript). For this, you do not need to be a mobile developer, if you
know Odoo JavaScript API you can access all available mobile features.

:::: warning
::: title
Warning
:::

These features work with **Odoo Enterprise 10.0+** only
::::

## How does it work?

Internal workings of the mobile application:

![image](mobile/mobile_working.jpg)

Of course, it is a web page that loads on a Mobile Native Web container.
But it is integrated in such a way that you can access native resources
from your web JavaScript.

WebPages (Odoo Web) is on the top of each layer, where the second layer
is a Bridge between Odoo Web (JS) and the native mobile components.

When any call from JavaScript is triggered it passes through Bridge and
Bridge passes it to the native invoker to perform that action.

When the native component has done its work, it is passed to the Bridge
again and you get the output in JavaScript.

Process time taken by the Native component depends on what you are
requesting from the Native resources. For example the Camera or GPS
Location.

## How to use it?

Just like the Odoo Web Framework, the Mobile API can be used anywhere by
getting the object from **web_mobile.rpc**

![image](mobile/odoo_mobile_api.png)

The mobile RPC object provides a list of methods that are available
(this only works with the mobile app).

Check if the method is available and then execute it.

### Methods

:::: note
::: title
Note
:::

Each of the methods returns a JQuery Deferred object which returns a
data JSON dictionary
::::

#### Show Toast in device

> 
>
> param object args
> :   **message** text to display

A toast provides simple feedback about an operation in a small popup. It
only fills the amount of space required for the message and the current
activity remains visible and interactive.

``` javascript
mobile.methods.showToast({'message': 'Message sent'});
```

![image](mobile/toast.png)

#### Vibrating device

> 
>
> param object args
> :   Vibrates constantly for the specified period of time (in
>     milliseconds).

Vibrate mobile device with given duration.

``` javascript
mobile.methods.vibrate({'duration': 100});
```

#### Show snackbar with action

> 
>
> param object args
> :   (*required*) **Message** to show in snackbar and action **button
>     label** in Snackbar (optional)
>
> returns
> :   `True` if the user clicks on the Action button, `False` if
>     SnackBar auto dismissed after some time.

Snackbars provide lightweight feedback about an operation. They show a
brief message at the bottom of the screen on mobile or in the lower left
corner on larger devices. Snackbars appear above all the other elements
on the screen and only one can be displayed at a time.

``` javascript
mobile.methods.showSnackBar({'message': 'Message is deleted', 'btn_text': 'Undo'}).then(function(result){
    if(result){
        // Do undo operation
    }else{
        // Snack Bar dismissed
    }
});
```

![image](mobile/snackbar.png)

#### Showing notification

> 
>
> param object args
> :   **title** (first row) of the notification, **message** (second
>     row) of the notification, in a standard notification.

A notification is a message you can display to the user outside of your
application\'s normal UI. When you tell the system to issue a
notification, it first appears as an icon in the notification area. To
see the details of the notification, the user opens the notification
drawer. Both the notification area and the notification drawer are
system-controlled areas that the user can view at any time.

``` javascript
mobile.showNotification({'title': 'Simple Notification', 'message': 'This is a test for a simple notification'})
```

![image](mobile/mobile_notification.png)

#### Create contact in device

> 
>
> param object args
> :   Dictionary with contact details. Possible keys (name, mobile,
>     phone, fax, email, website, street, street2, country_id, state_id,
>     city, zip, parent_id, function and image)

Create a new device contact with the given contact details.

``` javascript
var contact = {
    'name': 'Michel Fletcher',
    'mobile': '9999999999',
    'phone': '7954856587',
    'fax': '765898745',
    'email': 'michel.fletcher@agrolait.example.com',
    'website': 'http://www.agrolait.com',
    'street': '69 rue de Namur',
    'street2': false,
    'country_id': [21, 'Belgium'],
    'state_id': false,
    'city': 'Wavre',
    'zip': '1300',
    'parent_id': [8, 'Agrolait'],
    'function': 'Analyst',
    'image': '<<BASE 64 Image Data>>'
}

mobile.methods.addContact(contact);
```

![image](mobile/mobile_contact_create.png)

#### Scanning barcodes

> 
>
> returns
> :   Scanned `code` from any barcode

The barcode API detects barcodes in real-time, on the device, in any
orientation.

The barcode API can read the following barcode formats:

- 1D barcodes: EAN-13, EAN-8, UPC-A, UPC-E, Code-39, Code-93, Code-128,
  ITF, Codabar
- 2D barcodes: QR Code, Data Matrix, PDF-417, AZTEC

``` javascript
mobile.methods.scanBarcode().then(function(code){
    if(code){
        // Perform operation with the scanned code
    }
});
```

#### Switching account in device

Use switchAccount to switch from one account to another on the device.

``` javascript
mobile.methods.switchAccount();
```

![image](mobile/mobile_switch_account.png)




--- SOURCE: developer/reference/frontend/odoo_editor.md ---

# Odoo Editor

Odoo Editor is Odoo\'s own rich text editor. Its sources can be found in
the [odoo-editor
directory]({GITHUB_PATH}/addons/web_editor/static/src/js/editor/odoo-editor).

## Powerbox

The Powerbox is a piece of user interface that contains
`commands <reference/frontend/odoo_editor/powerbox/command>`{.interpreted-text
role="ref"} organized into
`categories <reference/frontend/odoo_editor/powerbox/category>`{.interpreted-text
role="ref"}. It appears when typing [/]{.title-ref} in the editor. The
commands can be filtered when the user inputs text, and navigated with
the arrow keys.

![The Powerbox opened after typing \"/\".](odoo_editor/powerbox.png){.align-center}

### Modifying the Powerbox

Only one Powerbox should be instantiated at the time, and that job is
done by the editor itself. Its Powerbox instance can be found in its
[powerbox]{.title-ref} instance variable. To change the Powerbox\'s
contents and options, change the options passed to the editor before it
gets instantiated.

:::: important
::: title
Important
:::

Never instantiate the Powerbox yourself. Always use the current
editor\'s own instance instead.
::::

::::::: example
Say we want to add a new command [Document]{.title-ref} to the Powerbox,
just for the [mass_mailing]{.title-ref} module. We want to add it to a
new category called [Documentation]{.title-ref} and we want it all the
way at the top of the Powerbox.

[mass_mailing]{.title-ref}
[extends]({GITHUB_PATH}/addons/mass_mailing/static/src/js/wysiwyg.js)
[web_editor]{.title-ref}\'s [Wysiwyg
class]({GITHUB_PATH}/addons/web_editor/static/src/js/wysiwyg/wysiwyg.js),
which instantiates the editor in its [start]{.title-ref} method. Before
doing so, it calls its own [\_getPowerboxOptions]{.title-ref} method,
which can conveniently be overridden to add our new commands.

Since [mass_mailing]{.title-ref} already overrides
[\_getPowerboxOptions]{.title-ref}, let\'s just add our new command to
it:

``` javascript
_getPowerboxOptions: function () {
    const options = this._super();
    // (existing code before the return statement)
    options.categories.push({
        name: _t('Documentation'),
        priority: 300,
    });
    options.commands.push({
        name: _t('Document'),
        category: _t('Documentation'),
        description: _t("Add this text to your mailing's documentation"),
        fontawesome: 'fa-book',
        priority: 1, // This is the only command in its category anyway.
    });
    return options;
}
```

:::: important
::: title
Important
:::

In order to allow the names and descriptions of your commands and
categories to be translated, make sure to wrap them in the
[\_t]{.title-ref} function.
::::

:::: tip
::: title
Tip
:::

To avoid out-of-control escalations, don\'t use random numbers for your
priorities: look at which other priorities already exist and choose your
value accordingly (like you would do for a [z-index]{.title-ref}).
::::
:::::::

### Opening a custom Powerbox

It is possible to open the Powerbox with a custom set of categories and
commands, bypassing all pre-existing ones. To do that, call the
[open]{.title-ref} method of the Powerbox and pass it your custom
commands and categories.

![The Powerbox opened with custom categories and commands when pasting an
image URL.](odoo_editor/powerbox-custom.png){.align-center}

::: example
We need the current instance of the Powerbox, which can be found in the
current editor. In the [Wysiwyg
class]({GITHUB_PATH}/addons/web_editor/static/src/js/wysiwyg/wysiwyg.js),
you will find it as [this.odooEditor.powerbox]{.title-ref}.

Now to open it with our custom \"Document\" command in a custom
\"Documentation\" category:

``` javascript
this.odooEditor.powerbox.open(
    [{
        name: _t('Document'),
        category: _t('Documentation'),
        description: _t("Add this text to your mailing's documentation"),
        fontawesome: 'fa-book',
        priority: 1, // This is the only command in its category anyway.
    }],
    [{
        name: _t('Documentation'),
        priority: 300,
    }]
);
```
:::

### Filtering commands

There are three ways to filter commands:

1.  Via the [powerboxFilters]{.title-ref}
    `Powerbox option <reference/frontend/odoo_editor/powerbox/options>`{.interpreted-text
    role="ref"}.
2.  Via a given
    `command <reference/frontend/odoo_editor/powerbox/command>`{.interpreted-text
    role="ref"}\'s [isDisabled]{.title-ref} entry.
3.  The user can filter commands by simply typing text after opening the
    Powerbox. It will fuzzy-match that text with the names of the
    categories and commands.

![The Powerbox with its commands filtered using the word \"head\".](odoo_editor/powerbox-filtered.png){.align-center}

### Reference

#### Category {#reference/frontend/odoo_editor/powerbox/category}

  ------------------------------------------------------------------------------------------
  Name                     Type                   Description
  ------------------------ ---------------------- ------------------------------------------
  [name]{.title-ref}       [string]{.title-ref}   the name of the category

  [priority]{.title-ref}   [number]{.title-ref}   used to order the category: a category
                                                  with a higher priority is displayed higher
                                                  into the Powerbox (categories with the
                                                  same priority are ordered alphabetically)
  ------------------------------------------------------------------------------------------

:::: note
::: title
Note
:::

If several categories exist with the same name, they will be grouped
into one. Its priority will be that defined in the version of the
category that was declared last.
::::

#### Command {#reference/frontend/odoo_editor/powerbox/command}

  -----------------------------------------------------------------------------------------------
  Name                        Type                     Description
  --------------------------- ------------------------ ------------------------------------------
  [name]{.title-ref}          [string]{.title-ref}     the name of the command

  [category]{.title-ref}      [string]{.title-ref}     the name of the category the command
                                                       belongs to

  [description]{.title-ref}   [string]{.title-ref}     a short text to describe the command

  [fontawesome]{.title-ref}   [string]{.title-ref}     the name of a *Font Awesome* that will
                                                       serve as the command\'s icon

  [priority]{.title-ref}      [number]{.title-ref}     used to order the command: a command with
                                                       a higher priority is displayed higher into
                                                       the Powerbox (commands with the same
                                                       priority are ordered alphabetically)

  [callback]{.title-ref}      [function]{.title-ref}   the function to execute when the command
                              ([() =\>                 is picked (can be asynchronous)
                              void]{.title-ref})       

  [isDisabled]{.title-ref}    [function]{.title-ref}   a function used to disable the command
  (optional)                  ([() =\>                 under certain conditions (when it returns
                              void]{.title-ref})       [true]{.title-ref}, the command will be
                                                       disabled)
  -----------------------------------------------------------------------------------------------

:::: note
::: title
Note
:::

If the command points to a category that doesn\'t exist yet, that
category will be created and appended at the end of the Powerbox.
::::

#### Options {#reference/frontend/odoo_editor/powerbox/options}

The following options can be passed to OdooEditor, that will then be
passed to the instance of the Powerbox:

  -------------------------------------------------------------------------------------------------------------
  Name                                     Type                      Description
  ---------------------------------------- ------------------------- ------------------------------------------
  [commands]{.title-ref}                   [array of                 commands to add to the default defined by
                                           commands]{.title-ref}     the editor

  [categories]{.title-ref}                 [array of                 categories to add to the default defined
                                           categories]{.title-ref}   by the editor

  [powerboxFilters]{.title-ref}            [array of                 functions used to filter commands
                                           functions]{.title-ref}    displayed in the Powerbox
                                           ([commands =\>            
                                           commands]{.title-ref})    

  [getContextFromParentRect]{.title-ref}   [function]{.title-ref}    a function that returns the
                                           ([() =\>                  [DOMRect]{.title-ref} of an ancestor of
                                           DOMRect]{.title-ref})     the editor (can be useful when the editor
                                                                     is in an iframe)
  -------------------------------------------------------------------------------------------------------------




--- SOURCE: developer/reference/frontend/owl_components.md ---

# Owl Components {#frontend/components}

The Odoo Javascript framework uses a custom component framework called
Owl. It is a declarative component system, loosely inspired by Vue and
React. Components are defined using
`QWeb templates <qweb>`{.interpreted-text role="doc"}, enriched with
some Owl specific directives. The official [Owl
documentation](https://github.com/odoo/owl/blob/master/doc/readme.md)
contains a complete reference and a tutorial.

:::: important
::: title
Important
:::

Although the code can be found in the [web]{.title-ref} module, it is
maintained from a separate GitHub repository. Any modification to Owl
should therefore be made through a pull request on
<https://github.com/odoo/owl>.
::::

:::: note
::: title
Note
:::

Currently, all Odoo versions (starting in version 14) share the same Owl
version.
::::

## Using Owl components

The [Owl
documentation](https://github.com/odoo/owl/blob/master/doc/readme.md)
already documents in detail the Owl framework, so this page will only
provide Odoo specific information. But first, let us see how we can make
a simple component in Odoo.

``` javascript
const { useState } = owl.hooks;
const { xml } = owl.tags;

class MyComponent extends Component {
    setup() {
        this.state = useState({ value: 1 });
    }

    increment() {
        this.state.value++;
    }
}
MyComponent.template = xml
    `<div t-on-click="increment">
        <t t-esc="state.value">
    </div>`;
```

This example shows that Owl is available as a library in the global
namespace as \`owl\`: it can simply be used like most libraries in Odoo.
Note that we defined here the template as a static property, but without
using the [static]{.title-ref} keyword, which is not available in some
browsers (Odoo javascript code should be Ecmascript 2019 compliant).

We define here the template in the javascript code, with the help of the
[xml]{.title-ref} helper. However, it is only useful to get started. In
practice, templates in Odoo should be defined in an xml file, so they
can be translated. In that case, the component should only define the
template name.

In practice, most components should define 2 or 3 files, located at the
same place: a javascript file ([my_component.js]{.title-ref}), a
template file ([my_component.xml]{.title-ref}) and optionally a scss (or
css) file ([my_component.scss]{.title-ref}). These files should then be
added to some assets bundle. The web framework will take care of loading
the javascript/css files, and loading the templates into Owl.

Here is how the component above should be defined:

``` javascript
const { useState } = owl.hooks;

class MyComponent extends Component {
    ...
}
MyComponent.template = 'myaddon.MyComponent';
```

And the template is now located in the corresponding xml file:

``` xml
<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="myaddon.MyComponent" owl="1">
  <div t-on-click="increment">
    <t t-esc="state.value"/>
  </div>
</t>

</templates>
```

Odoo code is not yet completely made in Owl, so it needs a way to tell
the difference between Owl templates (new code) and old templates (for
components). To do that in a backward-compatible way, all new templates
should be defined with the [owl]{.title-ref} attribute set to 1.

:::: note
::: title
Note
:::

Do not forget to set [owl=\"1\"]{.title-ref} in your Owl templates!
::::

:::: note
::: title
Note
:::

Template names should follow the convention
[addon_name.ComponentName]{.title-ref}.
::::

::: seealso
\- [Owl Repository](https://github.com/odoo/owl)
:::

## Best practices {#frontend/owl/best_practices}

First of all, components are classes, so they have a constructor. But
constructors are special methods in javascript that are not overridable
in any way. Since this is an occasionally useful pattern in Odoo, we
need to make sure that no component in Odoo directly uses the
constructor method. Instead, components should use the
[setup]{.title-ref} method:

``` javascript
// correct:
class MyComponent extends Component {
    setup() {
        // initialize component here
    }
}

// incorrect. Do not do that!
class IncorrectComponent extends Component {
    constructor(parent, props) {
        // initialize component here
    }
}
```

Another good practice is to use a consistent convention for template
names: [addon_name.ComponentName]{.title-ref}. This prevents name
collision between odoo addons.

## Reference List

The Odoo web client is built with [Owl](https://github.com/odoo/owl)
components. To make it easier, the Odoo javascript framework provides a
suite of generic components that can be reused in some common
situations, such as dropdowns, checkboxes or datepickers. This page
explains how to use these generic components.

  ----------------------------------------------------------------------------------------------------------------
  Technical Name                                                 Short Description
  -------------------------------------------------------------- -------------------------------------------------
  `ActionSwiper <frontend/owl/actionswiper>`{.interpreted-text   a swiper component to perform actions on touch
  role="ref"}                                                    swipe

  `CheckBox <frontend/owl/checkbox>`{.interpreted-text           a simple checkbox component with a label next to
  role="ref"}                                                    it

  `ColorList <frontend/owl/colorlist>`{.interpreted-text         a list of colors to choose from
  role="ref"}                                                    

  `Dropdown <frontend/owl/dropdown>`{.interpreted-text           full-featured dropdown
  role="ref"}                                                    

  `Notebook <frontend/owl/notebook>`{.interpreted-text           a component to navigate between pages using tabs
  role="ref"}                                                    

  `Pager <frontend/pager>`{.interpreted-text role="ref"}         a small component to handle pagination
  ----------------------------------------------------------------------------------------------------------------

### ActionSwiper {#frontend/owl/actionswiper}

#### Location

[\@web/core/action_swiper/action_swiper]{.title-ref}

#### Description

This is a component that can perform actions when an element is swiped
horizontally. The swiper is wrapping a target element to add actions to
it. The action is executed once the user has released the swiper passed
a portion of its width.

``` xml
<ActionSwiper onLeftSwipe="Object" onRightSwipe="Object">
  <SomeElement/>
</ActionSwiper>
```

The simplest way to use the component is to use it around your target
element directly in an xml template as shown above. But sometimes, you
may want to extend an existing element and would not want to duplicate
the template. It is possible to do just that.

If you want to extend the behavior of an existing element, you must
place the element inside, by wrapping it directly. Also, you can
conditionnally add props to manage when the element might be swipable,
its animation and the minimum portion to swipe to perform the action.

You can use the component to interact easily with records, messages,
items in lists and much more.

![Example of ActionSwiper usage](owl_components/actionswiper.png){.align-center
width="400px"}

The following example creates a basic ActionSwiper component. Here, the
swipe is enabled in both directions.

``` xml
<ActionSwiper
  onRightSwipe="
    {
      action: '() => Delete item',
      icon: 'fa-delete',
      bgColor: 'bg-danger',
    }"
  onLeftSwipe="
    {
      action: '() => Star item',
      icon: 'fa-star',
      bgColor: 'bg-warning',
    }"
>
  <div>
    Swipable item
  </div>
</ActionSwiper>
```

:::: note
::: title
Note
:::

Actions are permuted when using right-to-left (RTL) languages.
::::

#### Props

  -----------------------------------------------------------------------------------------------------
  Name                               Type                    Description
  ---------------------------------- ----------------------- ------------------------------------------
  [animationOnMove]{.title-ref}      [Boolean]{.title-ref}   optional boolean to determine if a
                                                             translate effect is present during the
                                                             swipe

  [animationType]{.title-ref}        [String]{.title-ref}    optional animation that is used after the
                                                             swipe ends ([bounce]{.title-ref} or
                                                             [forwards]{.title-ref})

  [onLeftSwipe]{.title-ref}          [Object]{.title-ref}    if present, the actionswiper can be swiped
                                                             to the left

  [onRightSwipe]{.title-ref}         [Object]{.title-ref}    if present, the actionswiper can be swiped
                                                             to the right

  [swipeDistanceRatio]{.title-ref}   [Number]{.title-ref}    optional minimum width ratio that must be
                                                             swiped to perform the action
  -----------------------------------------------------------------------------------------------------

You can use both [onLeftSwipe]{.title-ref} and
[onRightSwipe]{.title-ref} props at the same time.

The [Object]{.title-ref}\'s used for the left/right swipe must contain:

> - [action]{.title-ref}, which is the callable [Function]{.title-ref}
>   serving as a callback. Once the swipe has been completed in the
>   given direction, that action is performed.
> - [icon]{.title-ref} is the icon class to use, usually to represent
>   the action. It must be a [string]{.title-ref}.
> - [bgColor]{.title-ref} is the background color, given to decorate the
>   action. can be one of the following [bootstrap contextual
>   color](https://getbootstrap.com/docs/3.3/components/#available-variations)
>   ([danger]{.title-ref}, [info]{.title-ref}, [secondary]{.title-ref},
>   [success]{.title-ref} or [warning]{.title-ref}).
>
> Those values must be given to define the behavior and the visual
> aspect of the swiper.

#### Example: Extending existing components

In the following example, you can use [xpath]{.title-ref}\'s to wrap an
existing element in the ActionSwiper component. Here, a swiper has been
added to mark a message as read in mail.

``` xml
<xpath expr="//*[hasclass('o_Message')]" position="after">
  <ActionSwiper
    onRightSwipe="messaging.device.isMobile and messageView.message.isNeedaction ?
      {
        action: () => messageView.message.markAsRead(),
        icon: 'fa-check-circle',
        bgColor: 'bg-success',
      } : undefined"
  />
</xpath>
<xpath expr="//ActionSwiper" position="inside">
  <xpath expr="//*[hasclass('o_Message')]" position="move"/>
</xpath>
```

### CheckBox {#frontend/owl/checkbox}

#### Location

[\@web/core/checkbox/checkbox]{.title-ref}

#### Description

This is a simple checkbox component with a label next to it. The
checkbox is linked to the label: the checkbox is toggled whenever the
label is clicked.

``` xml
<CheckBox value="boolean" disabled="boolean" t-on-change="onValueChange">
  Some Text
</CheckBox>
```

#### Props

  -------------------------------------------------------------------------------------------
  Name                     Type                    Description
  ------------------------ ----------------------- ------------------------------------------
  [value]{.title-ref}      [boolean]{.title-ref}   if true, the checkbox is checked,
                                                   otherwise it is unchecked

  [disabled]{.title-ref}   [boolean]{.title-ref}   if true, the checkbox is disabled,
                                                   otherwise it is enabled
  -------------------------------------------------------------------------------------------

### ColorList {#frontend/owl/colorlist}

#### Location

[\@web/core/colorlist/colorlist]{.title-ref}

#### Description

The ColorList let you choose a color from a predefined list. By default,
the component displays the current selected color, and is not expandable
until the [canToggle]{.title-ref} props is present. Different props can
change its behavior, to always expand the list, or make it act as a
toggler once it is clicked, to display the list of available colors
until a choice is selected.

#### Props

  ---------------------------------------------------------------------------------------------------
  Name                            Type                     Description
  ------------------------------- ------------------------ ------------------------------------------
  [canToggle]{.title-ref}         [boolean]{.title-ref}    optional. Whether the colorlist can expand
                                                           the list on click

  [colors]{.title-ref}            [array]{.title-ref}      list of colors to display in the
                                                           component. Each color has a unique
                                                           [id]{.title-ref}

  [forceExpanded]{.title-ref}     [boolean]{.title-ref}    optional. If true, the list is always
                                                           expanded

  [isExpanded]{.title-ref}        [boolean]{.title-ref}    optional. If true, the list is expanded by
                                                           default

  [onColorSelected]{.title-ref}   [function]{.title-ref}   callback executed once a color is selected

  [selectedColor]{.title-ref}     [number]{.title-ref}     optional. The color [id]{.title-ref} that
                                                           is selected
  ---------------------------------------------------------------------------------------------------

Color [id]{.title-ref}\'s are the following:

  Id                 Color
  ------------------ ---------------------------
  [0]{.title-ref}    [No color]{.title-ref}
  [1]{.title-ref}    [Red]{.title-ref}
  [2]{.title-ref}    [Orange]{.title-ref}
  [3]{.title-ref}    [Yellow]{.title-ref}
  [4]{.title-ref}    [Light blue]{.title-ref}
  [5]{.title-ref}    [Dark purple]{.title-ref}
  [6]{.title-ref}    [Salmon pink]{.title-ref}
  [7]{.title-ref}    [Medium blue]{.title-ref}
  [8]{.title-ref}    [Dark blue]{.title-ref}
  [9]{.title-ref}    [Fuchsia]{.title-ref}
  [12]{.title-ref}   [Green]{.title-ref}
  [11]{.title-ref}   [Purple]{.title-ref}

### Dropdown {#frontend/owl/dropdown}

#### Location

[\@web/core/dropdown/dropdown]{.title-ref} and
[\@web/core/dropdown/dropdown_item]{.title-ref}

#### Description

Dropdowns are surprisingly complicated components. They need to provide
many features such as:

- Toggle the item list on click
- Direct siblings dropdowns: when one is open, toggle others on hover
- Close on outside click
- Optionally close the item list when an item is selected
- Call a function when the item is selected
- Support sub dropdowns, up to any level
- SIY: style it yourself
- Configurable hotkey to open/close a dropdown or select a dropdown item
- Keyboard navigation (arrows, tab, shift+tab, home, end, enter and
  escape)
- Reposition itself whenever the page scrolls or is resized
- Smartly chose the direction it should open (right-to-left direction is
  automatically handled).

To solve these issues once and for all, the Odoo framework provides a
set of two components: a [Dropdown]{.title-ref} component (the actual
dropdown), and [DropdownItem]{.title-ref}, for each element in the item
list.

``` xml
<Dropdown>
  <t t-set-slot="toggler">
    <!-- "toggler" slot content is rendered inside a button -->
    Click me to toggle the dropdown menu !
  </t>
  <!-- "default" slot content is rendered inside a div -->
  <DropdownItem onSelected="selectItem1">Menu Item 1</DropdownItem>
  <DropdownItem onSelected="selectItem2">Menu Item 2</DropdownItem>
</Dropdown>
```

#### Props

A [\<Dropdown/\>]{.title-ref} component is simply a [\<div
class=\"dropdown\"/\>]{.title-ref} having a [\<button
class=\"dropdown-toggle\"/\>]{.title-ref} next to menu div ([\<div
class=\"dropdown-menu\"/\>]{.title-ref}). The button is responsible for
the menu being present in the DOM or not.

  ----------------------------------------------------------------------------------------------------------------------
  Dropdown                     Type                       Description
  ---------------------------- -------------------------- --------------------------------------------------------------
  [startOpen]{.title-ref}      boolean                    initial dropdown open state (defaults to [false]{.title-ref})

  [menuClass]{.title-ref}      string                     additional css class applied to the dropdown menu [\<div
                                                          class=\"dropdown-menu\"/\>]{.title-ref}

  [togglerClass]{.title-ref}   string                     additional css class applied to the toggler [\<button
                                                          class=\"dropdown-toggle\"/\>]{.title-ref}

  [hotkey]{.title-ref}         string                     hotkey to toggle the opening through keyboard

  [tooltip]{.title-ref}        string                     add a tooltip on the toggler

  [beforeOpen]{.title-ref}     function                   hook to execute logic just before opening. May be
                                                          asynchronous.

  [manualOnly]{.title-ref}     boolean                    if true, only toggle the dropdown when the button is clicked
                                                          on (defaults to [false]{.title-ref})

  [title]{.title-ref}          string                     title attribute content for the [\<button
                                                          class=\"dropdown-toggle\"/\>]{.title-ref} (default: none)

  [position]{.title-ref}       string                     defines the desired menu opening position. RTL direction is
                                                          automatically applied. Should be a valid
                                                          `usePosition <frontend/hooks/useposition>`{.interpreted-text
                                                          role="ref"} hook position. (default:
                                                          [bottom-start]{.title-ref})

  [toggler]{.title-ref}        [\"parent\"]{.title-ref}   when set to [\"parent\"]{.title-ref} the [\<button
                               or [undefined]{.title-ref} class=\"dropdown-toggle\"/\>]{.title-ref} is not rendered
                                                          (thus [toggler]{.title-ref} slot is ignored) and the toggling
                                                          feature is handled by the parent node (e.g. use case: pivot
                                                          cells). (default: [undefined]{.title-ref})
  ----------------------------------------------------------------------------------------------------------------------

A [\<DropdownItem/\>]{.title-ref} is simply a span ([\<span
class=\"dropdown-item\"/\>]{.title-ref}). When a
[\<DropdownItem/\>]{.title-ref} is selected, it calls its
[onSelected]{.title-ref} prop. If this prop is a method, make sure it is
bound if the method need to use the [this]{.title-ref} value.

  ----------------------------------------------------------------------------------------------------
  DropdownItem                      Type                    Description
  --------------------------------- ----------------------- ------------------------------------------
  [onSelected]{.title-ref}          Function                a function that will be called when the
                                                            dropdown item is selected.

  [parentClosingMode]{.title-ref}   [none]{.title-ref} \|   when the item is selected, control which
                                    [closest]{.title-ref}   parent dropdown will get closed: none,
                                    \| [all]{.title-ref}    closest or all (default =
                                                            [all]{.title-ref})

  [hotkey]{.title-ref}              string                  optional hotkey to select the item

  [href]{.title-ref}                string                  if provided the DropdownItem will become
                                                            an [\<a href=\"value\"
                                                            class=\"dropdown-item\"/\>]{.title-ref}
                                                            instead of a [\<span
                                                            class=\"dropdown-item\"/\>]{.title-ref}.
                                                            (default: not provided)

  [title]{.title-ref}               string                  optional title attribute which will be
                                                            passed to the root node of the
                                                            DropdownItem. (default: not provided)

  [dataset]{.title-ref}             Object                  optional object containing values that
                                                            should be added to the root element\'s
                                                            dataset. This can be used so that the
                                                            element is easier to find
                                                            programmatically, for example in tests or
                                                            tours.
  ----------------------------------------------------------------------------------------------------

#### Technical notes

The rendered DOM is structured like this:

``` html
<div class="dropdown">
    <button class="dropdown-toggle">Click me !</button>
    <!-- following <div/> will or won't appear in the DOM depending on the state controlled by the preceding button -->
    <div class="dropdown-menu">
        <span class="dropdown-item">Menu Item 1</span>
        <span class="dropdown-item">Menu Item 2</span>
    </div>
</div>
```

To properly use a [\<Dropdown/\>]{.title-ref} component, you need to
populate two [OWL
slots](https://github.com/odoo/owl/blob/master/doc/reference/slots.md) :

- [toggler]{.title-ref} slot: it contains the *toggler* elements of your
  dropdown and is rendered inside the dropdown [button]{.title-ref}
  (unless the [toggler]{.title-ref} prop is set to
  [parent]{.title-ref}),
- [default]{.title-ref} slot: it contains the *elements* of the dropdown
  menu itself and is rendered inside the [\<div
  class=\"dropdown-menu\"/\>]{.title-ref}. Although it is not mandatory,
  there is usually at least one [DropdownItem]{.title-ref} inside the
  [menu]{.title-ref} slot.

When several dropdowns share the same parent element in the DOM, then
they are considered part of a group, and will notify each other about
their state changes. This means that when one of these dropdowns is
open, the others will automatically open themselves on mouse hover,
without the need for a click.

#### Example: Direct Siblings Dropdown

When one dropdown toggler is clicked (**File** , **Edit** or **About**),
the others will open themselves on hover.

``` xml
<div>
  <Dropdown>
    <t t-set-slot="toggler">File</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-open')">Open</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-document')">New Document</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-spreadsheet')">New Spreadsheet</DropdownItem>
  </Dropdown>
  <Dropdown>
    <t t-set-slot="toggler">Edit</t>
    <DropdownItem onSelected="() => this.onItemSelected('edit-undo')">Undo</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('edit-redo')">Redo</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('edit-find')">Search</DropdownItem>
  </Dropdown>
  <Dropdown>
    <t t-set-slot="toggler">About</t>
    <DropdownItem onSelected="() => this.onItemSelected('about-help')">Help</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('about-update')">Check update</DropdownItem>
  </Dropdown>
</div>
```

#### Example: Multi-level Dropdown (with [t-call]{.title-ref})

This example shows how one could make a [File]{.title-ref} dropdown
menu, with submenus for the [New]{.title-ref} and [Save
as\...]{.title-ref} sub elements.

``` xml
<t t-name="addon.Dropdown.File" owl="1">
  <Dropdown>
    <t t-set-slot="toggler">File</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-open')">Open</DropdownItem>
    <t t-call="addon.Dropdown.File.New"/>
    <DropdownItem onSelected="() => this.onItemSelected('file-save')">Save</DropdownItem>
    <t t-call="addon.Dropdown.File.Save.As"/>
  </Dropdown>
</t>

<t t-name="addon.Dropdown.File.New" owl="1">
  <Dropdown>
    <t t-set-slot="toggler">New</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-document')">Document</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-spreadsheet')">Spreadsheet</DropdownItem>
  </Dropdown>
</t>

<t t-name="addon.Dropdown.File.Save.As" owl="1">
  <Dropdown>
    <t t-set-slot="toggler">Save as...</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-save-as-csv')">CSV</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-save-as-pdf')">PDF</DropdownItem>
  </Dropdown>
</t>
```

#### Example: Multi-level Dropdown (nested)

``` xml
<Dropdown>
  <t t-set-slot="toggler">File</t>
  <DropdownItem onSelected="() => this.onItemSelected('file-open')">Open</DropdownItem>
  <Dropdown>
    <t t-set-slot="toggler">New</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-document')">Document</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-new-spreadsheet')">Spreadsheet</DropdownItem>
  </Dropdown>
  <DropdownItem onSelected="() => this.onItemSelected('file-save')">Save</DropdownItem>
  <Dropdown>
    <t t-set-slot="toggler">Save as...</t>
    <DropdownItem onSelected="() => this.onItemSelected('file-save-as-csv')">CSV</DropdownItem>
    <DropdownItem onSelected="() => this.onItemSelected('file-save-as-pdf')">PDF</DropdownItem>
  </Dropdown>
</Dropdown>
```

#### Example: Recursive Multi-level Dropdown

In this example, we recursively call a template to display a tree-like
structure.

``` xml
<t t-name="addon.MainTemplate" owl="1">
  <div>
    <t t-call="addon.RecursiveDropdown">
      <t t-set="name" t-value="'Main Menu'" />
      <t t-set="items" t-value="state.menuItems" />
    </t>
  </div>
</t>

<t t-name="addon.RecursiveDropdown" owl="1">
  <Dropdown>
    <t t-set-slot="toggler"><t t-esc="name"/></t>
      <t t-foreach="items" t-as="item" t-key="item.id">

        <!-- If this item has no child: make it a <DropdownItem/> -->
        <t t-if="!item.childrenTree.length">
          <DropdownItem onSelected="() => this.onItemSelected(item)" t-esc="item.name"/>
        </t>
        <!-- Else: recursively call the current dropdown template. -->
        <t t-else="" t-call="addon.RecursiveDropdown">
          <t t-set="name" t-value="item.name" />
          <t t-set="items" t-value="item.childrenTree" />
        </t>

      </t>
    </t>
  </Dropdown>
</t>
```

### Notebook {#frontend/owl/notebook}

#### Location

[\@web/core/notebook/notebook]{.title-ref}

#### Description

The Notebook is made to display multiple pages in a tabbed interface.
Tabs can be located at the top of the element to display horizontally,
or at the left for a vertical layout.

There are two ways to define your Notebook pages to instanciate, either
by using [slot]{.title-ref}\'s, or by passing a dedicated
[props]{.title-ref}.

#### Props

  ------------------------------------------------------------------------------------------------
  Name                         Type                     Description
  ---------------------------- ------------------------ ------------------------------------------
  [anchors]{.title-ref}        [object]{.title-ref}     optional. Allow anchors navigation to
                                                        elements inside tabs that are not visible.

  [className]{.title-ref}      [string]{.title-ref}     optional. Classname set on the root of the
                                                        component.

  [defaultPage]{.title-ref}    [string]{.title-ref}     optional. Page [id]{.title-ref} to display
                                                        by default.

  [orientation]{.title-ref}    [string]{.title-ref}     optional. Whether tabs direction is
                                                        [horizontal]{.title-ref} or
                                                        [vertical]{.title-ref}.

  [onPageUpdate]{.title-ref}   [function]{.title-ref}   optional. Callback executed once the page
                                                        has changed.

  [pages]{.title-ref}          [array]{.title-ref}      optional. Contain the list of
                                                        [page]{.title-ref}\'s to populate from a
                                                        template.
  ------------------------------------------------------------------------------------------------

::: example
The first approach is to set the pages in the slots of the component.

``` xml
<Notebook orientation="'vertical'">
  <t t-set-slot="page_1" title="'Page 1'" isVisible="true">
    <h1>My First Page</h1>
    <p>It's time to build Owl components. Did you read the documentation?</p>
  </t>
  <t t-set-slot="page_2" title="'2nd page'" isVisible="true">
    <p>Wise owl's silent flight. Through the moonlit forest deep, guides my path to code</p>
  </t>
</Notebook>
```

The other way to define your pages is by passing the props. This can be
useful if some pages share the same structure. Create first a component
for each page template that you may use.

``` javascript
import { Notebook } from "@web/core/notebook/notebook";

class MyTemplateComponent extends owl.Component {
  static template = owl.tags.xml`
    <h1 t-esc="props.title" />
    <p t-esc="props.text" />
  `;
}

class MyComponent extends owl.Component {
  get pages() {
    return [
      {
        Component: MyTemplateComponent,
        title: "Page 1",
        props: {
          title: "My First Page",
          text: "This page is not visible",
        },
      },
      {
        Component: MyTemplateComponent,
        id: "page_2",
        title: "Page 2",
        props: {
          title: "My second page",
          text: "You're at the right place!",
        },
      },
    ]
  }
}
MyComponent.template = owl.tags.xml`
  <Notebook defaultPage="'page_2'" pages="pages" />
`;
```

Both examples are shown here:

![Examples with vertical and horizontal layout](owl_components/notebook.png){.align-center
width="400px"}
:::

### Pager {#frontend/pager}

#### Location

[\@web/core/pager/pager]{.title-ref}

#### Description

The Pager is a small component to handle pagination. A page is defined
by an [offset]{.title-ref} and a [limit]{.title-ref} (the size of the
page). It displays the current page and the [total]{.title-ref} number
of elements, for instance, \"9-12 / 20\". In the previous example,
[offset]{.title-ref} is 8, [limit]{.title-ref} is 4 and
[total]{.title-ref} is 20. It has two buttons (\"Previous\" and
\"Next\") to navigate between pages.

:::: note
::: title
Note
:::

The pager can be used anywhere but its main use is in the control panel.
See the `usePager <frontend/hooks/usepager>`{.interpreted-text
role="ref"} hook in order to manipulate the pager of the control panel.
::::

``` xml
<Pager offset="0" limit="80" total="50" onUpdate="doSomething" />
```

#### Props

  -------------------------------------------------------------------------------------------------
  Name                          Type                     Description
  ----------------------------- ------------------------ ------------------------------------------
  [offset]{.title-ref}          [number]{.title-ref}     Index of the first element of the page. It
                                                         starts with 0 but the pager displays
                                                         [offset + 1]{.title-ref}.

  [limit]{.title-ref}           [number]{.title-ref}     Size of the page. The sum of
                                                         [offset]{.title-ref} and
                                                         [limit]{.title-ref} corresponds to the
                                                         index of the last element of the page.

  [total]{.title-ref}           [number]{.title-ref}     Total number of elements the page can
                                                         reach.

  [onUpdate]{.title-ref}        [function]{.title-ref}   Function that is called when page is
                                                         modified by the pager. This function can
                                                         be async, the pager cannot be edited while
                                                         this function is executing.

  [isEditable]{.title-ref}      [boolean]{.title-ref}    Allows to click on the current page to
                                                         edit it ([true]{.title-ref} by default).

  [withAccessKey]{.title-ref}   [boolean]{.title-ref}    Binds access key [p]{.title-ref} on the
                                                         previous page button and [n]{.title-ref}
                                                         on the next page one ([true]{.title-ref}
                                                         by default).
  -------------------------------------------------------------------------------------------------




--- SOURCE: developer/reference/frontend/patching_code.md ---

# Patching code

Sometimes, we need to customize the way the UI works. Many common needs
are covered by some supported API. For example, all registries are good
extension points: the field registry allows adding/removing specialized
field components, or the main component registry allows adding
components that should be displayed all the time.

However, there are situations for which it is not sufficient. In those
cases, we may need to modify an object or a class in place. To achieve
that, Odoo provides the utility function [patch]{.title-ref}. It is
mostly useful to override/update the behavior of some other
component/piece of code that one does not control.

## Description

The patch function is located in \`@web/core/utils/patch\`:

> 
>
> param Object obj
> :   object that should be patched
>
> param string patchName
> :   unique string describing the patch
>
> param Object patchValue
> :   an object mapping each key to a patchValue
>
> param Object options
> :   option object (see below)
>
> The [patch]{.title-ref} function modifies in place the
> [obj]{.title-ref} object (or class) and applies all key/value
> described in the [patchValue]{.title-ref} object. This operation is
> registered under the [patchName]{.title-ref} name, so it can be
> unpatched later if necessary.
>
> Most patch operations provide access to the parent value by using the
> [\_super]{.title-ref} property (see below in the examples). To do
> that, the [patch]{.title-ref} method wraps each pair key/value in a
> getter that dynamically binds [\_super]{.title-ref}.
>
> The only option is [pure (boolean)]{.title-ref}. If set to
> [true]{.title-ref}, the patch operation does not bind the
> [\_super]{.title-ref} property.

## Patching a simple object

Here is a simple example of how an object can be patched:

``` javascript
import { patch } from "@web/core/utils/patch";

const object = {
  field: "a field",
  fn() {
    // do something
  },
};

patch(object, "patch name", {
  fn() {
    // do things
  },
});
```

When patching functions, we usually want to be able to access the
`parent` function. Since we are working with patch objects, not ES6
classes, we cannot use the native `super` keyword. So, Odoo provides a
special method to simulate this behaviour: `this._super`:

``` javascript
patch(object, "_super patch", {
  fn() {
    this._super(...arguments);
    // do other things
  },
});
```

:::: warning
::: title
Warning
:::

`this._super` is reassigned after each patched function is called. This
means that if you use an asynchronous function in the patch then you
cannot call `this._super` after an `await`, because it may or may not be
the function that you expect. The correct way to do that is to keep a
reference to the initial `_super` method:

``` javascript
patch(object, "async _super patch", {
  async myAsyncFn() {
    const _super = this._super.bind(this);
    await Promise.resolve();
    await _super(...arguments);
    // await this._super(...arguments); // this._super is undefined.
  },
});
```
::::

Getters and setters are supported too:

``` javascript
patch(object, "getter/setter patch", {
  get number() {
    return this._super() / 2;
  },
  set number(value) {
    this._super(value * 2);
  },
});
```

## Patching a javascript class

The `patch` function is designed to work with anything: object or ES6
class.

However, since javascript classes work with the prototypal inheritance,
when one wishes to patch a standard method from a class, then we
actually need to patch the \`prototype\`:

``` javascript
class MyClass {
  static myStaticFn() {...}
  myPrototypeFn() {...}
}

// this will patch static properties!!!
patch(MyClass, "static patch", {
  myStaticFn() {...},
});

// this is probably the usual case: patching a class method
patch(MyClass.prototype, "prototype patch", {
  myPrototypeFn() {...},
});
```

Also, Javascript handles the constructor in a special native way which
makes it impossible to be patched. The only workaround is to call a
method in the original constructor and patch that method instead:

``` javascript
class MyClass {
  constructor() {
    this.setup();
  }
  setup() {
    this.number = 1;
  }
}

patch(MyClass.prototype, "constructor", {
  setup() {
    this._super(...arguments);
    this.doubleNumber = this.number * 2;
  },
});
```

:::: warning
::: title
Warning
:::

It is impossible to patch directly the [constructor]{.title-ref} of a
class!
::::

## Patching a component

Components are defined by javascript classes, so all the information
above still holds. For these reasons, Owl components should use the
[setup]{.title-ref} method, so they can easily be patched as well (see
the section on
`best practices<frontend/owl/best_practices>`{.interpreted-text
role="ref"}.

``` javascript
patch(MyComponent.prototype, "my patch", {
  setup() {
    useMyHook();
  },
});
```

## Removing a patch

The [patch]{.title-ref} function has a counterpart,
[unpatch]{.title-ref}, also located in
[\@web/core/utils/patch]{.title-ref}.

> 
>
> param Object obj
> :   object that should be unpatched
>
> param string patchName
> :   string describing the patch that should be removed
>
> Removes an existing patch from an object [obj]{.title-ref}. This is
> mostly useful for testing purposes, when we patch something at the
> beginning of a test, and unpatch it at the end.
>
> ``` javascript
> patch(object, "patch name", { ... });
> // test stuff here
> unpatch(object, "patch name");
> ```




--- SOURCE: developer/reference/frontend/qweb.md ---

# QWeb Templates {#reference/qweb}

QWeb is the primary
[templating](https://en.wikipedia.org/wiki/Template_processor) engine
used by Odoo[^1]. It is an XML templating engine[^2] and used mostly to
generate [HTML](https://en.wikipedia.org/wiki/HTML) fragments and pages.

Template directives are specified as XML attributes prefixed with `t-`,
for instance `t-if` for `reference/qweb/conditionals`{.interpreted-text
role="ref"}, with elements and other attributes being rendered directly.

To avoid element rendering, a placeholder element `<t>` is also
available, which executes its directive but doesn\'t generate any output
in and of itself:

``` xml
<t t-if="condition">
    <p>Test</p>
</t>
```

will result in:

``` xml
<p>Test</p>
```

if `condition` is true, but:

``` xml
<div t-if="condition">
    <p>Test</p>
</div>
```

will result in:

``` xml
<div>
    <p>Test</p>
</div>
```

## Data output {#reference/qweb/output}

QWeb\'s output directive `out` will automatically HTML-escape its input,
limiting [XSS](https://en.wikipedia.org/wiki/Cross-site_scripting) risks
when displaying user-provided content.

`out` takes an expression, evaluates it and injects the result in the
document:

``` xml
<p><t t-out="value"/></p>
```

rendered with the value `value` set to `42` yields:

``` xml
<p>42</p>
```

See `reference/qweb/advanced-output`{.interpreted-text role="ref"} for
more advanced topics (e.g. injecting raw HTML, etc\...).

## Conditionals {#reference/qweb/conditionals}

QWeb has a conditional directive `if`, which evaluates an expression
given as attribute value:

``` xml
<div>
    <t t-if="condition">
        <p>ok</p>
    </t>
</div>
```

The element is rendered if the condition is true:

``` xml
<div>
    <p>ok</p>
</div>
```

but if the condition is false it is removed from the result:

``` xml
<div>
</div>
```

The conditional rendering applies to the bearer of the directive, which
does not have to be `<t>`:

``` xml
<div>
    <p t-if="condition">ok</p>
</div>
```

will give the same results as the previous example.

Extra conditional branching directives `t-elif` and `t-else` are also
available:

``` xml
<div>
    <p t-if="user.birthday == today()">Happy birthday!</p>
    <p t-elif="user.login == 'root'">Welcome master!</p>
    <p t-else="">Welcome!</p>
</div>
```

## Loops {#reference/qweb/loops}

QWeb has an iteration directive `foreach` which take an expression
returning the collection to iterate on, and a second parameter `t-as`
providing the name to use for the \"current item\" of the iteration:

``` xml
<t t-foreach="[1, 2, 3]" t-as="i">
    <p><t t-out="i"/></p>
</t>
```

will be rendered as:

``` xml
<p>1</p>
<p>2</p>
<p>3</p>
```

Like conditions, `foreach` applies to the element bearing the
directive\'s attribute, and

``` xml
<p t-foreach="[1, 2, 3]" t-as="i">
    <t t-out="i"/>
</p>
```

is equivalent to the previous example.

`foreach` can iterate on an array (the current item will be the current
value) or a mapping (the current item will be the current key).
Iterating on an integer (equivalent to iterating on an array between 0
inclusive and the provided integer exclusive) is still supported but
deprecated.

In addition to the name passed via `t-as`, `foreach` provides a few
other variables for various data points:

:::: warning
::: title
Warning
:::

`$as` will be replaced by the name passed to `t-as`
::::

::: rst-class
o-definition-list
:::

`{$as}_all`{.interpreted-text role="samp"} (deprecated)

:   the object being iterated over

    :::: note
    ::: title
    Note
    :::

    This variable is only available on JavaScript QWeb, not Python.
    ::::

`{$as}_value`{.interpreted-text role="samp"}

:   the current iteration value, identical to `$as` for lists and
    integers, but for mappings it provides the value (where `$as`
    provides the key)

`{$as}_index`{.interpreted-text role="samp"}

:   the current iteration index (the first item of the iteration has
    index 0)

`{$as}_size`{.interpreted-text role="samp"}

:   the size of the collection if it is available

`{$as}_first`{.interpreted-text role="samp"}

:   whether the current item is the first of the iteration (equivalent
    to `{$as}_index == 0`{.interpreted-text role="samp"})

`{$as}_last`{.interpreted-text role="samp"}

:   whether the current item is the last of the iteration (equivalent to
    `{$as}_index + 1 == {$as}_size`{.interpreted-text role="samp"}),
    requires the iteratee\'s size be available

`{$as}_parity`{.interpreted-text role="samp"} (deprecated)

:   either `"even"` or `"odd"`, the parity of the current iteration
    round

`{$as}_even`{.interpreted-text role="samp"} (deprecated)

:   a boolean flag indicating that the current iteration round is on an
    even index

`{$as}_odd`{.interpreted-text role="samp"} (deprecated)

:   a boolean flag indicating that the current iteration round is on an
    odd index

These extra variables provided and all new variables created into the
`foreach` are only available in the scope of the `foreach`. If the
variable exists outside the context of the `foreach`, the value is
copied at the end of the foreach into the global context.

``` xml
<t t-set="existing_variable" t-value="False"/>
<!-- existing_variable now False -->

<p t-foreach="[1, 2, 3]" t-as="i">
    <t t-set="existing_variable" t-value="True"/>
    <t t-set="new_variable" t-value="True"/>
    <!-- existing_variable and new_variable now True -->
</p>

<!-- existing_variable always True -->
<!-- new_variable undefined -->
```

## attributes {#reference/qweb/attributes}

QWeb can compute attributes on-the-fly and set the result of the
computation on the output node. This is done via the `t-att` (attribute)
directive which exists in 3 different forms:

::: rst-class
o-definition-list
:::

`t-att-{$name}`{.interpreted-text role="samp"}

:   an attribute called `$name` is created, the attribute value is
    evaluated and the result is set as the attribute\'s value:

    ``` xml
    <div t-att-a="42"/>
    ```

    will be rendered as:

    ``` xml
    <div a="42"></div>
    ```

`t-attf-{$name}`{.interpreted-text role="samp"}

:   same as previous, but the parameter is a
    `format string`{.interpreted-text role="term"} instead of just an
    expression, often useful to mix literal and non-literal string (e.g.
    classes):

    ``` xml
    <t t-foreach="[1, 2, 3]" t-as="item">
        <li t-attf-class="row {{ (item_index % 2 === 0) ? 'even' : 'odd' }}">
            <t t-out="item"/>
        </li>
    </t>
    ```

    will be rendered as:

    ``` xml
    <li class="row even">1</li>
    <li class="row odd">2</li>
    <li class="row even">3</li>
    ```

    :::: tip
    ::: title
    Tip
    :::

    There are two equivalent syntaxes for format strings:
    `"plain_text {{code}}"` (aka jinja-style) and `"plain_text #{code}"`
    (aka ruby-style).
    ::::

`t-att=mapping`{.interpreted-text role="samp"}

:   if the parameter is a mapping, each (key, value) pair generates a
    new attribute and its value:

    ``` xml
    <div t-att="{'a': 1, 'b': 2}"/>
    ```

    will be rendered as:

    ``` xml
    <div a="1" b="2"></div>
    ```

`t-att=pair`{.interpreted-text role="samp"}

:   if the parameter is a pair (tuple or array of 2 element), the first
    item of the pair is the name of the attribute and the second item is
    the value:

    ``` xml
    <div t-att="['a', 'b']"/>
    ```

    will be rendered as:

    ``` xml
    <div a="b"></div>
    ```

## setting variables {#reference/qweb/set}

QWeb allows creating variables from within the template, to memoize a
computation (to use it multiple times), give a piece of data a clearer
name, \...

This is done via the `set` directive, which takes the name of the
variable to create. The value to set can be provided in two ways:

- a `t-value` attribute containing an expression, and the result of its
  evaluation will be set:

  ``` xml
  <t t-set="foo" t-value="2 + 1"/>
  <t t-out="foo"/>
  ```

  will print `3`

- if there is no `t-value` attribute, the node\'s body is rendered and
  set as the variable\'s value:

  ``` xml
  <t t-set="foo">
      <li>ok</li>
  </t>
  <t t-out="foo"/>
  ```

## calling sub-templates[]{#reference/qweb/call} {#reference/qweb/sub-templates}

QWeb templates can be used for top-level rendering, but they can also be
used from within another template (to avoid duplication or give names to
parts of templates) using the `t-call` directive:

``` xml
<t t-call="other-template"/>
```

This calls the named template with the execution context of the parent,
if `other_template` is defined as:

``` xml
<p><t t-value="var"/></p>
```

the call above will be rendered as `<p/>` (no content), but:

``` xml
<t t-set="var" t-value="1"/>
<t t-call="other-template"/>
```

will be rendered as `<p>1</p>`.

However, this has the problem of being visible from outside the
`t-call`. Alternatively, content set in the body of the `call` directive
will be evaluated *before* calling the sub-template, and can alter a
local context:

``` xml
<t t-call="other-template">
    <t t-set="var" t-value="1"/>
</t>
<!-- "var" does not exist here -->
```

The body of the `call` directive can be arbitrarily complex (not just
`set` directives), and its rendered form will be available within the
called template as a magical `0` variable:

``` xml
<div>
    This template was called with content:
    <t t-out="0"/>
</div>
```

being called thus:

``` xml
<t t-call="other-template">
    <em>content</em>
</t>
```

will result in:

``` xml
<div>
    This template was called with content:
    <em>content</em>
</div>
```

## Advanced Output {#reference/qweb/advanced-output}

By default, `out` should HTML-escape content which needs to be escaped,
protecting the system against
[XSS](https://en.wikipedia.org/wiki/Cross-site_scripting)

Content which does *not* need to be escaped will instead be injected
as-is in the document, and may become part of the document\'s actual
markup.

The only cross-platform \"safe\" content is the output of
`t-call <reference/qweb/call>`{.interpreted-text role="ref"} or a
`t-set <reference/qweb/set>`{.interpreted-text role="ref"} used with a
\"body\" (as opposed to `t-value` or `t-valuef`).

### Python

Usually you should not have to care too much: APIs for which it makes
sense should generate \"safe\" content automatically, and things should
work transparently.

For the cases where things need to be clearer though the following APIs
output safe content which will by default not be (re-)escaped when
injected into templates:

- `HTML fields <odoo.fields.Html>`{.interpreted-text role="class"}.

- `~odoo.tools.misc.html_escape`{.interpreted-text role="func"} and
  `markupsafe.escape`{.interpreted-text role="func"} (they are aliases,
  and have no risk of double-escaping).

- `~odoo.tools.mail.html_sanitize`{.interpreted-text role="func"}.

- `markupsafe.Markup`{.interpreted-text role="class"}.

  :::: warning
  ::: title
  Warning
  :::

  `markupsafe.Markup`{.interpreted-text role="class"} is an unsafe API,
  it\'s an *assertion* that you want the content to be markup-safe but
  necessarily can not check that, it should be used with care.
  ::::

- `~odoo.tools.pycompat.to_text`{.interpreted-text role="func"} does not
  mark the content as safe, but will not strip that information from
  safe content.

#### Creating safe content using `~markupsafe.Markup`{.interpreted-text role="class"}

See the official documentation for explanations, but the big advantage
of `~markupsafe.Markup`{.interpreted-text role="class"} is that it\'s a
very rich type overriding `str`{.interpreted-text role="class"}
operations to *automatically escape parameters*.

This means that it\'s easy to create *safe* html snippets by using
`~markupsafe.Markup`{.interpreted-text role="class"} on a string literal
and \"formatting in\" user-provided (and thus potentially unsafe)
content:

``` pycon
>>> Markup('<em>Hello</em> ') + '<foo>'
Markup('<em>Hello</em> &lt;foo&gt;')
>>> Markup('<em>Hello</em> %s') % '<foo>'
Markup('<em>Hello</em> &lt;foo&gt;')
```

though it is a very good thing, note that the effects can be odd at
times:

``` pycon
>>> Markup('<a>').replace('>', 'x')
Markup('<a>')
>>> Markup('<a>').replace(Markup('>'), 'x')
Markup('<ax')
>>> Markup('<a&gt;').replace('>', 'x')
Markup('<ax')
>>> Markup('<a&gt;').replace('>', '&')
Markup('<a&amp;')
```

:::: tip
::: title
Tip
:::

Most of the content-safe APIs actually return a
`~markupsafe.Markup`{.interpreted-text role="class"} with all that
implies.
::::

### Javascript

::: todo
what APIs do we end up considering OK there?
:::

::: todo
talk about vdom thingies?
:::

:::: warning
::: title
Warning
:::

Due to the lack of operator overriding, `Markup`{.interpreted-text
role="js:class"} is a much more limited type than
`~markupsafe.Markup`{.interpreted-text role="class"}.

Therefore it doesn\'t override methods either, and any operation
involving `Markup`{.interpreted-text role="js:class"} will return a
normal `String`{.interpreted-text role="js:class"} (and in reality not
even that, but a \"primitive string\").

This means the fallback is safe, but it is easy to trigger
double-escaping when working with `Markup`{.interpreted-text
role="js:class"} objects.
::::

### forcing double-escaping

If content is marked as safe but for some reason needs to be escaped
anyway (e.g. printing the markup of an HTML fields), it can just be
converted back to a normal string to \"strip\" the safety flag e.g.
[str(content)]{.title-ref} in Python and [String(content)]{.title-ref}
in Javascript.

:::: note
::: title
Note
:::

Because `~markupsafe.Markup`{.interpreted-text role="class"} is a much
richer type than `Markup`{.interpreted-text role="js:class"}, some
operations will strip the safety information from a
`Markup`{.interpreted-text role="js:class"} but not a
`~markupsafe.Markup`{.interpreted-text role="class"} e.g. string
concatenation (`'' + content`) in Python will result in a
`~markupsafe.Markup`{.interpreted-text role="class"} with the other
operand having been properly escaped, while in Javascript will yield a
`String`{.interpreted-text role="js:class"} where the other operand was
*not* escaped before the concatenation.
::::

### Deprecated output directives

::: rst-class
o-definition-list
:::

`esc`

:   An alias for `out`, would originally HTML-escape its input. Not yet
    formally deprecated as the only difference between `out` and `esc`
    is that the latter is a bit unclear / incorrect.

`raw`

:   A version of `out` which *never* escapes its content. Content is
    emitted as-is, whether it\'s safe or not.

    ::: deprecated
    15.0

    Use `out` with a `markupsafe.Markup`{.interpreted-text role="class"}
    value instead.

    `t-raw` was deprecated because as the code *producting* the content
    evolves it can be hard to track that it\'s going to be used for
    markup, leading to more complicated reviews and more dangerous
    lapses.
    :::

## Python

### Exclusive directives

#### Asset bundles

::: todo
have fme write these up because I\'ve no idea how they work
:::

#### \"smart records\" fields formatting

The `t-field` directive can only be used when performing field access
(`a.b`) on a \"smart\" record (result of the `browse` method). It is
able to automatically format based on field type, and is integrated in
the website\'s rich text editing.

`t-options` can be used to customize fields, the most common option is
`widget`, other options are field- or widget-dependent.

### Debugging

::: rst-class
o-definition-list
:::

`t-debug`

:   invokes a debugger using PDB\'s `set_trace` API. The parameter
    should be the name of a module, on which a `set_trace` method is
    called:

    ``` xml
    <t t-debug="pdb"/>
    ```

    is equivalent to `importlib.import_module("pdb").set_trace()`

### Rendering cache:

`t-cache="key_cache"` tags part of template to be cached at rendering
time. Every sub-directives will be call only during the first rendering.
It means that the sql queries excecuted during the rendering of those
sub-directives are also done only once.

`t-nocache="documentation"` tags part of template to be render every
time. The content can only use the root values.

#### Why and when to use `t-cache`?

This directive is used to speed up the rendering, by caching parts of
the final document, which may save queries to the database. However, it
should be used sparingly, as `t-cache` will inevitably complicate
templates (and their understanding of `t-set` for example).

However, in order to actually save database queries, it might be
necessary to render the template with values that are evaluated lazily.
If those lazy values are used in a cached part, they will not be
evaluated if the part is available in cache.

The `t-cache` directive is useful for template parts using values that
depend on a limited amount of data. We recommend to analyze the
rendering of the template with the profiler (by activating the \"\*\*Add
qweb directive context\*\*\" option). Passing lazy values to the
rendering in controllers allow you to display the directives using these
values and triggering the queries.

A concern of using such a cache are making it available to different
users (different users should render the cached parts the same way).
Another potential issue is to invalidate its entries when necessary. For
the latter, the **key expression** should be chosen wisely. Using the
`write_date` of a recordset can make a cache key out-of-date without
having to discard it explicitly from the cache, for instance.

One should also pay attention to the fact that the values in `t-cache`
parts are scoped. This implies that if there are `t-set` directives in
this part of the template, the rendering of what comes after it could be
different than if there was no `t-cache` directive.

#### What if there is a `t-cache` inside a `t-cache`?

The parts are cached. Each containing only the string corresponding to
its rendering. Thus, the `t-cache` inside will probably be read less
often, its cache key will not necessarily be used. If this must be the
case, then you may need to add a `t-nocache` (on the same node or a
parent).

#### What is `t-nocache` used for?

If you want to cache part of a template with `t-cache` but a small piece
must remain dynamic and be evaluated at cache times. However, the part
in `t-nocache` will not have access to the `t-set` value of the
template. Only the values ​​provided by the controller are accessible
there. For example, the menu is cached because it\'s the same all the
time and takes time to render (using the performance devtools with the
qweb context lets you investigate). However, in the menu, we want the
ecommerce cart to be always up to date. So there is a `t-nocache` to
keep this part dynamic.

#### The base of `t-cache`

The `t-cache` directive allows you to store the rendered result of a
template. The **key expression** (eg 42: `t-cache="42"`) will be
evaluated as a python expression. This will be used to generate the
**cache key**. So there can be different **cache values** (cached render
part) for the same template part. If the **key expression** is a tuple
or a list, it will be searched when generating the **cache key**. If one
or more recordsets are returned by the **key expression**, then the
model, ids and their corresponding write_date will be used to generate
the **cache key**. Special case: If the **key expression** returns a
Falsy value, then the content will not be cached.

Example:

``` xml
<div t-cache="record,bool(condition)">
    <span t-if="condition" t-field="record.partner_id.name">
    <span t-else="" t-field="record.partner_id" t-options-widget="contact">
</div>
```

In this case, there may be values ​​(string) in the cache corresponding to
each record already returned with a true condition, as well as for the
false condition. And if a module modifies the record, the write_date
being modified, the cached value is discarded.

#### `t-cache` and scoped values (`t-set`, `t-foreach`\...)

Values in `t-cache` are scoped, this involves a change in behavior
between having or not having `t-cache` on one of the parent nodes.
Don\'t forget to take into account that Odoo uses a lot of templates,
`t-call` and view inheritance. Adding a `t-cache` can therefore modify
the rendering of a template that you do not see when editing.
(`t-foreach` it\'s like a `t-set` for each iteration)

Example:

``` xml
<div>
    <t t-set="a" t-value="1"/>
    <inside>
        <t t-set="a" t-value="2"/>
        <t t-out="a"/>
    </inside>
    <outside t-out="a"/>

    <t t-set="b" t-value="1"/>
    <inside t-cache="True">
        <t t-set="b" t-value="2"/>
        <t t-out="b"/>
    </inside>
    <outside t-out="b"/>
</div>
```

Will render:

``` xml
<div>
    <inside>2</inside>
    <outside>2</inside>

    <inside>2</inside>
    <outside>1</inside>
</div>
```

#### The base of `t-nocache`

The template part contained in a node with a `t-nocache` attribute is
not cached. This content is therefore **dynamic** and is rendered
systematically. However the available values are those provided by the
controller (when calling the `_render` method).

Example:

``` xml
<section>
    <article t-cache="record">
        <title><t t-out="record.name"/> <i t-nocache="">(views: <t t-out="counter"/>)</i></titlle>
        <content t-out="record.description"/>
    </article>
</section>
```

Will render (counter = 1):

``` xml
<section>
    <article>
        <title>The record name <i>(views: 1)</i></titlle>
        <content>Record description</content>
    </article>
</section>
```

Here the `<i>` tag that contains the container will always be rendered.
While the rest is as a single string in the cache.

#### `t-nocache` and scoped root values (`t-set`, `t-foreach`\...)

The contents of the `t-nocache` tag can be used for documentation and to
explain why the directive is added. The values are scoped into
`t-nocache`, these values are root values only (values provided by the
controller and/or when calling the `_render` method of `ir.qweb`).
`t-set` can be done in the template part, but will not be available
elsewhere.

Example:

``` xml
<section>
    <t t-set="counter" t-value="counter * 10"/>
    <header t-nocache="">
        <t t-set="counter" t-value="counter + 5"/>
        (views: <t t-out="counter"/>)
    </header>
    <article t-cache="record">
        <title><t t-out="record.name"/> <i t-nocache="">(views: <t t-out="counter"/>)</i></titlle>
        <content t-out="record.description"/>
    </article>
    <footer>(views: <t t-out="counter"/>)</footer>
</section>
```

Will render (counter = 1):

``` xml
<section>
    <header>
        (views: 6)
    </header>
    <article>
        <title>The record name <i>(views: 1)</i></titlle>
        <content>Record description</content>
    </article>
    <footer>(views: 10)</footer>
</section>
```

Here the `<i>` tag that contains the container will always be rendered.
While the rest is as a single string in the cache. The counter is not
updated by the `t-set` out of the `t-nocache`

#### `t-nocache-*` add some primitive values in the cache

In order to be able to use values generated in the template, it is
possible to cache them. The directive is used as `t-nocache-*="expr"`
where `*` is the name of the chosen value and `expr` the python
expression so the result will be cached. The cached value must be
primitive type.

Example:

``` xml
<section t-cache="records">
    <article t-foreach="records" t-as="record">
        <header>
            <title t-field="record.get_method_title()"/>
        </header>
        <footer t-nocache="This part has a dynamic counter and must be rendered all the time."
                t-nocache-cached_value="record.get_base_counter()">
            <span t-out="counter + cached_value"/>
        </footer>
    </article>
</section>
```

The value `cached_value` is cached with the cached template part of
`t-cache="records"` and add to the scoped root values each time.

### Helpers

#### Request-based

Most Python-side uses of QWeb are in controllers (and during HTTP
requests), in which case templates stored in the database (as
`views <reference/views/qweb>`{.interpreted-text role="ref"}) can be
trivially rendered by calling
`odoo.http.HttpRequest.render`{.interpreted-text role="meth"}:

``` python
response = http.request.render('my-template', {
    'context_value': 42
})
```

This automatically creates a `~odoo.http.Response`{.interpreted-text
role="class"} object which can be returned from the controller (or
further customized to suit).

#### View-based

At a deeper level than the previous helper is the `_render` method on
`ir.qweb` (use the datable) and the public module method `render`
(don\'t use the database):

> Renders a QWeb view/template by database id or
> `external id`{.interpreted-text role="term"}. Templates are
> automatically loaded from `ir.qweb` records.
>
> `_prepare_environment` method sets up a number of default values in
> the rendering context. The `http_routing` and `website` addons, also
> default values they need. You can use `minimal_qcontext=False` option
> to avoid this default value like the public method `render`:
>
> ::: rst-class
> o-definition-list
> :::
>
> `request`
>
> :   the current `~odoo.http.Request`{.interpreted-text role="class"}
>     object, if any
>
> `debug`
>
> :   whether the current request (if any) is in `debug` mode
>
> `quote_plus <werkzeug.urls.url_quote_plus>`{.interpreted-text role="func"}
>
> :   url-encoding utility function
>
> `json`{.interpreted-text role="mod"}
>
> :   the corresponding standard library module
>
> `time`{.interpreted-text role="mod"}
>
> :   the corresponding standard library module
>
> `datetime`{.interpreted-text role="mod"}
>
> :   the corresponding standard library module
>
> [relativedelta](https://labix.org/python-dateutil#head-ba5ffd4df8111d1b83fc194b97ebecf837add454)
>
> :   see module
>
> `keep_query`
>
> :   the `keep_query` helper function
>
> <!-- -->
>
> param values
> :   context values to pass to QWeb for rendering
>
> param str engine
> :   name of the Odoo model to use for rendering, can be used to expand
>     or customize QWeb locally (by creating a \"new\" qweb based on
>     `ir.qweb` with alterations)

> 
>
> `load(ref)`{.interpreted-text role="func"}
>
> :   returns etree object, ref

:::: {#reference/qweb/javascript}
::: todo
the members below are no longer relevant, section to rewrite
:::
::::

## Javascript

### Exclusive directives

#### Defining templates

The `t-name` directive can only be placed at the top-level of a template
file (direct children to the document root):

``` xml
<templates>
    <t t-name="template-name">
        <!-- template code -->
    </t>
</templates>
```

It takes no other parameter, but can be used with a `<t>` element or any
other. With a `<t>` element, the `<t>` should have a single child.

The template name is an arbitrary string, although when multiple
templates are related (e.g. called sub-templates) it is customary to use
dot-separated names to indicate hierarchical relationships.

#### Template inheritance {#reference/qweb/template_inheritance}

Template inheritance is used to either:

:   - Alter existing templates in-place, e.g. to add information to
      templates

created by other modules.

:   - Create a new template from a given parent template

Template inheritance is performed via the use of two directives:

:   - `t-inherit` which is the name of the template to inherit from,
    - `t-inherit-mode` which is the behaviour of the inheritance: it can
      either be set to `primary` to create a new child template from the
      parented one or to `extension` to alter the parent template in
      place.

An optional `t-name` directive can also be specified. It will be the
name of the newly created template if used in primary mode, else it will
be added as a comment on the transformed template to help retrace
inheritances.

For the inheritance itself, the changes are done using xpaths
directives. See the
[XPATH](https://developer.mozilla.org/en-US/docs/Web/XPath)
documentation for the complete set of available instructions.

Primary inheritance (child template):

``` xml
<t t-name="child.template" t-inherit="base.template" t-inherit-mode="primary">
    <xpath expr="//ul" position="inside">
        <li>new element</li>
    </xpath>
</t>
```

Extension inheritance (in-place transformation):

``` xml
<t t-inherit="base.template" t-inherit-mode="extension">
    <xpath expr="//tr[1]" position="after">
        <tr><td>new cell</td></tr>
    </xpath>
</t>
```

#### Old inheritance mechanism (deprecated)

Template inheritance is performed via the `t-extend` directive which
takes the name of the template to alter as parameter.

The directive `t-extend` will act as a primary inheritance when combined
with `t-name` and as an extension one when used alone.

In both cases the alteration is then performed with any number of
`t-jquery` sub-directives:

``` xml
<t t-extend="base.template">
    <t t-jquery="ul" t-operation="append">
        <li>new element</li>
    </t>
</t>
```

The `t-jquery` directives takes a [CSS
selector](https://api.jquery.com/category/selectors/). This selector is
used on the extended template to select *context nodes* to which the
specified `t-operation` is applied:

::: rst-class
o-definition-list
:::

`append`

:   the node\'s body is appended at the end of the context node (after
    the context node\'s last child)

`prepend`

:   the node\'s body is prepended to the context node (inserted before
    the context node\'s first child)

`before`

:   the node\'s body is inserted right before the context node

`after`

:   the node\'s body is inserted right after the context node

`inner`

:   the node\'s body replaces the context node\'s children

`replace`

:   the node\'s body is used to replace the context node itself

`attributes`

:   the nodes\'s body should be any number of `attribute` elements, each
    with a `name` attribute and some textual content, the named
    attribute of the context node will be set to the specified value
    (either replaced if it already existed or added if not)

No operation

:   if no `t-operation` is specified, the template body is interpreted
    as javascript code and executed with the context node as `this`

    :::: warning
    ::: title
    Warning
    :::

    while much more powerful than other operations, this mode is also
    much harder to debug and maintain, it is recommended to avoid it
    ::::

### debugging

The javascript QWeb implementation provides a few debugging hooks:

::: rst-class
o-definition-list
:::

`t-log`

:   takes an expression parameter, evaluates the expression during
    rendering and logs its result with `console.log`:

    ``` xml
    <t t-set="foo" t-value="42"/>
    <t t-log="foo"/>
    ```

    will print `42` to the console

`t-debug`

:   triggers a debugger breakpoint during template rendering:

    ``` xml
    <t t-if="a_test">
        <t t-debug=""/>
    </t>
    ```

    will stop execution if debugging is active (exact condition depend
    on the browser and its development tools)

`t-js`

:   the node\'s body is javascript code executed during template
    rendering. Takes a `context` parameter, which is the name under
    which the rendering context will be available in the `t-js`\'s body:

    ``` xml
    <t t-set="foo" t-value="42"/>
    <t t-js="ctx">
        console.log("Foo is", ctx.foo);
    </t>
    ```

### Helpers

> (core is the `web.core` module) An instance of
> `QWeb2.Engine`{.interpreted-text role="js:class"} with all
> module-defined template files loaded, and references to standard
> helper objects `_` (underscore), `_t` (translation function) and
> [JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON).
>
> `core.qweb.render <QWeb2.Engine.render>`{.interpreted-text
> role="js:func"} can be used to easily render basic module templates

### API {#reference/qweb/api}

> The QWeb \"renderer\", handles most of QWeb\'s logic (loading,
> parsing, compiling and rendering templates).
>
> Odoo Web instantiates one for the user in the core module, and exports
> it to `core.qweb`. It also loads all the template files of the various
> modules into that QWeb instance.
>
> A `QWeb2.Engine`{.interpreted-text role="js:class"} also serves as a
> \"template namespace\".
>
> > Renders a previously loaded template to a String, using `context`
> > (if provided) to find the variables accessed during template
> > rendering (e.g. strings to display).
> >
> > param String template
> > :   the name of the template to render
> >
> > param Object context
> > :   the basic namespace to use for template rendering
> >
> > returns
> > :   String
>
> The engine exposes an other method which may be useful in some cases
> (e.g. if you need a separate template namespace with, in Odoo Web,
> Kanban views get their own `QWeb2.Engine`{.interpreted-text
> role="js:class"} instance so their templates don\'t collide with more
> general \"module\" templates):
>
> > Loads a template file (a collection of templates) in the QWeb
> > instance. The templates can be specified as:
> >
> > An XML string
> >
> > :   QWeb will attempt to parse it to an XML document then load it.
> >
> > A URL
> >
> > :   QWeb will attempt to download the URL content, then load the
> >     resulting XML string.
> >
> > A `Document` or `Node`
> >
> > :   QWeb will traverse the first level of the document (the child
> >     nodes of the provided root) and load any named template or
> >     template override.
> >
> > <!-- -->
> >
> > type templates
> > :   String \| Document \| Node
>
> A `QWeb2.Engine`{.interpreted-text role="js:class"} also exposes
> various attributes for behavior customization:
>
> > Prefix used to recognize directives during parsing. A string. By
> > default, `t`.
>
> > Boolean flag putting the engine in \"debug mode\". Normally, QWeb
> > intercepts any error raised during template execution. In debug
> > mode, it leaves all exceptions go through without intercepting them.
>
> > The jQuery instance used during template inheritance processing.
> > Defaults to `window.jQuery`.
>
> > A `Function`. If present, called before compiling each DOM node to
> > template code. In Odoo Web, this is used to automatically translate
> > text content and some attributes in templates. Defaults to `null`.

[^1]: although it uses a few others, either for historical reasons or
    because they remain better fits for the use case. Odoo 9.0 still
    depends on [Jinja](##REF##Jinja) and [Mako](##REF##Mako).

[^2]: it is similar in that to [Genshi](##REF##Genshi), although it does
    not use (and has no support for) [XML
    namespaces](##REF##XML namespaces)




--- SOURCE: developer/reference/frontend/registries.md ---

# Registries {#frontend/registries}

Registries are (ordered) key/value maps. They are the main web client
extension points: many features provided by the Odoo javascript
framework simply look up into a registry whenever it needs a definition
for some object (such as fields, views, client actions or services).
Customizing the web client is then simply done by adding specific values
in the correct registry.

``` javascript
import { Registry } from "@web/core/registry";

const myRegistry = new Registry();

myRegistry.add("hello", "odoo");

console.log(myRegistry.get("hello"));
```

A useful feature of registries is that they maintain a set of sub
registries, obtained by the [category]{.title-ref} method. If the sub
registry does not exist yet, it is created on the fly. All registries
used by the web client are obtained in such a way from one root
registry, exported in [\@web/core/registry]{.title-ref}.

``` javascript
import { registry } from "@web/core/registry";

const fieldRegistry = registry.category("fields");
const serviceRegistry = registry.category("services");
const viewRegistry = registry.category("views");
```

## Registry API

> Creates a new registry. Note that a registry is an event bus, so one
> can listen to the [UPDATE]{.title-ref} event if necessary. Registries
> are ordered: the `getAll <Registry.getAll>`{.interpreted-text
> role="js:meth"} method returns a list of values ordered according to
> their sequence number.
>
> > 
> >
> > param string key
> > :   key for the new entry
> >
> > param any value
> > :   value for the new entry
> >
> > param Object options
> > :   options
> >
> > param boolean \[options.force\]
> > :   do not throw if key already exists
> >
> > param number \[options.sequence\]
> > :   sequence number (useful to order entries)
> >
> > returns
> > :   Registry
> >
> > Inserts a value at a specific key. If the key is already used, this
> > method throws an error (unless the option [force]{.title-ref} is set
> > to true). The option [sequence]{.title-ref} is useful to insert the
> > value at a specific position. This method also triggers an
> > [UPDATE]{.title-ref} event.
> >
> > Returns the same registry, so [add]{.title-ref} method calls can be
> > chained.
>
> > 
> >
> > param string key
> > :   key for the entry
> >
> > param defaultValue any
> > :   return value if no entry for key exists
> >
> > Returns the value corresponding to the [key]{.title-ref} argument.
> > If the registry does not contain that key, this method returns
> > [defaultValue]{.title-ref} if given, or throws an error otherwise.
>
> > 
> >
> > param string key
> > :   key for the entry
> >
> > returns
> > :   boolean
> >
> > Returns [true]{.title-ref} if [key]{.title-ref} is present in the
> > registry
>
> > 
> >
> > returns
> > :   any\[\]
> >
> > Returns the list of all elements in the registry. It is ordered
> > according to the sequence numbers.
>
> > 
> >
> > param string key
> > :   the key for the entry that should be removed
> >
> > Removes a key/value pair from the registry. This operation triggers
> > an [UPDATE]{.title-ref} event.
>
> > 
> >
> > param string subcategory
> > :   the name for the sub category
> >
> > returns
> > :   Registry
> >
> > Returns the sub registry associated with the
> > [subcategory]{.title-ref}. If it does not exist yet, the sub
> > registry is created on the fly.

## Reference List

  -----------------------------------------------------------------------------------------------------------------------------
  Category                                                                    Content
  --------------------------------------------------------------------------- -------------------------------------------------
  `effects <frontend/registries/effects>`{.interpreted-text role="ref"}       implementation for all available effects

  `formatters <frontend/registries/formatters>`{.interpreted-text role="ref"} utility functions to format values (mostly used
                                                                              for field values)

  `main_components <frontend/registries/main_components>`{.interpreted-text   top level components
  role="ref"}                                                                 

  `parsers <frontend/registries/parsers>`{.interpreted-text role="ref"}       utility functions to parse values (mostly used
                                                                              for field values)

  `services <frontend/registries/services>`{.interpreted-text role="ref"}     all services that should be activated

  `systray <frontend/registries/systray>`{.interpreted-text role="ref"}       components displayed in the systray zone in the
                                                                              navbar

  `user_menuitems <frontend/registries/usermenu>`{.interpreted-text           menu items displayed in the user menu (top right
  role="ref"}                                                                 of navbar)
  -----------------------------------------------------------------------------------------------------------------------------

### Effect registry {#frontend/registries/effects}

The [effects]{.title-ref} registry contains the implementations of all
available effects. See the section on the
`effect service <frontend/services/effect_registry>`{.interpreted-text
role="ref"} for more details.

### Formatter registry {#frontend/registries/formatters}

The [formatters]{.title-ref} registry contains functions to format
values. Each formatter has the following API:

> 
>
> param value
> :   a value of a specific type, or [false]{.title-ref} if no value is
>     given
>
> type value
> :   T \| false
>
> param Object options
> :   various options
>
> returns
> :   string
>
> Formats a value and returns a string

::: seealso
\- `Parsers registry <frontend/registries/parsers>`{.interpreted-text
role="ref"}
:::

### Main components registry {#frontend/registries/main_components}

The main component registry ([main_components]{.title-ref}) is useful
for adding top level components in the web client. The webclient has a
[MainComponentsContainer]{.title-ref} as direct child. This component is
basically a live representation of the ordered list of components
registered in the main components registry.

API

:   ``` text
    interface {
        Component: Owl Component class
        props?: any
    }
    ```

For example, the [LoadingIndicator]{.title-ref} component can be added
in the registry like this:

``` javascript
registry.category("main_components").add("LoadingIndicator", {
  Component: LoadingIndicator,
});
```

### Parser registry {#frontend/registries/parsers}

The [parsers]{.title-ref} registry contains functions to parse values.
Each parser has the following API:

::: seealso
\-
`Formatters registry <frontend/registries/formatters>`{.interpreted-text
role="ref"}
:::

### Service registry {#frontend/registries/services}

The service registry (category: [services]{.title-ref}) contains all
`services <frontend/services>`{.interpreted-text role="ref"} that should
be activated by the Odoo framework.

``` javascript
import { registry } from "@web/core/registry";

const myService = {
    dependencies: [...],
    start(env, deps) {
        // some code here
    }
};

registry.category("services").add("myService", myService);
```

### Systray registry {#frontend/registries/systray}

The systray is the zone on the right of the navbar that contains various
small components, that usually display some sort of information (like
the number of unread messages), notifications and/or let the user
interact with them.

The [systray]{.title-ref} registry contains a description of these
systray items, as objects with the following three keys:

- \`Component\`: the component class that represents the item. Its root
  element should be a [\<li\>]{.title-ref} tag, otherwise it might not
  be styled properly.
- \`props (optional)\`: props that should be given to the component
- \`isDisplayed (optional)\`: a function that takes the
  `env <frontend/framework/environment>`{.interpreted-text role="ref"}
  and returns a boolean. If true, the systray item is displayed.
  Otherwise it is removed.

For example:

``` javascript
import { registry } from "@web/core/registry";

class MySystrayItem extends Component {
    // some component ...
}

registry.category("systray").add("myAddon.myItem", {
    Component: MySystrayItem,
});
```

The systray registry is an ordered registry (with the
[sequence]{.title-ref} number):

``` javascript
const item = {
    Component: MySystrayItem
};
registry.category("systray").add("myaddon.some_description", item, { sequence: 43 });
```

The sequence number defaults to 50. If given, this number will be used
to order the items. The lowest sequence is on the right and the highest
sequence is on the left in the systray menu.

### Usermenu registry {#frontend/registries/usermenu}

The user menu registry (category: [user_menuitems]{.title-ref}) contains
all menu items that are shown when opening the user menu (the navbar
element with the user name, on the top right).

User menu items are defined by a function taking the
`env <frontend/framework/environment>`{.interpreted-text role="ref"} and
returning a plain object, containing the following information:

- [description]{.title-ref} : the menu item text,
- [href]{.title-ref} : (optional) if given (and truthy), the item text
  is put in a [a]{.title-ref} tag with given attribute href,
- [callback]{.title-ref} : callback to call when the item is selected,
- \`hide\`: (optional) indicates if the item should be hidden (default:
  [false]{.title-ref}),
- \`sequence\`: (optional) determines the rank of the item among the
  other dropwdown items (default: 100).

The user menu calls all the functions defining items every time it is
opened.

Example:

``` javascript
import { registry } from "@web/core/registry";

registry.category("user_menuitems").add("my item", (env) => {
    return {
        description: env._t("Technical Settings"),
        callback: () => { env.services.action_manager.doAction(3); },
        hide: (Math.random() < 0.5),
    };
});
```




--- SOURCE: developer/reference/frontend/services.md ---

# Services {#frontend/services}

Services are long lived pieces of code that provide a feature. They may
be imported by components (with `useService`) or by other services.
Also, they can declare a set of dependencies. In that sense, services
are basically a DI `dependency injection`{.interpreted-text role="dfn"}
system. For example, the `notification` service provides a way to
display a notification, or the `rpc` service is the proper way to
perform a request to the Odoo server.

The following example registers a simple service that displays a
notification every 5 seconds:

``` javascript
import { registry } from "@web/core/registry";

const myService = {
    dependencies: ["notification"],
    start(env, { notification }) {
        let counter = 1;
        setInterval(() => {
            notification.add(`Tick Tock ${counter++}`);
        }, 5000);
    }
};

registry.category("services").add("myService", myService);
```

At startup, the web client starts all services present in the
[services]{.title-ref} registry. Note that the name used in the registry
is the name of the service.

:::: note
::: title
Note
:::

Most code that is not a component should be *packaged* in a service, in
particular if it performs some side effect. This is very useful for
testing purposes: tests can choose which services are active, so there
are less chance for unwanted side effects interfering with the code
being tested.
::::

## Defining a service

A service needs to implement the following interface:

> Optional list of strings. It is the list of all dependencies (other
> services) that this service needs

> 
>
> param Environment env
> :   the application environment
>
> param Object deps
> :   all requested dependencies
>
> returns
> :   value of service or Promise\<value of service\>
>
> This is the main definition for the service. It can return either a
> value or a promise. In that case, the service loader simply waits for
> the promise to resolve to a value, which is then the value of the
> service.
>
> Some services do not export any value. They may just do their work
> without a need to be directly called by other code. In that case,
> their value will be set to `null` in `env.services`.

> Optional value. If given, it should be [true]{.title-ref} or a list of
> strings.
>
> Some services need to provide an asynchronous API. For example, the
> [rpc]{.title-ref} service is an asynchronous function, or the
> [orm]{.title-ref} service provides a set of functions to call the Odoo
> server.
>
> In that case, it is possible for components that use a service to be
> destroyed before the end of an asynchronous function call. Most of the
> time, the asynchronous function call needs to be ignored. Doing
> otherwise is potentially very risky, because the underlying component
> is no longer active. The [async]{.title-ref} flag is a way to do just
> that: it signals to the service creator that all asynchronous calls
> coming from components should be left pending if the component is
> destroyed.

## Using a service

A service that depends on other services and has properly declared its
`dependencies` simply receives a reference to the corresponding services
in the second argument of the `start` method.

The `useService` hook is the proper way to use a service in a component.
It simply returns a reference to the service value, that can then be
used by the component later. For example:

``` javascript
import { useService } from "@web/core/utils/hooks";

class MyComponent extends Component {
  setup() {
    const rpc = useService("rpc");

    onWillStart(async () => {
      this.someValue = await rpc(...);
    });
  }
}
```

## Reference List

  -------------------------------------------------------------------------------------------------------------------------
  Technical Name                                                      Short Description
  ------------------------------------------------------------------- -----------------------------------------------------
  `cookie <frontend/services/cookie>`{.interpreted-text role="ref"}   read or modify cookies

  `effect <frontend/services/effect>`{.interpreted-text role="ref"}   display graphical effects

  `http <frontend/services/http>`{.interpreted-text role="ref"}       perform low level http calls

  `notification <frontend/services/notification>`{.interpreted-text   display notifications
  role="ref"}                                                         

  `router <frontend/services/router>`{.interpreted-text role="ref"}   manage the browser url

  `rpc <frontend/services/rpc>`{.interpreted-text role="ref"}         send requests to the server

  `scroller <frontend/services/scroller>`{.interpreted-text           handle clicks on anchors elements
  role="ref"}                                                         

  `title <frontend/services/title>`{.interpreted-text role="ref"}     read or modify the window title

  `user <frontend/services/user>`{.interpreted-text role="ref"}       provides some information related to the current user
  -------------------------------------------------------------------------------------------------------------------------

### Cookie service {#frontend/services/cookie}

#### Overview

- Technical name: [cookie]{.title-ref}
- Dependencies: none

Provides a way to manipulate cookies. For example:

``` javascript
cookieService.setCookie("hello", "odoo");
```

#### API

> Object representing each cookie and its value if any (or empty string)

> 
>
> param string name
> :   the name of the cookie that should be set
>
> param any value
> :   optional. If given, the cookie will be set to that value
>
> param number ttl
> :   optional. the time in seconds before the cookie will be deleted
>     (default=1 year)
>
> Sets the cookie [name]{.title-ref} to the value [value]{.title-ref}
> with a max age of [ttl]{.title-ref}

> 
>
> param string name
> :   name of the cookie
>
> Deletes the cookie [name]{.title-ref}.

### Effect service {#frontend/services/effect}

#### Overview

- Technical name: [effect]{.title-ref}
- Dependencies: None

Effects are graphical elements that can be temporarily displayed on top
of the page, usually to provide feedback to the user that something
interesting happened.

A good example would be the rainbow man:

![The rainbow man effect](services/rainbow_man.png){.align-center
width="600px"}

Here\'s how this can be displayed:

``` javascript
const effectService = useService("effect");
effectService.add({
  type: "rainbow_man", // can be omitted, default type is already "rainbow_man"
  message: "Boom! Team record for the past 30 days.",
});
```

#### API

> 
>
> param object options
> :   the options for the effect. They will get passed along to the
>     underlying effect component.
>
> Display an effect.

The options are defined by:

``` ts
interface EffectOptions {
  // The name of the desired effect
  type?: string;
  [paramName: string]: any;
}
```

#### Available effects

Currently, the only effect is the rainbow man.

##### RainbowMan

``` javascript
effectService.add({ type: "rainbow_man" });
```

+------------------------------------+--------------------------------------------------------------------+------------------------------+
| Name                               | Type                                                               | Description                  |
+====================================+====================================================================+==============================+
| [params.Component]{.title-ref}     | [owl.Component?]{.title-ref}                                       | Component class to           |
|                                    |                                                                    | instantiate inside the       |
|                                    |                                                                    | RainbowMan (will replace the |
|                                    |                                                                    | message).                    |
+------------------------------------+--------------------------------------------------------------------+------------------------------+
| [params.props]{.title-ref}         | [object?={}]{.title-ref}                                           | If params.Component is       |
|                                    |                                                                    | given, its props can be      |
|                                    |                                                                    | passed with this argument.   |
+------------------------------------+--------------------------------------------------------------------+------------------------------+
| [params.message]{.title-ref}       | [string?=\"Well Done!\"]{.title-ref}                               | Message is the notice the    |
|                                    |                                                                    | rainbowman holds.            |
|                                    |                                                                    |                              |
|                                    |                                                                    | If effects are disabled for  |
|                                    |                                                                    | the user, the rainbowman     |
|                                    |                                                                    | won\'t appear and a simple   |
|                                    |                                                                    | notification will get        |
|                                    |                                                                    | displayed as a fallback.     |
|                                    |                                                                    |                              |
|                                    |                                                                    | If effects are enabled and   |
|                                    |                                                                    | params.Component is given,   |
|                                    |                                                                    | params.message is not used.  |
|                                    |                                                                    |                              |
|                                    |                                                                    | The message is a simple      |
|                                    |                                                                    | string or a string           |
|                                    |                                                                    | representing html (prefer    |
|                                    |                                                                    | using params.Component if    |
|                                    |                                                                    | you want interactions in the |
|                                    |                                                                    | DOM).                        |
+------------------------------------+--------------------------------------------------------------------+------------------------------+
| [params.messageIsHtml]{.title-ref} | [boolean?=false]{.title-ref}                                       | Set to true if the message   |
|                                    |                                                                    | represents html, s.t. it     |
|                                    |                                                                    | will be correctly inserted   |
|                                    |                                                                    | into the DOM.                |
+------------------------------------+--------------------------------------------------------------------+------------------------------+
| [params.img_url]{.title-ref}       | [string?=/web/static/img/smile.svg]{.title-ref}                    | The url of the image to      |
|                                    |                                                                    | display inside the rainbow.  |
+------------------------------------+--------------------------------------------------------------------+------------------------------+
| [params.fadeout]{.title-ref}       | [(\"slow\"\|\"medium\"\|\"fast\"\|\"no\")?=\"medium\"]{.title-ref} | Delay for rainbowman to      |
|                                    |                                                                    | disappear.                   |
|                                    |                                                                    |                              |
|                                    |                                                                    | [\"fast\"]{.title-ref} will  |
|                                    |                                                                    | make rainbowman dissapear    |
|                                    |                                                                    | quickly.                     |
|                                    |                                                                    |                              |
|                                    |                                                                    | [\"medium\"]{.title-ref} and |
|                                    |                                                                    | [\"slow\"]{.title-ref} will  |
|                                    |                                                                    | wait little longer before    |
|                                    |                                                                    | disappearing (can be used    |
|                                    |                                                                    | when                         |
|                                    |                                                                    | [params.message]{.title-ref} |
|                                    |                                                                    | is longer).                  |
|                                    |                                                                    |                              |
|                                    |                                                                    | [\"no\"]{.title-ref} will    |
|                                    |                                                                    | keep rainbowman on screen    |
|                                    |                                                                    | until user clicks anywhere   |
|                                    |                                                                    | outside rainbowman.          |
+------------------------------------+--------------------------------------------------------------------+------------------------------+

#### How to add an effect

::: {#frontend/services/effect_registry}
The effects are stored in a registry called [effects]{.title-ref}. You
can add new effects by providing a name and a function.
:::

``` javascript
const effectRegistry = registry.category("effects");
effectRegistry.add("rainbow_man", rainbowManEffectFunction);
```

The function must follow this API:

> 
>
> param Env env
> :   the environment received by the service
>
> param object params
> :   the params received from the add function on the service.
>
> returns
> :   [({Component, props} \| void)]{.title-ref} A component and its
>     props or nothing.

This function must create a component and return it. This component is
mounted inside the effect component container.

#### Example

Let\'s say we want to add an effect that add a sepia look at the page.

``` javascript
/** @odoo-module **/

import { registry } from "@web/core/registry";
const { Component, tags } = owl;

class SepiaEffect extends Component {}
SepiaEffect.template = tags.xml`
    <div style="
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        background: rgba(124,87,0, 0.4);
    "></div>
`;

export function sepiaEffectProvider(env, params = {}) {
    return {
        Component: SepiaEffect,
    };
}

const effectRegistry = registry.category("effects");
effectRegistry.add("sepia", sepiaEffectProvider);
```

And then, call it somewhere you want and you will see the result. Here,
it is called in webclient.js to make it visible everywhere for the
example.

``` javascript
const effectService = useService("effect");
effectService.add({ type: "sepia" });
```

![Odoo in sepia](services/odoo_sepia.png){.align-center width="600px"}

### Http Service {#frontend/services/http}

#### Overview

- Technical name: [http]{.title-ref}
- Dependencies: None

While most interactions between the client and the server in odoo are
[RPCs]{.title-ref} ([XMLHTTPRequest]{.title-ref}), lower level control
on requests may sometimes be required.

This service provides a way to send [get]{.title-ref} and
[post]{.title-ref} [http
requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).

#### API

> 
>
> param string route
> :   the url to send the request to
>
> param string readMethod
> :   the response content type. Can be \"text\", \"json\",
>     \"formData\", \"blob\", \"arrayBuffer\".
>
> returns
> :   the result of the request with the format defined by the
>     readMethod argument.
>
> Sends a get request.

> 
>
> param string route
> :   the url to send the request to
>
> param object params
> :   key value data to be set in the form data part of the request
>
> param string readMethod
> :   the response content type. Can be \"text\", \"json\",
>     \"formData\", \"blob\", \"arrayBuffer\".
>
> returns
> :   the result of the request with the format defined by the
>     readMethod argument.
>
> Sends a post request.

#### Example

``` javascript
const httpService = useService("http");
const data = await httpService.get("https://something.com/posts/1");
// ...
await httpService.post("https://something.com/posts/1", { title: "new title", content: "new content" });
```

### Notification service {#frontend/services/notification}

#### Overview

- Technical name: [notification]{.title-ref}
- Dependencies: None

The [notification]{.title-ref} service allows to display notifications
on the screen.

``` javascript
const notificationService = useService("notification");
notificationService.add("I'm a very simple notification");
```

#### API

> 
>
> param string message
> :   the notification message to display
>
> param object options
> :   the options of the notification
>
> returns
> :   a function to close the notification
>
> Shows a notification.
>
> The options are defined by:
>
>   -----------------------------------------------------------------------------------------
>   Name                      Type                    Description
>   ------------------------- ----------------------- ---------------------------------------
>   [title]{.title-ref}       string                  Add a title to the notification
>
>   [type]{.title-ref}        [warning]{.title-ref}   Changes the background color according
>                             \| [danger]{.title-ref} to the type
>                             \|                      
>                             [success]{.title-ref}   
>                             \| [info]{.title-ref}   
>
>   [sticky]{.title-ref}      boolean                 Whether or not the notification should
>                                                     stay until dismissed
>
>   [className]{.title-ref}   string                  additional css class that will be added
>                                                     to the notification
>
>   [onClose]{.title-ref}     function                callback to be executed when the
>                                                     notification closes
>
>   [buttons]{.title-ref}     button\[\] (see below)  list of button to display in the
>                                                     notification
>   -----------------------------------------------------------------------------------------
>
> The buttons are defined by:
>
>   -------------------------------------------------------------------------------------
>   Name                    Type                  Description
>   ----------------------- --------------------- ---------------------------------------
>   [name]{.title-ref}      string                The button text
>
>   [onClick]{.title-ref}   function              callback to execute when the button is
>                                                 clicked
>
>   [primary]{.title-ref}   boolean               whether the button should be styled as
>                                                 a primary button
>   -------------------------------------------------------------------------------------

#### Examples

A notification for when a sale deal is made with a button to go some
kind of commission page.

``` javascript
// in setup
this.notificationService = useService("notification");
this.actionService = useService("action");

// later
this.notificationService.add("You closed a deal!", {
  title: "Congrats",
  type: "success",
  buttons: [
      {
          name: "See your Commission",
          onClick: () => {
              this.actionService.doAction("commission_action");
          },
      },
  ],
});
```

![Example of notification](services/notification_service.png){.align-center
width="600px"}

A notification that closes after a second:

``` javascript
const notificationService = useService("notification");
const close = notificationService.add("I will be quickly closed");
setTimeout(close, 1000);
```

### Router Service {#frontend/services/router}

#### Overview

- Technical name: [router]{.title-ref}
- Dependencies: none

The [router]{.title-ref} service provides three features:

- information about the current route
- a way for the application to update the url, depending on its state
- listens to every hash change, and notifies the rest of the application

#### API

For example:

``` javascript
// url = /web?debug=assets#action=123&owl&menu_id=174
const { pathname, search, hash } = env.services.router.current;
console.log(pathname); //   /web
console.log(search); //   { debug="assets" }
console.log(hash); //   { action:123, owl: "", menu_id: 174 }
```

Updating the URL is done with the [pushState]{.title-ref} method:

> 
>
> param Object hash
> :   object containing a mapping from some keys to some values
>
> param boolean replace
> :   if true, the url will be replaced, otherwise only key/value pairs
>     from the [hash]{.title-ref} will be updated.
>
> Updates the URL with each key/value pair from the [hash]{.title-ref}
> object. If a value is set to an empty string, the key is added to the
> url without any corresponding value.
>
> If true, the [replace]{.title-ref} argument tells the router that the
> url hash should be completely replaced (so values not present in the
> [hash]{.title-ref} object will be removed).
>
> This method call does not reload the page. It also does not trigger a
> [hashchange]{.title-ref} event, nor a [ROUTE_CHANGE]{.title-ref} in
> the `main bus <frontend/framework/bus>`{.interpreted-text role="ref"}.
> This is because this method is intended to only updates the url. The
> code calling this method has the responsibility to make sure that the
> screen is updated as well.

For example:

``` javascript
// url = /web#action_id=123
routerService.pushState({ menu_id: 321 });
// url is now /web#action_id=123&menu_id=321
routerService.pushState({ yipyip: "" }, replace: true);
// url is now /web#yipyip
```

Finally, the [redirect]{.title-ref} method will redirect the browser to
a specified url:

> 
>
> param string url
> :   a valid url
>
> param boolean wait
> :   if true, wait for the server to be ready, and redirect after
>
> Redirect the browser to [url]{.title-ref}. This method reloads the
> page. The [wait]{.title-ref} argument is rarely used: it is useful in
> some cases where we know that the server will be unavailable for a
> short duration, typically just after an addon update or install
> operation.

:::: note
::: title
Note
:::

The router service emits a [ROUTE_CHANGE]{.title-ref} event on the
`main bus <frontend/framework/bus>`{.interpreted-text role="ref"}
whenever the current route has changed.
::::

### RPC service {#frontend/services/rpc}

#### Overview

- Technical name: [rpc]{.title-ref}
- Dependencies: none

The [rpc]{.title-ref} service provides a single asynchronous function to
send requests to the server. Calling a controller is very simple: the
route should be the first argument and optionally, a `params` object can
be given as a second argument.

``` javascript
// in setup
this.rpc = useService("rpc");

// somewhere else, in an async function:
const result = await this.rpc("/my/route", { some: "value" });
```

:::: note
::: title
Note
:::

Note that the `rpc` service is considered a low-level service. It should
only be used to interact with Odoo controllers. To work with models
(which is by far the most important usecase), one should use the `orm`
service instead.
::::

#### API

> 
>
> param string route
> :   route targeted by the request
>
> param Object params
> :   (optional) parameters sent to the server
>
> param Object settings
> :   (optional) request settings (see below)
>
> The `settings` object can contain:
>
> - `xhr`, which should be a `XMLHTTPRequest` object. In that case, the
>   `rpc` method will simply use it instead of creating a new one. This
>   is useful when one accesses advanced features of the
>   [XMLHTTPRequest]{.title-ref} API.
> - `silent (boolean)` If set to `true`, the web client will not provide
>   a feedback that there is a pending rpc.

The `rpc` service communicates with the server by using a
`XMLHTTPRequest` object, configured to work with the `application/json`
content type. So clearly the content of the request should be JSON
serializable. Each request done by this service uses the `POST` http
method.

Server errors actually return the response with an http code 200. But
the `rpc` service will treat them as error.

#### Error Handling

An rpc can fail for two main reasons:

- either the odoo server returns an error (so, we call this a `server`
  error). In that case the http request will return with an http code
  200 BUT with a response object containing an `error` key.
- or there is some other kind of network error

When a rpc fails, then:

- the promise representing the rpc is rejected, so the calling code will
  crash, unless it handles the situation

- an event `RPC_ERROR` is triggered on the main application bus. The
  event payload contains a description of the cause of the error:

  If it is a server error (the server code threw an exception). In that
  case the event payload will be an object with the following keys:

  - `type = 'server'`
  - `message(string)`
  - `code(number)`
  - `name(string)` (optional, used by the error service to look for an
    appropriate dialog to use when handling the error)
  - `subType(string)` (optional, often used to determine the dialog
    title)
  - `data(object)` (optional object that can contain various keys among
    which `debug` : the main debug information, with the call stack)

  If it is a network error, then the error description is simply an
  object `{type: 'network'}`. When a network error occurs, a
  `notification <frontend/services/notification>`{.interpreted-text
  role="ref"} is displayed and the server is regularly contacted until
  it responds. The notification is closed as soon as the server
  responds.

### Scroller service {#frontend/services/scroller}

#### Overview

- Technical name: [scroller]{.title-ref}
- Dependencies: none

Whenever the user clicks on an anchor in the web client, this service
automatically scrolls to the target (if appropriate).

The service adds an event listener to get [click]{.title-ref}\'s on the
document. The service checks if the selector contained in its href
attribute is valid to distinguish anchors and Odoo actions (e.g. [\<a
href=\"#target_element\"\>\</a\>]{.title-ref}). It does nothing if it is
not the case.

An event [SCROLLER:ANCHOR_LINK_CLICKED]{.title-ref} is triggered on the
main application bus if the click seems to be targeted at an element.
The event contains a custom event containing the [element]{.title-ref}
matching and its [id]{.title-ref} as a reference. It may allow other
parts to handle a behavior relative to anchors themselves. The original
event is also given as it might need to be prevented. If the event is
not prevented, then the user interface will scroll to the target
element.

#### API

The following values are contained in the
[anchor-link-clicked]{.title-ref} custom event explained above.

  -------------------------------------------------------------------------------------
  Name                       Type                   Description
  -------------------------- ---------------------- -----------------------------------
  [element]{.title-ref}      [HTMLElement \|        The anchor element targeted by the
                             null]{.title-ref}      href

  [id]{.title-ref}           [string]{.title-ref}   The id contained in the href

  [originalEv]{.title-ref}   [Event]{.title-ref}    The original click event
  -------------------------------------------------------------------------------------

:::: note
::: title
Note
:::

The scroller service emits a [SCROLLER:ANCHOR_LINK_CLICKED]{.title-ref}
event on the `main bus <frontend/framework/bus>`{.interpreted-text
role="ref"}. To avoid the default scroll behavior of the scroller
service, you must use [preventDefault()]{.title-ref} on the event given
to the listener so that you can implement your own behavior correctly
from the listener.
::::

### Title Service {#frontend/services/title}

#### Overview

- Technical name: [title]{.title-ref}
- Dependencies: none

The [title]{.title-ref} service offers a simple API that allows to
read/modify the document title. For example, if the current document
title is \"Odoo\", we can change it to \"Odoo 15 - Apple\" by using the
following command:

``` javascript
// in some component setup method
const titleService = useService("title");

titleService.setParts({ odoo: "Odoo 15", fruit: "Apple" });
```

#### API

The `title` service manipulates the following interface:

``` ts
interface Parts {
    [key: string]: string | null;
}
```

Each key represents the identity of a part of the title, and each value
is the string that is displayed, or [null]{.title-ref} if it has been
removed.

Its API is:

> 
>
> returns
> :   Parts the current [Parts]{.title-ref} object maintained by the
>     title service

> 
>
> param Parts parts
> :   object representing the required change
>
> The `setParts` method allows to add/replace/delete several parts of
> the title. Delete a part (a value) is done by setting the associated
> key value to [null]{.title-ref}.
>
> Note that one can only modify a single part without affecting the
> other parts. For example, if the title is composed of the following
> parts:
>
> ``` javascript
> { odoo: "Odoo", action: "Import" }
> ```
>
> with `current` value being `Odoo - Import` , then
>
> ``` javascript
> setParts({
>   action: null,
> });
> ```
>
> will change the title to `Odoo`.

### User service {#frontend/services/user}

#### Overview

- Technical name: [user]{.title-ref}
- Dependencies: [rpc]{.title-ref}

The [user]{.title-ref} service provides a bunch of data and a few helper
functions concerning the connected user.

#### API

  -----------------------------------------------------------------------------------------------------------
  Name               Type                 Description
  ------------------ -------------------- -------------------------------------------------------------------
  `context`          `Object`             The
                                          `user context<frontend/framework/user_context>`{.interpreted-text
                                          role="ref"}

  `db`               `Object`             Info about the database

  `home_action_id`   `(number | false)`   Id of the action used as home for the user

  `isAdmin`          `boolean`            Whether the user is an admin (group
                                          [base.group_erp_manager]{.title-ref} or superuser)

  `isSystem`         `boolean`            Whether the user is part of the system group
                                          ([base.group_system]{.title-ref})

  `lang`             `string`             language used

  `name`             `string`             Name of the user

  `partnerId`        `number`             Id of the partner instance of the user

  `tz`               `string`             The timezone of the user

  `userId`           `number`             Id of the user

  `userName`         `string`             Alternative nick name of the user
  -----------------------------------------------------------------------------------------------------------

> 
>
> param object update
> :   the object to update the context with
>
> update the
> `user context<frontend/framework/user_context>`{.interpreted-text
> role="ref"} with the given object.
>
> ``` javascript
> userService.updateContext({ isFriend: true })
> ```

> 
>
> param string key
> :   the key of the targeted attribute
>
> remove the value with the given key from the
> `user context<frontend/framework/user_context>`{.interpreted-text
> role="ref"}
>
> ``` javascript
> userService.removeFromContext("isFriend")
> ```

> 
>
> param string group
> :   the xml_id of the group to look for
>
> returns
> :   [Promise\<boolean\>]{.title-ref} is the user in the group
>
> check if the user is part of a group
>
> ``` javascript
> const isInSalesGroup = await userService.hasGroup("sale.group_sales")
> ```




--- SOURCE: developer/reference/frontend.md ---

nosearch

:   

# JavaScript framework

::: {.toctree titlesonly=""}
frontend/framework_overview frontend/assets frontend/javascript_modules
frontend/owl_components frontend/registries frontend/services
frontend/hooks frontend/patching_code frontend/javascript_reference
frontend/mobile frontend/qweb frontend/odoo_editor
:::




--- SOURCE: developer/reference/standard_modules/account/account_account.md ---

# Account {#reference/account_account}

::::::::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountAccountTemplate

::: autofield
name
:::

::: autofield
currency_id
:::

::: autofield
code
:::

::: autofield
account_type
:::

::: autofield
reconcile
:::

::: autofield
note
:::

::: autofield
tax_ids
:::

::: autofield
nocreate
:::

::: autofield
chart_template_id
:::

::: autofield
tag_ids
:::
:::::::::::::




--- SOURCE: developer/reference/standard_modules/account/account_account_tag.md ---

# Account Tag {#reference/account_account_tag}

::::::::: {.automodel main=""}
odoo.addons.account.models.account_account_tag.AccountAccountTag

::: autofield
name
:::

::: autofield
applicability
:::

::: autofield
color
:::

::: autofield
active
:::

::: autofield
tax_negate
:::

::: autofield
country_id
:::
:::::::::




--- SOURCE: developer/reference/standard_modules/account/account_chart_template.md ---

# Chart Template {#reference/account_chart_template}

::::::::::::::::::::::::::::::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountChartTemplate

::: autofield
name
:::

::: autofield
parent_id
:::

::: autofield
code_digits
:::

::: autofield
visible
:::

::: autofield
currency_id
:::

::: autofield
country_id
:::

::: autofield
use_anglo_saxon
:::

::: autofield
bank_account_code_prefix
:::

::: autofield
cash_account_code_prefix
:::

::: autofield
transfer_account_code_prefix
:::

::: autofield
account_ids
:::

::: autofield
income_currency_exchange_account_id
:::

::: autofield
expense_currency_exchange_account_id
:::

::: autofield
account_journal_suspense_account_id
:::

::: autofield
account_journal_payment_debit_account_id
:::

::: autofield
account_journal_payment_credit_account_id
:::

::: autofield
default_cash_difference_income_account_id
:::

::: autofield
default_cash_difference_expense_account_id
:::

::: autofield
default_pos_receivable_account_id
:::

::: autofield
property_account_receivable_id
:::

::: autofield
property_account_payable_id
:::

::: autofield
property_account_expense_categ_id
:::

::: autofield
property_account_income_categ_id
:::

::: autofield
property_account_expense_id
:::

::: autofield
property_account_income_id
:::

::: autofield
property_stock_account_input_categ_id
:::

::: autofield
property_stock_account_output_categ_id
:::

::: autofield
property_stock_valuation_account_id
:::

::: autofield
property_tax_payable_account_id
:::

::: autofield
property_tax_receivable_account_id
:::

::: autofield
property_advance_tax_payment_account_id
:::

::: autofield
property_cash_basis_base_account_id
:::
:::::::::::::::::::::::::::::::::::

:::: automodel
odoo.addons.l10n_multilang.models.account.AccountChartTemplate

Multi language support for Chart of Accounts, Taxes, Tax Codes,
Journals, Accounting Templates, Analytic Chart of Accounts and Analytic
Journals.

::: autofield
spoken_languages
:::
::::




--- SOURCE: developer/reference/standard_modules/account/account_fiscal_position.md ---

# Fiscal Position {#reference/account_fiscal_position}

:::::::::::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountFiscalPositionTemplate

::: autofield
sequence
:::

::: autofield
name
:::

::: autofield
chart_template_id
:::

::: autofield
account_ids
:::

::: autofield
tax_ids
:::

::: autofield
note
:::

::: autofield
auto_apply
:::

::: autofield
vat_required
:::

::: autofield
country_id
:::

::: autofield
country_group_id
:::

::: autofield
state_ids
:::

::: autofield
zip_from
:::

::: autofield
zip_to
:::
::::::::::::::::




--- SOURCE: developer/reference/standard_modules/account/account_group.md ---

# Account Group {#reference/account_group}

:::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountGroupTemplate

::: autofield
parent_id
:::

::: autofield
name
:::

::: autofield
code_prefix_start
:::

::: autofield
code_prefix_end
:::

::: autofield
chart_template_id
:::
::::::::




--- SOURCE: developer/reference/standard_modules/account/account_report.md ---

# Report

::::::::::::::::::::::::::: {.automodel main=""}
odoo.addons.account.models.account_report.AccountReport

::: autofield
name
:::

::: autofield
line_ids
:::

::: autofield
column_ids
:::

::: autofield
root_report_id
:::

::: autofield
chart_template_id
:::

::: autofield
country_id
:::

::: autofield
only_tax_exigible
:::

::: autofield
availability_condition
:::

::: autofield
load_more_limit
:::

::: autofield
search_bar
:::

::: autofield
default_opening_date_filter
:::

::: autofield
filter_multi_company
:::

::: autofield
filter_date_range
:::

::: autofield
filter_show_draft
:::

::: autofield
filter_unreconciled
:::

::: autofield
filter_unfold_all
:::

::: autofield
filter_period_comparison
:::

::: autofield
filter_growth_comparison
:::

::: autofield
filter_journals
:::

::: autofield
filter_analytic
:::

::: autofield
filter_hierarchy
:::

::: autofield
filter_account_type
:::

::: autofield
filter_partner
:::

::: autofield
filter_fiscal_position
:::
:::::::::::::::::::::::::::




--- SOURCE: developer/reference/standard_modules/account/account_report_line.md ---

# Report Line

::::::::::::: {.automodel main=""}
odoo.addons.account.models.account_report.AccountReportLine

::: autofield
name
:::

::: autofield
expression_ids
:::

::: autofield
report_id
:::

::: autofield
hierarchy_level
:::

::: autofield
parent_id
:::

::: autofield
children_ids
:::

::: autofield
foldable
:::

::: autofield
print_on_new_page
:::

::: autofield
action_id
:::

::: autofield
hide_if_zero
:::
:::::::::::::




--- SOURCE: developer/reference/standard_modules/account/account_tax.md ---

# Taxes {#reference/account_tax}

:::::::::::::::::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountTaxTemplate

::: autofield
chart_template_id
:::

::: autofield
name
:::

::: autofield
type_tax_use
:::

::: autofield
tax_scope
:::

::: autofield
amount_type
:::

::: autofield
active
:::

::: autofield
children_tax_ids
:::

::: autofield
sequence
:::

::: autofield
amount
:::

::: autofield
description
:::

::: autofield
price_include
:::

::: autofield
include_base_amount
:::

::: autofield
is_base_affected
:::

::: autofield
analytic
:::

::: autofield
invoice_repartition_line_ids
:::

::: autofield
refund_repartition_line_ids
:::

::: autofield
tax_group_id
:::

::: autofield
tax_exigibility
:::

::: autofield
cash_basis_transition_account_id
:::
::::::::::::::::::::::




--- SOURCE: developer/reference/standard_modules/account/account_tax_repartition.md ---

# Tax Repartitions {#reference/account_tax_repartition}

:::::::::: {.automodel main=""}
odoo.addons.account.models.chart_template.AccountTaxRepartitionLineTemplate

::: autofield
factor_percent
:::

::: autofield
repartition_type
:::

::: autofield
account_id
:::

::: autofield
invoice_tax_id
:::

::: autofield
refund_tax_id
:::

::: autofield
tag_ids
:::

::: autofield
use_in_tax_closing
:::
::::::::::




--- SOURCE: developer/reference/standard_modules/account.md ---

nosearch

:   

# Accounting

::: {.toctree titlesonly=""}
account/account_account_tag account/account_account
account/account_chart_template account/account_fiscal_position
account/account_group account/account_report account/account_report_line
account/account_tax account/account_tax_repartition
:::




--- SOURCE: developer/reference/standard_modules/payment/payment_provider.md ---

hide-page-toc

:   

# Payment Provider

::::::::::::: autoclass
odoo.addons.payment.models.payment_provider.PaymentProvider()

::: automethod
[compute_feature_support_fields]{#compute_feature_support_fields}
:::

::: automethod
[compute_fees]{#compute_fees}
:::

::: automethod
[compute_view_configuration_fields]{#compute_view_configuration_fields}
:::

::: automethod
[get_compatible_providers]{#get_compatible_providers}
:::

::: automethod
[get_redirect_form_view]{#get_redirect_form_view}
:::

::: automethod
[get_validation_amount]{#get_validation_amount}
:::

::: automethod
[get_validation_currency]{#get_validation_currency}
:::

::: automethod
[is_tokenization_required]{#is_tokenization_required}
:::

::: automethod
[should_build_inline_form]{#should_build_inline_form}
:::

::: automethod
[get_removal_values]{#get_removal_values}
:::
:::::::::::::




--- SOURCE: developer/reference/standard_modules/payment/payment_token.md ---

hide-page-toc

:   

# Payment Token

::::::: autoclass
odoo.addons.payment.models.payment_token::PaymentToken()

::: automethod
[build_display_name]{#build_display_name}
:::

::: automethod
[get_specific_create_values]{#get_specific_create_values}
:::

::: automethod
[handle_archiving]{#handle_archiving}
:::

::: automethod
get_linked_records_info
:::
:::::::




--- SOURCE: developer/reference/standard_modules/payment/payment_transaction.md ---

hide-page-toc

:   

# Payment Transaction

::::::::::::::::::::: autoclass
odoo.addons.payment.models.payment_transaction::PaymentTransaction()

::: automethod
[compute_reference]{#compute_reference}
:::

::: automethod
[compute_reference_prefix]{#compute_reference_prefix}
:::

::: automethod
[get_post_processing_values]{#get_post_processing_values}
:::

::: automethod
[get_specific_create_values]{#get_specific_create_values}
:::

::: automethod
[get_specific_processing_values]{#get_specific_processing_values}
:::

::: automethod
[get_specific_rendering_values]{#get_specific_rendering_values}
:::

::: automethod
[get_tx_from_notification_data]{#get_tx_from_notification_data}
:::

::: automethod
[handle_notification_data]{#handle_notification_data}
:::

::: automethod
[process_notification_data]{#process_notification_data}
:::

::: automethod
[send_capture_request]{#send_capture_request}
:::

::: automethod
[send_payment_request]{#send_payment_request}
:::

::: automethod
[send_refund_request]{#send_refund_request}
:::

::: automethod
[send_void_request]{#send_void_request}
:::

::: automethod
[set_authorized]{#set_authorized}
:::

::: automethod
[set_canceled]{#set_canceled}
:::

::: automethod
[set_done]{#set_done}
:::

::: automethod
[set_error]{#set_error}
:::

::: automethod
[set_pending]{#set_pending}
:::
:::::::::::::::::::::




--- SOURCE: developer/reference/standard_modules/payment.md ---

hide-page-toc

:   

# Payment

::: {.toctree titlesonly=""}
payment/payment_provider payment/payment_token
payment/payment_transaction
:::




--- SOURCE: developer/reference/standard_modules.md ---

nosearch

:   

# Standard modules

::: {.toctree titlesonly=""}
standard_modules/account standard_modules/payment
:::




--- SOURCE: developer/reference/upgrades/upgrade_scripts.md ---

# Upgrade scripts

An upgrade script is a Python file containing a function called
`migrate`{.interpreted-text role="meth"}, which the upgrade process
invokes during the update of a module.

::: method
migrate(cr, version)

param cr
:   current database cursor

type cr
:   `~odoo.sql_db.Cursor`{.interpreted-text role="class"}

param str version
:   installed version of the module
:::

Typically, this function executes one or multiple SQL queries and can
also access Odoo\'s ORM, as well as the
`./upgrade_utils`{.interpreted-text role="doc"}.

## Writing upgrade scripts

Upgrade scripts follow a specific tree structure with a naming
convention which determines when they are executed.

The structure of an upgrade script path is
`$module/migrations/$version/{pre,post,end}-*.py`{.interpreted-text
role="file"}, where [\$module]{.title-ref} is the module for which the
script will run, [\$version]{.title-ref} is the full version of the
module (including Odoo\'s major version and the module\'s minor version)
and [{pre\|post\|end}-\*.py]{.title-ref} is the file that needs to be
executed. The file\'s name will determine the `phase
<upgrade-scripts/phases>`{.interpreted-text role="ref"} and order in
which it is executed for that module and version.

:::: note
::: title
Note
:::

From Odoo 13 the top-level directory for the upgrade scripts can also be
named [upgrades]{.title-ref}. This naming is preferred since it has the
correct meaning: *migrate* can be confused with *moving out of Odoo*.
Thus `$module/upgrades/$version/`{.interpreted-text role="file"} is also
valid.
::::

:::: note
::: title
Note
:::

Upgrade scripts are only executed when the module is being updated.
Therefore, the module\'s minor version set in the
[\$version]{.title-ref} directory needs to be higher than the module\'s
installed version and equal or lower to the updated version of the
module.
::::

::: example
Directory structure of an upgrade script for a custom module named
[awesome_partner]{.title-ref} upgraded to version [2.0]{.title-ref} on
Odoo 17.

``` text
awesome_partner/
|-- migrations/
|   |-- 17.0.2.0/
|   |   |-- pre-exclamation.py
```

Two upgrade scripts examples with the content of the
`pre-exclamation.py`{.interpreted-text role="file"}, file adding \"!\"
at the end of partners\' names:

``` python
import logging

_logger = logging.getLogger(__name__)


def migrate(cr, version):
    cr.execute("UPDATE res_partner SET name = name || '!'")
    _logger.info("Updated %s partners", cr.rowcount)
```

``` python
import logging
from odoo.upgrade import util

_logger = logging.getLogger(__name__)


def migrate(cr, version):
    env = util.env(cr)

    partners = env["res.partner"].search([])
    for partner in partners:
        partner.name += "!"

    _logger.info("Updated %s partners", len(partners))
```

Note that in the second example, the script takes advantage of the
`./upgrade_utils`{.interpreted-text role="doc"} to access the ORM. Check
the documentation to find out more about this library.
:::

## Phases of upgrade scripts {#upgrade-scripts/phases}

The upgrade process consists of three phases for each version of each
module:

> 1.  The pre-phase, before the module is loaded.
> 2.  The post-phase, after the module and its dependencies are loaded
>     and updated.
> 3.  The end-phase, after all modules have been loaded and updated for
>     that version.

Upgrade scripts are grouped according to the first part of their
filenames into the corresponding phase. Within each phase, the files are
executed according to their lexical order.

::: admonition
Execution order of example scripts for one module in one version

1.  `pre-10-do_something.py`{.interpreted-text role="file"}
2.  `pre-20-something_else.py`{.interpreted-text role="file"}
3.  `post-do_something.py`{.interpreted-text role="file"}
4.  `post-something.py`{.interpreted-text role="file"}
5.  `end-01-migrate.py`{.interpreted-text role="file"}
6.  `end-migrate.py`{.interpreted-text role="file"}
:::




--- SOURCE: developer/reference/upgrades/upgrade_utils.md ---

# Upgrade utils

[Upgrade utils](https://github.com/odoo/upgrade-util/) is a library that
contains helper functions to facilitate the writing of upgrade scripts.
This library, used by Odoo for the upgrade scripts of standard modules,
provides reliability and helps speed up the upgrade process:

- The helper functions help make sure the data is consistent in the
  database.
- It takes care of indirect references of the updated records.
- Allows calling functions and avoid writing code, saving time and
  reducing development risks.
- Helpers allow to focus on what is important for the upgrade and not
  think of details.

## Installation

Clone the [Upgrade utils
repository](https://github.com/odoo/upgrade-util/) locally and start
`odoo` with the `src` directory prepended to the `--upgrade-path`
option.

``` console
$ ./odoo-bin --upgrade-path=/path/to/upgrade-util/src,/path/to/other/upgrade/script/directory [...]
```

On platforms where you do not manage Odoo yourself, you can install this
library via \`pip\`:

``` console
$ python3 -m pip install git+https://github.com/odoo/upgrade-util@master
```

On [Odoo.sh](https://www.odoo.sh/) it is recommended to add it to the
`requirements.txt`{.interpreted-text role="file"} of the custom
repository. For this, add the following line inside the file:

    odoo_upgrade @ git+https://github.com/odoo/upgrade-util@master

## Using upgrade utils

Once installed, the following packages are available for the upgrade
scripts:

- `odoo.upgrade.util`{.interpreted-text role="mod"}: the helper itself.
- `odoo.upgrade.testing`{.interpreted-text role="mod"}: base TestCase
  classes.

To use it in upgrade scripts, simply import it:

``` python
from odoo.upgrade import util


def migrate(cr, version):
   # Rest of the script
```

Now, the helper functions are available to be called through `util`.

## Util functions

Upgrade utils provides many useful functions to ease the upgrade
process. Here, we describe some of the most useful ones. Refer to the
[util folder](https://github.com/odoo/upgrade-util/tree/master/src/util)
for the comprehensive declaration of helper functions.

:::: note
::: title
Note
:::

The `cr`{.interpreted-text role="attr"} parameter in util functions
always refers to the database cursor. Pass the one received as a
parameter in `migrate`{.interpreted-text role="meth"}. Not all functions
need this parameter.
::::

::: currentmodule
odoo.upgrade.util
:::

### Modules

::: {.automodule members=""}
odoo.upgrade.util.modules
:::

### Models

::: {.automodule members=""}
odoo.upgrade.util.models
:::

### Fields

::: {.automodule members=""}
odoo.upgrade.util.fields
:::

### Records

::: {.automodule members=""}
odoo.upgrade.util.records
:::

### ORM

::: {.automodule members=""}
odoo.upgrade.util.orm
:::

::: {.automodule members=""}
odoo.upgrade.util.domains
:::

### SQL

::: {.automodule members=""}
odoo.upgrade.util.pg
:::

### Misc

::: {.automodule members=""}
odoo.upgrade.util.misc
:::

## Testing upgrade scripts

::: {.automodule members=""}
odoo.upgrade.testing
:::




--- SOURCE: developer/reference/upgrades.md ---

nosearch

:   

# Upgrades

::: {.toctree titlesonly=""}
upgrades/upgrade_scripts upgrades/upgrade_utils
:::




--- SOURCE: developer/reference/user_interface/icons.md ---

hide-page-toc

:   

# UI icons

Odoo\'s user interface mostly relies on [FontAwesome4
icons](https://fontawesome.com/v4/icons/).

To cover FontAwesome\'s lack of iconography for specific
functionalities, we designed our own icon-font. These icons can be
rendered using the main [oi]{.title-ref} class in conjunction with the
specific icon class.

::: example
``` html
<i class="oi oi-odoo"/>
```
:::

<section class="row">

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-apps h1 p-4"></i>
            <code>oi-apps</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-group h1 p-4"></i>
            <code>oi-group</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-launch h1 p-4"></i>
            <code>oi-launch</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-odoo h1 p-4"></i>
            <code>oi-odoo</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-panel-right h1 p-4"></i>
            <code>oi-panel-right</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-search h1 p-4"></i>
            <code>oi-search</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-settings-adjust h1 p-4"></i>
            <code>oi-settings-adjust</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-studio h1 p-4"></i>
            <code>oi-studio</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-view-cohort h1 p-4"></i>
            <code>oi-view-cohort</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-view-kanban h1 p-4"></i>
            <code>oi-view-kanban</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-view-list h1 p-4"></i>
            <code>oi-view-list</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-view-pivot h1 p-4"></i>
            <code>oi-view-pivot</code>
        </div>
    </div>

    <div class="o_icon_card col-6 col-sm-4 col-md-3 col-xl-2 mb-3">
        <div class="card text-center">
            <i class="oi oi-voip h1 p-4"></i>
            <code>oi-voip</code>
        </div>
    </div>

</section>




--- SOURCE: developer/reference/user_interface/scss_inheritance.md ---

# SCSS inheritance

## Overview

Managing SCSS assets in Odoo is not as straightforward as it is in some
other environments, but it\'s highly efficient.

Modularity is key. The inheritance scheme described further allows Odoo
to:

- customize the Bootstrap CSS framework;
- handle two different webclient designs (Community and Enterprise);
- handle backend and frontend bundles separately (including the user\'s
  website design);
- contextually load only necessary assets;
- handle multiple color-schemes (e.g.: dark-mode);

## SCSS\'s [!default]{.title-ref} directive

\"Direct variables' overrides\" are technically possible in SCSS but may
lead to inconsistent results in complex environments like Odoo.

::: example
``` {.scss caption=":file:`library.scss`"}
$foo: red;
```

``` {.scss caption=":file:`customization_layer.scss`"}
$foo: blue; // -> Don't!
```
:::

Indeed, since the compilation process acts across different
interdependent bundles, re-assigning a variable in the \"wrong spot\"
may lead to unexpected cascading results.

SCSS provides several techniques to overcome these issues (e.g.:
[shadowing](https://sass-lang.com/documentation/variables#shadowing)),
but the most critical procedure in Odoo is the use of the
[!default]{.title-ref} flag.

When using the [!default]{.title-ref} flag, the compiler assigns a value
**only** if that variable is not yet defined.

As a result of this technique, the priority in which variables are
assigned matches the assets\' loading order.

::: example
``` {.scss caption=":file:`customization_layer.scss`"}
$foo: red !default;
```

``` {.scss caption=":file:`library.scss`"}
$foo: blue !default; // -> Already defined, line ignored.
$bar: black !default; // -> Not defined yet, value assigned.
```

``` {caption=":file:`component.scss`"}
.component {
   color: $foo; // -> 'color: red;'
   background: $bar; // -> 'background: black;'
}
```
:::

::: seealso
[!default]{.title-ref} flag on the [SASS
Documentation](https://sass-lang.com/documentation/variables#default-values)
:::

## Odoo\'s SCSS inheritance system

The following diagram conceptually illustrates the compilation order in
which the CSS and SCSS variables are defined.

``` text
↓ [Compilation starts]
⏐
↓ web.dark_mode_variables
⏐   ├─ Primary Variables
⏐   └─ Components Variables
⏐
↓ web._assets_primary_variables
⏐   ├─ Primary Variables (enterprise)
⏐   ├─ Components Variables (enterprise)
⏐   ├─ Primary Variables (community)
⏐   └─ Components Variables (community)
⏐
↓ web._assets_bootstrap
⏐
↓ web.assets_backend
⏐   ├─ ...
⏐   ├─ CSS variables definition
⏐   └─ CSS variables contextual adaptations
⏐
● [Visual result on screen]
```

:::: important
::: title
Important
:::

This diagram is incomplete and does not match the current bundles\'
organization. Read more on
`asset bundles <reference/assets_bundle>`{.interpreted-text role="ref"}.
::::




--- SOURCE: developer/reference/user_interface.md ---

nosearch

:   

# User interface

::: {.toctree titlesonly=""}
user_interface/scss_inheritance user_interface/icons
:::




--- SOURCE: developer/reference.md ---

nosearch

:   

# Reference

::: {.toctree titlesonly=""}
reference/backend reference/frontend reference/user_interface
reference/standard_modules reference/cli reference/upgrades
reference/external_api reference/extract_api
:::




--- SOURCE: developer/tutorials/backend.md ---

orphan

:   

# Building a Module[]{#howto/base} {#howto/module}

:::: danger
::: title
Danger
:::

This tutorial is outdated. We recommend reading
`getting_started`{.interpreted-text role="doc"} instead.
::::

:::: warning
::: title
Warning
:::

This tutorial requires
`having installed Odoo </administration/on_premise>`{.interpreted-text
role="doc"}
::::

## Start/Stop the Odoo server

Odoo uses a client/server architecture in which clients are web browsers
accessing the Odoo server via RPC.

Business logic and extension is generally performed on the server side,
although supporting client features (e.g. new data representation such
as interactive maps) can be added to the client.

In order to start the server, simply invoke the command `odoo-bin
<reference/cmdline>`{.interpreted-text role="ref"} in the shell, adding
the full path to the file if necessary:

``` bash
odoo-bin
```

The server is stopped by hitting `Ctrl-C` twice from the terminal, or by
killing the corresponding OS process.

## Build an Odoo module

Both server and client extensions are packaged as *modules* which are
optionally loaded in a *database*.

Odoo modules can either add brand new business logic to an Odoo system,
or alter and extend existing business logic: a module can be created to
add your country\'s accounting rules to Odoo\'s generic accounting
support, while the next module adds support for real-time visualisation
of a bus fleet.

Everything in Odoo thus starts and ends with modules.

### Composition of a module

An Odoo module can contain a number of elements:

Business objects

:   Declared as Python classes, these resources are automatically
    persisted by Odoo based on their configuration

`Object views <reference/views>`{.interpreted-text role="ref"}

:   Definition of business objects UI display

`Data files <reference/data>`{.interpreted-text role="ref"}

:   XML or CSV files declaring the model metadata :

    - `views <reference/views>`{.interpreted-text role="ref"} or
      `reports <reference/reports>`{.interpreted-text role="ref"},
    - configuration data (modules parametrization,
      `security rules <reference/security>`{.interpreted-text
      role="ref"}),
    - demonstration data
    - and more

`Web controllers <reference/controllers>`{.interpreted-text role="ref"}

:   Handle requests from web browsers

Static web data

:   Images, CSS or javascript files used by the web interface or website

### Module structure

Each module is a directory within a *module directory*. Module
directories are specified by using the
`--addons-path <odoo-bin --addons-path>`{.interpreted-text
role="option"} option.

:::: {.tip .aphorism}
::: title
Tip
:::

most command-line options can also be set using `a configuration file
<reference/cmdline/config>`{.interpreted-text role="ref"}
::::

An Odoo module is declared by its
`manifest <reference/module/manifest>`{.interpreted-text role="ref"}.

A module is also a [Python
package](http://docs.python.org/2/tutorial/modules.html#packages) with a
`__init__.py` file, containing import instructions for various Python
files in the module.

For instance, if the module has a single `mymodule.py` file
`__init__.py` might contain:

    from . import mymodule

Odoo provides a mechanism to help set up a new module, `odoo-bin
<reference/cmdline/server>`{.interpreted-text role="ref"} has a
subcommand `scaffold
<reference/cmdline/scaffold>`{.interpreted-text role="ref"} to create an
empty module:

``` console
$ odoo-bin scaffold <module name> <where to put it>
```

The command creates a subdirectory for your module, and automatically
creates a bunch of standard files for a module. Most of them simply
contain commented code or XML. The usage of most of those files will be
explained along this tutorial.

::: exercise
Module creation

Use the command line above to create an empty module Open Academy, and
install it in Odoo.
:::

### Object-Relational Mapping

A key component of Odoo is the
`ORM (Object-Relational Mapping)`{.interpreted-text role="abbr"} layer.
This layer avoids having to write most
`SQL (Structured Query Language)`{.interpreted-text role="abbr"} by hand
and provides extensibility and security services[^1].

Business objects are declared as Python classes extending
`~odoo.models.Model`{.interpreted-text role="class"} which integrates
them into the automated persistence system.

Models can be configured by setting a number of attributes at their
definition. The most important attribute is
`~odoo.models.Model._name`{.interpreted-text role="attr"} which is
required and defines the name for the model in the Odoo system. Here is
a minimally complete definition of a model:

    from odoo import models
    class MinimalModel(models.Model):
        _name = 'test.model'

### Model fields

Fields are used to define what the model can store and where. Fields are
defined as attributes on the model class:

    from odoo import models, fields

    class LessMinimalModel(models.Model):
        _name = 'test.model2'

        name = fields.Char()

#### Common Attributes

Much like the model itself, its fields can be configured, by passing
configuration attributes as parameters:

    name = fields.Char(required=True)

Some attributes are available on all fields, here are the most common
ones:

`~odoo.fields.Field.string`{.interpreted-text role="attr"} (`unicode`, default: field\'s name)

:   The label of the field in UI (visible by users).

`~odoo.fields.Field.required`{.interpreted-text role="attr"} (`bool`, default: `False`)

:   If `True`, the field can not be empty, it must either have a default
    value or always be given a value when creating a record.

`~odoo.fields.Field.help`{.interpreted-text role="attr"} (`unicode`, default: `''`)

:   Long-form, provides a help tooltip to users in the UI.

`~odoo.fields.Field.index`{.interpreted-text role="attr"} (`bool`, default: `False`)

:   Requests that Odoo create a [database
    index](https://use-the-index-luke.com/sql/preface) on the column.

#### Simple fields

There are two broad categories of fields: \"simple\" fields which are
atomic values stored directly in the model\'s table and \"relational\"
fields linking records (of the same model or of different models).

Example of simple fields are `~odoo.fields.Boolean`{.interpreted-text
role="class"}, `~odoo.fields.Date`{.interpreted-text role="class"},
`~odoo.fields.Char`{.interpreted-text role="class"}.

#### Reserved fields

Odoo creates a few fields in all models[^2]. These fields are managed by
the system and shouldn\'t be written to. They can be read if useful or
necessary:

`~odoo.fields.Model.id`{.interpreted-text role="attr"} (`~odoo.fields.Id`{.interpreted-text role="class"})

:   The unique identifier for a record in its model.

`~odoo.fields.Model.create_date`{.interpreted-text role="attr"} (`~odoo.fields.Datetime`{.interpreted-text role="class"})

:   Creation date of the record.

`~odoo.fields.Model.create_uid`{.interpreted-text role="attr"} (`~odoo.fields.Many2one`{.interpreted-text role="class"})

:   User who created the record.

`~odoo.fields.Model.write_date`{.interpreted-text role="attr"} (`~odoo.fields.Datetime`{.interpreted-text role="class"})

:   Last modification date of the record.

`~odoo.fields.Model.write_uid`{.interpreted-text role="attr"} (`~odoo.fields.Many2one`{.interpreted-text role="class"})

:   user who last modified the record.

#### Special fields

By default, Odoo also requires a `name` field on all models for various
display and search behaviors. The field used for these purposes can be
overridden by setting `~odoo.models.Model._rec_name`{.interpreted-text
role="attr"}.

::: exercise
Define a model

Define a new data model *Course* in the *openacademy* module. A course
has a title and a description. Courses must have a title.
:::

### Data files

Odoo is a highly data driven system. Although behavior is customized
using [Python](https://python.org) code part of a module\'s value is in
the data it sets up when loaded.

:::: {.tip .aphorism}
::: title
Tip
:::

some modules exist solely to add data into Odoo
::::

Module data is declared via
`data files <reference/data>`{.interpreted-text role="ref"}, XML files
with `<record>` elements. Each `<record>` element creates or updates a
database record.

``` xml
<odoo>

        <record model="{model name}" id="{record identifier}">
            <field name="{a field name}">{a value}</field>
        </record>

</odoo>
```

- `model` is the name of the Odoo model for the record.
- `id` is an `external identifier`{.interpreted-text role="term"}, it
  allows referring to the record (without having to know its in-database
  identifier).
- `<field>` elements have a `name` which is the name of the field in the
  model (e.g. `description`). Their body is the field\'s value.

Data files have to be declared in the manifest file to be loaded, they
can be declared in the `'data'` list (always loaded) or in the `'demo'`
list (only loaded in demonstration mode).

::: exercise
Define demonstration data

Create demonstration data filling the *Courses* model with a few
demonstration courses.
:::

:::: tip
::: title
Tip
:::

The content of the data files is only loaded when a module is installed
or updated.

After making some changes, do not forget to use `odoo-bin -u openacademy
<reference/cmdline>`{.interpreted-text role="ref"} to save the changes
to your database.
::::

### Actions and Menus {#howtos/module/actions}

Actions and menus are regular records in database, usually declared
through data files. Actions can be triggered in three ways:

1.  by clicking on menu items (linked to specific actions)
2.  by clicking on buttons in views (if these are connected to actions)
3.  as contextual actions on object

Because menus are somewhat complex to declare there is a `<menuitem>`
shortcut to declare an `ir.ui.menu` and connect it to the corresponding
action more easily.

``` xml
<record model="ir.actions.act_window" id="action_list_ideas">
    <field name="name">Ideas</field>
    <field name="res_model">idea.idea</field>
    <field name="view_mode">tree,form</field>
</record>
<menuitem id="menu_ideas" parent="menu_root" name="Ideas" sequence="10"
          action="action_list_ideas"/>
```

:::: {.danger .aphorism}
::: title
Danger
:::

The action must be declared before its corresponding menu in the XML
file.

Data files are executed sequentially, the action\'s `id` must be present
in the database before the menu can be created.
::::

::: exercise
Define new menu entries

Define new menu entries to access courses under the OpenAcademy menu
entry. A user should be able to:

- display a list of all the courses
- create/modify courses
:::

## Basic views

Views define the way the records of a model are displayed. Each type of
view represents a mode of visualization (a list of records, a graph of
their aggregation, ...). Views can either be requested generically via
their type (e.g. *a list of partners*) or specifically via their id. For
generic requests, the view with the correct type and the lowest priority
will be used (so the lowest-priority view of each type is the default
view for that type).

`View inheritance <reference/views/inheritance>`{.interpreted-text
role="ref"} allows altering views declared elsewhere (adding or removing
content).

### Generic view declaration

A view is declared as a record of the model `ir.ui.view`. The view type
is implied by the root element of the `arch` field:

``` xml
<record model="ir.ui.view" id="view_id">
    <field name="name">view.name</field>
    <field name="model">object_name</field>
    <field name="priority" eval="16"/>
    <field name="arch" type="xml">
        <!-- view content: <form>, <tree>, <graph>, ... -->
    </field>
</record>
```

:::: {.danger .aphorism}
::: title
Danger
:::

The view\'s content is XML.

The `arch` field must thus be declared as `type="xml"` to be parsed
correctly.
::::

### Tree views

Tree views, also called list views, display records in a tabular form.

Their root element is `<tree>`. The simplest form of the tree view
simply lists all the fields to display in the table (each field as a
column):

``` xml
<tree string="Idea list">
    <field name="name"/>
    <field name="inventor_id"/>
</tree>
```

### Form views {#howtos/module/views/form}

Forms are used to create and edit single records.

Their root element is `<form>`. They are composed of high-level
structure elements (groups, notebooks) and interactive elements (buttons
and fields):

``` xml
<form string="Idea form">
    <group colspan="4">
        <group colspan="2" col="2">
            <separator string="General stuff" colspan="2"/>
            <field name="name"/>
            <field name="inventor_id"/>
        </group>

        <group colspan="2" col="2">
            <separator string="Dates" colspan="2"/>
            <field name="active"/>
            <field name="invent_date" readonly="1"/>
        </group>

        <notebook colspan="4">
            <page string="Description">
                <field name="description" nolabel="1"/>
            </page>
        </notebook>

        <field name="state"/>
    </group>
</form>
```

::: exercise
Customise form view using XML

Create your own form view for the Course object. Data displayed should
be: the name and the description of the course.
:::

::: exercise
Notebooks

In the Course form view, put the description field under a tab, such
that it will be easier to add other tabs later, containing additional
information.
:::

Form views can also use plain HTML for more flexible layouts:

``` xml
<form string="Idea Form">
    <header>
        <button string="Confirm" type="object" name="action_confirm"
                states="draft" class="oe_highlight" />
        <button string="Mark as done" type="object" name="action_done"
                states="confirmed" class="oe_highlight"/>
        <button string="Reset to draft" type="object" name="action_draft"
                states="confirmed,done" />
        <field name="state" widget="statusbar"/>
    </header>
    <sheet>
        <div class="oe_title">
            <label for="name" class="oe_edit_only" string="Idea Name" />
            <h1><field name="name" /></h1>
        </div>
        <separator string="General" colspan="2" />
        <group colspan="2" col="2">
            <field name="description" placeholder="Idea description..." />
        </group>
    </sheet>
</form>
```

### Search views

Search views customize the search field associated with the list view
(and other aggregated views). Their root element is `<search>` and
they\'re composed of fields defining which fields can be searched on:

``` xml
<search>
    <field name="name"/>
    <field name="inventor_id"/>
</search>
```

If no search view exists for the model, Odoo generates one which only
allows searching on the `name` field.

::: exercise
Search courses

Allow searching for courses based on their title or their description.
:::

## Relations between models

A record from a model may be related to a record from another model. For
instance, a sale order record is related to a client record that
contains the client data; it is also related to its sale order line
records.

::: exercise
Create a session model

For the module Open Academy, we consider a model for *sessions*: a
session is an occurrence of a course taught at a given time for a given
audience.

Create a model for *sessions*. A session has a name, a start date, a
duration and a number of seats. Add an action and a menu item to display
them. Make the new model visible via a menu item.
:::

### Relational fields

Relational fields link records, either of the same model (hierarchies)
or between different models.

Relational field types are:

`Many2one(other_model, ondelete='set null') <odoo.fields.Many2one>`{.interpreted-text role="class"}

:   A simple link to an other object:

        print(foo.other_id.name)

    ::: seealso
    [foreign
    keys](http://www.postgresql.org/docs/12/static/tutorial-fk.html)
    :::

`One2many(other_model, related_field) <odoo.fields.One2many>`{.interpreted-text role="class"}

:   A virtual relationship, inverse of a
    `~odoo.fields.Many2one`{.interpreted-text role="class"}. A
    `~odoo.fields.One2many`{.interpreted-text role="class"} behaves as a
    container of records, accessing it results in a (possibly empty) set
    of records:

        for other in foo.other_ids:
            print(other.name)

    :::: danger
    ::: title
    Danger
    :::

    Because a `~odoo.fields.One2many`{.interpreted-text role="class"} is
    a virtual relationship, there *must* be a
    `~odoo.fields.Many2one`{.interpreted-text role="class"} field in the
    `{other_model}`{.interpreted-text role="samp"}, and its name *must*
    be `{related_field}`{.interpreted-text role="samp"}
    ::::

`Many2many(other_model) <odoo.fields.Many2many>`{.interpreted-text role="class"}

:   Bidirectional multiple relationship, any record on one side can be
    related to any number of records on the other side. Behaves as a
    container of records, accessing it also results in a possibly empty
    set of records:

        for other in foo.other_ids:
            print(other.name)

::: exercise
Many2one relations

Using a many2one, modify the *Course* and *Session* models to reflect
their relation with other models:

- A course has a *responsible* user; the value of that field is a record
  of the built-in model `res.users`.
- A session has an *instructor*; the value of that field is a record of
  the built-in model `res.partner`.
- A session is related to a *course*; the value of that field is a
  record of the model `openacademy.course` and is required.
- Adapt the views.
:::

::: exercise
Inverse one2many relations

Using the inverse relational field one2many, modify the models to
reflect the relation between courses and sessions.
:::

::: exercise
Multiple many2many relations

Using the relational field many2many, modify the *Session* model to
relate every session to a set of *attendees*. Attendees will be
represented by partner records, so we will relate to the built-in model
`res.partner`. Adapt the views accordingly.
:::

## Inheritance

### Model inheritance

Odoo provides two *inheritance* mechanisms to extend an existing model
in a modular way.

The first inheritance mechanism allows a module to modify the behavior
of a model defined in another module:

- add fields to a model,
- override the definition of fields on a model,
- add constraints to a model,
- add methods to a model,
- override existing methods on a model.

The second inheritance mechanism (delegation) allows to link every
record of a model to a record in a parent model, and provides
transparent access to the fields of the parent record.

![image](../reference/backend/orm/inheritance_methods.png){.align-center}

::: seealso
\* `~odoo.models.Model._inherit`{.interpreted-text role="attr"} \*
`~odoo.models.Model._inherits`{.interpreted-text role="attr"}
:::

### View inheritance

Instead of modifying existing views in place (by overwriting them), Odoo
provides view inheritance where children \"extension\" views are applied
on top of root views, and can add or remove content from their parent.

An extension view references its parent using the `inherit_id` field,
and instead of a single view its `arch` field is composed of any number
of `xpath` elements selecting and altering the content of their parent
view:

``` xml
<!-- improved idea categories list -->
<record id="idea_category_list2" model="ir.ui.view">
    <field name="name">id.category.list2</field>
    <field name="model">idea.category</field>
    <field name="inherit_id" ref="id_category_list"/>
    <field name="arch" type="xml">
        <!-- find field description and add the field
             idea_ids after it -->
        <xpath expr="//field[@name='description']" position="after">
          <field name="idea_ids" string="Number of ideas"/>
        </xpath>
    </field>
</record>
```

`expr`

:   An [XPath](https://w3.org/TR/xpath) expression selecting a single
    element in the parent view. Raises an error if it matches no element
    or more than one

`position`

:   Operation to apply to the matched element:

    `inside`

    :   appends `xpath`\'s body at the end of the matched element

    `replace`

    :   replaces the matched element with the `xpath`\'s body, replacing
        any `$0` node occurrence in the new body with the original
        element

    `before`

    :   inserts the `xpath`\'s body as a sibling before the matched
        element

    `after`

    :   inserts the `xpaths`\'s body as a sibling after the matched
        element

    `attributes`

    :   alters the attributes of the matched element using special
        `attribute` elements in the `xpath`\'s body

:::: tip
::: title
Tip
:::

When matching a single element, the `position` attribute can be set
directly on the element to be found. Both inheritances below will give
the same result.

``` xml
<xpath expr="//field[@name='description']" position="after">
    <field name="idea_ids" />
</xpath>

<field name="description" position="after">
    <field name="idea_ids" />
</field>
```
::::

::: exercise
Alter existing content

- Using model inheritance, modify the existing *Partner* model to add an
  `instructor` boolean field, and a many2many field that corresponds to
  the session-partner relation
- Using view inheritance, display this fields in the partner form view
:::

#### Domains

In Odoo, `reference/orm/domains`{.interpreted-text role="ref"} are
values that encode conditions on records. A domain is a list of criteria
used to select a subset of a model\'s records. Each criteria is a triple
with a field name, an operator and a value.

For instance, when used on the *Product* model the following domain
selects all *services* with a unit price over *1000*:

    [('product_type', '=', 'service'), ('unit_price', '>', 1000)]

By default criteria are combined with an implicit AND. The logical
operators `&` (AND), `|` (OR) and `!` (NOT) can be used to explicitly
combine criteria. They are used in prefix position (the operator is
inserted before its arguments rather than between). For instance to
select products \"which are services *OR* have a unit price which is
*NOT* between 1000 and 2000\":

    ['|',
        ('product_type', '=', 'service'),
        '!', '&',
            ('unit_price', '>=', 1000),
            ('unit_price', '<', 2000)]

A `domain` parameter can be added to relational fields to limit valid
records for the relation when trying to select records in the client
interface.

::: exercise
Domains on relational fields

When selecting the instructor for a *Session*, only instructors
(partners with `instructor` set to `True`) should be visible.
:::

::: exercise
More complex domains

Create new partner categories *Teacher / Level 1* and *Teacher / Level
2*. The instructor for a session can be either an instructor or a
teacher (of any level).
:::

## Computed fields and default values

So far fields have been stored directly in and retrieved directly from
the database. Fields can also be *computed*. In that case, the field\'s
value is not retrieved from the database but computed on-the-fly by
calling a method of the model.

To create a computed field, create a field and set its attribute
`~odoo.fields.Field.compute`{.interpreted-text role="attr"} to the name
of a method. The computation method should simply set the value of the
field to compute on every record in `self`.

:::: {.danger .aphorism}
::: title
Danger
:::

`self` is a collection

The object `self` is a *recordset*, i.e., an ordered collection of
records. It supports the standard Python operations on collections, like
`len(self)` and `iter(self)`, plus extra set operations like
`recs1 + recs2`.

Iterating over `self` gives the records one by one, where each record is
itself a collection of size 1. You can access/assign fields on single
records by using the dot notation, like `record.name`.
::::

``` python
import random
from odoo import models, fields, api

class ComputedModel(models.Model):
    _name = 'test.computed'

    name = fields.Char(compute='_compute_name')

    def _compute_name(self):
        for record in self:
            record.name = str(random.randint(1, 1e6))
```

### Dependencies

The value of a computed field usually depends on the values of other
fields on the computed record. The ORM expects the developer to specify
those dependencies on the compute method with the decorator
`~odoo.api.depends`{.interpreted-text role="func"}. The given
dependencies are used by the ORM to trigger the recomputation of the
field whenever some of its dependencies have been modified:

    from odoo import models, fields, api

    class ComputedModel(models.Model):
        _name = 'test.computed'

        name = fields.Char(compute='_compute_name')
        value = fields.Integer()

        @api.depends('value')
        def _compute_name(self):
            for record in self:
                record.name = "Record with value %s" % record.value

::: exercise
Computed fields

- Add the percentage of taken seats to the *Session* model
- Display that field in the tree and form views
- Display the field as a progress bar
:::

### Default values

Any field can be given a default value. In the field definition, add the
option `default=X` where `X` is either a Python literal value (boolean,
integer, float, string), or a function taking a recordset and returning
a value:

    name = fields.Char(default="Unknown")
    user_id = fields.Many2one('res.users', default=lambda self: self.env.user)

:::: note
::: title
Note
:::

The object `self.env` gives access to request parameters and other
useful things:

- `self.env.cr` or `self._cr` is the database *cursor* object; it is
  used for querying the database
- `self.env.uid` or `self._uid` is the current user\'s database id
- `self.env.user` is the current user\'s record
- `self.env.context` or `self._context` is the context dictionary
- `self.env.ref(xml_id)` returns the record corresponding to an XML id
- `self.env[model_name]` returns an instance of the given model
::::

::: exercise
Active objects -- Default values

- Define the start_date default value as today (see
  `~odoo.fields.Date`{.interpreted-text role="class"}).
- Add a field `active` in the class Session, and set sessions as active
  by default.
:::

## Onchange

The \"onchange\" mechanism provides a way for the client interface to
update a form whenever the user has filled in a value in a field,
without saving anything to the database.

For instance, suppose a model has three fields `amount`, `unit_price`
and `price`, and you want to update the price on the form when any of
the other fields is modified. To achieve this, define a method where
`self` represents the record in the form view, and decorate it with
`~odoo.api.onchange`{.interpreted-text role="func"} to specify on which
field it has to be triggered. Any change you make on `self` will be
reflected on the form.

``` xml
<!-- content of form view -->
<field name="amount"/>
<field name="unit_price"/>
<field name="price" readonly="1"/>
```

``` python
# onchange handler
@api.onchange('amount', 'unit_price')
def _onchange_price(self):
    # set auto-changing field
    self.price = self.amount * self.unit_price
    # Can optionally return a warning and domains
    return {
        'warning': {
            'title': "Something bad happened",
            'message': "It was very bad indeed",
        }
    }
```

For computed fields, valued `onchange` behavior is built-in as can be
seen by playing with the *Session* form: change the number of seats or
participants, and the `taken_seats` progressbar is automatically
updated.

::: exercise
Warning

Add an explicit onchange to warn about invalid values, like a negative
number of seats, or more participants than seats.
:::

## Model constraints

Odoo provides two ways to set up automatically verified invariants:
`Python constraints <odoo.api.constrains>`{.interpreted-text
role="func"} and
`SQL constraints <odoo.models.Model._sql_constraints>`{.interpreted-text
role="attr"}.

A Python constraint is defined as a method decorated with
`~odoo.api.constrains`{.interpreted-text role="func"}, and invoked on a
recordset. The decorator specifies which fields are involved in the
constraint, so that the constraint is automatically evaluated when one
of them is modified. The method is expected to raise an exception if its
invariant is not satisfied:

    from odoo.exceptions import ValidationError

    @api.constrains('age')
    def _check_something(self):
        for record in self:
            if record.age > 20:
                raise ValidationError("Your record is too old: %s" % record.age)
        # all records passed the test, don't return anything

::: exercise
Add Python constraints

Add a constraint that checks that the instructor is not present in the
attendees of his/her own session.
:::

SQL constraints are defined through the model attribute
`~odoo.models.Model._sql_constraints`{.interpreted-text role="attr"}.
The latter is assigned to a list of triples of strings
`(name, sql_definition, message)`, where `name` is a valid SQL
constraint name, `sql_definition` is a
[table_constraint](https://www.postgresql.org/docs/12/static/ddl-constraints.html)
expression, and `message` is the error message.

::: exercise
Add SQL constraints

With the help of [PostgreSQL\'s
documentation](https://www.postgresql.org/docs/12/static/ddl-constraints.html)
, add the following constraints:

1.  CHECK that the course description and the course title are different
2.  Make the Course\'s name UNIQUE
:::

::: exercise
Exercise 6 - Add a duplicate option

Since we added a constraint for the Course name uniqueness, it is not
possible to use the \"duplicate\" function anymore (`Form -->
Duplicate`{.interpreted-text role="menuselection"}).

Re-implement your own \"copy\" method which allows to duplicate the
Course object, changing the original name into \"Copy of \[original
name\]\".
:::

## Advanced Views

### Tree views

Tree views can take supplementary attributes to further customize their
behavior:

`decoration-{$name}`

:   allow changing the style of a row\'s text based on the corresponding
    record\'s attributes.

    Values are Python expressions. For each record, the expression is
    evaluated with the record\'s attributes as context values and if
    `true`, the corresponding style is applied to the row. Here are some
    of the other values available in the context:

    - `uid`: the id of the current user,
    - `today`: the current local date as a string of the form
      `YYYY-MM-DD`,
    - `now`: same as `today` with the addition of the current time. This
      value is formatted as `YYYY-MM-DD hh:mm:ss`.

    `{$name}` can be `bf` (`font-weight: bold`), `it`
    (`font-style: italic`), or any [bootstrap contextual
    color](https://getbootstrap.com/docs/3.3/components/#available-variations)
    (`danger`, `info`, `muted`, `primary`, `success` or `warning`).

    ``` xml
    <tree string="Idea Categories" decoration-info="state=='draft'"
        decoration-danger="state=='trashed'">
        <field name="name"/>
        <field name="state"/>
    </tree>
    ```

`editable`

:   Either `"top"` or `"bottom"`. Makes the tree view editable in-place
    (rather than having to go through the form view), the value is the
    position where new rows appear.

::: exercise
List coloring

Modify the Session tree view in such a way that sessions lasting less
than 5 days are colored blue, and the ones lasting more than 15 days are
colored red.
:::

### Calendars

Displays records as calendar events. Their root element is `<calendar>`
and their most common attributes are:

`color`

:   The name of the field used for *color segmentation*. Colors are
    automatically distributed to events, but events in the same color
    segment (records which have the same value for their `@color` field)
    will be given the same color.

`date_start`

:   record\'s field holding the start date/time for the event

`date_stop` (optional)

:     record\'s field holding the end date/time for the event

`string`

:   record\'s field to define the label for each calendar event

``` xml
<calendar string="Ideas" date_start="invent_date" color="inventor_id">
    <field name="name"/>
</calendar>
```

::: exercise
Calendar view

Add a Calendar view to the *Session* model enabling the user to view the
events associated to the Open Academy.
:::

### Search views

Search view `<field>` elements can have a `@filter_domain` that
overrides the domain generated for searching on the given field. In the
given domain, `self` represents the value entered by the user. In the
example below, it is used to search on both fields `name` and
`description`.

Search views can also contain `<filter>` elements, which act as toggles
for predefined searches. Filters must have one of the following
attributes:

`domain`

:   add the given domain to the current search

`context`

:   add some context to the current search; use the key `group_by` to
    group results on the given field name

``` xml
<search string="Ideas">
    <field name="name"/>
    <field name="description" string="Name and description"
           filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"/>
    <field name="inventor_id"/>
    <field name="country_id" widget="selection"/>

    <filter name="my_ideas" string="My Ideas"
            domain="[('inventor_id', '=', uid)]"/>
    <group string="Group By">
        <filter name="group_by_inventor" string="Inventor"
                context="{'group_by': 'inventor_id'}"/>
    </group>
</search>
```

To use a non-default search view in an action, it should be linked using
the `search_view_id` field of the action record.

The action can also set default values for search fields through its
`context` field: context keys of the form
`search_default_{field_name}`{.interpreted-text role="samp"} will
initialize *field_name* with the provided value. Search filters must
have an optional `@name` to have a default and behave as booleans (they
can only be enabled by default).

::: exercise
Search views

1.  Add a button to filter the courses for which the current user is the
    responsible in the course search view. Make it selected by default.
2.  Add a button to group courses by responsible user.
:::

### Gantt

:::: warning
::: title
Warning
:::

The gantt view requires the web_gantt module which is present in the
`enterprise edition
<install/editions>`{.interpreted-text role="ref"} version.
::::

Horizontal bar charts typically used to show project planning and
advancement, their root element is `<gantt>`.

``` xml
<gantt string="Ideas"
       date_start="invent_date"
       date_stop="date_finished"
       progress="progress"
       default_group_by="inventor_id" />
```

::: exercise
Gantt charts

Add a Gantt Chart enabling the user to view the sessions scheduling
linked to the Open Academy module. The sessions should be grouped by
instructor.
:::

### Graph views

Graph views allow aggregated overview and analysis of models, their root
element is `<graph>`.

:::: note
::: title
Note
:::

Pivot views (element `<pivot>`) a multidimensional table, allows the
selection of filers and dimensions to get the right aggregated dataset
before moving to a more graphical overview. The pivot view shares the
same content definition as graph views.
::::

Graph views have 4 display modes, the default mode is selected using the
`@type` attribute.

Bar (default)

:   a bar chart, the first dimension is used to define groups on the
    horizontal axis, other dimensions define aggregated bars within each
    group.

    By default bars are side-by-side, they can be stacked by using
    `@stacked="True"` on the `<graph>`

Line

:   2-dimensional line chart

Pie

:   2-dimensional pie

Graph views contain `<field>` with a mandatory `@type` attribute taking
the values:

`row` (default)

:   the field should be aggregated by default

`measure`

:   the field should be aggregated rather than grouped on

``` xml
<graph string="Total idea score by Inventor">
    <field name="inventor_id"/>
    <field name="score" type="measure"/>
</graph>
```

:::: warning
::: title
Warning
:::

Graph views perform aggregations on database values, they do not work
with non-stored computed fields.
::::

::: exercise
Graph view

Add a Graph view in the Session object that displays, for each course,
the number of attendees under the form of a bar chart.
:::

### Kanban

Used to organize tasks, production processes, etc... their root element
is `<kanban>`.

A kanban view shows a set of cards possibly grouped in columns. Each
card represents a record, and each column the values of an aggregation
field.

For instance, project tasks may be organized by stage (each column is a
stage), or by responsible (each column is a user), and so on.

Kanban views define the structure of each card as a mix of form elements
(including basic HTML) and `reference/qweb`{.interpreted-text
role="ref"}.

::: exercise
Kanban view

Add a Kanban view that displays sessions grouped by course (columns are
thus courses).
:::

## Security

Access control mechanisms must be configured to achieve a coherent
security policy.

### Group-based access control mechanisms

Groups are created as normal records on the model `res.groups`, and
granted menu access via menu definitions. However even without a menu,
objects may still be accessible indirectly, so actual object-level
permissions (read, write, create, unlink) must be defined for groups.
They are usually inserted via CSV files inside modules. It is also
possible to restrict access to specific fields on a view or object using
the field\'s groups attribute.

### Access rights

Access rights are defined as records of the model `ir.model.access`.
Each access right is associated to a model, a group (or no group for
global access), and a set of permissions: read, write, create, unlink.
Such access rights are usually created by a CSV file named after its
model: `ir.model.access.csv`.

``` text
id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_idea_idea,idea.idea,model_idea_idea,base.group_user,1,1,1,0
access_idea_vote,idea.vote,model_idea_vote,base.group_user,1,1,1,0
```

::: exercise
Add access control through the Odoo interface

Create a new user \"John Smith\". Then create a group \"OpenAcademy /
Session Read\" with read access to the *Session* model.
:::

::: exercise
Add access control through data files in your module

Using data files,

- Create a group *OpenAcademy / Manager* with full access to all
  OpenAcademy models
- Make *Session* and *Course* readable by all users
:::

### Record rules

A record rule restricts the access rights to a subset of records of the
given model. A rule is a record of the model `ir.rule`, and is
associated to a model, a number of groups (many2many field), permissions
to which the restriction applies, and a domain. The domain specifies to
which records the access rights are limited.

Here is an example of a rule that prevents the deletion of leads that
are not in state `cancel`. Notice that the value of the field `groups`
must follow the same convention as the method
`~odoo.models.Model.write`{.interpreted-text role="meth"} of the ORM.

``` xml
<record id="delete_cancelled_only" model="ir.rule">
    <field name="name">Only cancelled leads may be deleted</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="groups" eval="[(4, ref('sales_team.group_sale_manager'))]"/>
    <field name="perm_read" eval="0"/>
    <field name="perm_write" eval="0"/>
    <field name="perm_create" eval="0"/>
    <field name="perm_unlink" eval="1" />
    <field name="domain_force">[('state','=','cancel')]</field>
</record>
```

::: exercise
Record rule

Add a record rule for the model Course and the group \"OpenAcademy /
Manager\", that restricts `write` and `unlink` accesses to the
responsible of a course. If a course has no responsible, all users of
the group must be able to modify it.
:::

## Wizards {#howto/module/wizard}

Wizards describe interactive sessions with the user (or dialog boxes)
through dynamic forms. A wizard is simply a model that extends the class
`~odoo.models.TransientModel`{.interpreted-text role="class"} instead of
`~odoo.models.Model`{.interpreted-text role="class"}. The class
`~odoo.models.TransientModel`{.interpreted-text role="class"} extends
`~odoo.models.Model`{.interpreted-text role="class"} and reuse all its
existing mechanisms, with the following particularities:

- Wizard records are not meant to be persistent; they are automatically
  deleted from the database after a certain time. This is why they are
  called *transient*.
- Wizard records may refer to regular records or wizard records through
  relational fields(many2one or many2many), but regular records *cannot*
  refer to wizard records through a many2one field.

We want to create a wizard that allow users to create attendees for a
particular session, or for a list of sessions at once.

::: exercise
Define the wizard

Create a wizard model with a many2one relationship with the *Session*
model and a many2many relationship with the *Partner* model.
:::

### Launching wizards

Wizards are simply
`window actions <howtos/module/actions>`{.interpreted-text role="ref"}
with a `target` field set to the value `new`, which opens the view
(usually `a form <howtos/module/views/form>`{.interpreted-text
role="ref"}) in a separate dialog. The action may be triggered via a
menu item, but is more generally triggered by a button.

An other way to launch wizards is through the `Action`{.interpreted-text
role="menuselection"} menu of a tree or form view. This is done through
the `binding_model_id` field of the action. Setting this field will make
the action appear on the views of the model the action is \"bound\" to.

``` xml
<record id="launch_the_wizard" model="ir.actions.act_window">
    <field name="name">Launch the Wizard</field>
    <field name="res_model">wizard.model.name</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="binding_model_id" ref="model_context_model_ref"/>
</record>
```

:::: tip
::: title
Tip
:::

While wizards use regular views and buttons, normally clicking any
button in a form would first save the form then close the dialog.
Because this is often undesirable in wizards, a special attribute
`special="cancel"` is available which immediately closes the wizard
without saving the form.
::::

::: exercise
Launch the wizard

1.  Define a form view for the wizard.
2.  Add the action to launch it in the context of the *Session* model.
3.  Define a default value for the session field in the wizard; use the
    context parameter `self._context` to retrieve the current session.
:::

::: exercise
Register attendees

Add buttons to the wizard, and implement the corresponding method for
adding the attendees to the given session.
:::

::: exercise
Register attendees to multiple sessions

Modify the wizard model so that attendees can be registered to multiple
sessions.
:::

## Internationalization

Each module can provide its own translations within the i18n directory,
by having files named LANG.po where LANG is the locale code for the
language, or the language and country combination when they differ (e.g.
pt.po or pt_BR.po). Translations will be loaded automatically by Odoo
for all enabled languages. Developers always use English when creating a
module, then export the module terms using Odoo\'s gettext POT export
feature (`Settings --> Translations --> Import/Export --> Export
Translation`{.interpreted-text role="menuselection"} without specifying
a language), to create the module template POT file, and then derive the
translated PO files. Many IDE\'s have plugins or modes for editing and
merging PO/POT files.

:::: tip
::: title
Tip
:::

The Portable Object files generated by Odoo are published on [Odoo\'s
Translations Platform](https://translate.odoo.com/), making it easy to
translate the software.
::::

``` text
|- idea/ # The module directory
   |- i18n/ # Translation files
      | - idea.pot # Translation Template (exported from Odoo)
      | - fr.po # French translation
      | - pt_BR.po # Brazilian Portuguese translation
      | (...)
```

:::: tip
::: title
Tip
:::

By default Odoo\'s POT export only extracts labels inside XML files or
inside field definitions in Python code, but any Python string can be
translated this way by surrounding it with the function
`odoo._`{.interpreted-text role="func"} (e.g. `_("Label")`)
::::

::: exercise
Translate a module

Choose a second language for your Odoo installation. Translate your
module using the facilities provided by Odoo.
:::

## Reporting

### Printed reports

Odoo uses a report engine based on `reference/qweb`{.interpreted-text
role="ref"}, [Twitter Bootstrap](https://getbootstrap.com) and
[Wkhtmltopdf](https://wkhtmltopdf.org).

A report is a combination two elements:

- an `ir.actions.report` which configures various basic parameters for
  the report (default type, whether the report should be saved to the
  database after generation,...)

  ``` xml
  <record id="account_invoices" model="ir.actions.report">
      <field name="name">Invoices</field>
      <field name="model">account.invoice</field>
      <field name="report_type">qweb-pdf</field>
      <field name="report_name">account.report_invoice</field>
      <field name="report_file">account.report_invoice</field>
      <field name="attachment_use" eval="True"/>
      <field name="attachment">(object.state in ('open','paid')) and
          ('INV'+(object.number or '').replace('/','')+'.pdf')</field>
      <field name="binding_model_id" ref="model_account_invoice"/>
      <field name="binding_type">report</field>
  </record>
  ```

  :::: tip
  ::: title
  Tip
  :::

  Because it largerly a standard action, as with
  `howto/module/wizard`{.interpreted-text role="ref"} it is generally
  useful to add the report as a *contextual item* on the tree and / or
  form views of the model being reported on via the `binding_model_id`
  field.

  Here we are also using `binding_type` in order for the report to be in
  the *report* contextual menu rather than the *action* one. There is no
  technical difference but putting elements in the right place helps
  users.
  ::::

- A standard `QWeb view <reference/views/qweb>`{.interpreted-text
  role="ref"} for the actual report:

  ``` xml
  <t t-call="web.html_container">
      <t t-foreach="docs" t-as="o">
          <t t-call="web.external_layout">
              <div class="page">
                  <h2>Report title</h2>
              </div>
          </t>
      </t>
  </t>
  ```

  the standard rendering context provides a number of elements, the most
  important being:

  `docs`

  :   the records for which the report is printed

  `user`

  :   the user printing the report

Because reports are standard web pages, they are available through a URL
and output parameters can be manipulated through this URL, for instance
the HTML version of the *Invoice* report is available through
<http://localhost:8069/report/html/account.report_invoice/1> (if
`account` is installed) and the PDF version through
<http://localhost:8069/report/pdf/account.report_invoice/1>.

::::: {#reference/backend/reporting/printed-reports/pdf-without-styles}
:::: danger
::: title
Danger
:::

If it appears that your PDF report is missing the styles (i.e. the text
appears but the style/layout is different from the html version),
probably your [wkhtmltopdf](https://wkhtmltopdf.org) process cannot
reach your web server to download them.

If you check your server logs and see that the CSS styles are not being
downloaded when generating a PDF report, most surely this is the
problem.

The [wkhtmltopdf](https://wkhtmltopdf.org) process will use the
`web.base.url` system parameter as the *root path* to all linked files,
but this parameter is automatically updated each time the Administrator
is logged in. If your server resides behind some kind of proxy, that
could not be reachable. You can fix this by adding one of these system
parameters:

- `report.url`, pointing to an URL reachable from your server (probably
  `http://localhost:8069` or something similar). It will be used for
  this particular purpose only.
- `web.base.url.freeze`, when set to `True`, will stop the automatic
  updates to `web.base.url`.
::::
:::::

::: exercise
Create a report for the Session model

For each session, it should display session\'s name, its start and end,
and list the session\'s attendees.
:::

### Dashboards

::: exercise
Define a Dashboard

Define a dashboard containing the graph view you created, the sessions
calendar view and a list view of the courses (switchable to a form
view). This dashboard should be available through a menuitem in the
menu, and automatically displayed in the web client when the OpenAcademy
main menu is selected.
:::

[^1]: writing raw SQL queries is possible, but requires care as it
    bypasses all Odoo authentication and security mechanisms.

[^2]: it is possible to `disable the automatic creation of some
    fields <reference/fields/automatic/log_access>`{.interpreted-text
    role="ref"}




--- SOURCE: developer/tutorials/define_module_data.md ---

# Define module data

:::: important
::: title
Important
:::

This tutorial is an extension of the `getting_started`{.interpreted-text
role="doc"} tutorial. Make sure you have completed it and use the
[estate]{.title-ref} module you have built as a base for the exercises
in this tutorial. Fetch the branch [{BRANCH}-core]{.title-ref} from the
[technical-training-solutions](https://github.com/odoo/technical-training-solutions/tree/{BRANCH}-core)
repository if you want to start from a clean base.
::::

## Data Types

### Master Data

Master data is usually part of the technical or business requirements
for the module. In other words, such data is often necessary for the
module to work properly. This data will always be installed when
installing the module.

We already met technical data previously since we have defined
`views <reference/views>`{.interpreted-text role="ref"} and
`actions <reference/actions>`{.interpreted-text role="ref"}. Those are
one kind of master data.

On top of technical data, business data can be defined, e.g. countries,
currencies, units of measure, as well as complete country localization
(legal reports, tax definitions, chart of account), and much more\...

### Demo Data

In additional to master data, which are requirements for a module to
work properly, we also like having data for demonstration purposes:

- Help the sales representatives make their demos quickly.
- Have a set of working data for developers to test new features and see
  how these new features look with data they might not have added
  themselves.
- Test that the data is loaded correctly, without raising an error.
- Setup most of the features to be used quickly when creating a new
  database.

Demo data is automatically loaded when you start the server if you
don\'t explicitly say you don\'t want it. This can be done in the
database manager or with the command line.

``` console
$ ./odoo-bin -h
Usage: odoo-bin [options]

Options:
--version             show program's version number and exit
-h, --help            show this help message and exit

Common options:
  [...]
  --without-demo=WITHOUT_DEMO
                      disable loading demo data for modules to be installed
                      (comma-separated, use "all" for all modules). Requires
                      -d and -i. Default is none
[...]

$ ./odoo-bin --addons-path=... -d db -i account --without-demo=all
```

## Data Declaration

### Manifest

**Reference**: the documentation related to this topic can be found in
`Module Manifests<reference/module/manifest>`{.interpreted-text
role="ref"}.

Data is declared either in CSV or in XML. Each file containing data must
be added in the manifest for them to be loaded.

The keys to use in the manifest to add new data are `data` for the
master data and `demo` for the demo data. Both values should be a list
of strings representing the relative paths to the files declaring the
data.

Usually, demo data is in a `demo` folder, views and actions are in a
`views` folder, security related data is in a `security` folder, and
other data is in a `data` folder.

If your work tree looks like this:

``` bash
estate
├── data
│   └── master_data.xml
├── demo
│   └── demo_data.xml
├── models
│   ├── *.py
│   └── __init__.py
├── security
│   └── ir.model.access.csv
├── views
│   └── estate_property_offer_views.xml
├── __init__.py
└── __manifest__.py
```

Your manifest should look like this:

``` python
# -*- coding: utf-8 -*-

{
    "name": "Real Estate",
    "depends": [
        ...
    ],
    "data": [
        "security/ir.model.access.csv",  # CSV and XML files are loaded at the same place
        "views/estate_property_offer_views.xml",  # Views are data too
        "data/master_data.xml",  # Split the data in multiple files depending on the model
    ],
    "demo": [
        "demo/demo_data.xml",
    ]
    "application": True,
}
```

### CSV

**Reference**: the documentation related to this topic can be found in
`CSV data files<reference/data/csvdatafiles>`{.interpreted-text
role="ref"}.

The easiest way to declare simple data is by using the CSV format. This
is however limited in terms of features: use it for long lists of simple
models, but prefer XML otherwise.

``` text
id,field_a,field_b,related_id:id
id1,valueA1,valueB1,module.relatedid
id2,valueA2,valueB2,module.relatedid
```

:::: tip
::: title
Tip
:::

Your IDE has probably an extension to have a syntax highlighting of the
CSV files

- [Atom](https://atom.io/packages/rainbow-csv).
- [PyCharm/IntelliJ](https://plugins.jetbrains.com/plugin/10037-csv-plugin).
- [Vim](https://github.com/mechatroner/rainbow_csv).
- [Visual
  Studio](https://marketplace.visualstudio.com/items?itemName=mechatroner.rainbow-csv).
::::

::: exercise
Add some standard Real Estate Property Types for the
[estate]{.title-ref} module: Residential, Commercial, Industrial and
Land. These should always be installed.
:::

### XML

**Reference**: the documentation related to this topic can be found in
`Data Files<reference/data>`{.interpreted-text role="ref"}.

When the data to create is more complex it can be useful, or even
necessary, to do it in XML.

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="field_a">valueA1</field>
    <field name="field_b">valueB1</field>
  </record>

  <record id="id2" model="tutorial.example">
    <field name="field_a">valueA2</field>
    <field name="field_b">valueB2</field>
  </record>
</odoo>
```

::: exercise
Create some demo data for the [estate]{.title-ref} module.

  Field                Values                 Values
  -------------------- ---------------------- ------------------------
  name                 Big Villa              Trailer home
  state                New                    Canceled
  description          A nice and big villa   Home in a trailer park
  postcode             12345                  54321
  date_availability    2020-02-02             1970-01-01
  expected_price       1,600,000              100,000
  selling_price                               120,000
  bedrooms             6                      1
  living_area          100                    10
  facades              4                      4
  garage               True                   False
  garden               True                   
  garden_area          100000                 
  garden_orientation   South                  
:::

#### Data Extension

During the Core Training, we saw in the
`tutorials/getting_started/13_inheritance`{.interpreted-text role="ref"}
chapter we could inherit (extend) an existing view. This was a special
case of data extension: any data can be extended in a module.

When you are adding new fields to an existing model in a new module, you
might want to populate those fields on the records created in the
modules you are depending on. This is done by giving the
[xml_id]{.title-ref} of the record you want to extend. It won\'t replace
it, in this case we will set the `field_c` to the given value for both
records.

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="field_c">valueC1</field>
  </record>

  <record id="id2" model="tutorial.example">
    <field name="field_c">valueC2</field>
  </record>
</odoo>
```

#### `ref`

Related fields can be set using the `ref` key. The value of that key is
the `xml_id` of the record you want to link. Remember the `xml_id` is
composed of the name of the module where the data is first declared,
followed by a dot, followed by the `id` of the record (just the `id`
works too if you are in the module declaring it).

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="related_id" ref="module.relatedid"/>
  </record>
</odoo>
```

::: exercise
Create some demo data offers for the properties you created.

Create offers using the partners defined in `base`

  Partner          Estate      Price     Validity
  ---------------- ----------- --------- ----------
  Azure Interior   Big Villa   10000     14
  Azure Interior   Big Villa   1500000   14
  Deco Addict      Big Villa   1500001   14
:::

::: exercise
Ensure both of your demo properties are created with their Property Type
set to Residential.
:::

#### `eval`

The value to assign to a field is not always a simple string and you
might need to compute it. It can also be used to optimize the insertion
of related values, or because a constraint forces you to add the related
values in batch. See `Add X2many fields
<tutorials/getting_started/C_data/x2m>`{.interpreted-text role=":ref"}.

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="year" eval="datetime.now().year+1"/>
  </record>
</odoo>
```

::: exercise
The offers you added should always be in a date relative to the
installation of the module.
:::

#### `search`

Sometimes, you need to call the ORM to do a `search`. This is not
feasible with the CSV format.

``` xml
<odoo>
  <record id="id1" model="account.move.line">
    <field name="account_id" search="[
      ('user_type_id', '=', ref('account.data_account_type_direct_costs')),
      ('company_id', '=', obj().env.company.id)]
    "/>
  </record>
</odoo>
```

In this code snippet, it is needed because the master data depends on
the localization installed.

#### `function`

You might also need to execute python code when loading data.

``` xml
<function model="tutorial.example" name="action_validate">
    <value eval="[ref('demo_invoice_1')]"/>
</function>
```

::: exercise
Validate one of the demo data offers by using the \"Accept Offer\"
button. Refuse the others.
:::

### Add X2many fields {#tutorials/getting_started/C_data/x2m}

**Reference**: the documentation related to this topic can be found in
`~odoo.fields.Command`{.interpreted-text role="class"}.

If you need to add related data in a One2many or a Many2many field, you
can do so by using the `~odoo.fields.Command`{.interpreted-text
role="class"} methods.

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="related_ids" eval="[
        Command.create({
            'name': 'My name',
        }),
        Command.create({
            'name': 'Your name',
        }),
        Command.link(ref('model.xml_id')),
    ]"/>
  </record>
</odoo>
```

::: exercise
Create one new Property, but this time with some offers created directly
inside the One2many field linked to the Offers.
:::

## Accessing the data

:::: warning
::: title
Warning
:::

You should never access demo data outside of the demo data declaration,
not even in tests.
::::

There are multiple ways to access the master/demo data.

In python code, you can use the
`env.ref(self, xml_id, raise_if_not_found=True)` method. It returns the
recordset linked to the `xml_id` you specify.

In XML, you can use the [ref]{.title-ref} key like this

``` xml
<odoo>
  <record id="id1" model="tutorial.example">
    <field name="related_id" ref="module.relatedid"/>
  </record>
</odoo>
```

It will call the ref method, and store the id of the record returned on
the field `related_id` of the record of type `tutorial.example` with id
`id1`.

In CSV, the title of the column must be suffixed with `:id` or `/id`.

``` text
id,parent_id:id,name
"child1","module.parent","Name1"
"child2","module.parent","Name2"
"child3","module.parent","Name3"
```

In SQL, it is more complicated, see `the advanced section
<tutorials/getting_started/C_data/xml_id>`{.interpreted-text
role="ref"}.

:::: warning
::: title
Warning
:::

Data can always be deleted by the user. Always code defensively, taking
this into account.
::::

## Advanced

### What is the XML id? {#tutorials/getting_started/C_data/xml_id}

Because we don\'t want a column `xml_id` in every single SQL table of
the database, we need a mechanism to store it. This is done with the
`ir.model.data` model.

It contains the name of the record (the `xml_id`) along with the module
in which it is defined, the model defining it, and the id of it.

### No update

The records created with the `noupdate` flag won\'t be updated when
upgrading the module that created them, but it will be created if it
didn\'t exist yet.

:::: note
::: title
Note
:::

`odoo-bin -i module` will bypass this setting and always load the data.
But normally one shouldn\'t do this on a production database.
::::

``` xml
<odoo noupdate="1">
  <record id="id1" model="model">
    <field name="fieldA" eval="True"/>
  </record>
</odoo>
```

### Import as SQL

In some cases, it makes sense to do the import directly in SQL. This is
however discouraged as it bypasses all the features of the ORM, computed
fields (including metadata) and python constraints.

:::: note
::: title
Note
:::

Generally using raw SQL also bypasses ACLs and increases the risks of
injections.

**Reference**: `Security in Odoo<reference/security>`{.interpreted-text
role="ref"}
::::

- It can help to speed the import time by a lot [with huge
  files](https://github.com/odoo/enterprise/blob/d46cceef8c594b9056d0115edb7169e207a5986f/product_unspsc/hooks.py#L19).
- For more complex imports like for the
  [translations](https://github.com/odoo/odoo/blob/e1f8d549895cd9c459e6350430f30d541d02838a/odoo/addons/base/models/ir_translation.py#L24).
- It can be necessary to [initialize the
  database](https://github.com/odoo/odoo/blob/e1f8d549895cd9c459e6350430f30d541d02838a/odoo/addons/base/data/base_data.sql).




--- SOURCE: developer/tutorials/discover_js_framework/01_owl_components.md ---

# Chapter 1: Owl Components

This chapter introduces the [Owl
framework](https://github.com/odoo/owl), a tailor-made component system
for Odoo. The main building blocks of OWL are
[components]({OWL_PATH}/doc/reference/component.md) and
[templates]({OWL_PATH}/doc/reference/templates.md).

In Owl, every part of user interface is managed by a component: they
hold the logic and define the templates that are used to render the user
interface. In practice, a component is represented by a small JavaScript
class subclassing the [Component]{.title-ref} class.

Before getting into the exercises, make sure you have followed all the
steps described in this
`tutorial introduction <tutorials/discover_js_framework/setup>`{.interpreted-text
role="ref"}.

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/owl_playground).
It is recommended to try to solve them first without looking at the
solution!
:::

:::: tip
::: title
Tip
:::

If you use Chrome as your web browser, you can install the [Owl
Devtools]{.title-ref} extension. This extension provides many features
to help you understand and profile any Owl application.

[Video: How to use the
DevTools](https://www.youtube.com/watch?v=IUyQjwnrpzM)
::::

In this chapter, we use the [owl_playground]{.title-ref} addon, which
provides a simplified environment that only contains Owl and a few other
files. The goal is to learn Owl itself, without relying on Odoo web
client code. To get started, open the
[/owl_playground/playground]{.title-ref} route with your browser: it
should display an Owl component with the text *hello world*.

## Example: a [Counter]{.title-ref} component

First, let us have a look at a simple example. The [Counter]{.title-ref}
component shown below is a component that maintains an internal number
value, displays it, and updates it whenever the user clicks on the
button.

``` js
import { Component, useState } from "@odoo/owl";

class Counter extends Component {
    static template = "my_module.Counter";

    setup() {
        this.state = useState({ value: 0 });
    }

    increment() {
        this.state.value++;
    }
}
```

The [Counter]{.title-ref} component specifies the name of the template
to render. The template is written in XML and defines a part of user
interface:

``` xml
<templates xml:space="preserve">
   <t t-name="my_module.Counter" owl="1">
      <p>Counter: <t t-esc="state.value"/></p>
      <button class="btn btn-primary" t-on-click="increment">Increment</button>
   </t>
</templates>
```

You maybe noticed the [owl=\"1\"]{.title-ref} temporary attribute, it
allows Odoo to differentiate Owl templates from the old JavaScript
framework templates. Note that Owl templates are not the same as QWeb
templates: they can contain additional directives, such as
[t-on-click]{.title-ref}.

## 1. Displaying a counter

As a first exercise, let us implement a counter in the
[Playground]{.title-ref} component located in
`owl_playground/static/src/`{.interpreted-text role="file"}. To see the
result, you can go to the [/owl_playground/playground]{.title-ref} route
with your browser.

::: exercise
1.  Modify `playground.js`{.interpreted-text role="file"} so that it
    acts as a counter like in the example above. You will need to use
    the [useState hook]({OWL_PATH}/doc/reference/hooks.md#usestate) so
    that the component is re-rendered whenever any part of the state
    object that has been read by this component is modified.
2.  In the same component, create an [increment]{.title-ref} method.
3.  Modify the template in `playground.xml`{.interpreted-text
    role="file"} so that it displays your counter variable. Use
    [t-esc]({OWL_PATH}/doc/reference/templates.md#outputting-data) to
    output the data.
4.  Add a button in the template and specify a
    [t-on-click]({OWL_PATH}/doc/reference/event_handling.md#event-handling)
    attribute in the button to trigger the [increment]{.title-ref}
    method whenever the button is clicked.
:::

![image](01_owl_components/counter.png){.align-center}

:::: tip
::: title
Tip
:::

The Odoo JavaScript files downloaded by the browser are minified. For
debugging purpose, it\'s easier when the files are not minified. Switch
to `debug mode with assets
<developer-mode/activation>`{.interpreted-text role="ref"} so that the
files are not minified.
::::

## 2. Extract counter in a component

For now we have the logic of a counter in the [Playground]{.title-ref}
component, let us see how to create a
[sub-component]({OWL_PATH}/doc/reference/component.md#sub-components)
from it.

::: exercise
1.  Extract the counter code from the [Playground]{.title-ref} component
    into a new [Counter]{.title-ref} component.
2.  You can do it in the same file first, but once it\'s done, update
    your code to move the [Counter]{.title-ref} in its own folder and
    file. Import it relatively from [./counter/counter]{.title-ref}.
    Make sure the template is in its own file, with the same name.
:::

:::: important
::: title
Important
:::

Don\'t forget `/** @odoo-module **/` in your JavaScript files. More
information on this can be found
`here <frontend/modules/native_js>`{.interpreted-text role="ref"}.
::::

## 3. A todo component

We will create new components in
`owl_playground/static/src/`{.interpreted-text role="file"} to keep
track of a list of todos. This will be done incrementally in multiple
exercises that will introduce various concepts.

::: exercise
1.  Create a [Todo]{.title-ref} component that receive a
    [todo]{.title-ref} object in
    [props]({OWL_PATH}/doc/reference/props.md), and display it. It
    should show something like **3. buy milk**.

2.  Add the Bootstrap classes [text-muted]{.title-ref} and
    [text-decoration-line-through]{.title-ref} on the task if it is
    done. To do that, you can use [dynamic
    attributes]({OWL_PATH}/doc/reference/templates.md#dynamic-attributes).

3.  Modify `owl_playground/static/src/playground.js`{.interpreted-text
    role="file"} and
    `owl_playground/static/src/playground.xml`{.interpreted-text
    role="file"} to display your new [Todo]{.title-ref} component with
    some hard-coded props to test it first.

    ::: example
    ``` javascript
    setup() {
        ...
        this.todo = { id: 3, description: "buy milk", done: false };
    }
    ```
    :::
:::

![image](01_owl_components/todo.png){.align-center}

::: seealso
[Owl: Dynamic class
attributes]({OWL_PATH}/doc/reference/templates.md#dynamic-class-attribute)
:::

## 4. Props validation

The [Todo]{.title-ref} component has an implicit API. It expects to
receive in its props the description of a todo object in a specified
format: [id]{.title-ref}, [description]{.title-ref} and
[done]{.title-ref}. Let us make that API more explicit. We can add a
props definition that will let Owl perform a validation step in [dev
mode]({OWL_PATH}/doc/reference/app.md#dev-mode). You can activate the
dev mode in the [App
configuration]({OWL_PATH}/doc/reference/app.md#configuration).

> It is a good practice to do props validation for every component.

::: exercise
1.  Add [props
    validation]({OWL_PATH}/doc/reference/props.md#props-validation) to
    the [Todo]{.title-ref} component.
2.  Open the `Console`{.interpreted-text role="guilabel"} tab of your
    browser\'s dev tools and make sure the props validation passes in
    dev mode, which is activated by default in
    [owl_playground]{.title-ref}. The dev mode can be activated and
    deactivated by modifying the [dev]{.title-ref} attribute in the in
    the [config]{.title-ref} parameter of the
    [mount]({OWL_PATH}/doc/reference/app.md#mount-helper) function in
    `owl_playground/static/src/main.js`{.interpreted-text role="file"}.
3.  Remove [done]{.title-ref} from the props and reload the page. The
    validation should fail.
:::

## 5. A list of todos

Now, let us display a list of todos instead of just one todo. For now,
we can still hard-code the list.

::: exercise
1.  Change the code to display a list of todos instead of just one.
    Create a new [TodoList]{.title-ref} component to hold the
    [Todo]{.title-ref} components and use
    [t-foreach]({OWL_PATH}/doc/reference/templates.md#loops) in its
    template.
2.  Think about how it should be keyed with the [t-key]{.title-ref}
    directive.
:::

![image](01_owl_components/todo_list.png){.align-center}

## 6. Adding a todo

So far, the todos in our list are hard-coded. Let us make it more useful
by allowing the user to add a todo to the list.

::: exercise
1.  Add an input above the task list with placeholder *Enter a new
    task*.

2.  Add an [event handler]({OWL_PATH}/doc/reference/event_handling.md)
    on the [keyup]{.title-ref} event named [addTodo]{.title-ref}.

3.  Implement [addTodo]{.title-ref} to check if enter was pressed
    (`ev.keyCode === 13`), and in that case, create a new todo with the
    current content of the input as the description and clear the input
    of all content.

4.  Make sure the todo has a unique id. It can be just a counter that
    increments at each todo.

5.  Wrap the todo list in a [useState]{.title-ref} hook to let Owl know
    that it should update the UI when the list is modified.

6.  Bonus point: don\'t do anything if the input is empty.

    ``` javascript
    this.todos = useState([]);
    ```
:::

![image](01_owl_components/create_todo.png){.align-center}

::: seealso
[Owl: Reactivity]({OWL_PATH}/doc/reference/reactivity.md)
:::

## 7. Focusing the input

Let\'s see how we can access the DOM with
[t-ref]({OWL_PATH}/doc/reference/refs.md) and
[useRef]({OWL_PATH}/doc/reference/hooks.md#useref).

::: exercise
1.  Focus the [input]{.title-ref} from the previous exercise when the
    dashboard is
    [mounted]({OWL_PATH}/doc/reference/component.md#mounted). This this
    should be done from the [TodoList]{.title-ref} component.
2.  Bonus point: extract the code into a specialized
    [hook]({OWL_PATH}/doc/reference/hooks.md) [useAutofocus]{.title-ref}
    in a new `owl_playground/utils.js`{.interpreted-text role="file"}
    file.
:::

::: seealso
[Owl: Component
lifecycle]({OWL_PATH}/doc/reference/component.md#lifecycle)
:::

## 8. Toggling todos

Now, let\'s add a new feature: mark a todo as completed. This is
actually trickier than one might think. The owner of the state is not
the same as the component that displays it. So, the [Todo]{.title-ref}
component needs to communicate to its parent that the todo state needs
to be toggled. One classic way to do this is by using a [callback
prop]({OWL_PATH}/doc/reference/props.md#binding-function-props)
[toggleState]{.title-ref}.

::: exercise
1.  Add an input with the attribute `type="checkbox"` before the id of
    the task, which must be checked if the state [done]{.title-ref} is
    true.

    :::: tip
    ::: title
    Tip
    :::

    QWeb does not create attributes computed with the
    [t-att]{.title-ref} directive if it evaluates to a falsy value.
    ::::

2.  Add a callback props [toggleState]{.title-ref}.

3.  Add a [click]{.title-ref} event handler on the input in the
    [Todo]{.title-ref} component and make sure it calls the
    [toggleState]{.title-ref} function with the todo id.

4.  Make it work!
:::

![image](01_owl_components/toggle_todo.png){.align-center}

## 9. Deleting todos

The final touch is to let the user delete a todo.

::: exercise
1.  Add a new callback prop [removeTodo]{.title-ref}.

2.  Insert `<span class="fa fa-remove"/>` in the template of the
    [Todo]{.title-ref} component.

3.  Whenever the user clicks on it, it should call the
    [removeTodo]{.title-ref} method.

    :::: tip
    ::: title
    Tip
    :::

    If you\'re using an array to store your todo list, you can use the
    JavaScript [splice]{.title-ref} function to remove a todo from it.
    ::::

``` 
// find the index of the element to delete
const index = list.findIndex((elem) => elem.id === elemId);
if (index >= 0) {
    // remove the element at index from list
    list.splice(index, 1);
}
```
:::

![image](01_owl_components/delete_todo.png){.align-center}

## 10. Generic card with slots {#tutorials/discover_js_framework/generic_card}

Owl has a powerful [slot]({OWL_PATH}/doc/reference/slots.md) system to
allow you to write generic components. This is useful to factorize the
common layout between different parts of the interface.

::: exercise
1.  Insert a new [Card]{.title-ref} component between the
    [Counter]{.title-ref} and [Todolist]{.title-ref} components. Use the
    following Bootstrap HTML structure for the card:

    ``` html
    <div class="card" style="width: 18rem;">
        <img src="..." class="card-img-top" alt="..." />
        <div class="card-body">
            <h5 class="card-title">Card title</h5>
            <p class="card-text">
                Some quick example text to build on the card title and make up the bulk
                of the card's content.
            </p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
    </div>
    ```

2.  This component should have two slots: one slot for the title, and
    one for the content (the default slot). It should be possible to use
    the [Card]{.title-ref} component as follows:

    ``` html
    <Card>
        <t t-set-slot="title">Card title</t>
        <p class="card-text">Some quick example text...</p>
        <a href="#" class="btn btn-primary">Go somewhere</a>
    </Card>
    ```

3.  Bonus point: if the [title]{.title-ref} slot is not given, the
    [h5]{.title-ref} should not be rendered at all.
:::

![image](01_owl_components/card.png){.align-center}

::: seealso
[Bootstrap: documentation on
cards](https://getbootstrap.com/docs/5.2/components/card/)
:::

## 11. Extensive props validation

::: exercise
1.  Add prop validation on the [Card]{.title-ref} component.
2.  Try to express in the props validation system that it requires a
    [default]{.title-ref} slot, and an optional [title]{.title-ref}
    slot.
:::




--- SOURCE: developer/tutorials/discover_js_framework/02_web_framework.md ---

# Chapter 2: Odoo Web Framework

The first part of this tutorial introduced you to most of Owl ideas. It
is now time to learn about the Odoo JavaScript framework in its
entirety, as used by the web client.

<figure class="align-center">
<img src="02_web_framework/previously_learned.svg"
style="width:50.0%" />
</figure>

For this chapter, we will start from the empty dashboard provided by the
[awesome_tshirt]{.title-ref} addon. We will progressively add features
to it, using the Odoo JavaScript framework.

::: admonition
Goal

![image](02_web_framework/overview_02.png){.align-center}
:::

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/awesome_tshirt).
:::

## 1. A new Layout

Most screens in the Odoo web client uses a common layout: a control
panel on top, with some buttons, and a main content zone just below.
This is done using the [Layout
component]({GITHUB_PATH}/addons/web/static/src/search/layout.js),
available in [\@web/search/layout]{.title-ref}.

::: exercise
Update the [AwesomeDashboard]{.title-ref} component located in
`awesome_tshirt/static/src/`{.interpreted-text role="file"} to use the
[Layout]{.title-ref} component. You can use
`{controlPanel: { "top-right": false, "bottom-right": false } }` for the
[display]{.title-ref} props of the [Layout]{.title-ref} component.

Open <http://localhost:8069/web>, then open the
`Awesome T-Shirts`{.interpreted-text role="guilabel"} app, and see the
result.
:::

![image](02_web_framework/new_layout.png){.align-center}

::: seealso
- [Example: use of Layout in client
  action]({GITHUB_PATH}/addons/web/static/src/webclient/actions/reports/report_action.js)
  and
  [template]({GITHUB_PATH}/addons/web/static/src/webclient/actions/reports/report_action.xml)
- [Example: use of Layout in kanban
  view]({GITHUB_PATH}/addons/web/static/src/views/kanban/kanban_controller.xml)
:::

## 2. Add some buttons for quick navigation

Let us now use the action service for an easy access to the common views
in Odoo.

`Services <frontend/services>`{.interpreted-text role="ref"} is a notion
defined by the Odoo JavaScript framework; it is a persistent piece of
code that exports a state and/or functions. Each service can depend on
other services, and components can import a service with the
[useService()]{.title-ref} hook.

::: example
This shows how to open the settings view from a component using the
action service.

``` js
import { useService } from "@web/core/utils/hooks";
...
setup() {
    this.action = useService("action");
}
openSettings() {
    this.action.doAction("base_setup.action_general_configuration");
}
...
```
:::

::: exercise
Let us add three buttons in the control panel bottom left zone.

1.  A button [Customers]{.title-ref}, which opens a kanban view with all
    customers (this action already exists, so you should use [its xml
    id](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/odoo/addons/base/views/res_partner_views.xml#L525)).

2.  A button [New Orders]{.title-ref}, which opens a list view with all
    orders created in the last 7 days. Use the
    [Domain](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273//addons/web/static/src/core/domain.js#L19)
    helper class to represent the domain.

    :::: tip
    ::: title
    Tip
    :::

    One way to represent the desired domain could be
    `[('create_date','>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]`
    ::::

3.  A button [Cancelled Order]{.title-ref}, which opens a list of all
    orders created in the last 7 days, but already cancelled. Rather
    than defining the action twice, factorize it in a new
    [openOrders]{.title-ref} method.
:::

![image](02_web_framework/navigation_buttons.png){.align-center}

::: seealso
\- [Example: doAction
use]({GITHUB_PATH}/addons/account/static/src/components/journal_dashboard_activity/journal_dashboard_activity.js#L35) -
[Code: action
service]({GITHUB_PATH}/addons/web/static/src/webclient/actions/action_service.js)
:::

## 3. Call the server, add some statistics

Let\'s improve the dashboard by adding a few cards (see the
[Card]{.title-ref} component `made in the
previous chapter <tutorials/discover_js_framework/generic_card>`{.interpreted-text
role="ref"}) containing a few statistics. There is a route
[/awesome_tshirt/statistics]{.title-ref} that performs some computations
and returns an object containing some useful information.

Whenever we need to call a specific controller, we need to use the
`rpc service
<frontend/services/rpc>`{.interpreted-text role="ref"}. It only exports
a single function that perform the request:
`rpc(route, params, settings)`

Here is a short explanation on the various arguments:

- [route]{.title-ref} is the target route, as a string. For example
  [/myroute/]{.title-ref}.
- [params]{.title-ref} is an object that contains all data that will be
  given to the controller. (optional)
- [settings]{.title-ref} are for advanced controls on the request. Make
  it silent, or using a specific xhr instance. (optional)

::: example
A basic request could look like this:

``` js
setup() {
    this.rpc = useService("rpc");
    onWillStart(async () => {
        const result = await this.rpc("/my/controller", {a: 1, b: 2});
        // ...
    });
}
```
:::

::: exercise
#\. Change [Dashboard]{.title-ref} so that it uses the [rpc]{.title-ref}
service. #. Call the statistics route
[/awesome_tshirt/statistics]{.title-ref} in the
[onWillStart]{.title-ref} hook. #. Display a few cards in the dashboard
containing:

- Number of new orders this month
- Total amount of new orders this month
- Average amount of t-shirt by order this month
- Number of cancelled orders this month
- Average time for an order to go from \'new\' to \'sent\' or
  \'cancelled\'
:::

![image](02_web_framework/statistics.png){.align-center}

::: seealso
- [Code: rpc
  service]({GITHUB_PATH}/addons/web/static/src/core/network/rpc_service.js)
- [Example: calling a route in
  onWillStart](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/lunch/static/src/views/search_model.js#L21)
:::

## 4. Cache network calls, create a service

If you open the `Network`{.interpreted-text role="guilabel"} tab of your
browser\'s dev tools, you will see that the call to
[/awesome_tshirt/statistics]{.title-ref} is done every time the client
action is displayed. This is because the [onWillStart]{.title-ref} hook
is called each time the [Dashboard]{.title-ref} component is mounted.
But in this case, we would prefer to do it only the first time, so we
actually need to maintain some state outside of the
[Dashboard]{.title-ref} component. This is a nice use case for a
service!

::: example
The following example registers a simple service that displays a
notification every 5 seconds.

``` js
import { registry } from "@web/core/registry";
const myService = {
    dependencies: ["notification"],
    start(env, { notification }) {
        let counter = 1;
        setInterval(() => {
            notification.add(`Tick Tock ${counter++}`);
        }, 5000);
    },
};
registry.category("services").add("myService", myService);
```
:::

::: exercise
1.  Register and import a new [awesome_tshirt.statistics]{.title-ref}
    service.
2.  It should provide a function [loadStatistics]{.title-ref} that, once
    called, performs the actual rpc, and always return the same
    information.
3.  Use the
    [memoize](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/utils/functions.js#L11)
    utility function from [\@web/core/utils/functions]{.title-ref} that
    will allow caching the statistics.
4.  Use this service in the [Dashboard]{.title-ref} component.
5.  Check that it works as expected
:::

::: seealso
\- [Example: simple
service]({GITHUB_PATH}/addons/web/static/src/core/network/http_service.js) -
[Example: service with a
dependency]({GITHUB_PATH}/addons/web/static/src/core/user_service.js)
:::

## 5. Display a pie chart

Everyone likes charts (!), so let us add a pie chart in our dashboard.
It will display the proportions of t-shirts sold for each size:
S/M/L/XL/XXL.

For this exercise, we will use [Chart.js](https://www.chartjs.org/). It
is the chart library used by the graph view. However, it is not loaded
by default, so we will need to either add it to our assets bundle, or
lazy load it. Lazy loading is usually better since our users will not
have to load the chartjs code every time if they don\'t need it.

::: exercise
#\. Load chartjs, you can use the
[loadJs](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/assets.js#L23)
function to load `/web/static/lib/Chart/Chart.js`{.interpreted-text
role="file"}. #. In a [Card]{.title-ref} (from previous exercises),
display a [pie
chart](https://www.chartjs.org/docs/2.8.0/charts/doughnut.html) in the
dashboard that displays the correct quantity for each sold t-shirts in
each size (that information is available in the statistics route).
:::

![image](02_web_framework/pie_chart.png){.align-center}

::: seealso
\- [Example: lazy loading a js
file](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/views/graph/graph_renderer.js#L57) -
[Example: rendering a chart in a
component](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/views/graph/graph_renderer.js#L618)
:::

## 6. Going further

Here is a list of some small improvements you could try to do if you
have the time:

::: exercise
1.  Make sure your application can be
    `translated <reference/translations>`{.interpreted-text role="ref"}
    (with [env.\_t]{.title-ref}).
2.  Clicking on a section of the pie chart should open a list view of
    all orders which have the corresponding size.
3.  Add a SCSS file and see if you can change the background color of
    the dashboard action.

![image](02_web_framework/misc.png){.align-center}
:::

::: seealso
\- [Example: use of env.\_t
function](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/account/static/src/components/bills_upload/bills_upload.js#L64) -
[Code: translation code in
web/](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/l10n/translation.js#L16)
:::




--- SOURCE: developer/tutorials/discover_js_framework.md ---

show-content

:   

# Discover the JS Framework

::: {.toctree titlesonly="" glob=""}
discover_js_framework/\*
:::

This tutorial is designed to introduce you to the basics of the Odoo
Javascript framework. Whether you are new to the framework or have some
prior experience, this tutorial will provide you with a solid foundation
for using the Odoo JavaScript framework in your projects.

This tutorial is divided into two parts. The first part covers the
basics of Owl components, which are a key part of the Odoo JS framework.
Owl components are reusable UI components that can be used to build
complex web interfaces quickly and efficiently. We will explore how to
create and use Owl components in Odoo.

The second part of the tutorial focuses on creating a dashboard using
various features of Odoo. Dashboards are an essential part of any web
application, and provide a nice starting point to use and interact with
the Odoo codebase.

This tutorial assumes that you have some basic knowledge of development
with Odoo in general (models, controllers, QWeb, \...). If you are new
to Odoo, we recommend that you start with the
`Getting started </developer/tutorials/getting_started>`{.interpreted-text
role="doc"} tutorial before proceeding with this one.

## Setup {#tutorials/discover_js_framework/setup}

1.  Clone the [official Odoo tutorials
    repository](https://github.com/odoo/tutorials) and switch to the
    branch [{CURRENT_MAJOR_BRANCH}]{.title-ref}.
2.  Add the cloned repository to the
    `--addons-path <odoo-bin --addons-path>`{.interpreted-text
    role="option"}.
3.  Start a new Odoo database and install the modules
    [owl_playground]{.title-ref} and [awesome_tshirt]{.title-ref}.

## Content

- `discover_js_framework/01_owl_components`{.interpreted-text
  role="doc"}
- `discover_js_framework/02_web_framework`{.interpreted-text role="doc"}




--- SOURCE: developer/tutorials/getting_started/01_architecture.md ---

# Chapter 1: Architecture Overview {#tutorials/getting_started/01_architecture}

## Multitier application

Odoo follows a [multitier
architecture](https://en.wikipedia.org/wiki/Multitier_architecture),
meaning that the presentation, the business logic and the data storage
are separated. More specifically, it uses a three-tier architecture
(image from Wikipedia):

![Three-tier architecture](01_architecture/three_tier.svg){.align-center}

The presentation tier is a combination of HTML5, JavaScript and CSS. The
logic tier is exclusively written in Python, while the data tier only
supports PostgreSQL as an RDBMS.

Depending on the scope of your module, Odoo development can be done in
any of these tiers. Therefore, before going any further, it may be a
good idea to refresh your memory if you don\'t have an intermediate
level in these topics.

In order to go through this tutorial, you will need a very basic
knowledge of HTML and an intermediate level of Python. Advanced topics
will require more knowledge in the other subjects. There are plenty of
tutorials freely accessible, so we cannot recommend one over another
since it depends on your background.

For reference this is the official [Python
tutorial](https://docs.python.org/3.7/tutorial/).

:::: note
::: title
Note
:::

Since version 15.0, Odoo is actively transitioning to using its own
in-house developed [OWL framework](https://odoo.github.io/owl/) as part
of its presentation tier. The legacy JavaScript framework is still
supported but will be deprecated over time. This will be discussed
further in advanced topics.
::::

## Odoo modules

Both server and client extensions are packaged as *modules* which are
optionally loaded in a *database*. A module is a collection of functions
and data that target a single purpose.

Odoo modules can either add brand new business logic to an Odoo system
or alter and extend existing business logic. One module can be created
to add your country\'s accounting rules to Odoo\'s generic accounting
support, while a different module can add support for real-time
visualisation of a bus fleet.

Everything in Odoo starts and ends with modules.

Terminology: developers group their business features in Odoo *modules*.
The main user-facing modules are flagged and exposed as *Apps*, but a
majority of the modules aren\'t Apps. *Modules* may also be referred to
as *addons* and the directories where the Odoo server finds them form
the `addons_path`.

### Composition of a module

An Odoo module **can** contain a number of elements:

`Business objects <reference/orm>`{.interpreted-text role="ref"}

:   A business object (e.g. an invoice) is declared as a Python class.
    The fields defined in these classes are automatically mapped to
    database columns thanks to the
    `ORM (Object-Relational Mapping)`{.interpreted-text role="abbr"}
    layer.

`Object views <reference/views>`{.interpreted-text role="ref"}

:   Define UI display

`Data files <reference/data>`{.interpreted-text role="ref"}

:   XML or CSV files declaring the model data:

    - `views <reference/views>`{.interpreted-text role="ref"} or
      `reports <reference/reports>`{.interpreted-text role="ref"},
    - configuration data (modules parametrization,
      `security rules <reference/security>`{.interpreted-text
      role="ref"}),
    - demonstration data
    - and more

`Web controllers <reference/controllers>`{.interpreted-text role="ref"}

:   Handle requests from web browsers

Static web data

:   Images, CSS or JavaScript files used by the web interface or website

None of these elements are mandatory. Some modules may only add data
files (e.g. country-specific accounting configuration), while others may
only add business objects. During this training, we will create business
objects, object views and data files.

### Module structure

Each module is a directory within a *module directory*. Module
directories are specified by using the
`--addons-path <odoo-bin --addons-path>`{.interpreted-text
role="option"} option.

An Odoo module is declared by its
`manifest <reference/module/manifest>`{.interpreted-text role="ref"}.

When an Odoo module includes business objects (i.e. Python files), they
are organized as a [Python
package](https://docs.python.org/3/tutorial/modules.html#packages) with
a `__init__.py` file. This file contains import instructions for various
Python files in the module.

Here is a simplified module directory:

``` bash
module
├── models
│   ├── *.py
│   └── __init__.py
├── data
│   └── *.xml
├── __init__.py
└── __manifest__.py
```

## Odoo Editions

Odoo is available in [two versions](https://www.odoo.com/page/editions):
Odoo Enterprise (licensed & shared sources) and Odoo Community
(open-source). In addition to services such as support or upgrades, the
Enterprise version provides extra functionalities to Odoo. From a
technical point-of-view, these functionalities are simply new modules
installed on top of the modules provided by the Community version.

Ready to start? Before writing actual code, let\'s go to the
`next chapter <02_setup>`{.interpreted-text role="doc"} to review the
Odoo installation process. Even if Odoo is already running on your
system, we strongly suggest you go through this chapter to make sure we
start on the same page during the development of our new application.




--- SOURCE: developer/tutorials/getting_started/02_setup.md ---

# Chapter 2: Development environment setup

Depending on the intended use case, there are multiple ways to install
Odoo. For developers of the Odoo community and Odoo employees alike, the
preferred way is to perform a source install
(`running Odoo from the source code`{.interpreted-text role="dfn"}).

## Prepare the environment

First, follow the `contributing/development/setup`{.interpreted-text
role="ref"} section of the contributing guide to prepare your
environment.

By now, you should have downloaded the source code into two local
repositories, one for [odoo/odoo]{.title-ref} and one for
[odoo/enterprise]{.title-ref}. These repositories are set up to push
changes to pre-defined forks on GitHub. This will prove to be convenient
when you start contributing to the codebase, but for the scope of this
tutorial, we want to avoid polluting them with training material. Let\'s
then develop your own module in a third repository
[odoo/tutorials]{.title-ref}. Like the first two repositories, it will
be part of the [addons-path]{.title-ref} that references all directories
containing Odoo modules. In this repository, we will create our first
module!

:::: note
::: title
Note
:::

This repository also already contains some bare modules that will be
used in other tutorials.
::::

1.  Following the same process as with the [odoo/odoo]{.title-ref} and
    [odoo/enterprise]{.title-ref} repositories, clone the
    [odoo/tutorials]{.title-ref} repository on your machine with:

    ``` console
    $ git clone git@github.com:odoo/tutorials.git
    ```

2.  Configure your fork and Git to push changes to your fork rather than
    to the main codebase. If you work at Odoo, configure Git to push
    changes to the shared fork created on the account **odoo-dev**.

    ::::: tabs
    ::: tab
    Link Git with your fork

    1.  Visit
        [github.com/odoo/tutorials](https://github.com/odoo/tutorials)
        and click the `Fork`{.interpreted-text role="guilabel"} button
        to create a fork of the repository on your account.

    2.  In the command below, replace
        [\<your_github_account\>]{.title-ref} with the name of the
        GitHub account on which you created the fork.

        ``` console
        $ cd /TutorialsPath
        $ git remote add dev git@github.com:<your_github_account>/tutorials.git
        ```
    :::

    ::: tab
    Link Git with odoo-dev

    ``` console
    $ cd /tutorials
    $ git remote add dev git@github.com:odoo-dev/tutorials.git
    $ git remote set-url --push origin you_should_not_push_on_this_repository
    ```
    :::
    :::::

That\'s it! Your environment is now prepared to run Odoo from the
sources, and you have successfully created a repository to serve as an
addons directory. This will allow you to push your work to GitHub.

:::: important
::: title
Important
:::

**For Odoo employees only:**

1.  Make sure to read very carefully
    `contributing/development/first-contribution`{.interpreted-text
    role="ref"}. In particular, your branch name must follow our
    conventions.

2.  Once you have pushed your first change to the shared fork on
    **odoo-dev**, create a `PR (Pull Request)`{.interpreted-text
    role="abbr"}. Please put your quadrigram in the PR title (e.g.,
    \"abcd - Technical Training\").

    This will enable you to share your upcoming work and receive
    feedback from your coaches. To ensure a continuous feedback loop, we
    recommend pushing a new commit as soon as you complete a chapter of
    the tutorial. Note that the PR is automatically updated with commits
    you push to **odoo-dev**, you don\'t need to open multiple PRs.

3.  At Odoo we use [Runbot](https://runbot.odoo.com) extensively for our
    `CI (Continuous
    Integration)`{.interpreted-text role="abbr"} tests. When you push
    your changes to **odoo-dev**, Runbot creates a new build and test
    your code. Once logged in, you will be able to see your branches
    [Tutorials project](https://runbot.odoo.com/runbot/tutorials-12).
::::

:::: note
::: title
Note
:::

The specific location of the repositories on your file system is not
crucial. However, for the sake of simplicity, we will assume that you
have cloned all the repositories under the same directory. If this is
not the case, make sure to adjust the following commands accordingly,
providing the appropriate relative path from the [odoo/odoo]{.title-ref}
repository to the [odoo/tutorials]{.title-ref} repository.
::::

## Run the server

### Launch with [odoo-bin]{.title-ref}

Once all dependencies are set up, Odoo can be launched by running
[odoo-bin]{.title-ref}, the command-line interface of the server.

``` console
$ cd $HOME/src/odoo/
$ ./odoo-bin --addons-path="addons/,../enterprise/,../tutorials" -d rd-demo
```

There are multiple
`command-line arguments <reference/cmdline/server>`{.interpreted-text
role="ref"} that you can use to run the server. In this training you
will only need some of them.

::: option

`-d <database>`

:   

The database that is going to be used.
:::

::: option

`--addons-path <directories>`

:   

A comma-separated list of directories in which modules are stored. These
directories are scanned for modules.
:::

::: option

`--limit-time-cpu <limit>`

:   

Prevent the worker from using more than \<limit\> CPU seconds for each
request.
:::

::: option

`--limit-time-real <limit>`

:   

Prevent the worker from taking longer than \<limit\> seconds to process
a request.
:::

:::: tip
::: title
Tip
:::

\- The `--limit-time-cpu`{.interpreted-text role="option"} and
`--limit-time-real`{.interpreted-text role="option"} arguments can be
used to prevent the worker from being killed when debugging the source
code. - \| You may face an error similar to [AttributeError: module
\'\<MODULE_NAME\>\' has no attribute \'\<\$ATTRIBUTE\'\>]{.title-ref}.
In this case, you may need to re-install the module with `$ pip
install --upgrade --force-reinstall <MODULE_NAME>`{.interpreted-text
role="command"}. \| If this error occurs with more than one module, you
may need to re-install all the requirements with
`$ pip install --upgrade --force-reinstall -r requirements.txt`{.interpreted-text
role="command"}. \| You can also clear the python cache to solve the
issue:

``` console
$ cd $HOME/.local/lib/python3.8/site-packages/
$ find -name '*.pyc' -type f -delete
```

- Other commonly used arguments are:

\- `-i <odoo-bin --init>`{.interpreted-text role="option"}: Install some
modules before running the server (comma-separated list). This is
equivalent to going to `Apps`{.interpreted-text role="guilabel"} in the
user interface, and installing the module from there. -
`-u <odoo-bin --update>`{.interpreted-text role="option"}: Update some
modules before running the server (comma-separated list). This is
equivalent to going to `Apps`{.interpreted-text role="guilabel"} in the
user interface, selecting a module, and upgrading it from there.
::::

:::: note
::: title
Note
:::

For now you cannot add [../technical-training-sandbox]{.title-ref} to
your [addons-path]{.title-ref} as it is empty and will result into an
invalid addons-path folder error, but you will have to add it back later
on !
::::

### Log in to Odoo

Open <http://localhost:8069/> on your browser. We recommend using
[Chrome](https://www.google.com/intl/en/chrome/),
[Firefox](https://www.mozilla.org/firefox/new/), or any other browser
with development tools.

To log in as the administrator user, use the following credentials:

- email: [admin]{.title-ref}
- password: [admin]{.title-ref}

## Enable the developer mode

The developer or debug mode is useful for training as it gives access to
additional (advanced) tools. In the next chapters, **we will always
assume that you have enabled the developer mode**.

`Enable the developer mode <developer-mode>`{.interpreted-text
role="ref"} now. Choose the method that you prefer; they are all
equivalent.

:::: note
::: title
Note
:::

The main page of the Settings screen is only accessible if at least one
application is installed. You will be led into installing your own
application in the next chapter.
::::

## Extra tools

### Useful Git commands

Here are some useful Git commands for your day-to-day work.

- | Switch branches:
  | When you switch branches, both repositories (odoo and enterprise)
    must be synchronized, i.e. both need to be in the same branch.

  ``` console
  $ cd $HOME/src/odoo
  $ git switch {BRANCH}

  $ cd $HOME/src/enterprise
  $ git switch {BRANCH}
  ```

- Fetch and rebase:

  ``` console
  $ cd $HOME/src/odoo
  $ git fetch --all --prune
  $ git rebase --autostash odoo/{BRANCH}

  $ cd $HOME/src/enterprise
  $ git fetch --all --prune
  $ git rebase --autostash enterprise/{BRANCH}
  ```

### Code Editor

If you are working at Odoo, many of your colleagues are using
[VSCode](https://code.visualstudio.com),
[VSCodium](https://vscodium.com) (the open source equivalent),
[PyCharm](https://www.jetbrains.com/pycharm/download/#section=linux), or
[Sublime Text](https://www.sublimetext.com). However, you are free to
choose your preferred editor.

It is important to configure your linters correctly. Using a linter
helps you by showing syntax and semantic warnings or errors. Odoo source
code tries to respect Python\'s and JavaScript\'s standards, but some of
them can be ignored.

For Python, we use PEP8 with these options ignored:

- \`E501\`: line too long
- \`E301\`: expected 1 blank line, found 0
- \`E302\`: expected 2 blank lines, found 1

For JavaScript, we use ESLint and you can find a [configuration file
example
here](https://github.com/odoo/odoo/wiki/Javascript-coding-guidelines#use-a-linter).

### Administrator tools for PostgreSQL

You can manage your PostgreSQL databases using the command line as
demonstrated earlier or using a GUI application such as
[pgAdmin](https://www.pgadmin.org/download/pgadmin-4-apt/) or
[DBeaver](https://dbeaver.io/).

To connect the GUI application to your database we recommend you connect
using the Unix socket.

- Host name/address: [/var/run/postgresql]{.title-ref}
- Port: [5432]{.title-ref}
- Username: [\$USER]{.title-ref}

### Python Debugging

When facing a bug or trying to understand how the code works, simply
printing things out can go a long way, but a proper debugger can save a
lot of time.

You can use a classic Python library debugger
([pdb](https://docs.python.org/3/library/pdb.html),
[pudb](https://pypi.org/project/pudb/) or
[ipdb](https://pypi.org/project/ipdb/)), or you can use your editor\'s
debugger.

In the following example we use ipdb, but the process is similar with
other libraries.

1.  Install the library:

    ``` console
    pip install ipdb
    ```

2.  Place a trigger (breakpoint):

    ``` python
    import ipdb; ipdb.set_trace()
    ```

    ::: example
    ``` {.python emphasize-lines="2"}
    def copy(self, default=None):
        import ipdb; ipdb.set_trace()
        self.ensure_one()
        chosen_name = default.get('name') if default else ''
        new_name = chosen_name or _('%s (copy)') % self.name
        default = dict(default or {}, name=new_name)
        return super(Partner, self).copy(default)
    ```
    :::

Here is a list of commands:

::: option
h(elp) \[command\]

Print the list of available commands if not argument is supplied. With a
command as an argument, print the help about that command.
:::

::: option
pp expression

The value of the [expression]{.title-ref} is pretty-printed using the
[pprint]{.title-ref} module.
:::

::: option
w(here)

Print a stack trace with the most recent frame at the bottom.
:::

::: option
d(own)

Move the current frame one level down in the stack trace (to a newer
frame).
:::

::: option
u(p)

Move the current frame one level up in the stack trace (to an older
frame).
:::

::: option
n(ext)

Continue the execution until the next line in the current function is
reached or it returns.
:::

::: option
c(ontinue)

Continue the execution and only stop when a breakpoint is encountered.
:::

::: option
s(tep)

Execute the current line. Stop at the first possible occasion (either in
a function that is called or on the next line in the current function).
:::

::: option
q(uit)

Quit the debugger. The program being executed is aborted.
:::

Now that your server is running, it\'s time to start
`writing your own application
<tutorials/getting_started/03_newapp>`{.interpreted-text role="ref"}!




--- SOURCE: developer/tutorials/getting_started/03_newapp.md ---

# Chapter 3: A New Application {#tutorials/getting_started/03_newapp}

The purpose of this chapter is to lay the foundation for the creation of
a completely new Odoo module. We will start from scratch with the
minimum needed to have our module recognized by Odoo. In the upcoming
chapters, we will progressively add features to build a realistic
business case.

## The Real Estate Advertisement module

Our new module will cover a business area which is very specific and
therefore not included in the standard set of modules: real estate. It
is worth noting that before developing a new module, it is good practice
to verify that Odoo doesn\'t already provide a way to answer the
specific business case.

Here is an overview of the main list view containing some
advertisements:

![List view 01](03_newapp/overview_list_view_01.png){.align-center}

The top area of the form view summarizes important information for the
property, such as the name, the property type, the postcode and so on.
The first tab contains information describing the property: bedrooms,
living area, garage, garden\...

![Form view 01](03_newapp/overview_form_view_01.png){.align-center}

The second tab lists the offers for the property. We can see here that
potential buyers can make offers above or below the expected selling
price. It is up to the seller to accept an offer.

![Form view 02](03_newapp/overview_form_view_02.png){.align-center}

Here is a quick video showing the workflow of the module.

Hopefully, this video will be recorded soon :-)

## Prepare the addon directory

**Reference**: the documentation related to this topic can be found in
`manifest <reference/module/manifest>`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: the goal of this section is to have Odoo recognize our new
module, which will be an empty shell for now. It will be listed in the
Apps:

![The new module appears in the list](03_newapp/app_in_list.png){.align-center}
::::

The first step of module creation is to create its directory. In the
[tutorials]{.title-ref} directory, add a new directory
`estate`{.interpreted-text role="file"}.

A module must contain at least 2 files: the `__manifest__.py` file and a
`__init__.py` file. The `__init__.py` file can remain empty for now and
we\'ll come back to it in the next chapter. On the other hand, the
`__manifest__.py` file must describe our module and cannot remain empty.
Its only required field is the `name`, but it usually contains much more
information.

Take a look at the [CRM
file](https://github.com/odoo/odoo/blob/fc92728fb2aa306bf0e01a7f9ae1cfa3c1df0e10/addons/crm/__manifest__.py#L1-L67)
as an example. In addition to providing the description of the module
(`name`, `category`, `summary`, `website`\...), it lists its
dependencies (`depends`). A dependency means that the Odoo framework
will ensure that these modules are installed before our module is
installed. Moreover, if one of these dependencies is uninstalled, then
our module and **any other that depends on it will also be
uninstalled**. Think about your favorite Linux distribution package
manager (`apt`, `dnf`, `pacman`\...): Odoo works in the same way.

::: exercise
Create the required addon files.

Create the following folders and files:

- `/home/$USER/src/tutorials/estate/__init__.py`
- `/home/$USER/src/tutorials/estate/__manifest__.py`

The `__manifest__.py` file should only define the name and the
dependencies of our modules. The only necessary framework module for now
is `base`.
:::

Restart the Odoo server and go to Apps. Click on Update Apps List,
search for `estate` and\... tadaaa, your module appears! Did it not
appear? Maybe try removing the default \'Apps\' filter ;-)

:::: warning
::: title
Warning
:::

Remember to enable the
`developer mode <developer-mode>`{.interpreted-text role="ref"} as
explained in the previous chapter. You won\'t see the
`Update Apps List`{.interpreted-text role="guilabel"} button otherwise.
::::

::: exercise
Make your module an \'App\'.

Add the appropriate key to your `__manifest__.py` so that the module
appears when the \'Apps\' filter is on.
:::

You can even install the module! But obviously it\'s an empty shell, so
no menu will appear.

All good? If yes, then let\'s `create our first model
<tutorials/getting_started/04_basicmodel>`{.interpreted-text
role="ref"}!




--- SOURCE: developer/tutorials/getting_started/04_basicmodel.md ---

# Chapter 4: Models And Basic Fields {#tutorials/getting_started/04_basicmodel}

At the end of the
`previous chapter <tutorials/getting_started/03_newapp>`{.interpreted-text
role="ref"}, we were able to create an Odoo module. However, at this
point it is still an empty shell which doesn\'t allow us to store any
data. In our real estate module, we want to store the information
related to the properties (name, description, price, living area\...) in
a database. The Odoo framework provides tools to facilitate database
interactions.

Before moving forward in the exercise, make sure the `estate` module is
installed, i.e. it must appear as \'Installed\' in the Apps list.

:::: warning
::: title
Warning
:::

Do not use mutable global variables.

A single Odoo instance can run several databases in parallel within the
same python process. Distinct modules might be installed on each of
these databases, therefore we cannot rely on global variables that would
be updated depending on installed modules.
::::

## Object-Relational Mapping

**Reference**: the documentation related to this topic can be found in
the `reference/orm/model`{.interpreted-text role="ref"} API.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the table `estate_property` should
be created:

``` text
$ psql -d rd-demo
rd-demo=# SELECT COUNT(*) FROM estate_property;
count
-------
    0
(1 row)
```
::::

A key component of Odoo is the
[ORM](https://en.wikipedia.org/wiki/Object-relational_mapping) layer.
This layer avoids having to manually write most
[SQL](https://en.wikipedia.org/wiki/SQL) and provides extensibility and
security services[^1].

Business objects are declared as Python classes extending
`~odoo.models.Model`{.interpreted-text role="class"}, which integrates
them into the automated persistence system.

Models can be configured by setting attributes in their definition. The
most important attribute is `~odoo.models.Model._name`{.interpreted-text
role="attr"}, which is required and defines the name for the model in
the Odoo system. Here is a minimum definition of a model:

    from odoo import models

    class TestModel(models.Model):
        _name = "test_model"

This definition is enough for the ORM to generate a database table named
[test_model]{.title-ref}. By convention all models are located in a
[models]{.title-ref} directory and each model is defined in its own
Python file.

Take a look at how the `crm_recurring_plan` table is defined and how the
corresponding Python file is imported:

1.  The model is defined in the file `crm/models/crm_recurring_plan.py`
    (see
    [here](https://github.com/odoo/odoo/blob/e80911aaead031e7523173789e946ac1fd27c7dc/addons/crm/models/crm_recurring_plan.py#L1-L9))
2.  The file `crm_recurring_plan.py` is imported in
    `crm/models/__init__.py` (see
    [here](https://github.com/odoo/odoo/blob/e80911aaead031e7523173789e946ac1fd27c7dc/addons/crm/models/__init__.py#L15))
3.  The folder `models` is imported in `crm/__init__.py` (see
    [here](https://github.com/odoo/odoo/blob/e80911aaead031e7523173789e946ac1fd27c7dc/addons/crm/__init__.py#L5))

::: exercise
Define the real estate properties model.

Based on example given in the CRM module, create the appropriate files
and folder for the `estate_property` table.

When the files are created, add a minimum definition for the
`estate.property` model.
:::

Any modification of the Python files requires a restart of the Odoo
server. When we restart the server, we will add the parameters `-d` and
`-u`:

``` console
$ ./odoo-bin --addons-path=addons,../enterprise/,../tutorials/ -d rd-demo -u estate
```

`-u estate` means we want to upgrade the `estate` module, i.e. the ORM
will apply database schema changes. In this case it creates a new table.
`-d rd-demo` means that the upgrade should be performed on the `rd-demo`
database. `-u` should always be used in combination with `-d`.

During the startup you should see the following warnings:

``` text
...
WARNING rd-demo odoo.models: The model estate.property has no _description
...
WARNING rd-demo odoo.modules.loading: The model estate.property has no access rules, consider adding one...
...
```

If this is the case, then you should be good! To be sure, double check
with `psql` as demonstrated in the **Goal**.

::: exercise
Add a description.

Add a `_description` to your model to get rid of one of the warnings.
:::

## Model fields

**Reference**: the documentation related to this topic can be found in
the `reference/orm/fields`{.interpreted-text role="ref"} API.

Fields are used to define what the model can store and where they are
stored. Fields are defined as attributes in the model class:

    from odoo import fields, models

    class TestModel(models.Model):
        _name = "test_model"
        _description = "Test Model"

        name = fields.Char()

The `name` field is a `~odoo.fields.Char`{.interpreted-text
role="class"} which will be represented as a Python unicode `str` and a
SQL `VARCHAR`.

### Types

:::: note
::: title
Note
:::

**Goal**: at the end of this section, several basic fields should have
been added to the table `estate_property`:

``` text
$ psql -d rd-demo

rd-demo=# \d estate_property;
                                            Table "public.estate_property"
    Column       |            Type             | Collation | Nullable |                   Default
--------------------+-----------------------------+-----------+----------+---------------------------------------------
id                 | integer                     |           | not null | nextval('estate_property_id_seq'::regclass)
create_uid         | integer                     |           |          |
create_date        | timestamp without time zone |           |          |
write_uid          | integer                     |           |          |
write_date         | timestamp without time zone |           |          |
name               | character varying           |           |          |
description        | text                        |           |          |
postcode           | character varying           |           |          |
date_availability  | date                        |           |          |
expected_price     | double precision            |           |          |
selling_price      | double precision            |           |          |
bedrooms           | integer                     |           |          |
living_area        | integer                     |           |          |
facades            | integer                     |           |          |
garage             | boolean                     |           |          |
garden             | boolean                     |           |          |
garden_area        | integer                     |           |          |
garden_orientation | character varying           |           |          |
Indexes:
    "estate_property_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "estate_property_create_uid_fkey" FOREIGN KEY (create_uid) REFERENCES res_users(id) ON DELETE SET NULL
    "estate_property_write_uid_fkey" FOREIGN KEY (write_uid) REFERENCES res_users(id) ON DELETE SET NULL
```
::::

There are two broad categories of fields: \'simple\' fields, which are
atomic values stored directly in the model\'s table, and \'relational\'
fields, which link records (of the same or different models).

Simple field examples are `~odoo.fields.Boolean`{.interpreted-text
role="class"}, `~odoo.fields.Float`{.interpreted-text role="class"},
`~odoo.fields.Char`{.interpreted-text role="class"},
`~odoo.fields.Text`{.interpreted-text role="class"},
`~odoo.fields.Date`{.interpreted-text role="class"} and
`~odoo.fields.Selection`{.interpreted-text role="class"}.

::: exercise
Add basic fields to the Real Estate Property table.

Add the following basic fields to the table:

  Field                Type
  -------------------- -----------
  name                 Char
  description          Text
  postcode             Char
  date_availability    Date
  expected_price       Float
  selling_price        Float
  bedrooms             Integer
  living_area          Integer
  facades              Integer
  garage               Boolean
  garden               Boolean
  garden_area          Integer
  garden_orientation   Selection

The `garden_orientation` field must have 4 possible values: \'North\',
\'South\', \'East\' and \'West\'. The selection list is defined as a
list of tuples, see
[here](https://github.com/odoo/odoo/blob/b0e0035b585f976e912e97e7f95f66b525bc8e43/addons/crm/report/crm_activity_report.py#L31-L34)
for an example.
:::

When the fields are added to the model, restart the server with
`-u estate`

``` console
$ ./odoo-bin --addons-path=addons,../enterprise/,../tutorials/ -d rd-demo -u estate
```

Connect to `psql` and check the structure of the table
`estate_property`. You\'ll notice that a couple of extra fields were
also added to the table. We will revisit them later.

### Common Attributes

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the columns `name` and
`expected_price` should be not nullable in the table `estate_property`:

``` console
rd-demo=# \d estate_property;
                                            Table "public.estate_property"
    Column       |            Type             | Collation | Nullable |                   Default
--------------------+-----------------------------+-----------+----------+---------------------------------------------
...
name               | character varying           |           | not null |
...
expected_price     | double precision            |           | not null |
...
```
::::

Much like the model itself, fields can be configured by passing
configuration attributes as parameters:

    name = fields.Char(required=True)

Some attributes are available on all fields, here are the most common
ones:

`~odoo.fields.Field.string`{.interpreted-text role="attr"} (`str`, default: field\'s name)

:   The label of the field in UI (visible by users).

`~odoo.fields.Field.required`{.interpreted-text role="attr"} (`bool`, default: `False`)

:   If `True`, the field can not be empty. It must either have a default
    value or always be given a value when creating a record.

`~odoo.fields.Field.help`{.interpreted-text role="attr"} (`str`, default: `''`)

:   Provides long-form help tooltip for users in the UI.

`~odoo.fields.Field.index`{.interpreted-text role="attr"} (`bool`, default: `False`)

:   Requests that Odoo create a [database
    index](https://use-the-index-luke.com/sql/preface) on the column.

::: exercise
Set attributes for existing fields.

Add the following attributes:

  Field            Attribute
  ---------------- -----------
  name             required
  expected_price   required

After restarting the server, both fields should be not nullable.
:::

### Automatic Fields

**Reference**: the documentation related to this topic can be found in
`reference/fields/automatic`{.interpreted-text role="ref"}.

You may have noticed your model has a few fields you never defined. Odoo
creates a few fields in all models[^2]. These fields are managed by the
system and can\'t be written to, but they can be read if useful or
necessary:

`~odoo.fields.Model.id`{.interpreted-text role="attr"} (`~odoo.fields.Id`{.interpreted-text role="class"})

:   The unique identifier for a record of the model.

`~odoo.fields.Model.create_date`{.interpreted-text role="attr"} (`~odoo.fields.Datetime`{.interpreted-text role="class"})

:   Creation date of the record.

`~odoo.fields.Model.create_uid`{.interpreted-text role="attr"} (`~odoo.fields.Many2one`{.interpreted-text role="class"})

:   User who created the record.

`~odoo.fields.Model.write_date`{.interpreted-text role="attr"} (`~odoo.fields.Datetime`{.interpreted-text role="class"})

:   Last modification date of the record.

`~odoo.fields.Model.write_uid`{.interpreted-text role="attr"} (`~odoo.fields.Many2one`{.interpreted-text role="class"})

:   User who last modified the record.

Now that we have created our first model, let\'s
`add some security <tutorials/getting_started/05_securityintro>`{.interpreted-text
role="ref"}!

[^1]: writing raw SQL queries is possible, but requires caution as this
    bypasses all Odoo authentication and security mechanisms.

[^2]: it is possible to `disable the automatic creation of some
    fields <reference/fields/automatic/log_access>`{.interpreted-text
    role="ref"}




--- SOURCE: developer/tutorials/getting_started/05_securityintro.md ---

# Chapter 5: Security - A Brief Introduction {#tutorials/getting_started/05_securityintro}

In the
`previous chapter <tutorials/getting_started/04_basicmodel>`{.interpreted-text
role="ref"}, we created our first table intended to store business data.
In a business application such as Odoo, one of the first questions to
consider is who[^1] can access the data. Odoo provides a security
mechanism to allow access to the data for specific groups of users.

The topic of security is covered in more detail in
`../restrict_data_access`{.interpreted-text role="doc"}. This chapter
aims to cover the minimum required for our new module.

## Data Files (CSV)

Odoo is a highly data driven system. Although behavior is customized
using Python code, part of a module\'s value is in the data it sets up
when loaded. One way to load data is through a CSV file. One example is
the [list of country
states]({GITHUB_PATH}/odoo/addons/base/data/res.country.state.csv) which
is loaded at installation of the [base]{.title-ref} module.

``` text
"id","country_id:id","name","code"
state_au_1,au,"Australian Capital Territory","ACT"
state_au_2,au,"New South Wales","NSW"
state_au_3,au,"Northern Territory","NT"
state_au_4,au,"Queensland","QLD"
...
```

- `id` is an `external identifier`{.interpreted-text role="term"}. It
  can be used to refer to the record (without knowing its in-database
  identifier).
- `country_id:id` refers to the country by using its
  `external identifier`{.interpreted-text role="term"}.
- `name` is the name of the state.
- `code` is the code of the state.

These three fields are
[defined](https://github.com/odoo/odoo/blob/2ad2f3d6567b6266fc42c6d2999d11f3066b282c/odoo/addons/base/models/res_country.py#L108-L111)
in the `res.country.state` model.

By convention, a file importing data is located in the `data` folder of
a module. When the data is related to security, it is located in the
`security` folder. When the data is related to views and actions (we
will cover this later), it is located in the `views` folder.
Additionally, all of these files must be declared in the `data` list
within the `__manifest__.py` file. Our example file is defined [in the
manifest of the base
module](https://github.com/odoo/odoo/blob/e8697f609372cd61b045c4ee2c7f0fcfb496f58a/odoo/addons/base/__manifest__.py#L29).

Also note that the content of the data files is only loaded when a
module is installed or updated.

:::: warning
::: title
Warning
:::

The data files are sequentially loaded following their order in the
`__manifest__.py` file. This means that if data `A` refers to data `B`,
you must make sure that `B` is loaded before `A`.

In the case of the country states, you will note that the [list of
countries](https://github.com/odoo/odoo/blob/e8697f609372cd61b045c4ee2c7f0fcfb496f58a/odoo/addons/base/__manifest__.py#L22)
is loaded **before** the [list of country
states](https://github.com/odoo/odoo/blob/e8697f609372cd61b045c4ee2c7f0fcfb496f58a/odoo/addons/base/__manifest__.py#L29).
This is because the states refer to the countries.
::::

Why is all this important for security? Because all the security
configuration of a model is loaded through data files, as we\'ll see in
the next section.

## Access Rights

**Reference**: the documentation related to this topic can be found in
`reference/security/acl`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the following warning should not
appear anymore:

``` text
WARNING rd-demo odoo.modules.loading: The models ['estate.property'] have no access rules...
```
::::

When no access rights are defined on a model, Odoo determines that no
users can access the data. It is even notified in the log:

``` text
WARNING rd-demo odoo.modules.loading: The models ['estate.property'] have no access rules in module estate, consider adding some, like:
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
```

Access rights are defined as records of the model `ir.model.access`.
Each access right is associated with a model, a group (or no group for
global access) and a set of permissions: create, read, write and
unlink[^2]. Such access rights are usually defined in a CSV file named
`ir.model.access.csv`.

Here is an example for our previous \`test_model\`:

``` text
id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_test_model,access_test_model,model_test_model,base.group_user,1,0,0,0
```

- `id` is an `external identifier`{.interpreted-text role="term"}.
- `name` is the name of the `ir.model.access`.
- `model_id/id` refers to the model which the access right applies to.
  The standard way to refer to the model is `model_<model_name>`, where
  `<model_name>` is the `_name` of the model with the `.` replaced by
  `_`. Seems cumbersome? Indeed it is\...
- `group_id/id` refers to the group which the access right applies to.
- `perm_read,perm_write,perm_create,perm_unlink`: read, write, create
  and unlink permissions

::: exercise
Add access rights.

Create the `ir.model.access.csv` file in the appropriate folder and
define it in the `__manifest__.py` file.

Give the read, write, create and unlink permissions to the group
`base.group_user`.

Tip: the warning message in the log gives you most of the solution ;-)
:::

Restart the server and the warning message should have disappeared!

It\'s now time to finally
`interact with the UI <tutorials/getting_started/06_firstui>`{.interpreted-text
role="ref"}!

[^1]: meaning which Odoo user (or group of users)

[^2]: \'unlink\' is the equivalent of \'delete\'




--- SOURCE: developer/tutorials/getting_started/06_firstui.md ---

# Chapter 6: Finally, Some UI To Play With {#tutorials/getting_started/06_firstui}

Now that we\'ve created our new
`model <tutorials/getting_started/04_basicmodel>`{.interpreted-text
role="ref"} and its corresponding
`access rights <tutorials/getting_started/05_securityintro>`{.interpreted-text
role="ref"}, it is time to interact with the user interface.

At the end of this chapter, we will have created a couple of menus in
order to access a default list and form view.

## Data Files (XML)

**Reference**: the documentation related to this topic can be found in
`reference/data`{.interpreted-text role="ref"}.

In `tutorials/getting_started/05_securityintro`{.interpreted-text
role="ref"}, we added data through a CSV file. The CSV format is
convenient when the data to load has a simple format. When the format is
more complex (e.g. load the structure of a view or an email template),
we use the XML format. For example, this [help
field](https://github.com/odoo/odoo/blob/09c59012bf80d2ccbafe21c39e604d6cfda72924/addons/crm/views/crm_lost_reason_views.xml#L61-L69)
contains HTML tags. While it would be possible to load such data through
a CSV file, it is more convenient to use an XML file.

The XML files must be added to the same folders as the CSV files and
defined similarly in the `__manifest__.py`. The content of the data
files is also sequentially loaded when a module is installed or updated,
therefore all remarks made for CSV files hold true for XML files. When
the data is linked to views, we add them to the `views` folder.

In this chapter, we will load our first action and menus through an XML
file. Actions and menus are standard records in the database.

:::: note
::: title
Note
:::

When performance is important, the CSV format is preferred over the XML
format. This is the case in Odoo where loading a CSV file is faster than
loading an XML file.
::::

In Odoo, the user interface (actions, menus and views) is largely
defined by creating and composing records defined in an XML file. A
common pattern is Menu \> Action \> View. To access records the user
navigates through several menu levels; the deepest level is an action
which triggers the opening of a list of the records.

## Actions

**Reference**: the documentation related to this topic can be found in
`reference/actions`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, an action should be loaded in the
system. We won\'t see anything yet in the UI, but the file should be
loaded in the log:

``` text
INFO rd-demo odoo.modules.loading: loading estate/views/estate_property_views.xml
```
::::

Actions can be triggered in three ways:

1.  by clicking on menu items (linked to specific actions)
2.  by clicking on buttons in views (if these are connected to actions)
3.  as contextual actions on object

We will only cover the first case in this chapter. The second case will
be covered in a
`later chapter <tutorials/getting_started/10_actions>`{.interpreted-text
role="ref"} while the last is the focus of an advanced topic. In our
Real Estate example, we would like to link a menu to the
`estate.property` model, so we are able to create a new record. The
action can be viewed as the link between the menu and the model.

A basic action for our [test_model]{.title-ref} is:

``` xml
<record id="test_model_action" model="ir.actions.act_window">
    <field name="name">Test action</field>
    <field name="res_model">test_model</field>
    <field name="view_mode">tree,form</field>
</record>
```

- `id` is an `external identifier`{.interpreted-text role="term"}. It
  can be used to refer to the record (without knowing its in-database
  identifier).
- `model` has a fixed value of `ir.actions.act_window`
  (`reference/actions/window`{.interpreted-text role="ref"}).
- `name` is the name of the action.
- `res_model` is the model which the action applies to.
- `view_mode` are the views that will be available; in this case they
  are the list (tree) and form views. We\'ll see
  `later <tutorials/getting_started/15_qwebintro>`{.interpreted-text
  role="ref"} that there can be other view modes.

Examples can be found everywhere in Odoo, but
[this](https://github.com/odoo/odoo/blob/09c59012bf80d2ccbafe21c39e604d6cfda72924/addons/crm/views/crm_lost_reason_views.xml#L57-L70)
is a good example of a simple action. Pay attention to the structure of
the XML data file since you will need it in the following exercise.

::: exercise
Add an action.

Create the `estate_property_views.xml` file in the appropriate folder
and define it in the `__manifest__.py` file.

Create an action for the model `estate.property`.
:::

Restart the server and you should see the file loaded in the log.

## Menus

**Reference**: the documentation related to this topic can be found in
`reference/data/shortcuts`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, three menus should be created and
the default view is displayed:

![Root menus](06_firstui/estate_menu_root.png){.align-center}

![First level and action menus](06_firstui/estate_menu_action.png){.align-center}

![Default form view](06_firstui/estate_form_default.png){.align-center}
::::

To reduce the complexity in declaring a menu (`ir.ui.menu`) and
connecting it to the corresponding action, we can use the `<menuitem>`
shortcut .

A basic menu for our `test_model_action` is:

``` xml
<menuitem id="test_model_menu_action" action="test_model_action"/>
```

The menu `test_model_menu_action` is linked to the action
`test_model_action`, and the action is linked to the model
[test_model]{.title-ref}. As previously mentioned, the action can be
seen as the link between the menu and the model.

However, menus always follow an architecture, and in practice there are
three levels of menus:

1.  The root menu, which is displayed in the App switcher (the Odoo
    Community App switcher is a dropdown menu)

2.  The first level menu, displayed in the top bar

3.  The action menus

    ![Root menus](06_firstui/menu_01.png){.align-center}

    ![First level and action menus](06_firstui/menu_02.png){.align-center}

The easiest way to define the structure is to create it in the XML file.
A basic structure for our `test_model_action` is:

``` xml
<menuitem id="test_menu_root" name="Test">
    <menuitem id="test_first_level_menu" name="First Level">
        <menuitem id="test_model_menu_action" action="test_model_action"/>
    </menuitem>
</menuitem>
```

The name for the third menu is taken from the name of the `action`.

::: exercise
Add menus.

Create the `estate_menus.xml` file in the appropriate folder and define
it in the `__manifest__.py` file. Remember the sequential loading of the
data files ;-)

Create the three levels of menus for the `estate.property` action
created in the previous exercise. Refer to the **Goal** of this section
for the expected result.
:::

Restart the server and **refresh the browser**[^1]. You should now see
the menus, and you\'ll even be able to create your first real estate
property advertisement!

## Fields, Attributes And View

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the selling price should be
read-only and the number of bedrooms and the availability date should
have default values. Additionally the selling price and availability
date values won\'t be copied when the record is duplicated.

![Interaction between model and view](06_firstui/attribute_and_default.gif){.align-center}

The reserved fields `active` and `state` are added to the
`estate.property` model.
::::

So far we have only used the generic view for our real estate property
advertisements, but in most cases we want to fine tune the view. There
are many fine-tunings possible in Odoo, but usually the first step is to
make sure that:

- some fields have a default value
- some fields are read-only
- some fields are not copied when duplicating the record

In our real estate business case, we would like the following:

- The selling price should be read-only (it will be automatically filled
  in later)
- The availability date and the selling price should not be copied when
  duplicating a record
- The default number of bedrooms should be 2
- The default availability date should be in 3 months

### Some New Attributes

Before moving further with the view design, let\'s step back to our
model definition. We saw that some attributes, such as `required=True`,
impact the table schema in the database. Other attributes will impact
the view or provide default values.

::: exercise
Add new attributes to the fields.

Find the appropriate attributes (see
`~odoo.fields.Field`{.interpreted-text role="class"}) to:

- set the selling price as read-only
- prevent copying of the availability date and the selling price values
:::

Restart the server and refresh the browser. You should not be able to
set any selling prices. When duplicating a record, the availability date
should be empty.

### Default Values

Any field can be given a default value. In the field definition, add the
option `default=X` where `X` is either a Python literal value (boolean,
integer, float, string) or a function taking a model and returning a
value:

    name = fields.Char(default="Unknown")
    last_seen = fields.Datetime("Last Seen", default=fields.Datetime.now)

The `name` field will have the value \'Unknown\' by default while the
`last_seen` field will be set as the current time.

::: exercise
Set default values.

Add the appropriate default attributes so that:

- the default number of bedrooms is 2
- the default availability date is in 3 months

Tip: this might help you: `~odoo.fields.Date.today`{.interpreted-text
role="meth"}
:::

Check that the default values are set as expected.

### Reserved Fields

**Reference**: the documentation related to this topic can be found in
`reference/orm/fields/reserved`{.interpreted-text role="ref"}.

A few field names are reserved for pre-defined behaviors. They should be
defined on a model when the related behavior is desired.

::: exercise
Add active field.

Add the `active` field to the `estate.property` model.
:::

Restart the server, create a new property, then come back to the list
view\... The property will not be listed! `active` is an example of a
reserved field with a specific behavior: when a record has
`active=False`, it is automatically removed from any search. To display
the created property, you will need to specifically search for inactive
records.

![Inactive records](06_firstui/inactive.gif){.align-center}

::: exercise
Set a default value for active field.

Set the appropriate default value for the `active` field so it doesn\'t
disappear anymore.
:::

Note that the default `active=False` value was assigned to all existing
records.

::: exercise
Add state field.

Add a `state` field to the `estate.property` model. Five values are
possible: New, Offer Received, Offer Accepted, Sold and Canceled. It
must be required, should not be copied and should have its default value
set to \'New\'.

Make sure to use the correct type!
:::

The `state` will be used later on for several UI enhancements.

Now that we are able to interact with the UI thanks to the default
views, the next step is obvious: we want to define
`our own views <tutorials/getting_started/07_basicviews>`{.interpreted-text
role="ref"}.

[^1]: A refresh is needed since the web client keeps a cache of the
    various menus and views for performance reasons.




--- SOURCE: developer/tutorials/getting_started/07_basicviews.md ---

# Chapter 7: Basic Views {#tutorials/getting_started/07_basicviews}

We have seen in the
`previous chapter <tutorials/getting_started/06_firstui>`{.interpreted-text
role="ref"} that Odoo is able to generate default views for a given
model. In practice, the default view is **never** acceptable for a
business application. Instead, we should at least organize the various
fields in a logical manner.

Views are defined in XML files with actions and menus. They are
instances of the `ir.ui.view` model.

In our real estate module, we need to organize the fields in a logical
way:

- in the list (tree) view, we want to display more than just the name.
- in the form view, the fields should be grouped.
- in the search view, we must be able to search on more than just the
  name. Specifically, we want a filter for the \'Available\' properties
  and a shortcut to group by postcode.

## List

**Reference**: the documentation related to this topic can be found in
`reference/views/list`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the list view should look like
this:

![List view](07_basicviews/list.png){.align-center}
::::

List views, also called tree views, display records in a tabular form.

Their root element is `<tree>`. The most basic version of this view
simply lists all the fields to display in the table (where each field is
a column):

``` xml
<tree string="Tests">
    <field name="name"/>
    <field name="last_seen"/>
</tree>
```

A simple example can be found
[here](https://github.com/odoo/odoo/blob/6da14a3aadeb3efc40f145f6c11fc33314b2f15e/addons/crm/views/crm_lost_reason_views.xml#L46-L54).

::: exercise
Add a custom list view.

Define a list view for the `estate.property` model in the appropriate
XML file. Check the **Goal** of this section for the fields to display.

Tips:

- do not add the `editable="bottom"` attribute that you can find in the
  example above. We\'ll come back to it later.
- some field labels may need to be adapted to match the reference.
:::

As always, you need to restart the server (do not forget the `-u`
option) and refresh the browser to see the result.

:::: warning
::: title
Warning
:::

You will probably use some copy-paste in this chapter, therefore always
make sure that the `id` remains unique for each view!
::::

## Form

**Reference**: the documentation related to this topic can be found in
`reference/views/form`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the form view should look like
this:

![Form view](07_basicviews/form.png){.align-center}
::::

Forms are used to create and edit single records.

Their root element is `<form>`. They are composed of high-level
structure elements (groups and notebooks) and interactive elements
(buttons and fields):

``` xml
<form string="Test">
    <sheet>
        <group>
            <group>
                <field name="name"/>
            </group>
            <group>
                <field name="last_seen"/>
            </group>
            <notebook>
                <page string="Description">
                    <field name="description"/>
                </page>
            </notebook>
        </group>
    </sheet>
</form>
```

It is possible to use regular HTML tags such as `div` and `h1` as well
as the the `class` attribute (Odoo provides some built-in classes) to
fine-tune the look.

A simple example can be found
[here](https://github.com/odoo/odoo/blob/6da14a3aadeb3efc40f145f6c11fc33314b2f15e/addons/crm/views/crm_lost_reason_views.xml#L16-L44).

::: exercise
Add a custom form view.

Define a form view for the `estate.property` model in the appropriate
XML file. Check the **Goal** of this section for the expected final
design of the page.
:::

This might require some trial and error before you get to the expected
result ;-) It is advised that you add the fields and the tags one at a
time to help understand how it works.

In order to avoid relaunching the server every time you do a
modification to the view, it can be convenient to use the `--dev xml`
parameter when launching the server:

``` console
$ ./odoo-bin --addons-path=addons,../enterprise/,../tutorials/ -d rd-demo -u estate --dev xml
```

This parameter allows you to just refresh the page to view your view
modifications.

## Search

**Reference**: the documentation related to this topic can be found in
`reference/views/search`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the search view should look like
this:

![Search fields](07_basicviews/search_01.png){.align-center}

![Filter](07_basicviews/search_02.png){.align-center}

![Group By](07_basicviews/search_03.png){.align-center}
::::

Search views are slightly different from the list and form views since
they don\'t display *content*. Although they apply to a specific model,
they are used to filter other views\' content (generally aggregated
views such as `reference/views/list`{.interpreted-text role="ref"}).
Beyond the difference in use case, they are defined the same way.

Their root element is `<search>`. The most basic version of this view
simply lists all the fields for which a shortcut is desired:

``` xml
<search string="Tests">
    <field name="name"/>
    <field name="last_seen"/>
</search>
```

The default search view generated by Odoo provides a shortcut to filter
by `name`. It is very common to add the fields which the user is likely
to filter on in a customized search view.

::: exercise
Add a custom search view.

Define a search view for the `estate.property` model in the appropriate
XML file. Check the first image of this section\'s **Goal** for the list
of fields.
:::

After restarting the server, it should be possible to filter on the
given fields.

Search views can also contain `<filter>` elements, which act as toggles
for predefined searches. Filters must have one of the following
attributes:

- `domain`: adds the given domain to the current search
- `context`: adds some context to the current search; uses the key
  `group_by` to group results on the given field name

A simple example can be found
[here](https://github.com/odoo/odoo/blob/715a24333bf000d5d98b9ede5155d3af32de067c/addons/delivery/views/delivery_view.xml#L30-L44).

Before going further in the exercise, it is necessary to introduce the
\'domain\' concept.

### Domains

**Reference**: the documentation related to this topic can be found in
`reference/orm/domains`{.interpreted-text role="ref"}.

In Odoo, a domain encodes conditions on records: a domain is a list of
criteria used to select a subset of a model\'s records. Each criterion
is a triplet with a *field name*, an *operator* and a *value*. A record
satisfies a criterion if the specified field meets the condition of the
operator applied to the value.

For instance, when used on the *Product* model the following domain
selects all *services* with a unit price greater than *1000*:

    [('product_type', '=', 'service'), ('unit_price', '>', 1000)]

By default criteria are combined with an implicit AND, meaning *every*
criterion needs to be satisfied for a record to match a domain. The
logical operators `&` (AND), `|` (OR) and `!` (NOT) can be used to
explicitly combine criteria. They are used in prefix position (the
operator is inserted before its arguments rather than between). For
instance, to select products \'which are services *OR* have a unit price
which is *NOT* between 1000 and 2000\':

    ['|',
        ('product_type', '=', 'service'),
        '!', '&',
            ('unit_price', '>=', 1000),
            ('unit_price', '<', 2000)]

::::: note
::: title
Note
:::

XML does not allow `<` and `&` to be used inside XML elements. To avoid
parsing errors, entity references should be used: `&lt;` for `<` and
`&amp;` for `&`. Other entity references (`&gt;`, `&apos;` & `&quot;`)
are optional.

::: example
.. code-block:: xml

\<filter name=\"negative\" domain=\"\[(\'test_val\', \'&lt;\', 0)\]\"/\>
:::
:::::

::: exercise
Add filter and Group By.

The following should be added to the previously created search view:

- a filter which displays available properties, i.e. the state should be
  \'New\' or \'Offer Received\'.
- the ability to group results by postcode.
:::

Looking good? At this point we are already able to create models and
design a user interface which makes sense business-wise. However, a key
component is still missing: the
`link between models <tutorials/getting_started/08_relations>`{.interpreted-text
role="ref"}.




--- SOURCE: developer/tutorials/getting_started/08_relations.md ---

# Chapter 8: Relations Between Models {#tutorials/getting_started/08_relations}

The
`previous chapter <tutorials/getting_started/07_basicviews>`{.interpreted-text
role="ref"} covered the creation of custom views for a model containing
basic fields. However, in any real business scenario we need more than
one model. Moreover, links between models are necessary. One can easily
imagine one model containing the customers and another one containing
the list of users. You might need to refer to a customer or a user on
any existing business model.

In our real estate module, we want the following information for a
property:

- the customer who bought the property
- the real estate agent who sold the property
- the property type: house, apartment, penthouse, castle\...
- a list of tags characterizing the property: cozy, renovated\...
- a list of the offers received

## Many2one

**Reference**: the documentation related to this topic can be found in
`~odoo.fields.Many2one`{.interpreted-text role="class"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- a new `estate.property.type` model should be created with the
  corresponding menu, action and views.

![Property type](08_relations/property_type.png){.align-center}

- three Many2one fields should be added to the `estate.property` model:
  property type, buyer and seller.

![Property](08_relations/property_many2one.png){.align-center}
::::

In our real estate module, we want to define the concept of property
type. A property type is, for example, a house or an apartment. It is a
standard business need to categorize properties according to their type,
especially to refine filtering.

A property can have **one** type, but the same type can be assigned to
**many** properties. This is supported by the **many2one** concept.

A many2one is a simple link to another object. For example, in order to
define a link to the `res.partner` in our test model, we can write:

    partner_id = fields.Many2one("res.partner", string="Partner")

By convention, many2one fields have the `_id` suffix. Accessing the data
in the partner can then be easily done with:

    print(my_test_object.partner_id.name)

::: seealso
[foreign keys](https://www.postgresql.org/docs/12/tutorial-fk.html)
:::

In practice a many2one can be seen as a dropdown list in a form view.

::: exercise
Add the Real Estate Property Type table.

- Create the `estate.property.type` model and add the following field:

  Field   Type   Attributes
  ------- ------ ------------
  name    Char   required

- Add the menus as displayed in this section\'s **Goal**
- Add the field `property_type_id` into your `estate.property` model and
  its form, tree and search views

This exercise is a good recap of the previous chapters: you need to
create a
`model <tutorials/getting_started/04_basicmodel>`{.interpreted-text
role="ref"}, set the
`model <tutorials/getting_started/05_securityintro>`{.interpreted-text
role="ref"}, add an
`action and a menu <tutorials/getting_started/06_firstui>`{.interpreted-text
role="ref"}, and
`create a view <tutorials/getting_started/07_basicviews>`{.interpreted-text
role="ref"}.

Tip: do not forget to import any new Python files in `__init__.py`, add
new data files in `__manifest.py__` or add the access rights ;-)
:::

Once again, restart the server and refresh to see the results!

In the real estate module, there are still two missing pieces of
information we want on a property: the buyer and the salesperson. The
buyer can be any individual, but on the other hand the salesperson must
be an employee of the real estate agency (i.e. an Odoo user).

In Odoo, there are two models which we commonly refer to:

- `res.partner`: a partner is a physical or legal entity. It can be a
  company, an individual or even a contact address.
- `res.users`: the users of the system. Users can be \'internal\', i.e.
  they have access to the Odoo backend. Or they can be \'portal\', i.e.
  they cannot access the backend, only the frontend (e.g. to access
  their previous orders in eCommerce).

::: exercise
Add the buyer and the salesperson.

Add a buyer and a salesperson to the `estate.property` model using the
two common models mentioned above. They should be added in a new tab of
the form view, as depicted in this section\'s **Goal**.

The default value for the salesperson must be the current user. The
buyer should not be copied.

Tip: to get the default value, check the note below or look at an
example
[here](https://github.com/odoo/odoo/blob/5bb8b927524d062be32f92eb326ef64091301de1/addons/crm/models/crm_lead.py#L92).
:::

:::: note
::: title
Note
:::

The object `self.env` gives access to request parameters and other
useful things:

- `self.env.cr` or `self._cr` is the database *cursor* object; it is
  used for querying the database
- `self.env.uid` or `self._uid` is the current user\'s database id
- `self.env.user` is the current user\'s record
- `self.env.context` or `self._context` is the context dictionary
- `self.env.ref(xml_id)` returns the record corresponding to an XML id
- `self.env[model_name]` returns an instance of the given model
::::

Now let\'s have a look at other types of links.

## Many2many

**Reference**: the documentation related to this topic can be found in
`~odoo.fields.Many2many`{.interpreted-text role="class"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- a new `estate.property.tag` model should be created with the
  corresponding menu and action.

![Property tag](08_relations/property_tag.png){.align-center}

- tags should be added to the `estate.property` model:

![Property](08_relations/property_many2many.png){.align-center}
::::

In our real estate module, we want to define the concept of property
tags. A property tag is, for example, a property which is \'cozy\' or
\'renovated\'.

A property can have **many** tags and a tag can be assigned to **many**
properties. This is supported by the **many2many** concept.

A many2many is a bidirectional multiple relationship: any record on one
side can be related to any number of records on the other side. For
example, in order to define a link to the `account.tax` model on our
test model, we can write:

    tax_ids = fields.Many2many("account.tax", string="Taxes")

By convention, many2many fields have the `_ids` suffix. This means that
several taxes can be added to our test model. It behaves as a list of
records, meaning that accessing the data must be done in a loop:

    for tax in my_test_object.tax_ids:
        print(tax.name)

A list of records is known as a *recordset*, i.e. an ordered collection
of records. It supports standard Python operations on collections, such
as `len()` and `iter()`, plus extra set operations like `recs1 | recs2`.

::: exercise
Add the Real Estate Property Tag table.

- Create the `estate.property.tag` model and add the following field:

  Field   Type   Attributes
  ------- ------ ------------
  name    Char   required

- Add the menus as displayed in this section\'s **Goal**
- Add the field `tag_ids` to your `estate.property` model and in its
  form and tree views

Tip: in the view, use the `widget="many2many_tags"` attribute as
demonstrated
[here](https://github.com/odoo/odoo/blob/5bb8b927524d062be32f92eb326ef64091301de1/addons/crm_iap_lead_website/views/crm_reveal_views.xml#L36).
The `widget` attribute will be explained in detail in
`a later chapter of the training <tutorials/getting_started/12_sprinkles>`{.interpreted-text
role="ref"}. For now, you can try to adding and removing it and see the
result ;-)
:::

## One2many

**Reference**: the documentation related to this topic can be found in
`~odoo.fields.One2many`{.interpreted-text role="class"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- a new `estate.property.offer` model should be created with the
  corresponding form and tree view.
- offers should be added to the `estate.property` model:

![Property offers](08_relations/property_offer.png){.align-center}
::::

In our real estate module, we want to define the concept of property
offers. A property offer is an amount a potential buyer offers to the
seller. The offer can be lower or higher than the expected price.

An offer applies to **one** property, but the same property can have
**many** offers. The concept of **many2one** appears once again.
However, in this case we want to display the list of offers for a given
property so we will use the **one2many** concept.

A one2many is the inverse of a many2one. For example, we defined on our
test model a link to the `res.partner` model thanks to the field
`partner_id`. We can define the inverse relation, i.e. the list of test
models linked to our partner:

    test_ids = fields.One2many("test_model", "partner_id", string="Tests")

The first parameter is called the `comodel` and the second parameter is
the field we want to inverse.

By convention, one2many fields have the `_ids` suffix. They behave as a
list of records, meaning that accessing the data must be done in a loop:

    for test in partner.test_ids:
        print(test.name)

:::: danger
::: title
Danger
:::

Because a `~odoo.fields.One2many`{.interpreted-text role="class"} is a
virtual relationship, there *must* be a
`~odoo.fields.Many2one`{.interpreted-text role="class"} field defined in
the comodel.
::::

::: exercise
Add the Real Estate Property Offer table.

- Create the `estate.property.offer` model and add the following fields:

  Field         Type                           Attributes   Values
  ------------- ------------------------------ ------------ -------------------
  price         Float                                       
  status        Selection                      no copy      Accepted, Refused
  partner_id    Many2one (`res.partner`)       required     
  property_id   Many2one (`estate.property`)   required     

- Create a tree view and a form view with the `price`, `partner_id` and
  `status` fields. No need to create an action or a menu.
- Add the field `offer_ids` to your `estate.property` model and in its
  form view as depicted in this section\'s **Goal**.
:::

There are several important things to notice here. First, we don\'t need
an action or a menu for all models. Some models are intended to be
accessed only through another model. This is the case in our exercise:
an offer is always accessed through a property.

Second, despite the fact that the `property_id` field is required, we
did not include it in the views. How does Odoo know which property our
offer is linked to? Well that\'s part of the magic of using the Odoo
framework: sometimes things are defined implicitly. When we create a
record through a one2many field, the corresponding many2one is populated
automatically for convenience.

Still alive? This chapter is definitely not the easiest one. It
introduced a couple of new concepts while relying on everything that was
introduced before. The
`next chapter <tutorials/getting_started/09_compute_onchange>`{.interpreted-text
role="ref"} will be lighter, don\'t worry ;-)




--- SOURCE: developer/tutorials/getting_started/09_compute_onchange.md ---

# Chapter 9: Computed Fields And Onchanges {#tutorials/getting_started/09_compute_onchange}

The
`relations between models <tutorials/getting_started/08_relations>`{.interpreted-text
role="ref"} are a key component of any Odoo module. They are necessary
for the modelization of any business case. However, we may want links
between the fields within a given model. Sometimes the value of one
field is determined from the values of other fields and other times we
want to help the user with data entry.

These cases are supported by the concepts of computed fields and
onchanges. Although this chapter is not technically complex, the
semantics of both concepts is very important. This is also the first
time we will write Python logic. Until now we haven\'t written anything
other than class definitions and field declarations.

## Computed Fields

**Reference**: the documentation related to this topic can be found in
`reference/fields/compute`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- In the property model, the total area and the best offer should be
  computed:

![Compute fields](09_compute_onchange/compute.gif){.align-center}

- In the property offer model, the validity date should be computed and
  can be updated:

![Compute field with inverse](09_compute_onchange/compute_inverse.gif){.align-center}
::::

In our real estate module, we have defined the living area as well as
the garden area. It is then natural to define the total area as the sum
of both fields. We will use the concept of a computed field for this,
i.e. the value of a given field will be computed from the value of other
fields.

So far fields have been stored directly in and retrieved directly from
the database. Fields can also be *computed*. In this case, the field\'s
value is not retrieved from the database but computed on-the-fly by
calling a method of the model.

To create a computed field, create a field and set its attribute
`~odoo.fields.Field.compute`{.interpreted-text role="attr"} to the name
of a method. The computation method should set the value of the computed
field for every record in `self`.

By convention, `~odoo.fields.Field.compute`{.interpreted-text
role="attr"} methods are private, meaning that they cannot be called
from the presentation tier, only from the business tier (see
`tutorials/getting_started/01_architecture`{.interpreted-text
role="ref"}). Private methods have a name starting with an underscore
`_`.

### Dependencies

The value of a computed field usually depends on the values of other
fields in the computed record. The ORM expects the developer to specify
those dependencies on the compute method with the decorator
`~odoo.api.depends`{.interpreted-text role="func"}. The given
dependencies are used by the ORM to trigger the recomputation of the
field whenever some of its dependencies have been modified:

    from odoo import api, fields, models

    class TestComputed(models.Model):
        _name = "test.computed"

        total = fields.Float(compute="_compute_total")
        amount = fields.Float()

        @api.depends("amount")
        def _compute_total(self):
            for record in self:
                record.total = 2.0 * record.amount

:::: {.note .aphorism}
::: title
Note
:::

`self` is a collection.

The object `self` is a *recordset*, i.e. an ordered collection of
records. It supports the standard Python operations on collections, e.g.
`len(self)` and `iter(self)`, plus extra set operations such as
`recs1 | recs2`.

Iterating over `self` gives the records one by one, where each record is
itself a collection of size 1. You can access/assign fields on single
records by using the dot notation, e.g. `record.name`.
::::

Many examples of computed fields can be found in Odoo.
[Here](https://github.com/odoo/odoo/blob/713dd3777ca0ce9d121d5162a3d63de3237509f4/addons/account/models/account_move.py#L3420-L3423)
is a simple one.

::: exercise
Compute the total area.

- Add the `total_area` field to `estate.property`. It is defined as the
  sum of the `living_area` and the `garden_area`.
- Add the field in the form view as depicted on the first image of this
  section\'s **Goal**.
:::

For relational fields it\'s possible to use paths through a field as a
dependency:

    description = fields.Char(compute="_compute_description")
    partner_id = fields.Many2one("res.partner")

    @api.depends("partner_id.name")
    def _compute_description(self):
        for record in self:
            record.description = "Test for partner %s" % record.partner_id.name

The example is given with a `~odoo.fields.Many2one`{.interpreted-text
role="class"}, but it is valid for
`~odoo.fields.Many2many`{.interpreted-text role="class"} or a
`~odoo.fields.One2many`{.interpreted-text role="class"}. An example can
be found
[here](https://github.com/odoo/odoo/blob/713dd3777ca0ce9d121d5162a3d63de3237509f4/addons/account/models/account_reconcile_model.py#L248-L251).

Let\'s try it in our module with the following exercise!

::: exercise
Compute the best offer.

- Add the `best_price` field to `estate.property`. It is defined as the
  highest (i.e. maximum) of the offers\' `price`.
- Add the field to the form view as depicted in the first image of this
  section\'s **Goal**.

Tip: you might want to try using the
`~odoo.models.BaseModel.mapped`{.interpreted-text role="meth"} method.
See
[here](https://github.com/odoo/odoo/blob/f011c9aacf3a3010c436d4e4f408cd9ae265de1b/addons/account/models/account_payment.py#L686)
for a simple example.
:::

### Inverse Function

You might have noticed that computed fields are read-only by default.
This is expected since the user is not supposed to set a value.

In some cases, it might be useful to still be able to set a value
directly. In our real estate example, we can define a validity duration
for an offer and set a validity date. We would like to be able to set
either the duration or the date with one impacting the other.

To support this Odoo provides the ability to use an `inverse` function:

    from odoo import api, fields, models

    class TestComputed(models.Model):
        _name = "test.computed"

        total = fields.Float(compute="_compute_total", inverse="_inverse_total")
        amount = fields.Float()

        @api.depends("amount")
        def _compute_total(self):
            for record in self:
                record.total = 2.0 * record.amount

        def _inverse_total(self):
            for record in self:
                record.amount = record.total / 2.0

An example can be found
[here](https://github.com/odoo/odoo/blob/2ccf0bd0dcb2e232ee894f07f24fdc26c51835f7/addons/crm/models/crm_lead.py#L308-L317).

A compute method sets the field while an inverse method sets the
field\'s dependencies.

Note that the `inverse` method is called when saving the record, while
the `compute` method is called at each change of its dependencies.

::: exercise
Compute a validity date for offers.

- Add the following fields to the `estate.property.offer` model:

  Field           Type      Default
  --------------- --------- ---------
  validity        Integer   7
  date_deadline   Date      

Where `date_deadline` is a computed field which is defined as the sum of
two fields from the offer: the `create_date` and the `validity`. Define
an appropriate inverse function so that the user can set either the date
or the validity.

Tip: the `create_date` is only filled in when the record is created,
therefore you will need a fallback to prevent crashing at time of
creation.

- Add the fields in the form view and the list view as depicted on the
  second image of this section\'s **Goal**.
:::

### Additional Information

Computed fields are **not stored** in the database by default. Therefore
it is **not possible** to search on a computed field unless a `search`
method is defined. This topic is beyond the scope of this training, so
we won\'t cover it. An example can be found
[here](https://github.com/odoo/odoo/blob/f011c9aacf3a3010c436d4e4f408cd9ae265de1b/addons/event/models/event_event.py#L188).

Another solution is to store the field with the `store=True` attribute.
While this is usually convenient, pay attention to the potential
computation load added to your model. Lets re-use our example:

    description = fields.Char(compute="_compute_description", store=True)
    partner_id = fields.Many2one("res.partner")

    @api.depends("partner_id.name")
    def _compute_description(self):
        for record in self:
            record.description = "Test for partner %s" % record.partner_id.name

Every time the partner `name` is changed, the `description` is
automatically recomputed for **all the records** referring to it! This
can quickly become prohibitive to recompute when millions of records
need recomputation.

It is also worth noting that a computed field can depend on another
computed field. The ORM is smart enough to correctly recompute all the
dependencies in the right order\... but sometimes at the cost of
degraded performance.

In general performance must always be kept in mind when defining
computed fields. The more complex is your field to compute (e.g. with a
lot of dependencies or when a computed field depends on other computed
fields), the more time it will take to compute. Always take some time to
evaluate the cost of a computed field beforehand. Most of the time it is
only when your code reaches a production server that you realize it
slows down a whole process. Not cool :-(

## Onchanges

**Reference**: the documentation related to this topic can be found in
`~odoo.api.onchange`{.interpreted-text role="func"}:

:::: note
::: title
Note
:::

**Goal**: at the end of this section, enabling the garden will set a
default area of 10 and an orientation to North.

![Onchange](09_compute_onchange/onchange.gif){.align-center}
::::

In our real estate module, we also want to help the user with data
entry. When the \'garden\' field is set, we want to give a default value
for the garden area as well as the orientation. Additionally, when the
\'garden\' field is unset we want the garden area to reset to zero and
the orientation to be removed. In this case, the value of a given field
modifies the value of other fields.

The \'onchange\' mechanism provides a way for the client interface to
update a form without saving anything to the database whenever the user
has filled in a field value. To achieve this, we define a method where
`self` represents the record in the form view and decorate it with
`~odoo.api.onchange`{.interpreted-text role="func"} to specify which
field it is triggered by. Any change you make on `self` will be
reflected on the form:

    from odoo import api, fields, models

    class TestOnchange(models.Model):
        _name = "test.onchange"

        name = fields.Char(string="Name")
        description = fields.Char(string="Description")
        partner_id = fields.Many2one("res.partner", string="Partner")

        @api.onchange("partner_id")
        def _onchange_partner_id(self):
            self.name = "Document for %s" % (self.partner_id.name)
            self.description = "Default description for %s" % (self.partner_id.name)

In this example, changing the partner will also change the name and the
description values. It is up to the user whether or not to change the
name and description values afterwards. Also note that we do not loop on
`self`, this is because the method is only triggered in a form view,
where `self` is always a single record.

::: exercise
Set values for garden area and orientation.

Create an `onchange` in the `estate.property` model in order to set
values for the garden area (10) and orientation (North) when garden is
set to True. When unset, clear the fields.
:::

### Additional Information

Onchanges methods can also return a non-blocking warning message
([example](https://github.com/odoo/odoo/blob/cd9af815ba591935cda367d33a1d090f248dd18d/addons/payment_authorize/models/payment.py#L34-L36)).

## How to use them?

There is no strict rule for the use of computed fields and onchanges.

In many cases, both computed fields and onchanges may be used to achieve
the same result. Always prefer computed fields since they are also
triggered outside of the context of a form view. Never ever use an
onchange to add business logic to your model. This is a **very bad**
idea since onchanges are not automatically triggered when creating a
record programmatically; they are only triggered in the form view.

The usual pitfall of computed fields and onchanges is trying to be \'too
smart\' by adding too much logic. This can have the opposite result of
what was expected: the end user is confused from all the automation.

Computed fields tend to be easier to debug: such a field is set by a
given method, so it\'s easy to track when the value is set. Onchanges,
on the other hand, may be confusing: it is very difficult to know the
extent of an onchange. Since several onchange methods may set the same
fields, it easily becomes difficult to track where a value is coming
from.

When using stored computed fields, pay close attention to the
dependencies. When computed fields depend on other computed fields,
changing a value can trigger a large number of recomputations. This
leads to poor performance.

In the
`next chapter <tutorials/getting_started/10_actions>`{.interpreted-text
role="ref"}, we\'ll see how we can trigger some business logic when
buttons are clicked.




--- SOURCE: developer/tutorials/getting_started/10_actions.md ---

# Chapter 10: Ready For Some Action? {#tutorials/getting_started/10_actions}

So far we have mostly built our module by declaring fields and views. We
just introduced business logic in the
`previous chapter <tutorials/getting_started/09_compute_onchange>`{.interpreted-text
role="ref"} thanks to computed fields and onchanges. In any real
business scenario, we would want to link some business logic to action
buttons. In our real estate example, we would like to be able to:

- cancel or set a property as sold
- accept or refuse an offer

One could argue that we can already do these things by changing the
state manually, but this is not really convenient. Moreover, we want to
add some extra processing: when an offer is accepted we want to set the
selling price and the buyer for the property.

## Action Type

**Reference**: the documentation related to this topic can be found in
`reference/actions`{.interpreted-text role="ref"} and
`reference/exceptions`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- You should be able to cancel or set a property as sold:

![Cancel and set to sold](10_actions/property.gif){.align-center}

A canceled property cannot be sold and a sold property cannot be
canceled. For the sake of clarity, the `state` field has been added on
the view.

- You should be able to accept or refuse an offer:

![Accept or refuse an offer](10_actions/offer_01.gif){.align-center}

- Once an offer is accepted, the selling price and the buyer should be
  set:

![Accept an offer](10_actions/offer_02.gif){.align-center}
::::

In our real estate module, we want to link business logic with some
buttons. The most common way to do this is to:

- Add a button in the view, for example in the `header` of the view:

``` xml
<form>
    <header>
        <button name="action_do_something" type="object" string="Do Something"/>
    </header>
    <sheet>
        <field name="name"/>
    </sheet>
</form>
```

- and link this button to business logic:

``` python
from odoo import fields, models

class TestAction(models.Model):
    _name = "test.action"

    name = fields.Char()

    def action_do_something(self):
        for record in self:
            record.name = "Something"
        return True
```

By assigning `type="object"` to our button, the Odoo framework will
execute a Python method with `name="action_do_something"` on the given
model.

The first important detail to note is that our method name isn\'t
prefixed with an underscore (`_`). This makes our method a **public**
method, which can be called directly from the Odoo interface (through an
RPC call). Until now, all methods we created (compute, onchange) were
called internally, so we used **private** methods prefixed by an
underscore. You should always define your methods as private unless they
need to be called from the user interface.

Also note that we loop on `self`. Always assume that a method can be
called on multiple records; it\'s better for reusability.

Finally, a public method should always return something so that it can
be called through XML-RPC. When in doubt, just `return True`.

There are hundreds of examples in the Odoo source code. One example is
this [button in a
view](https://github.com/odoo/odoo/blob/cd9af815ba591935cda367d33a1d090f248dd18d/addons/crm/views/crm_lead_views.xml#L9-L11)
and its [corresponding Python
method](https://github.com/odoo/odoo/blob/cd9af815ba591935cda367d33a1d090f248dd18d/addons/crm/models/crm_lead.py#L746-L760)

::: exercise
Cancel and set a property as sold.

- Add the buttons \'Cancel\' and \'Sold\' to the `estate.property`
  model. A canceled property cannot be set as sold, and a sold property
  cannot be canceled.

  Refer to the first image of the **Goal** for the expected result.

  Tip: in order to raise an error, you can use the
  `UserError<reference/exceptions>`{.interpreted-text role="ref"}
  function. There are plenty of examples in the Odoo source code ;-)

- Add the buttons \'Accept\' and \'Refuse\' to the
  `estate.property.offer` model.

  Refer to the second image of the **Goal** for the expected result.

  Tip: to use an icon as a button, have a look [at this
  example](https://github.com/odoo/odoo/blob/cd9af815ba591935cda367d33a1d090f248dd18d/addons/event/views/event_views.xml#L521).

- When an offer is accepted, set the buyer and the selling price for the
  corresponding property.

  Refer to the third image of the **Goal** for the expected result.

  Pay attention: in real life only one offer can be accepted for a given
  property!
:::

## Object Type

In `tutorials/getting_started/06_firstui`{.interpreted-text role="ref"},
we created an action that was linked to a menu. You may be wondering if
it is possible to link an action to a button. Good news, it is! One way
to do it is:

``` xml
<button type="action" name="%(test.test_model_action)d" string="My Action"/>
```

We use `type="action"` and we refer to the
`external identifier`{.interpreted-text role="term"} in the `name`.

In the
`next chapter <tutorials/getting_started/11_constraints>`{.interpreted-text
role="ref"} we\'ll see how we can prevent encoding incorrect data in
Odoo.




--- SOURCE: developer/tutorials/getting_started/11_constraints.md ---

# Chapter 11: Constraints {#tutorials/getting_started/11_constraints}

The
`previous chapter <tutorials/getting_started/10_actions>`{.interpreted-text
role="ref"} introduced the ability to add some business logic to our
model. We can now link buttons to business code, but how can we prevent
users from entering incorrect data? For example, in our real estate
module nothing prevents users from setting a negative expected price.

Odoo provides two ways to set up automatically verified invariants:
`Python constraints <odoo.api.constrains>`{.interpreted-text
role="func"} and
`SQL constraints <odoo.models.Model._sql_constraints>`{.interpreted-text
role="attr"}.

## SQL

**Reference**: the documentation related to this topic can be found in
`reference/orm/models`{.interpreted-text role="ref"} and in the
[PostgreSQL\'s
documentation](https://www.postgresql.org/docs/12/ddl-constraints.html).

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- Amounts should be (strictly) positive

![Constraints on amounts](11_constraints/sql_01.gif){.align-center}

- Property types and tags should have a unique name

![Constraints on names](11_constraints/sql_02.gif){.align-center}
::::

SQL constraints are defined through the model attribute
`~odoo.models.Model._sql_constraints`{.interpreted-text role="attr"}.
This attribute is assigned a list of triples containing strings
`(name, sql_definition, message)`, where `name` is a valid SQL
constraint name, `sql_definition` is a
[table_constraint](https://www.postgresql.org/docs/12/ddl-constraints.html)
expression and `message` is the error message.

You can find a simple example
[here](https://github.com/odoo/odoo/blob/24b0b6f07f65b6151d1d06150e376320a44fd20a/addons/analytic/models/analytic_account.py#L20-L23).

::: exercise
Add SQL constraints.

Add the following constraints to their corresponding models:

- A property expected price must be strictly positive
- A property selling price must be positive
- An offer price must be strictly positive
- A property tag name and property type name must be unique

Tip: search for the `unique` keyword in the Odoo codebase for examples
of unique names.
:::

Restart the server with the `-u estate` option to see the result. Note
that you might have data that prevents a SQL constraint from being set.
An error message similar to the following might pop up:

``` text
ERROR rd-demo odoo.schema: Table 'estate_property_offer': unable to add constraint 'estate_property_offer_check_price' as CHECK(price > 0)
```

For example, if some offers have a price of zero, then the constraint
can\'t be applied. You can delete the problematic data in order to apply
the new constraints.

## Python

**Reference**: the documentation related to this topic can be found in
`~odoo.api.constrains`{.interpreted-text role="func"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, it will not be possible to accept
an offer lower than 90% of the expected price.

![Python constraint](11_constraints/python.gif){.align-center}
::::

SQL constraints are an efficient way of ensuring data consistency.
However it may be necessary to make more complex checks which require
Python code. In this case we need a Python constraint.

A Python constraint is defined as a method decorated with
`~odoo.api.constrains`{.interpreted-text role="func"} and is invoked on
a recordset. The decorator specifies which fields are involved in the
constraint. The constraint is automatically evaluated when any of these
fields are modified . The method is expected to raise an exception if
its invariant is not satisfied:

    from odoo.exceptions import ValidationError

    ...

    @api.constrains('date_end')
    def _check_date_end(self):
        for record in self:
            if record.date_end < fields.Date.today():
                raise ValidationError("The end date cannot be set in the past")
        # all records passed the test, don't return anything

A simple example can be found
[here](https://github.com/odoo/odoo/blob/274dd3bf503e1b612179db92e410b336bfaecfb4/addons/stock/models/stock_quant.py#L239-L244).

::::: exercise
Add Python constraints.

Add a constraint so that the selling price cannot be lower than 90% of
the expected price.

Tip: the selling price is zero until an offer is validated. You will
need to fine tune your check to take this into account.

:::: warning
::: title
Warning
:::

Always use the `~odoo.tools.float_utils.float_compare`{.interpreted-text
role="meth"} and
`~odoo.tools.float_utils.float_is_zero`{.interpreted-text role="meth"}
methods from [odoo.tools.float_utils]{.title-ref} when working with
floats!
::::

Ensure the constraint is triggered every time the selling price or the
expected price is changed!
:::::

SQL constraints are usually more efficient than Python constraints. When
performance matters, always prefer SQL over Python constraints.

Our real estate module is starting to look good. We added some business
logic, and now we make sure the data is consistent. However, the user
interface is still a bit rough. Let\'s see how we can improve it in the
`next chapter <tutorials/getting_started/12_sprinkles>`{.interpreted-text
role="ref"}.




--- SOURCE: developer/tutorials/getting_started/12_sprinkles.md ---

# Chapter 12: Add The Sprinkles {#tutorials/getting_started/12_sprinkles}

Our real estate module now makes sense from a business perspective. We
created
`specific views <tutorials/getting_started/07_basicviews>`{.interpreted-text
role="ref"}, added several
`action buttons <tutorials/getting_started/10_actions>`{.interpreted-text
role="ref"} and
`constraints <tutorials/getting_started/11_constraints>`{.interpreted-text
role="ref"}. However our user interface is still a bit rough. We would
like to add some colors to the list views and make some fields and
buttons conditionally disappear. For example, the \'Sold\' and
\'Cancel\' buttons should disappear when the property is sold or
canceled since it is no longer allowed to change the state at this
point.

This chapter covers a very small subset of what can be done in the
views. Do not hesitate to read the reference documentation for a more
complete overview.

**Reference**: the documentation related to this chapter can be found in
`reference/views`{.interpreted-text role="ref"}.

## Inline Views

:::: note
::: title
Note
:::

**Goal**: at the end of this section, a specific list of properties
should be added to the property type view:

![Inline list view](12_sprinkles/inline_view.png){.align-center}
::::

In the real estate module we added a list of offers for a property. We
simply added the field `offer_ids` with:

``` xml
<field name="offer_ids"/>
```

The field uses the specific view for `estate.property.offer`. In some
cases we want to define a specific list view which is only used in the
context of a form view. For example, we would like to display the list
of properties linked to a property type. However, we only want to
display 3 fields for clarity: name, expected price and state.

To do this, we can define *inline* list views. An inline list view is
defined directly inside a form view. For example:

``` python
from odoo import fields, models

class TestModel(models.Model):
    _name = "test_model"
    _description = "Test Model"

    description = fields.Char()
    line_ids = fields.One2many("test_model_line", "model_id")


class TestModelLine(models.Model):
    _name = "test_model_line"
    _description = "Test Model Line"

    model_id = fields.Many2one("test_model")
    field_1 = fields.Char()
    field_2 = fields.Char()
    field_3 = fields.Char()
```

``` xml
<form>
    <field name="description"/>
    <field name="line_ids">
        <tree>
            <field name="field_1"/>
            <field name="field_2"/>
        </tree>
    </field>
</form>
```

In the form view of the [test_model]{.title-ref}, we define a specific
list view for [test_model_line]{.title-ref} with fields `field_1` and
`field_2`.

An example can be found
[here](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/event/views/event_tag_views.xml#L27-L33).

::: exercise
Add an inline list view.

- Add the `One2many` field `property_ids` to the `estate.property.type`
  model.
- Add the field in the `estate.property.type` form view as depicted in
  the **Goal** of this section.
:::

## Widgets

**Reference**: the documentation related to this section can be found in
`reference/js/widgets`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the state of the property should
be displayed using a specific widget:

![Statusbar widget](12_sprinkles/widget.png){.align-center}

Four states are displayed: New, Offer Received, Offer Accepted and Sold.
::::

Whenever we\'ve added fields to our models, we\'ve (almost) never had to
worry about how these fields would look like in the user interface. For
example, a date picker is provided for a `Date` field and a `One2many`
field is automatically displayed as a list. Odoo chooses the right
\'widget\' depending on the field type.

However, in some cases, we want a specific representation of a field
which can be done thanks to the `widget` attribute. We already used it
for the `tag_ids` field when we used the `widget="many2many_tags"`
attribute. If we hadn\'t used it, then the field would have displayed as
a list.

Each field type has a set of widgets which can be used to fine tune its
display. Some widgets also take extra options. An exhaustive list can be
found in `reference/js/widgets`{.interpreted-text role="ref"}.

::: exercise
Use the status bar widget.

Use the `statusbar` widget in order to display the `state` of the
`estate.property` as depicted in the **Goal** of this section.

Tip: a simple example can be found
[here](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/account/views/account_bank_statement_views.xml#L136).
:::

:::: warning
::: title
Warning
:::

Same field multiple times in a view

Add a field only **once** to a list or a form view. Adding it multiple
times is not supported.
::::

## List Order

**Reference**: the documentation related to this section can be found in
`reference/orm/models`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, all lists should display by
default in a deterministic order. Property types can be ordered
manually.
::::

During the previous exercises, we created several list views. However,
at no point did we specify which order the records had to be listed in
by default. This is a very important thing for many business cases. For
example, in our real estate module we would want to display the highest
offers on top of the list.

### Model

Odoo provides several ways to set a default order. The most common way
is to define the `_order` attribute directly in the model. This way, the
retrieved records will follow a deterministic order which will be
consistent in all views including when records are searched
programmatically. By default there is no order specified, therefore the
records will be retrieved in a non-deterministic order depending on
PostgreSQL.

The `_order` attribute takes a string containing a list of fields which
will be used for sorting. It will be converted to an
[order_by](https://www.postgresql.org/docs/12/queries-order.html) clause
in SQL. For example:

``` python
from odoo import fields, models

class TestModel(models.Model):
    _name = "test_model"
    _description = "Test Model"
    _order = "id desc"

    description = fields.Char()
```

Our records are ordered by descending `id`, meaning the highest comes
first.

::: exercise
Add model ordering.

Define the following orders in their corresponding models:

  Model                     Order
  ------------------------- ------------------
  `estate.property`         Descending ID
  `estate.property.offer`   Descending Price
  `estate.property.tag`     Name
  `estate.property.type`    Name
:::

### View

Ordering is possible at the model level. This has the advantage of a
consistent order everywhere a list of records is retrieved. However, it
is also possible to define a specific order directly in a view thanks to
the `default_order` attribute
([example](https://github.com/odoo/odoo/blob/892dd6860733c46caf379fd36f57219082331b66/addons/crm/report/crm_activity_report_views.xml#L30)).

### Manual

Both model and view ordering allow flexibility when sorting records, but
there is still one case we need to cover: the manual ordering. A user
may want to sort records depending on the business logic. For example,
in our real estate module we would like to sort the property types
manually. It is indeed useful to have the most used types appear at the
top of the list. If our real estate agency mainly sells houses, it is
more convenient to have \'House\' appear before \'Apartment\'.

To do so, a `sequence` field is used in combination with the `handle`
widget. Obviously the `sequence` field must be the first field in the
`_order` attribute.

::: exercise
Add manual ordering.

- Add the following field:

  Model                    Field      Type
  ------------------------ ---------- ---------
  `estate.property.type`   Sequence   Integer

- Add the sequence to the `estate.property.type` list view with the
  correct widget.

Tip: you can find an example here:
[model](https://github.com/odoo/odoo/blob/892dd6860733c46caf379fd36f57219082331b66/addons/crm/models/crm_stage.py#L36)
and
[view](https://github.com/odoo/odoo/blob/892dd6860733c46caf379fd36f57219082331b66/addons/crm/views/crm_stage_views.xml#L23).
:::

## Attributes and options

It would be prohibitive to detail all the available features which allow
fine tuning of the look of a view. Therefore, we\'ll stick to the most
common ones.

### Form

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the property form view will have:

- Conditional display of buttons and fields
- Tag colors

![Form view with sprinkles](12_sprinkles/form.gif){.align-center}
::::

In our real estate module, we want to modify the behavior of some
fields. For example, we don\'t want to be able to create or edit a
property type from the form view. Instead we expect the types to be
handled in their appropriate menu. We also want to give tags a color. In
order to add these behavior customizations, we can add the `options`
attribute to several field widgets.

::: exercise
Add widget options.

- Add the appropriate option to the `property_type_id` field to prevent
  the creation and the editing of a property type from the property form
  view. Have a look at the
  `Many2one widget documentation <reference/js/widgets>`{.interpreted-text
  role="ref"} for more info.
- Add the following field:

  Model                   Field   Type
  ----------------------- ------- ---------
  `estate.property.tag`   Color   Integer

Then add the appropriate option to the `tag_ids` field to add a color
picker on the tags. Have a look at the
`FieldMany2ManyTags widget documentation <reference/js/widgets>`{.interpreted-text
role="ref"} for more info.
:::

In `tutorials/getting_started/06_firstui`{.interpreted-text role="ref"},
we saw that reserved fields were used for specific behaviors. For
example, the `active` field is used to automatically filter out inactive
records. We added the `state` as a reserved field as well. It\'s now
time to use it! A `state` field is used in combination with a `states`
attribute in the view to display buttons conditionally.

::: exercise
Add conditional display of buttons.

Use the `states` attribute to display the header buttons conditionally
as depicted in this section\'s **Goal** (notice how the \'Sold\' and
\'Cancel\' buttons change when the state is modified).

Tip: do not hesitate to search for `states=` in the Odoo XML files for
some examples.
:::

More generally, it is possible to make a field `invisible`, `readonly`
or `required` based on the value of other fields thanks to the `attrs`
attribute. Note that `invisible` can also be applied to other elements
of the view such as `button` or `group`.

The `attrs` is a dictionary with the property as a key and a domain as a
value. The domain gives the condition in which the property applies. For
example:

``` xml
<form>
    <field name="description" attrs="{'invisible': [('is_partner', '=', False)]}"/>
    <field name="is_partner" invisible="1"/>
</form>
```

This means that the `description` field is invisible when `is_partner`
is `False`. It is important to note that a field used in an `attrs`
**must** be present in the view. If it should not be displayed to the
user, we can use the `invisible` attribute to hide it.

::: exercise
Use `attrs`.

- Make the garden area and orientation invisible in the
  `estate.property` form view when there is no garden.
- Make the \'Accept\' and \'Refuse\' buttons invisible once the offer
  state is set.
- Do not allow adding an offer when the property state is \'Offer
  Accepted\', \'Sold\' or \'Canceled\'. To do this use the `readonly`
  `attrs`.
:::

:::: warning
::: title
Warning
:::

Using a (conditional) `readonly` attribute in the view can be useful to
prevent data entry errors, but keep in mind that it doesn\'t provide any
level of security! There is no check done server-side, therefore it\'s
always possible to write on the field through a RPC call.
::::

### List

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the property and offer list views
should have color decorations. Additionally, offers and tags will be
editable directly in the list, and the availability date will be hidden
by default.

![List view with decorations and optional field](12_sprinkles/decoration.png){.align-center}

![Editable list](12_sprinkles/editable_list.gif){.align-center}
::::

When the model only has a few fields, it can be useful to edit records
directly through the list view and not have to open the form view. In
the real estate example, there is no need to open a form view to add an
offer or create a new tag. This can be achieved thanks to the `editable`
attribute.

::: exercise
Make list views editable.

Make the `estate.property.offer` and `estate.property.tag` list views
editable.
:::

On the other hand, when a model has a lot of fields it can be tempting
to add too many fields in the list view and make it unclear. An
alternative method is to add the fields, but make them optionally
hidden. This can be achieved thanks to the `optional` attribute.

::: exercise
Make a field optional.

Make the field `date_availability` on the `estate.property` list view
optional and hidden by default.
:::

Finally, color codes are useful to visually emphasize records. For
example, in the real estate module we would like to display refused
offers in red and accepted offers in green. This can be achieved thanks
to the `decoration-{$name}` attribute (see
`reference/js/widgets`{.interpreted-text role="ref"} for a complete
list):

``` xml
<tree decoration-success="is_partner==True">
    <field name="name"/>
    <field name="is_partner" invisible="1"/>
</tree>
```

The records where `is_partner` is `True` will be displayed in green.

::: exercise
Add some decorations.

On the `estate.property` list view:

- Properties with an offer received are green
- Properties with an offer accepted are green and bold
- Properties sold are muted

On the `estate.property.offer` list view:

- Refused offers are red
- Accepted offers are green
- The state should not be visible anymore

Tips:

- Keep in mind that **all** fields used in attributes must be in the
  view!
- If you want to test the color of the \"Offer Received\" and \"Offer
  Accepted\" states, add the field in the form view and change it
  manually (we\'ll implement the business logic for this later).
:::

### Search

**Reference**: the documentation related to this section can be found in
`reference/views/search`{.interpreted-text role="ref"} and
`reference/views/search/defaults`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the available properties will be
filtered by default, and searching on the living area returns results
where the area is larger than the given number.

![Default filters and domains](12_sprinkles/search.gif){.align-center}
::::

Last but not least, there are some tweaks we would like to apply when
searching. First of all, we want to have our \'Available\' filter
applied by default when we access the properties. To make this happen,
we need to use the `search_default_{$name}` action context, where
`{$name}` is the filter name. This means that we can define which
filter(s) will be activated by default at the action level.

Here is an example of an
[action](https://github.com/odoo/odoo/blob/6decc32a889b46947db6dd4d42ef995935894a2a/addons/crm/report/crm_opportunity_report_views.xml#L115)
with its [corresponding
filter](https://github.com/odoo/odoo/blob/6decc32a889b46947db6dd4d42ef995935894a2a/addons/crm/report/crm_opportunity_report_views.xml#L68).

::: exercise
Add a default filter.

Make the \'Available\' filter selected by default in the
`estate.property` action.
:::

Another useful improvement in our module would be the ability to search
efficiently by living area. In practice, a user will want to search for
properties of \'at least\' the given area. It is unrealistic to expect
users would want to find a property of an exact living area. It is
always possible to make a custom search, but that\'s inconvenient.

Search view `<field>` elements can have a `filter_domain` that overrides
the domain generated for searching on the given field. In the given
domain, `self` represents the value entered by the user. In the example
below, it is used to search on both `name` and `description` fields.

``` xml
<search string="Test">
    <field name="description" string="Name and description"
           filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"/>
</search>
```

::: exercise
Change the living area search.

Add a `filter_domain` to the living area to include properties with an
area equal to or greater than the given value.
:::

## Stat Buttons

:::: note
::: title
Note
:::

**Goal**: at the end of this section, there will be a stat button on the
property type form view which shows the list of all offers related to
properties of the given type when it is clicked on.

![Stat button](12_sprinkles/stat_button.gif){.align-center}
::::

If you\'ve already used some functional modules in Odoo, you\'ve
probably already encountered a \'stat button\'. These buttons are
displayed on the top right of a form view and give a quick access to
linked documents. In our real estate module, we would like to have a
quick link to the offers related to a given property type as depicted in
the **Goal** of this section.

At this point of the tutorial we have already seen most of the concepts
to do this. However, there is not a single solution and it can still be
confusing if you don\'t know where to start from. We\'ll describe a
step-by-step solution in the exercise. It can always be useful to find
some examples in the Odoo codebase by looking for `oe_stat_button`.

The following exercise might be a bit more difficult than the previous
ones since it assumes you are able to search for examples in the source
code on your own. If you are stuck there is probably someone nearby who
can help you ;-)

The exercise introduces the concept of
`reference/fields/related`{.interpreted-text role="ref"}. The easiest
way to understand it is to consider it as a specific case of a computed
field. The following definition of the `description` field:

``` python
...

partner_id = fields.Many2one("res.partner", string="Partner")
description = fields.Char(related="partner_id.name")
```

is equivalent to:

``` python
...

partner_id = fields.Many2one("res.partner", string="Partner")
description = fields.Char(compute="_compute_description")

@api.depends("partner_id.name")
def _compute_description(self):
    for record in self:
        record.description = record.partner_id.name
```

Every time the partner name is changed, the description is modified.

::: exercise
Add a stat button to property type.

- Add the field `property_type_id` to `estate.property.offer`. We can
  define it as a related field on `property_id.property_type_id` and set
  it as stored.

Thanks to this field, an offer will be linked to a property type when
it\'s created. You can add the field to the list view of offers to make
sure it works.

- Add the field `offer_ids` to `estate.property.type` which is the
  One2many inverse of the field defined in the previous step.
- Add the field `offer_count` to `estate.property.type`. It is a
  computed field that counts the number of offers for a given property
  type (use `offer_ids` to do so).

At this point, you have all the information necessary to know how many
offers are linked to a property type. When in doubt, add `offer_ids` and
`offer_count` directly to the view. The next step is to display the list
when clicking on the stat button.

- Create a stat button on `estate.property.type` pointing to the
  `estate.property.offer` action. This means you should use the
  `type="action"` attribute (go back to the end of
  `tutorials/getting_started/10_actions`{.interpreted-text role="ref"}
  if you need a refresher).

At this point, clicking on the stat button should display all offers. We
still need to filter out the offers.

- On the `estate.property.offer` action, add a domain that defines
  `property_type_id` as equal to the `active_id` (= the current record,
  [here is an
  example](https://github.com/odoo/odoo/blob/df37ce50e847e3489eb43d1ef6fc1bac6d6af333/addons/event/views/event_views.xml#L162))
:::

Looking good? If not, don\'t worry, the `next chapter
<tutorials/getting_started/13_inheritance>`{.interpreted-text
role="ref"} doesn\'t require stat buttons ;-)




--- SOURCE: developer/tutorials/getting_started/13_inheritance.md ---

# Chapter 13: Inheritance {#tutorials/getting_started/13_inheritance}

A powerful aspect of Odoo is its modularity. A module is dedicated to a
business need, but modules can also interact with one another. This is
useful for extending the functionality of an existing module. For
example, in our real estate scenario we want to display the list of a
salesperson\'s properties directly in the regular user view.

But before going through the specific Odoo module inheritance, let\'s
see how we can alter the behavior of the standard CRUD (Create,
Retrieve, Update or Delete) methods.

## Python Inheritance

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- It should not be possible to delete a property which is not new or
  canceled.

![Unlink](13_inheritance/unlink.gif){.align-center}

- When an offer is created, the property state should change to \'Offer
  Received\'
- It should not be possible to create an offer with a lower price than
  an existing offer

![Create](13_inheritance/create.gif){.align-center}
::::

In our real estate module, we never had to develop anything specific to
be able to do the standard CRUD actions. The Odoo framework provides the
necessary tools to do them. In fact, such actions are already included
in our model thanks to classical Python inheritance:

    from odoo import fields, models

    class TestModel(models.Model):
        _name = "test_model"
        _description = "Test Model"

        ...

Our `class TestModel` inherits from
`~odoo.models.Model`{.interpreted-text role="class"} which provides
`~odoo.models.Model.create`{.interpreted-text role="meth"},
`~odoo.models.Model.read`{.interpreted-text role="meth"},
`~odoo.models.Model.write`{.interpreted-text role="meth"} and
`~odoo.models.Model.unlink`{.interpreted-text role="meth"}.

These methods (and any other method defined on
`~odoo.models.Model`{.interpreted-text role="class"}) can be extended to
add specific business logic:

    from odoo import fields, models

    class TestModel(models.Model):
        _name = "test_model"
        _description = "Test Model"

        ...

        @api.model
        def create(self, vals):
            # Do some business logic, modify vals...
            ...
            # Then call super to execute the parent method
            return super().create(vals)

The decorator `~odoo.api.model`{.interpreted-text role="func"} is
necessary for the `~odoo.models.Model.create`{.interpreted-text
role="meth"} method because the content of the recordset `self` is not
relevant in the context of creation, but it is not necessary for the
other CRUD methods.

It is also important to note that even though we can directly override
the `~odoo.models.Model.unlink`{.interpreted-text role="meth"} method,
you will almost always want to write a new method with the decorator
`~odoo.api.ondelete`{.interpreted-text role="func"} instead. Methods
marked with this decorator will be called during
`~odoo.models.Model.unlink`{.interpreted-text role="meth"} and avoids
some issues that can occur during uninstalling the model\'s module when
`~odoo.models.Model.unlink`{.interpreted-text role="meth"} is directly
overridden.

In Python 3, `super()` is equivalent to `super(TestModel, self)`. The
latter may be necessary when you need to call the parent method with a
modified recordset.

:::: danger
::: title
Danger
:::

- It is very important to **always** call `super()` to avoid breaking
  the flow. There are only a few very specific cases where you don\'t
  want to call it.
- Make sure to **always** return data consistent with the parent method.
  For example, if the parent method returns a `dict()`, your override
  must also return a `dict()`.
::::

::: exercise
Add business logic to the CRUD methods.

- Prevent deletion of a property if its state is not \'New\' or
  \'Canceled\'

Tip: create a new method with the `~odoo.api.ondelete`{.interpreted-text
role="func"} decorator and remember that `self` can be a recordset with
more than one record.

- At offer creation, set the property state to \'Offer Received\'. Also
  raise an error if the user tries to create an offer with a lower
  amount than an existing offer.

Tip: the `property_id` field is available in the `vals`, but it is an
`int`. To instantiate an `estate.property` object, use
`self.env[model_name].browse(value)`
([example](https://github.com/odoo/odoo/blob/136e4f66cd5cafe7df450514937c7218c7216c93/addons/gamification/models/badge.py#L57))
:::

## Model Inheritance

**Reference**: the documentation related to this topic can be found in
`reference/orm/inheritance`{.interpreted-text role="ref"}.

In our real estate module, we would like to display the list of
properties linked to a salesperson directly in the Settings / Users &
Companies / Users form view. To do this, we need to add a field to the
`res.users` model and adapt its view to show it.

Odoo provides two *inheritance* mechanisms to extend an existing model
in a modular way.

The first inheritance mechanism allows modules to modify the behavior of
a model defined in an another module by:

- adding fields to the model,
- overriding the definition of fields in the model,
- adding constraints to the model,
- adding methods to the model,
- overriding existing methods in the model.

The second inheritance mechanism (delegation) allows every record of a
model to be linked to a parent model\'s record and provides transparent
access to the fields of this parent record.

![Inheritance Methods](13_inheritance/inheritance_methods.png){.align-center}

In Odoo, the first mechanism is by far the most used. In our case, we
want to add a field to an existing model, which means we will use the
first mechanism. For example:

    from odoo import fields, models

    class InheritedModel(models.Model):
        _inherit = "inherited.model"

        new_field = fields.Char(string="New Field")

A practical example where two fields are added to a model can be found
[here](https://github.com/odoo/odoo/blob/60e9410e9aa3be4a9db50f6f7534ba31fea3bc29/addons/account_fleet/models/account_move.py#L39-L47).

By convention, each inherited model is defined in its own Python file.
In our example, it would be `models/inherited_model.py`.

::: exercise
Add a field to Users.

- Add the following field to `res.users`:

  Field          Type
  -------------- ------------------------------------------------------------------------------------
  property_ids   One2many inverse of the field that references the salesperson in `estate.property`

- Add a domain to the field so it only lists the available properties.
:::

In the next section let\'s add the field to the view and check that
everything is working well!

## View Inheritance

**Reference**: the documentation related to this topic can be found in
`reference/views/inheritance`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section, the list of available properties
linked to a salesperson should be displayed in their user form view

![Users](13_inheritance/users.png){.align-center}
::::

Instead of modifying existing views in place (by overwriting them), Odoo
provides view inheritance where children \'extension\' views are applied
on top of root views. These extension can both add and remove content
from their parent view.

An extension view references its parent using the `inherit_id` field.
Instead of a single view, its `arch` field contains a number of `xpath`
elements that select and alter the content of their parent view:

``` xml
<record id="inherited_model_view_form" model="ir.ui.view">
    <field name="name">inherited.model.form.inherit.test</field>
    <field name="model">inherited.model</field>
    <field name="inherit_id" ref="inherited.inherited_model_view_form"/>
    <field name="arch" type="xml">
        <!-- find field description and add the field
             new_field after it -->
        <xpath expr="//field[@name='description']" position="after">
          <field name="new_field"/>
        </xpath>
    </field>
</record>
```

`expr`

:   An [XPath](https://w3.org/TR/xpath) expression selecting a single
    element in the parent view. Raises an error if it matches no element
    or more than one

`position`

:   Operation to apply to the matched element:

    `inside`

    :   appends `xpath`\'s body to the end of the matched element

    `replace`

    :   replaces the matched element with the `xpath`\'s body, replacing
        any `$0` node occurrence in the new body with the original
        element

    `before`

    :   inserts the `xpath`\'s body as a sibling before the matched
        element

    `after`

    :   inserts the `xpaths`\'s body as a sibling after the matched
        element

    `attributes`

    :   alters the attributes of the matched element using the special
        `attribute` elements in the `xpath`\'s body

When matching a single element, the `position` attribute can be set
directly on the element to be found. Both inheritances below have the
same result.

``` xml
<xpath expr="//field[@name='description']" position="after">
    <field name="idea_ids" />
</xpath>

<field name="description" position="after">
    <field name="idea_ids" />
</field>
```

An example of a view inheritance extension can be found
[here](https://github.com/odoo/odoo/blob/691d1f087040f1ec7066e485d19ce3662dfc6501/addons/account_fleet/views/account_move_views.xml#L3-L17).

::: exercise
Add fields to the Users view.

Add the `property_ids` field to the `base.view_users_form` in a new
notebook page.

Tip: an example an inheritance of the users\' view can be found
[here](https://github.com/odoo/odoo/blob/691d1f087040f1ec7066e485d19ce3662dfc6501/addons/gamification/views/res_users_views.xml#L5-L14).
:::

Inheritance is extensively used in Odoo due to its modular concept. Do
not hesitate to read the corresponding documentation for more info!

In the
`next chapter <tutorials/getting_started/14_other_module>`{.interpreted-text
role="ref"}, we will learn how to interact with other modules.




--- SOURCE: developer/tutorials/getting_started/14_other_module.md ---

# Chapter 14: Interact With Other Modules {#tutorials/getting_started/14_other_module}

In the
`previous chapter <tutorials/getting_started/13_inheritance>`{.interpreted-text
role="ref"}, we used inheritance to modify the behavior of a module. In
our real estate scenario, we would like to go a step further and be able
to generate invoices for our customers. Odoo provides an Invoicing
module, so it would be neat to create an invoice directly from our real
estate module, i.e. once a property is set to \'Sold\', an invoice is
created in the Invoicing application.

## Concrete Example: Account Move

:::: note
::: title
Note
:::

**Goal**: at the end of this section:

- A new module `estate_account` should be created
- When a property is sold, an invoice should be issued for the buyer

![Invoice creation](14_other_module/create_inv.gif){.align-center}
::::

Any time we interact with another module, we need to keep in mind the
modularity. If we intend to sell our application to real estate
agencies, some may want the invoicing feature but others may not want
it.

### Link Module

The common approach for such use cases is to create a \'link\' module.
In our case, the module would depend on `estate` and `account` and would
include the invoice creation logic of the estate property. This way the
real estate and the accounting modules can be installed independently.
When both are installed, the link module provides the new feature.

::: exercise
Create a link module.

Create the `estate_account` module, which depends on the `estate` and
`account` modules. For now, it will be an empty shell.

Tip: you already did this at the
`beginning of the tutorial <tutorials/getting_started/03_newapp>`{.interpreted-text
role="ref"}. The process is very similar.
:::

When the `estate_account` module appears in the list, go ahead and
install it! You\'ll notice that the Invoicing application is installed
as well. This is expected since your module depends on it. If you
uninstall the Invoicing application, your module will be uninstalled as
well.

### Invoice Creation {#tutorials/getting_started/14_other_module/create}

It\'s now time to generate the invoice. We want to add functionality to
the `estate.property` model, i.e. we want to add some extra logic for
when a property is sold. Does that sound familiar? If not, it\'s a good
idea to go back to the
`previous chapter <tutorials/getting_started/13_inheritance>`{.interpreted-text
role="ref"} since you might have missed something ;-)

As a first step, we need to extend the action called when pressing the
`'Sold' button <tutorials/getting_started/10_actions>`{.interpreted-text
role="ref"} on a property. To do so, we need to create a
`model inheritance <tutorials/getting_started/13_inheritance>`{.interpreted-text
role="ref"} in the [estate_account]{.title-ref} module for the
`estate.property` model. For now, the overridden action will simply
return the `super` call. Maybe an example will make things clearer:

    from odoo import models

    class InheritedModel(models.Model):
        _inherit = "inherited.model"

        def inherited_action(self):
            return super().inherited_action()

A practical example can be found
[here](https://github.com/odoo/odoo/blob/f1f48cdaab3dd7847e8546ad9887f24a9e2ed4c1/addons/event_sale/models/account_move.py#L7-L16).

::: exercise
Add the first step of invoice creation.

- Create a `estate_property.py` file in the correct folder of the
  `estate_account` module.
- `_inherit` the `estate.property` model.
- Override the `action_sold` method (you might have named it
  differently) to return the `super` call.

Tip: to make sure it works, add a `print` or a debugger breakpoint in
the overridden method.
:::

Is it working? If not, maybe check that all Python files are correctly
imported.

If the override is working, we can move forward and create the invoice.
Unfortunately, there is no easy way to know how to create any given
object in Odoo. Most of the time, it is necessary to have a look at its
model to find the required fields and provide appropriate values.

A good way to learn is to look at how other modules already do what you
want to do. For example, one of the basic flows of Sales is the creation
of an invoice from a sales order. This looks like a good starting point
since it does exactly what we want to do. Take some time to read and
understand the
[\_create_invoices](https://github.com/odoo/odoo/blob/f1f48cdaab3dd7847e8546ad9887f24a9e2ed4c1/addons/sale/models/sale.py#L610-L717)
method. When you are done crying because this simple task looks awfully
complex, we can move forward in the tutorial.

To create an invoice, we need the following information:

- a `partner_id`: the customer
- a `move_type`: it has several [possible
  values](https://github.com/odoo/odoo/blob/f1f48cdaab3dd7847e8546ad9887f24a9e2ed4c1/addons/account/models/account_move.py#L138-L147)
- a `journal_id`: the accounting journal

This is enough to create an empty invoice.

::: exercise
Add the second step of invoice creation.

Create an empty `account.move` in the override of the `action_sold`
method:

- the `partner_id` is taken from the current `estate.property`
- the `move_type` should correspond to a \'Customer Invoice\'

Tips:

- to create an object, use `self.env[model_name].create(values)`, where
  `values` is a `dict`.
- the `create` method doesn\'t accept recordsets as field values.
:::

When a property is set to \'Sold\', you should now have a new customer
invoice created in Invoicing / Customers / Invoices.

Obviously we don\'t have any invoice lines so far. To create an invoice
line, we need the following information:

- `name`: a description of the line
- `quantity`
- `price_unit`

Moreover, an invoice line needs to be linked to an invoice. The easiest
and most efficient way to link a line to an invoice is to include all
lines at invoice creation. To do this, the `invoice_line_ids` field is
included in the `account.move` creation, which is a
`~odoo.fields.One2many`{.interpreted-text role="class"}. One2many and
Many2many use special \'commands\' which have been made human readable
with the `~odoo.fields.Command`{.interpreted-text role="class"}
namespace. This namespace represents a triplet command to execute on a
set of records. The triplet was originally the only option to do these
commands, but it is now standard to use the namespace instead. The
format is to place them in a list which is executed sequentially. Here
is a simple example to include a One2many field `line_ids` at creation
of a `test_model`:

    from odoo import Command

    def inherited_action(self):
        self.env["test_model"].create(
            {
                "name": "Test",
                "line_ids": [
                    Command.create({
                        "field_1": "value_1",
                        "field_2": "value_2",
                    })
                ],
            }
        )
        return super().inherited_action()

::: exercise
Add the third step of invoice creation.

Add two invoice lines during the creation of the `account.move`. Each
property sold will be invoiced following these conditions:

- 6% of the selling price
- an additional 100.00 from administrative fees

Tip: Add the `invoice_line_ids` at creation following the example above.
For each line, we need a `name`, `quantity` and `price_unit`.
:::

This chapter might be one of the most difficult that has been covered so
far, but it is the closest to what Odoo development will be in practice.
In the `next chapter
<tutorials/getting_started/15_qwebintro>`{.interpreted-text role="ref"},
we will introduce the templating mechanism used in Odoo.




--- SOURCE: developer/tutorials/getting_started/15_qwebintro.md ---

# Chapter 15: A Brief History Of QWeb {#tutorials/getting_started/15_qwebintro}

So far the interface design of our real estate module has been rather
limited. Building a list view is straightforward since only the list of
fields is necessary. The same holds true for the form view: despite the
use of a few tags such as `<group>` or `<page>`, there is very little to
do in terms of design.

However, if we want to give a unique look to our application, it is
necessary to go a step further and be able to design new views.
Moreover, other features such as PDF reports or website pages need
another tool to be created with more flexibility: a
[templating](https://en.wikipedia.org/wiki/Template_processor) engine.

You might already be familiar with existing engines such as Jinja
(Python), ERB (Ruby) or Twig (PHP). Odoo comes with its own built-in
engine: `reference/qweb`{.interpreted-text role="ref"}. QWeb is the
primary templating engine used by Odoo. It is an XML templating engine
and used mostly to generate HTML fragments and pages.

You probably already have come across the [kanban
board](https://en.wikipedia.org/wiki/Kanban_board) in Odoo where the
records are displayed in a card-like structure. We will build such a
view for our real estate module.

## Concrete Example: A Kanban View

**Reference**: the documentation related to this topic can be found in
`reference/views/kanban`{.interpreted-text role="ref"}.

:::: note
::: title
Note
:::

**Goal**: at the end of this section a Kanban view of the properties
should be created:

![Kanban view](15_qwebintro/kanban.png){.align-center}
::::

In our estate application, we would like to add a Kanban view to display
our properties. Kanban views are a standard Odoo view (like the form and
list views), but their structure is much more flexible. In fact, the
structure of each card is a mix of form elements (including basic HTML)
and QWeb. The definition of a Kanban view is similar to the definition
of the list and form views, except that their root element is
`<kanban>`. In its simplest form, a Kanban view looks like:

``` xml
<kanban>
    <templates>
        <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
                <field name="name"/>
            </div>
        </t>
    </templates>
</kanban>
```

Let\'s break down this example:

- `<templates>`: defines a list of `reference/qweb`{.interpreted-text
  role="ref"} templates. Kanban views *must* define at least one root
  template `kanban-box`, which will be rendered once for each record.
- `<t t-name="kanban-box">`: `<t>` is a placeholder element for QWeb
  directives. In this case, it is used to set the `name` of the template
  to `kanban-box`
- `<div class="oe_kanban_global_click">`: the `oe_kanban_global_click`
  makes the `<div>` clickable to open the record.
- `<field name="name"/>`: this will add the `name` field to the view.

::: exercise
Make a minimal kanban view.

Using the simple example provided, create a minimal Kanban view for the
properties. The only field to display is the `name`.

Tip: you must add `kanban` in the `view_mode` of the corresponding
`ir.actions.act_window`.
:::

Once the Kanban view is working, we can start improving it. If we want
to display an element conditionally, we can use the `t-if` directive
(see `reference/qweb/conditionals`{.interpreted-text role="ref"}).

``` xml
<kanban>
    <field name="state"/>
    <templates>
        <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
                <field name="name"/>
                <div t-if="record.state.raw_value == 'new'">
                    This is new!
                </div>
            </div>
        </t>
    </templates>
</kanban>
```

We added a few things:

- `t-if`: the `<div>` element is rendered if the condition is true.
- `record`: an object with all the requested fields as its attributes.
  Each field has two attributes `value` and `raw_value`. The former is
  formatted according to current user parameters and the latter is the
  direct value from a `~odoo.models.Model.read`{.interpreted-text
  role="meth"}.

In the above example, the field `name` was added in the `<templates>`
element, but `state` is outside of it. When we need the value of a field
but don\'t want to display it in the view, it is possible to add it
outside of the `<templates>` element.

::: exercise
Improve the Kanban view.

Add the following fields to the Kanban view: expected price, best price,
selling price and tags. Pay attention: the best price is only displayed
when an offer is received, while the selling price is only displayed
when an offer is accepted.

Refer to the **Goal** of the section for a visual example.
:::

Let\'s give the final touch to our view: the properties must be grouped
by type by default. You might want to have a look at the various options
described in `reference/views/kanban`{.interpreted-text role="ref"}.

::: exercise
Add default grouping.

Use the appropriate attribute to group the properties by type by
default. You must also prevent drag and drop.

Refer to the **Goal** of the section for a visual example.
:::

Kanban views are a typical example of how it is always a good idea to
start from an existing view and fine tune it instead of starting from
scratch. There are many options and classes available, so\... read and
learn!




--- SOURCE: developer/tutorials/getting_started/16_final_word.md ---

# Chapter 16: The final word {#tutorials/getting_started/16_final_word}

## Coding guidelines

We will start refactoring the code to match to the Odoo coding
guidelines. The guidelines aim to improve the quality of the Odoo Apps
code.

**Reference**: you will find the Odoo coding guidelines in
`/contributing/development/coding_guidelines`{.interpreted-text
role="doc"}.

::: exercise
Polish your code.

Refactor your code to respect the coding guidelines. Don\'t forget to
run your linter and respect the module structure, the variable names,
the method name convention, the model attribute order and the xml ids.
:::

## Test on the runbot

Odoo has its own `CI (Continuous integration)`{.interpreted-text
role="abbr"} server named [runbot](https://runbot.odoo.com/). All
commits, branches and PR will be tested to avoid regressions or breaking
of the stable versions. All the runs that pass the tests are deployed on
their own server with demo data.

::: exercise
Play with the runbot.

Feel free to go to the runbot website and open the last stable version
of Odoo to check out all the available applications and functionalities.
:::




--- SOURCE: developer/tutorials/getting_started.md ---

show-content

:   

# Getting started {#tutorials/getting_started}

::: {.toctree titlesonly="" glob=""}
getting_started/\*
:::

Welcome to the Getting Started Odoo tutorial! If you reached this page
that means you are interested in the development of your own Odoo
module. It might also mean that you recently joined the Odoo company for
a rather technical position. In any case, your journey to the technical
side of Odoo starts here.

The goal of this tutorial is for you to get an insight of the most
important parts of the Odoo development framework while developing your
own Odoo module to manage real estate assets. The chapters should be
followed in their given order since they cover the development of a new
Odoo application from scratch in an incremental way. In other words,
each chapter depends on the previous one.

:::: attention
::: title
Attention
:::

Are you following this tutorial as part of your technical onboarding as
an Odoo employee? Then, we ask you to complete all the chapters before
joining your new team.
::::

Ready? Let\'s get started!

- `getting_started/01_architecture`{.interpreted-text role="doc"}
- `getting_started/02_setup`{.interpreted-text role="doc"}
- `getting_started/03_newapp`{.interpreted-text role="doc"}
- `getting_started/04_basicmodel`{.interpreted-text role="doc"}
- `getting_started/05_securityintro`{.interpreted-text role="doc"}
- `getting_started/06_firstui`{.interpreted-text role="doc"}
- `getting_started/07_basicviews`{.interpreted-text role="doc"}
- `getting_started/08_relations`{.interpreted-text role="doc"}
- `getting_started/09_compute_onchange`{.interpreted-text role="doc"}
- `getting_started/10_actions`{.interpreted-text role="doc"}
- `getting_started/11_constraints`{.interpreted-text role="doc"}
- `getting_started/12_sprinkles`{.interpreted-text role="doc"}
- `getting_started/13_inheritance`{.interpreted-text role="doc"}
- `getting_started/14_other_module`{.interpreted-text role="doc"}
- `getting_started/15_qwebintro`{.interpreted-text role="doc"}
- `getting_started/16_final_word`{.interpreted-text role="doc"}




--- SOURCE: developer/tutorials/master_odoo_web_framework/01_fields_and_views.md ---

# Chapter 1: Fields and Views

In the previous chapter, we learned a range of skills, including how to
create and use services, work with the Layout component, make the
dashboard translatable, and lazy load a JavaScript library like
Chart.js. Now, let\'s learn how to create new fields and views.

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/awesome_tshirt).
It is recommended not to look at them before trying the exercises.
:::

Fields and views are among the most important concepts in the Odoo user
interface. They are key to many important user interactions, and should
therefore work perfectly. In the context of the JavaScript framework,
fields are components specialized for visualizing/editing a specific
field for a given record. For example, a (Python) model may define a
char field, which will be represented by a field component
[CharField]{.title-ref}.

A field component is basically just a component registered in the
[fields]{.title-ref} `registry
<frontend/registries>`{.interpreted-text role="ref"}. The field
component may define some additional static keys (metadata), such as
[displayName]{.title-ref} or [supportedTypes]{.title-ref}, and the most
important one: [extractProps]{.title-ref}, which prepare the base props
received by the [CharField]{.title-ref}.

## Example: a simple field

Let us discuss a simplified implementation of a [CharField]{.title-ref}.
First, here is the template:

``` xml
<t t-name="web.CharField" owl="1">
    <t t-if="props.readonly">
        <span t-esc="formattedValue" />
    </t>
    <t t-else="">
        <input
            class="o_input"
            t-att-type="props.isPassword ? 'password' : 'text'"
            t-att-placeholder="props.placeholder"
            t-on-change="updateValue"
        />
    </t>
</t>
```

It features a readonly mode and an edit mode, which is an input with a
few attributes. Now, here is the JavaScript code:

``` js
export class CharField extends Component {
    get formattedValue() {
        return formatChar(this.props.value, { isPassword: this.props.isPassword });
    }

    updateValue(ev) {
        let value = ev.target.value;
        if (this.props.shouldTrim) {
            value = value.trim();
        }
        this.props.update(value);
    }
}

CharField.template = "web.CharField";
CharField.displayName = _lt("Text");
CharField.supportedTypes = ["char"];

CharField.extractProps = ({ attrs, field }) => {
    return {
        shouldTrim: field.trim && !archParseBoolean(attrs.password),
        maxLength: field.size,
        isPassword: archParseBoolean(attrs.password),
        placeholder: attrs.placeholder,
    };
};

registry.category("fields").add("char", CharField);
```

There are a few important things to notice:

- The [CharField]{.title-ref} receives its (raw) value in props. It
  needs to format it before displaying it.
- It receives an [update]{.title-ref} function in its props, which is
  used by the field to notify the owner of the state that the value of
  this field has been changed. Note that the field does not (and should
  not) maintain a local state with its value. Whenever the change has
  been applied, it will come back (possibly after an onchange) by the
  way of the props.
- It defines an [extractProps]{.title-ref} function. This is a step that
  translates generic standard props, specific to a view, to specialized
  props, useful to the component. This allows the component to have a
  better API, and may make it so that it is reusable.

Fields have to be registered in the [fields]{.title-ref} registry. Once
it\'s done, they can be used in some views (namely: [form]{.title-ref},
[list]{.title-ref}, [kanban]{.title-ref}) by using the
[widget]{.title-ref} attribute.

::: example
``` xml
<field name="preview_moves" widget="account_resequence_widget"/>
```
:::

## 1. An [image_preview]{.title-ref} field {#tutorials/master_odoo_web_framework/image_preview_field}

Each new order on the website will be created as an
[awesome_tshirt.order]{.title-ref}. This model has a
[image_url]{.title-ref} field (of type [char]{.title-ref}), which is
currently only visible as a string. We want to be able to see the image
itself in the form view.

::: exercise
1.  Create a new [ImagePreview]{.title-ref} component and register it in
    the proper `registry
    <frontend/registries>`{.interpreted-text role="ref"}. Use the
    [CharField]{.title-ref} component in your template. You can use
    [t-props]({OWL_PATH}/doc/reference/props.md#dynamic-props) to pass
    props received by [ImagePreview]{.title-ref} to
    [CharField]{.title-ref}. Update the arch of the form view to use
    your new field by setting the [widget]{.title-ref} attribute.
2.  Change the code of the [ImagePreview]{.title-ref} component so that
    the image is displayed below the URL.
3.  When the field is readonly, only the image should be displayed and
    the URL should be hidden.
:::

:::: note
::: title
Note
:::

It is possible to solve this exercise by inheriting
[CharField]{.title-ref}, but the goal of this exercise is to create a
field from scratch.
::::

![image](01_fields_and_views/image_field.png){.align-center}

::: seealso
[Code:
CharField]({GITHUB_PATH}/addons/web/static/src/views/fields/char/char_field.js)
:::

## 2. Improving the [image_preview]{.title-ref} field

We want to improve the field of the previous task to help the staff
recognize orders for which some action should be done.

::: exercise
Display a warning \"MISSING TSHIRT DESIGN\" in red if there is no image
URL specified on the order.
:::

![image](01_fields_and_views/missing_image.png){.align-center}

## 3. Customizing a field component

Let\'s see how to use inheritance to extend an existing component.

There is a [is_late]{.title-ref}, readonly, boolean field on the order
model. That would be useful information to see on the list/kanban/view.
Then, let us say that we want to add a red word \"Late!\" next to it
whenever it is set to [true]{.title-ref}.

::: exercise
1.  Create a new [LateOrderBoolean]{.title-ref} field inheriting from
    [BooleanField]{.title-ref}. The template of
    [LateOrderBoolean]{.title-ref} can also
    `inherit <reference/qweb/template_inheritance>`{.interpreted-text
    role="ref"} from the [BooleanField]{.title-ref} template.
2.  Use it in the list/kanban/form view.
3.  Modify it to add a red [Late]{.title-ref} next to it, as requested.
:::

![image](01_fields_and_views/late_field.png){.align-center}

::: seealso
\- [Example: A field inheriting
another]({GITHUB_PATH}/addons/account/static/src/components/account_type_selection) -
`Documentation on xpath <reference/views/inheritance>`{.interpreted-text
role="ref"}
:::

## 4. Message for some customers

Odoo form views support a [widget]{.title-ref} API, which is like a
field, but more generic. It is useful to insert arbitrary components in
the form view. Let us see how we can use it.

::::: exercise
For a super efficient workflow, we would like to display an alert block
with specific messages depending on some conditions:

- If the [image_url]{.title-ref} field is not set, it should display
  \"No image\".
- If the [amount]{.title-ref} of the order is higher than 100 euros, it
  should display \"Add promotional material\".
- Make sure that your widget is updated in real time.

:::: tip
::: title
Tip
:::

Try to evaluate [props.record]{.title-ref} in the
`Console`{.interpreted-text role="guilabel"} tab of your browser\'s dev
tools.
::::
:::::

![image](01_fields_and_views/warning_widget.png){.align-center}

::: seealso
- [Example: Using the tag \<widget\> in a form view
  \<https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/
  addons/calendar/views/calendar_views.xml#L197\>]()
- [Example: Implementation of a
  widget]({GITHUB_PATH}/addons/web/static/src/views/widgets/week_days)
:::

## 5. Use [markup]{.title-ref}

Let's see how we can display raw HTML in a template. The
[t-out]{.title-ref} directive can be used for that propose. Indeed, [it
generally acts like t-esc, unless the data has been marked explicitly
with a markup
function]({OWL_PATH}/doc/reference/templates.md#outputting-data). In
that case, its value is injected as HTML.

::: exercise
1.  Modify the previous exercise to put the [image]{.title-ref} and
    [material]{.title-ref} words in bold.
2.  The warnings should be markuped, and the template should be modified
    to use [t-out]{.title-ref}.
3.  Import the [markup]{.title-ref} function from Owl and, for each
    message, replace it with a call of the function with the message
    passed as argument.
:::

:::: note
::: title
Note
:::

This is an example of a safe use of [t-out]{.title-ref}, since the
string is static.
::::

![image](01_fields_and_views/warning_widget2.png){.align-center}

## 6. Add buttons in the control panel

Views are among the most important components in Odoo: they allow users
to interact with their data. Let us discuss how Odoo views are designed.

The power of Odoo views is that they declare how a particular screen
should work with an XML document (usually named [arch]{.title-ref},
short for architecture). This description can be extended/modified by
xpaths serverside. Then, the browser loads that document, parses it
(fancy word to say that it extracts the useful information), and then
represents the data accordingly.

::: example
The [arch]{.title-ref} document is view specific. Here is how a
[graph]{.title-ref} view or a [calendar]{.title-ref} view could be
defined:

``` xml
<graph string="Invoices Analysis" type="line" sample="1">
    <field name="product_categ_id"/>
    <field name="price_subtotal" type="measure"/>
</graph>

<calendar string="Leads Generation" create="0" mode="month" date_start="activity_date_deadline" color="user_id" hide_time="true" event_limit="5">
    <field name="expected_revenue"/>
    <field name="partner_id" avatar_field="avatar_128"/>
    <field name="user_id" filters="1" invisible="1"/>
</calendar>
```
:::

A view is defined in the view registry by an object with a few specific
keys.

- \`type\`: The (base) type of a view (for example, [form]{.title-ref},
  [list]{.title-ref}\...).
- \`display_name\`: What should be displayed in the tooltip in the view
  switcher.
- \`icon\`: Which icon to use in the view switcher.
- \`multiRecord\`: Whether the view is supposed to manage a single
  record or a set of records.
- \`Controller\`: The component that will be used to render the view
  (the most important information).

::: example
Here is a minimal [Hello]{.title-ref} view, which does not display
anything:

``` js
/** @odoo-module */

import { registry } from "@web/core/registry";

export const helloView = {
   type: "hello",
   display_name: "Hello",
   icon: "fa fa-picture-o",
   multiRecord: true,
   Controller: Component,
};

registry.category("views").add("hello", helloView);
```
:::

Most (or all?) Odoo views share a common architecture:

![image](01_fields_and_views/view_architecture.svg){.o-no-modal
.o-no-modalalign-center width="75.0%"}

The view description can define a [props]{.title-ref} function, which
receives the standard props, and computes the base props of the concrete
view. The [props]{.title-ref} function is executed only once, and can be
thought of as being some kind of factory. It is useful to parse the
[arch]{.title-ref} XML document, and to allow the view to be
parameterized (for example, it can return a Renderer component that will
be used as Renderer). Then, it is easy to customize the specific
renderer used by a sub view.

The props will be extended before being given to the Controller. In
particular, the search props (domain/context/groupby) will be added.

Finally, the root component, commonly called the
[Controller]{.title-ref}, coordinates everything. It uses the generic
[Layout]{.title-ref} component (to add a control panel), instantiates a
[Model]{.title-ref}, and uses a [Renderer]{.title-ref} component in the
[Layout]{.title-ref} default slot. The [Model]{.title-ref} is tasked
with loading and updating data, and the [Renderer]{.title-ref} is
supposed to handle all rendering work, along with all user interactions.

In practice, once the t-shirt order is printed, we need to print a label
to put on the package. To do that, let us add a button in the order\'s
form view\'s control panel, which will call a model method.

There is a service dedicated to calling models methods:
[orm_service]{.title-ref}, located in [core/orm_service.js]{.title-ref}.
It provides a way to call common model methods, as well as a generic
[call(model, method, args, kwargs)]{.title-ref} method.

::: example
``` js
setup() {
    this.orm = useService("orm");
    onWillStart(async () => {
        // will read the fields 'id' and 'descr' from the record with id=3 of my.model
        const data = await this.orm.read("my.model", [3], ["id", "descr"]);
        // ...
    });
}
```
:::

::: exercise
1.  Create a customized form view extending the [web]{.title-ref} form
    view and register it as
    [awesome_tshirt.order_form_view]{.title-ref}.

2.  Add a [js_class=\"awesome_tshirt.order_form_view\"]{.title-ref}
    attribute to the arch of the form view so that Odoo will load it.

3.  Create a new template inheriting from the form controller template
    and add a \"Print Label\" button after the \"New\" button.

4.  Clicking on this button should call the method
    [print_label]{.title-ref} from the model
    [awesome_tshirt.order]{.title-ref} with the proper id.

    :::: note
    ::: title
    Note
    :::

    [print_label]{.title-ref} is a mock method; it only displays a
    message in the logs.
    ::::

5.  The button should not be disabled if the current order is in
    [create]{.title-ref} mode (i.e., it does not exist yet).

    :::: tip
    ::: title
    Tip
    :::

    Log [this.props.resId]{.title-ref} and
    [this.model.root.resId]{.title-ref} and compare the two values
    before and after entering [create]{.title-ref} mode.
    ::::

6.  The button should be displayed as a primary button if the customer
    is properly set and if the task stage is [printed]{.title-ref}.
    Otherwise, it should be displayed as a secondary button.

7.  Bonus point: clicking twice on the button should not trigger 2 RPCs.

![image](01_fields_and_views/form_button.png){.align-center}
:::

::: seealso
\- [Example: Extending a view
(JS)]({GITHUB_PATH}/addons/mass_mailing/static/src/views/mailing_contact_view_kanban.js) -
[Example: Extending a view
(XML)]({GITHUB_PATH}/addons/mass_mailing/static/src/views/mass_mailing_views.xml) -
[Example: Using a js_class
attribute](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/mass_mailing/views/mailing_contact_views.xml#L44) -
[Code: orm
service]({GITHUB_PATH}/addons/web/static/src/core/orm_service.js) -
[Example: Using the orm
service]({GITHUB_PATH}/addons/account/static/src/components/open_move_widget/open_move_widget.js) -
[Code: useDebounced
hook](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/utils/timing.js#L117)
:::

## 7. Auto-reload the kanban view

Bafien is upset: he wants to see the kanban view of the tshirt orders on
his external monitor, but the view needs to be up-to-date. He is tired
of clicking on the `refresh`{.interpreted-text role="guilabel"} icon
every 30s, so he tasked you to find a way to do it automatically.

Just like the previous exercise, that kind of customization requires
creating a new JavaScript view.

::: exercise
1.  Extend the kanban view/controller to reload its data every minute.
2.  Register it in the view registry, under
    [awesome_tshirt.autoreloadkanban]{.title-ref}.
3.  Use it in the arch of the kanban view (with the
    [js_class]{.title-ref} attribute).
:::

:::: important
::: title
Important
:::

If you use [setInterval]{.title-ref} or something similar, make sure
that it is properly canceled when your component is unmounted.
Otherwise, you will introduce a memory leak.
::::




--- SOURCE: developer/tutorials/master_odoo_web_framework/02_miscellaneous.md ---

# Chapter 2: Miscellaneous

In the previous task, we learned how to create fields and views. There
is still much more to discover in the feature-rich Odoo web framework,
so let\'s dive in and explore more in this chapter!

<figure class="align-center">
<img src="02_miscellaneous/previously_learned.svg" style="width:70.0%"
alt="This is the progress that we have made in discovering the JavaScript web framework at the end of 01_fields_and_views." />
<figcaption aria-hidden="true">This is the progress that we have made in
discovering the JavaScript web framework at the end of <code
class="interpreted-text"
role="doc">01_fields_and_views</code>.</figcaption>
</figure>

::: admonition
Goal

![image](02_miscellaneous/kitten_mode.png){.align-center}
:::

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/awesome_tshirt).
:::

## 1. Interacting with the notification system

:::: note
::: title
Note
:::

This task depends on
`the previous exercises <01_fields_and_views>`{.interpreted-text
role="doc"}.
::::

After using the `Print Label`{.interpreted-text role="guilabel"} button
for some t-shirt tasks, it is apparent that there should be some
feedback that the [print_label]{.title-ref} action is completed (or
failed, for example, the printer is not connected or ran out of paper).

::: exercise
#\. Display a
`notification <frontend/services/notification>`{.interpreted-text
role="ref"} message when the action is completed successfully, and a
warning if it failed. #. If it failed, the notification should be
permanent.

![image](02_miscellaneous/notification.png){.align-center}
:::

::: seealso
[Example: Using the notification
service]({GITHUB_PATH}/addons/web/static/src/views/fields/image_url/image_url_field.js)
:::

## 2. Add a systray item

Our beloved leader wants to keep a close eye on new orders. He wants to
see the number of new, unprocessed orders at all time. Let\'s do that
with a systray item.

A `systray <frontend/registries/systray>`{.interpreted-text role="ref"}
item is an element that appears in the system tray, which is a small
area located on the right-hand side of the navbar. The systray is used
to display notifications and provide access to certain features.

::: exercise
1.  Create a systray component that connects to the statistics service
    we made previously.
2.  Use it to display the number of new orders.
3.  Clicking on it should open a list view with all of those orders.
4.  Bonus point: avoid making the initial RPC by adding the information
    to the session info. The session info is given to the web client by
    the server in the initial response.

![image](02_miscellaneous/systray.png){.align-center}
:::

::: seealso
\- [Example: Systray
item]({GITHUB_PATH}/addons/web/static/src/webclient/user_menu/user_menu.js) -
[Example: Adding some information to the \"session
info\"]({GITHUB_PATH}/addons/barcodes/models/ir_http.py) - [Example:
Reading the session
information](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/barcodes/static/src/barcode_service.js#L5)
:::

## 3. Real life update

So far, the systray item from above does not update unless the user
refreshes the browser. Let us do that by calling periodically (for
example, every minute) the server to reload the information.

::: exercise
1.  The [tshirt]{.title-ref} service should periodically reload its
    data.
:::

Now, the question arises: how is the systray item notified that it
should re-render itself? It can be done in various ways but, for this
training, we choose to use the most *declarative* approach:

::: exercise
2.  Modify the [tshirt]{.title-ref} service to return a
    [reactive]({OWL_PATH}/doc/reference/reactivity.md#reactive) object.
    Reloading data should update the reactive object in place.
3.  The systray item can then perform a
    [useState]({OWL_PATH}/doc/reference/reactivity.md#usestate) on the
    service return value.
4.  This is not really necessary, but you can also *package* the calls
    to [useService]{.title-ref} and [useState]{.title-ref} in a custom
    hook [useStatistics]{.title-ref}.
:::

::: seealso
\- [Documentation on
reactivity]({OWL_PATH}/doc/reference/reactivity.md) - [Example: Use of
reactive in a
service](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/debug/profiling/profiling_service.js#L30)
:::

## 4. Add a command to the command palette

Now, let us see how we can interact with the command palette. The
command palette is a feature that allows users to quickly access various
commands and functions within the application. It is accessed by
pressing [CTRL+K]{.title-ref} in the Odoo interface.

::: exercise
Modify the
`image preview field <tutorials/master_odoo_web_framework/image_preview_field>`{.interpreted-text
role="ref"} to add a command to the command palette to open the image in
a new browser tab (or window).

Ensure the command is only active whenever a field preview is visible on
the screen.

![image](02_miscellaneous/new_command.png){.align-center}
:::

::: seealso
[Example: Using the useCommand
hook](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/debug/debug_menu.js#L15)
:::

## 5. Monkey patching a component

Often, we can achieve what we want by using existing extension points
that allow for customization, such as registering something in a
registry. Sometimes, however, it happens that we want to modify
something that has no such mechanism. In that case, we must fall back on
a less safe form of customization: monkey patching. Almost everything in
Odoo can be monkey patched.

Bafien, our beloved leader, heard about employees performing better if
they are constantly being watched. Since he cannot be there in person
for each of his employees, he tasked you with updating the user
interface to add a blinking red eye in the control panel. Clicking on
that eye should open a dialog with the following message: \"Bafien is
watching you. This interaction is recorded and may be used in legal
proceedings if necessary. Do you agree to these terms?\"

::: exercise
1.  `Inherit <reference/qweb/template_inheritance>`{.interpreted-text
    role="ref"} the [web.Breadcrumbs]{.title-ref} template of the
    [ControlPanel
    component]({GITHUB_PATH}/addons/web/static/src/search/control_panel)
    to add an icon next to the breadcrumbs. You might want to use the
    [fa-eye]{.title-ref} or [fa-eyes]{.title-ref} icons.

2.  `Patch </developer/reference/frontend/patching_code>`{.interpreted-text
    role="doc"} the component to display the message on click by using
    [the dialog
    service]({GITHUB_PATH}/addons/web/static/src/core/dialog/dialog_service.js).
    You can use
    [ConfirmationDialog]({GITHUB_PATH}/addons/web/static/src/core/confirmation_dialog/confirmation_dialog.js).

3.  Add the CSS class [blink]{.title-ref} to the element representing
    the eye and paste the following code in a new CSS file located in
    your patch\'s directory.

    ``` css
    .blink {
      animation: blink-animation 1s steps(5, start) infinite;
      -webkit-animation: blink-animation 1s steps(5, start) infinite;
    }
    @keyframes blink-animation {
      to {
        visibility: hidden;
      }
    }
    @-webkit-keyframes blink-animation {
      to {
          visibility: hidden;
      }
    }
    ```

![image](02_miscellaneous/bafien_eye.png){.align-center}

![image](02_miscellaneous/confirmation_dialog.png){.align-center}
:::

::: seealso
\- [Code: The patch
function](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/utils/patch.js#L16) -
[The Font Awesome website](https://fontawesome.com/) - [Example: Using
the dialog
service](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/board/static/src/board_controller.js#L88)
:::

## 6. Fetching orders from a customer

Let\'s see how to use some standard components to build a powerful
feature combining autocomplete, fetching data, and fuzzy lookup. We will
add an input in our dashboard to easily search all orders from a given
customer.

::: exercise
1.  Update `tshirt_service.js`{.interpreted-text role="file"} to add a
    [loadCustomers]{.title-ref} method, which returns a promise that
    returns the list of all customers (and only performs the call once).
2.  Add the [AutoComplete
    component]({GITHUB_PATH}/addons/web/static/src/core/autocomplete) to
    the dashboard, next to the buttons in the control panel.
3.  Fetch the list of customers with the tshirt service, and display it
    in the AutoComplete component, filtered by the
    [fuzzyLookup]({GITHUB_PATH}/addons/web/static/src/core/utils/search.js)
    method.

![image](02_miscellaneous/autocomplete.png){.align-center}
:::

## 7. Reintroduce Kitten Mode

Let us add a special mode to Odoo: whenever the URL contains
[kitten=1]{.title-ref}, we will display a kitten in the background of
Odoo, because we like kittens.

::: exercise
1.  Create a [kitten]{.title-ref} service, which should check the
    content of the active URL hash with the help of the
    `router service <frontend/services/router>`{.interpreted-text
    role="ref"}. If [kitten]{.title-ref} is set in the URL, add the
    class [o-kitten-mode]{.title-ref} to the document body.

2.  Add the following SCSS in `kitten_mode.scss`{.interpreted-text
    role="file"}:

    ``` css
    .o-kitten-mode {
      background-image: url(https://upload.wikimedia.org/wikipedia/commons/5/58/Mellow_kitten_%28Unsplash%29.jpg);
      background-size: cover;
      background-attachment: fixed;
    }

    .o-kitten-mode > * {
      opacity: 0.9;
    }
    ```

3.  Add a command to the command palette to toggle the kitten mode.
    Toggling the kitten mode should toggle the class
    [o-kitten-mode]{.title-ref} and update the current URL accordingly.

![image](02_miscellaneous/kitten_mode.png){.align-center}
:::

## 8. Lazy loading our dashboard

This is not really necessary, but the exercise is interesting. Imagine
that our awesome dashboard is a large application with potentially
multiple external libraries and lots of code/styles/templates. Also,
suppose that the dashboard is used only by some users in some business
flows. It would be interesting to lazy load it in order to speed up the
loading of the web client in most cases.

So, let us do that!

::: exercise
1.  Modify the manifest to create a new
    `bundle <reference/assets_bundle>`{.interpreted-text role="ref"}
    [awesome_tshirt.dashboard]{.title-ref}.
2.  Add the awesome dashboard code to this bundle. Create folders and
    move files if needed.
3.  Remove the code from the [web.assets_backend]{.title-ref} bundle so
    that it is not loaded twice.
:::

So far, we only removed the dashboard from the main bundle; we now want
to lazy load it. Currently, no client action is registered in the action
registry.

::: exercise
4.  Create a new file `dashboard_loader.js`{.interpreted-text
    role="file"}.
5.  Copy the code registering [AwesomeDashboard]{.title-ref} to the
    dashboard loader.
6.  Register [AwesomeDashboard]{.title-ref} as a
    [LazyComponent](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/core/assets.js#L265-L282).
7.  Modify the code in the dashboard loader to use the lazy component
    [AwesomeDashboard]{.title-ref}.
:::

If you open the `Network`{.interpreted-text role="guilabel"} tab of your
browser\'s dev tools, you should see that
`awesome_tshirt.dashboard.min.js`{.interpreted-text role="file"} is now
loaded only when the Dashboard is first accessed.

::: seealso
`Documentation on assets <reference/assets>`{.interpreted-text
role="ref"}
:::




--- SOURCE: developer/tutorials/master_odoo_web_framework/03_custom_kanban_view.md ---

# Chapter 3: Custom kanban view

::: todo
It\'d be cool to follow the naming convention of the previous chapters:
\"Chapter N: The concept studied in the chapter\"
:::

:::: warning
::: title
Warning
:::

It is highly recommended that you complete
`01_fields_and_views`{.interpreted-text role="doc"} before starting this
chapter. The concepts introduced in Chapter 3, including views and
examples, will be essential for understanding the material covered in
this chapter.
::::

We have gained an understanding of the numerous capabilities offered by
the Odoo web framework. As a next step, we will customize a kanban view.
This is a more complicated project that will showcase some non trivial
aspects of the framework. The goal is to practice composing views,
coordinating various aspects of the UI, and doing it in a maintainable
way.

Bafien had the greatest idea ever: a mix of a kanban view and a list
view would be perfect for your needs! In a nutshell, he wants a list of
customers on the left of the task\'s kanban view. When you click on a
customer on the left sidebar, the kanban view on the right is filtered
to only display orders linked to that customer.

::: admonition
Goal

![image](03_custom_kanban_view/overview.png){.align-center}
:::

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/awesome_tshirt).
:::

## 1. Create a new kanban view

Since we are customizing the kanban view, let us start by extending it
and using our extension in the kanban view for the tshirt orders.

::: exercise
1.  Extend the kanban view by extending the kanban controller and by
    creating a new view object.
2.  Register it in the views registry under
    [awesome_tshirt.customer_kanban]{.title-ref}.
3.  Update the kanban arch to use the extended view. This can be done
    with the [js_class]{.title-ref} attribute.
:::

## 2. Create a CustomerList component

We will need to display a list of customers, so we might as well create
the component.

::: exercise
1.  Create a [CustomerList]{.title-ref} component which only displays a
    [div]{.title-ref} with some text for now.
2.  It should have a [selectCustomer]{.title-ref} prop.
3.  Create a new template extending (XPath) the kanban controller
    template to add the [CustomerList]{.title-ref} next to the kanban
    renderer. Give it an empty function as [selectCustomer]{.title-ref}
    for now.
4.  Subclass the kanban controller to add [CustomerList]{.title-ref} in
    its sub-components.
5.  Make sure you see your component in the kanban view.

![image](03_custom_kanban_view/customer_list.png){.align-center}
:::

## 3. Load and display data

::: exercise
1.  Modify the [CustomerList]{.title-ref} component to fetch a list of
    all customers in [onWillStart]{.title-ref}.
2.  Display the list in the template with a [t-foreach]{.title-ref}.
3.  Whenever a customer is selected, call the
    [selectCustomer]{.title-ref} function prop.

![image](03_custom_kanban_view/customer_data.png){.align-center}
:::

## 4. Update the main kanban view

::: exercise
1.  Implement [selectCustomer]{.title-ref} in the kanban controller to
    add the proper domain.
2.  Modify the template to give the real function to the
    [CustomerList]{.title-ref} [selectCustomer]{.title-ref} prop.

Since it is not trivial to interact with the search view, here is a
quick snippet to help:

``` js
selectCustomer(customer_id, customer_name) {
   this.env.searchModel.setDomainParts({
      customer: {
            domain: [["customer_id", "=", customer_id]],
            facetLabel: customer_name,
      },
   });
}
```

![image](03_custom_kanban_view/customer_filter.png){.align-center}
:::

## 5. Only display customers which have an active order

There is a [has_active_order]{.title-ref} field on
[res.partner]{.title-ref}. Let us allow the user to filter results on
customers with an active order.

::: exercise
1.  Add an input of type checkbox in the [CustomerList]{.title-ref}
    component, with a label \"Active customers\" next to it.
2.  Changing the value of the checkbox should filter the list on
    customers with an active order.

![image](03_custom_kanban_view/active_customer.png){.align-center}
:::

## 6. Add a search bar to the customer list

::::: exercise
Add an input above the customer list that allows the user to enter a
string and to filter the displayed customers, according to their name.

:::: tip
::: title
Tip
:::

You can use the [fuzzyLookup]{.title-ref} function to perform the
filter.
::::

![image](03_custom_kanban_view/customer_search.png){.align-center}
:::::

::: seealso
- [Code: The fuzzylookup
  function]({GITHUB_PATH}/addons/web/static/src/core/utils/search.js)
- [Example: Using
  fuzzyLookup](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/tests/core/utils/search_test.js#L17)
:::

## 7. Refactor the code to use [t-model]{.title-ref}

To solve the previous two exercises, it is likely that you used an event
listener on the inputs. Let us see how we could do it in a more
declarative way, with the
[t-model]({OWL_PATH}/doc/reference/input_bindings.md) directive.

::: exercise
1.  Make sure you have a reactive object that represents the fact that
    the filter is active (something like
    `this.state = useState({ displayActiveCustomers: false, searchString: ''})`).
2.  Modify the code to add a getter [displayedCustomers]{.title-ref}
    which returns the currently active list of customers.
3.  Modify the template to use [t-model]{.title-ref}.
:::

## 8. Paginate customers!

::: exercise
1.  Add a `pager <frontend/pager>`{.interpreted-text role="ref"} in the
    [CustomerList]{.title-ref}, and only load/render the first 20
    customers.
2.  Whenever the pager is changed, the customer list should update
    accordingly.

This is actually pretty hard, in particular in combination with the
filtering done in the previous exercise. There are many edge cases to
take into account.

![image](03_custom_kanban_view/customer_pager.png){.align-center}
:::




--- SOURCE: developer/tutorials/master_odoo_web_framework/04_creating_view_from_scratch.md ---

# Chapter 4: Creating a view from scratch

:::: warning
::: title
Warning
:::

It is highly recommended that you complete
`01_fields_and_views`{.interpreted-text role="doc"} before starting this
chapter. The concepts introduced in Chapter 3, including views and
examples, will be essential for understanding the material covered in
this chapter.
::::

Let us see how one can create a new view, completely from scratch. In a
way, it is not very difficult to do, but there are no really good
resources on how to do it. Note that most situations should be solved by
either customizing an existing view, or with a client action.

For this exercise, let\'s assume that we want to create a
[gallery]{.title-ref} view, which is a view that lets us represent a set
of records with an image field. In our Awesome Tshirt scenario, we would
like to be able to see a set of t-shirts images.

The problem could certainly be solved with a kanban view, but this means
that it is not possible to have our normal kanban view and the gallery
view in the same action.

Let us make a gallery view. Each gallery view will be defined by an
[image_field]{.title-ref} attribute in its arch:

``` xml
<gallery image_field="some_field"/>
```

To complete the tasks in this chapter, you will need to install the
awesome_gallery addon. This addon includes the necessary server files to
add a new view.

::: admonition
Goal

![image](04_creating_view_from_scratch/overview.png){.align-center}
:::

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions/awesome_gallery).
:::

## 1. Make a hello world view

First step is to create a JavaScript implementation with a simple
component.

::: exercise
1.  Create the [gallery_view.js]{.title-ref} ,
    [gallery_controller.js]{.title-ref} and
    [gallery_controller.xml]{.title-ref} files in
    [static/src]{.title-ref}.
2.  Implement a simple hello world component in
    [gallery_controller.js]{.title-ref}.
3.  In [gallery_view.js]{.title-ref}, import the controller, create a
    view object, and register it in the view registry under the name
    [gallery]{.title-ref}.
4.  Add [gallery]{.title-ref} as one of the view type in the orders
    action.
5.  Make sure that you can see your hello world component when switching
    to the gallery view.

![image](04_creating_view_from_scratch/view_button.png){.align-center}

![image](04_creating_view_from_scratch/new_view.png){.align-center}
:::

## 2. Use the Layout component

So far, our gallery view does not look like a standard view. Let\'s use
the [Layout]{.title-ref} component to have the standard features like
other views.

::: exercise
1.  Import the [Layout]{.title-ref} component and add it to the
    [components]{.title-ref} of [GalleryController]{.title-ref}.
2.  Update the template to use [Layout]{.title-ref}. It needs a
    [display]{.title-ref} prop, which can be found in
    [props.display]{.title-ref}.

![image](04_creating_view_from_scratch/layout.png){.align-center}
:::

## 3. Parse the arch

For now, our gallery view does not do much. Let\'s start by reading the
information contained in the arch of the view.

The process of parsing an arch is usually done with a
[ArchParser]{.title-ref}, specific to each view. It inherits from a
generic [XMLParser]{.title-ref} class.

::: example
Here is an example of what an ArchParser might look like:

``` js
import { XMLParser } from "@web/core/utils/xml";

export class GraphArchParser extends XMLParser {
    parse(arch, fields) {
       const result = {};
       this.visitXML(arch, (node) => {
           ...
        });
       return result;
    }
}
```
:::

::::: exercise
1.  Create the [ArchParser]{.title-ref} class in its own file. It can
    inherit from [XMLParser]{.title-ref} in
    [\@web/core/utils/xml]{.title-ref}.
2.  Use it to read the [image_field]{.title-ref} information.
3.  Update the [gallery]{.title-ref} view code to add it to the props
    received by the controller.

:::: note
::: title
Note
:::

It is probably a little overkill to do it like that, since we basically
only need to read one attribute from the arch, but it is a design that
is used by every other odoo views, since it lets us extract some upfront
processing out of the controller.
::::
:::::

::: seealso
[Example: The graph arch
parser]({GITHUB_PATH}/addons/web/static/src/views/graph/graph_arch_parser.js)
:::

## 4. Load some data

Let us now get some real data.

::::: exercise
1.  Add a `loadImages(domain) {...}` method to the
    [GalleryController]{.title-ref}. It should perform a
    [webSearchRead]{.title-ref} call from the orm service to fetch
    records corresponding to the domain, and use
    [imageField]{.title-ref} received in props.
2.  Modify the [setup]{.title-ref} code to call that method in the
    [onWillStart]{.title-ref} and [onWillUpdateProps]{.title-ref} hooks.
3.  Modify the template to display the data inside the default slot of
    the [Layout]{.title-ref} component.

:::: note
::: title
Note
:::

The loading data code will be moved into a proper model in the next
exercise.
::::

![image](04_creating_view_from_scratch/gallery_data.png){.align-center}
:::::

## 5. Reorganize code

Real views are a little bit more organized. This may be overkill in this
example, but it is intended to learn how to structure code in Odoo.
Also, this will scale better with changing requirements.

::: exercise
1.  Move all the model code in its own [GalleryModel]{.title-ref} class.
2.  Move all the rendering code in a [GalleryRenderer]{.title-ref}
    component.
3.  Adapt the [GalleryController]{.title-ref} and
    [gallery_view]{.title-ref} to make it work.
:::

## 6. Display images

::: exercise
Update the renderer to display images in a nice way, if the field is
set. If [image_field]{.title-ref} is empty, display an empty box
instead.

![image](04_creating_view_from_scratch/tshirt_images.png){.align-center}
:::

## 7. Switch to form view on click

::: exercise
Update the renderer to react to a click on an image and switch to a form
view. You can use the [switchView]{.title-ref} function from the action
service.
:::

::: seealso
[Code: The switchView
function](https://github.com/odoo/odoo/blob/1f4e583ba20a01f4c44b0a4ada42c4d3bb074273/addons/web/static/src/webclient/actions/action_service.js#L1329)
:::

## 8. Add an optional tooltip

It is useful to have some additional information on mouse hover.

::: exercise
1.  Update the code to allow an optional additional attribute on the
    arch:

    ``` xml
    <gallery image_field="some_field" tooltip_field="some_other_field"/>
    ```

2.  On mouse hover, display the content of the tooltip field. It should
    work if the field is a char field, a number field or a many2one
    field.

3.  Update the orders gallery view to add the customer as tooltip field.

![image](04_creating_view_from_scratch/image_tooltip.png){.align-center}
:::

::: seealso
[Code: The tooltip
hook]({GITHUB_PATH}/addons/web/static/src/core/tooltip/tooltip_hook.js)
:::

## 9. Add pagination

::: exercise
Let\'s add a pager on the control panel and manage all the pagination
like in a normal Odoo view. Note that it is surprisingly difficult.

![image](04_creating_view_from_scratch/pagination.png){.align-center}
:::

::: seealso
[Code: The usePager
hook]({GITHUB_PATH}/addons/web/static/src/search/pager_hook.js)
:::

## 10. Validating views

We have a nice and useful view so far. But in real life, we may have
issue with users incorrectly encoding the [arch]{.title-ref} of their
Gallery view: it is currently only an unstructured piece of XML.

Let us add some validation! In Odoo, XML documents can be described with
an RN file `(Relax NG file)`{.interpreted-text role="dfn"}, and then
validated.

::: exercise
1.  Add an RNG file that describes the current grammar:
    - A mandatory attribute [image_field]{.title-ref}.
    - An optional attribute: [tooltip_field]{.title-ref}.
2.  Add some code to make sure all views are validated against this RNG
    file.
3.  While we are at it, let us make sure that [image_field]{.title-ref}
    and [tooltip_field]{.title-ref} are fields from the current model.

Since validating an RNG file is not trivial, here is a snippet to help:

``` python
# -*- coding: utf-8 -*-
import logging
import os

from lxml import etree

from odoo.loglevels import ustr
from odoo.tools import misc, view_validation

_logger = logging.getLogger(__name__)

_viewname_validator = None

@view_validation.validate('viewname')
def schema_viewname(arch, **kwargs):
    """ Check the gallery view against its schema

    :type arch: etree._Element
    """
    global _viewname_validator

    if _viewname_validator is None:
        with misc.file_open(os.path.join('modulename', 'rng', 'viewname.rng')) as f:
            _viewname_validator = etree.RelaxNG(etree.parse(f))

    if _viewname_validator.validate(arch):
        return True

    for error in _viewname_validator.error_log:
        _logger.error(ustr(error))
    return False
```
:::

::: seealso
[Example: The RNG file of the graph
view]({GITHUB_PATH}/addons/base/rng/graph_view.rng)
:::




--- SOURCE: developer/tutorials/master_odoo_web_framework/05_testing.md ---

# Chapter 5: Testing

Automatically testing code is important when working on a codebase. It
helps ensure we don\'t introduce (too many) bugs or regressions. Let us
see how to test our code.

::: spoiler
Solutions

The solutions for each exercise of the chapter are hosted on the
[official Odoo tutorials
repository](https://github.com/odoo/tutorials/commits/{CURRENT_MAJOR_BRANCH}-solutions).
:::

## 1. Integration testing

To make sure our application works as expected, we can perform
`integration testing
<reference/testing/integration-testing>`{.interpreted-text role="ref"}
by creating a tour: this is a sequence of steps that we can execute.
Each step wait until some desired DOM state is reached, then performs an
action. If, at some point, it is unable to go to the next step for a
long time, the tour fails.

Let\'s write a tour to ensure that it is possible to perform an tshirt
order from our public route

::: exercise
1.  In the [awesome_tshirt]{.title-ref} addon, add a
    `/static/tests/tours`{.interpreted-text role="file"} folder.
2.  Add a `/static/tests/tours/order_flow.js`{.interpreted-text
    role="file"} file.
3.  Add a tour that performs the following steps:
    1.  Open the [/awesome_tshirt/order]{.title-ref} route.
    2.  Fill the order form.
    3.  Validate it.
    4.  Navigate to our webclient.
    5.  Open the list view for the the t-shirt order.
    6.  Check that our order can be found in the list.
4.  Run the tour manually.
5.  Add a Python test to run it programmatically.
6.  Run the tour from the terminal.
:::

## 2. Unit testing a Component

It is also useful to test independently a component or a piece of code.
`QUnit
<reference/testing/qunit>`{.interpreted-text role="ref"} tests are
useful to quickly locate an issue.

::: exercise
1.  In the [awesome_tshirt]{.title-ref} addon, add a
    `static/tests/counter_tests.js`{.interpreted-text role="file"} file.
2.  Add a QUnit test that instantiates a counter, clicks on it, and
    makes sure it is incremented.

![image](05_testing/component_test.png){.align-center}
:::

::: seealso
[Example: Testing an Owl
component]({GITHUB_PATH}/addons/web/static/tests/core/checkbox_tests.js)
:::

## 3. Unit testing our gallery view

Many components need more setup to be tested. In particular, we often
need to mock some demo data. Let us see how to do that.

:::: note
::: title
Note
:::

This depends on our Gallery View from
`04_creating_view_from_scratch`{.interpreted-text role="doc"}.
::::

::: exercise
1.  In the [awesome_gallery]{.title-ref} addon, add a
    `/static/tests/gallery_view_tests.js`{.interpreted-text role="file"}
    file.
2.  Add a test that instantiates the gallery view with some demo data.
3.  Add another test that checks that when the user clicks on an image,
    it is switched to the form view of the corresponding order.

![image](05_testing/view_test.png){.align-center}
:::

::: seealso
[Example: Testing a list
view]({GITHUB_PATH}/addons/web/static/tests/views/list_view_tests.js)
:::




--- SOURCE: developer/tutorials/master_odoo_web_framework.md ---

show-content

:   

# Master the Odoo Web Framework

::: {.toctree titlesonly="" glob=""}
master_odoo_web_framework/\*
:::

This tutorial is designed for those who have completed the
`discover_js_framework`{.interpreted-text role="doc"} tutorial and are
looking to deepen their knowledge of the Odoo web framework.

For this training, we will step into the shoes of the IT staff at the
fictional company Awesome T-Shirt, which is dedicated to printing custom
t-shirts for online customers. The Awesome T-Shirt company uses Odoo to
manage orders and has created a dedicated Odoo module to manage their
workflow.

In this tutorial, we will explore various aspects of the Odoo web
framework in detail, including fields and views, notifications, command
palette, and much more. This tutorial will provide you with the
knowledge and skills you need to take full advantage of the Odoo web
framework. So, let\'s get started!

## Setup {#howtos/master_odoo_web_framework/setup}

1.  Clone the [official Odoo tutorials
    repository](https://github.com/odoo/tutorials) and switch to the
    branch [{CURRENT_MAJOR_BRANCH}]{.title-ref}.
2.  Add the cloned repository to the
    `--addons-path <odoo-bin --addons-path>`{.interpreted-text
    role="option"}.
3.  Start a new Odoo database and install the modules
    [awesome_tshirt]{.title-ref} and [awesome_gallery]{.title-ref}.

## Content

- `master_odoo_web_framework/01_fields_and_views`{.interpreted-text
  role="doc"}
- `master_odoo_web_framework/02_miscellaneous`{.interpreted-text
  role="doc"}
- `master_odoo_web_framework/03_custom_kanban_view`{.interpreted-text
  role="doc"}
- `master_odoo_web_framework/04_creating_view_from_scratch`{.interpreted-text
  role="doc"}
- `master_odoo_web_framework/05_testing`{.interpreted-text role="doc"}




--- SOURCE: developer/tutorials/mixins.md ---

# Reuse code with mixins

If you need to interface with common Odoo features such as the chatter,
you can rely on `mixins <../reference/backend/mixins>`{.interpreted-text
role="doc"}. They are Odoo models exposing useful methods through
inheritance.

To learn and play with mixins, visit [this
repository](https://github.com/tivisse/odoodays-2018/). This module for
a plant nursery is training material developed for the OXP 2018. You
don\'t need to code it on your side. But you can check the presentations
in the `/static/pdf`{.interpreted-text role="file"} directory and play
with the module to discover some magic features in Odoo.




--- SOURCE: developer/tutorials/pdf_reports.md ---

# Build PDF Reports

:::: important
::: title
Important
:::

This tutorial is an extension of the `getting_started`{.interpreted-text
role="doc"} tutorial. Make sure you have completed it and use the
[estate]{.title-ref} module you have built as a base for the exercises
in this tutorial. Fetch the branch [{BRANCH}-core]{.title-ref} from the
[technical-training-solutions](https://github.com/odoo/technical-training-solutions/tree/{BRANCH}-core)
repository if you want to start from a clean base.
::::

We were previously
`introduced to QWeb <tutorials/getting_started/15_qwebintro>`{.interpreted-text
role="ref"} where it was used to build a kanban view. Now we will expand
on one of QWeb\'s other main uses: creating PDF reports. A common
business requirement is the ability to create documents to send to
customers and to use internally. These reports can be used to summarize
and display information in an organized template to support the business
in different ways. Odoo can additionally add our company\'s header and
footer to our reports with minimal extra effort.

The documentation related to this topic can be found in
`reference/qweb`{.interpreted-text role="ref"},
`reference/reports/report`{.interpreted-text role="ref"}, and the
`reference/actions/report`{.interpreted-text role="ref"} section of the
Actions reference.

## File Structure

The bulk of a PDF report is its QWeb template. It also typically needs a
corresponding `ir.actions.report` to include the report within a
module\'s business logic. There is no strict rule for the file names or
where they are located, but these two parts are typically stored in 2
separate files within a `report` folder at the top level of your
module\'s directory. If a module has many or multiple long report
templates, then they are often organized logically across different
files named after the report(s) they contain. All actions for the
reports are usually stored in the same file ending with `_reports.xml`,
regardless of the number of reports it contains.

Therefore, it is expected that your work tree will look something like
this:

``` bash
estate
├── models
│   ├── *.py
│   └── __init__.py
├── report
│   ├── estate_property_templates.xml
│   └── estate_property_reports.xml
├── security
│   └── ir.model.access.csv
├── views
│   └── *.xml
├── __init__.py
└── __manifest__.py
```

Don\'t forget to add whatever files your template and action view will
be into to your `__manifest__.py`. In this case, you will want to add
the files to the `data` list and remember that the files listed in a
manifest are loaded sequentially!

## Basic Report

:::: note
::: title
Note
:::

**Goal**: at the end of this section, we will can print a report that
displays all offers for a property.

![Simple PDF report](pdf_reports/simple_report.png){.align-center}
::::

In our real estate example there are many useful reports that we could
create. One simple report we can create is one that displays all of a
property\'s offers.

### Report Data

Before we do anything we first need some data to populate our reports or
else this tutorial won\'t be very interesting. When creating reports,
you will need some data to test your report code and check that the
resulting look is as expected. It is a good idea to test with data that
will cover most or all of your expected use cases. A good representation
set for our simple report is:

- At least 3 properties where 1 is \"sold\", 1 is \"offer received\" and
  1 is \"new\".
- At least 2-3 offers for our \"sold\" and \"offer received\" properties

If you don\'t have a set of data like this already, you can either:

- Complete the `define_module_data`{.interpreted-text role="doc"}
  tutorial (if you haven\'t done so already) and add the extra cases to
  your demo data (you may need to create a new database to load in the
  demo data).
- Manually create the data in your database.
- Copy this [data
  file](https://github.com/odoo/technical-training-solutions/blob/{BRANCH}-J_reports/estate/data/estate_demo.xml)
  into a new directory (data) in your estate module and copy [these
  lines](https://github.com/odoo/technical-training-solutions/blob/{BRANCH}-J_reports/estate/__manifest__.py#L21-L23)
  into your \_\_manifest\_\_.py file (you may need to create a new
  database to load in the demo data).

Before continuing, click through your data in your database and make
sure your data is as expected. Of course you can add the data after you
write your report code, but then you will not be able to incrementally
test portions of your code as you write it. This can make checking for
mistakes and debugging your code more difficult in the long run for
complicated reports.

### Minimal Template

A minimal viable template is viewable under the \"Minimal viable
template\" section of the
`reference/reports/templates`{.interpreted-text role="ref"}
documentation. We can modify this example to build our minimal property
offers template file:

``` xml
<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_property_offers">
        <t t-foreach="docs" t-as="property">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <h2>
                            <span t-field="property.name"/>
                        </h2>
                        <div>
                            <strong>Expected Price: </strong>
                            <span t-field="property.expected_price"/>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="offers" t-value="property.mapped('offer_ids')"/>
                                <tr t-foreach="offers" t-as="offer">
                                    <td>
                                        <span t-field="offer.price"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
```

Most of the Odoo specific (i.e. non-HTML) items in our file are
explained in the minimal viable template section. Some additional
features in our template are:

- The use of the `class="table"` attribute, so our table has some nice
  formatting. Twitter Bootstrap (we\'re using its table class in this
  case), and Font Awesome (useful for adding icons) classes can be used
  in your report template.
- The use of `t-set`, `t-value`, `t-foreach`, and `t-as` so that we can
  loop over all the `offer_ids`.

If you are already familiar with website templating engines, then the
QWeb directives (i.e. the [t-]{.title-ref} commands) probably don\'t
need much explanation and you can just look at its
`documentation <reference/qweb>`{.interpreted-text role="ref"} and skip
ahead to the next subsection.

Otherwise you are encouraged to read more about them (
[Wikipedia](https://en.wikipedia.org/wiki/Template_processor) has a good
high level description), but the general idea is that QWeb provides the
ability to dynamically generate web code based on Odoo data and simple
commands. I.e. QWeb can access recordset data (and methods) and process
simple programming operations such as setting and accessing temporary
variables. For example, in the above example:

- `t-set` creates a temporary variable called \"offers\" that has its
  value set by `t-value` to the current `estate.property` recordset\'s
  `offer_ids`.
- The `t-foreach` and `t-as` usage is the equivalent to the Python:

``` Python
for offer in offers:
```

### Report Action

Now that we have a template, we need to make it accessible in our app
via a `ir.actions.report`. A practical example of `ir.actions.report` is
[here](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/event/report/event_event_reports.xml#L20-L30)
corresponding to [this
template](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/event/report/event_event_templates.xml#L5).
Its contents are all explained in
`the documentation <reference/actions/report>`{.interpreted-text
role="ref"}.

An `ir.actions.report` is primarily used via the Print menu of a
model\'s view. In the practical example, the `binding_model_id`
specifies which model\'s views the report should show, and Odoo will
auto-magically add it for you. Another common use case of the report
action is to link it to a button as we learned in
`tutorials/getting_started/10_actions`{.interpreted-text role="ref"}.
This is handy for reports that only make sense under specific
conditions. For example, if we wanted to make a \"Final Sale\" report,
then we can link it to a \"Print Sale Info\" button that appears in the
form view only when the property is \"Sold\".

![Print Menu Button](pdf_reports/print_menu.png){.align-center}

You may have noticed or are wondered why our report template loops
through a recordset. When our template is passed more than one record,
it can produce one PDF report for all the records. Using the Print menu
in the list view with multiple records selected will demonstrate this.

### Make a Report

Finally, you now know where to create your files and how the content of
the files should look. Happy report making!

::: exercise
Make a report.

- Add the property offers report from the minimal template subsection to
  the Print menu of the Property views.
- Improve the report by adding more data. Refer to the **Goal** of this
  section to see what additional data you can add and feel free to add
  even more.
- Bonus: Make an extra flexible report by adding in some logic so that
  when there are no offers on a property then we don\'t create a table
  and instead write something about how there are no offers yet. Hint:
  you will need to use `t-if` and `t-else`.

Remember to check that your PDF reports match your data as expected.
:::

## Sub-templates

:::: note
::: title
Note
:::

**Goal**: at the end of this section, we will have a sub-template that
we use in 2 reports.

![Report using a subtemplate](pdf_reports/report_subtemplate.png){.align-center}
::::

There are two main reasons for using sub-templates. One is to make the
code easier to read when working with extra-long or complicated
templates. The other is to reuse code where possible. Our simple
property offers report is useful, but listing property offers
information can be useful for more than just one report template. One
example is a report that lists all of a salesman\'s properties\' offers.

See if you can understand how to call a sub-template by reading the
`documentation <reference/qweb/sub-templates>`{.interpreted-text
role="ref"} on it and/or by looking at an
[example](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/portal/static/src/xml/portal_chatter.xml#L147-L160)
(remember QWeb uses the same control flows regardless if it is for a
report or a view in Odoo.)

::: exercise
Create and use a sub-template.

- Split the table portion of the offers into its own template. Remember
  to check that your original report still prints correctly afterwards.

- Add a new report for `res.users` that allows you to print all of the
  Real Estate Properties that are visible in their form view (i.e. in
  the \"Settings\" app). Include the offers for each of those saleman\'s
  properties in the same report. Hint: since the `binding_model_id` in
  this case will not be within the estate module, you will need to use
  `ref="base.model_res_users"`.

  Your end result should look similar to the image in the **Goal** of
  this section.

Remember to check that your reports match your data as expected!
:::

## Report Inheritance

:::: note
::: title
Note
:::

**Goal**: at the end of this section, we will inherit the property
report in the `estate_account` module.

![An inherited report](pdf_reports/inherited_report.png){.align-center}
::::

Inheritance in QWeb uses the same `xpath` elements as
`views inheritance <reference/views/inheritance>`{.interpreted-text
role="ref"}. A QWeb template refers to its parent template in a
different way though. It is even easier to do by just adding the
`inherit_id` attribute to the `template` element and setting it equal to
the *module.parent_template_id*.

We didn\'t add any new fields to any of the estate models in
[estate_account]{.title-ref}, but we can still add information to our
existing property report. For example, we know that any \"Sold\"
properties will already have an invoice created for them, so we can add
this information to our report.

::: exercise
Inherit a report.

- Extend the property report to include some information about the
  invoice. You can look at the **Goal** of this section for inspiration
  (i.e. print a line when the property is Done, otherwise print
  nothing).

Again, remember to check that your reports match your data as expected!
:::

## Additional Features

All the following extra features are described further in the
`reference/reports/report`{.interpreted-text role="ref"} documentation,
including how to implement each of them.

### Translations

We all know Odoo is used in multiple languages thanks to automated and
manual translating. QWeb reports are no exception! Note that sometimes
the translations do not work properly if there are unnecessary spaces in
your template\'s text content, so try to avoid them when possible
(especially leading spaces).

### Reports are web pages

You probably are tired of hearing that QWeb creates HTML, but we\'re
saying it again! One of the neat features of reports being written in
QWeb is they can be viewed within the web browser. This can be useful if
you want to embed a hyperlink that leads to a specific report. Note that
the usual security checks will still apply to prevent unauthorized users
from accessing the reports.

### Barcodes

Odoo has a built-in barcode image creator that allows for barcodes to be
embedded in your reports. Check out the corresponding
[code](https://github.com/odoo/odoo/blob/0e12fa135882cd5095dbf15fe2f64231c6a84336/addons/web/controllers/main.py#L2044-L2046)
to see all the supported barcode types.




--- SOURCE: developer/tutorials/restrict_data_access.md ---

# Restrict access to data

:::: important
::: title
Important
:::

This tutorial is an extension of the `getting_started`{.interpreted-text
role="doc"} tutorial. Make sure you have completed it and use the
[estate]{.title-ref} module you have built as a base for the exercises
in this tutorial. Fetch the branch [{BRANCH}-core]{.title-ref} from the
[technical-training-solutions](https://github.com/odoo/technical-training-solutions/tree/{BRANCH}-core)
repository if you want to start from a clean base.
::::

So far we have mostly concerned ourselves with implementing useful
features. However in most business scenarios *security* quickly becomes
a concern: currently,

- Any employee (which is what `group_user` stands for) can create, read,
  update or delete properties, property types, or property tags.
- If `estate_account` is installed then only agents allowed to interact
  with invoicing can confirm sales as that\'s necessary to `create an
  invoice <tutorials/getting_started/14_other_module/create>`{.interpreted-text
  role="ref"}.

However:

- We do not want third parties to be able to access properties directly.
- Not all our employees may be real-estate agents (e.g. administrative
  personnel, property managers, \...), we don\'t want non-agents to see
  the available properties.
- Real-estate agents don\'t need or get to decide what property types or
  tags are *available*.
- Real-estate agents can have *exclusive* properties, we do not want one
  agent to be able to manage another\'s exclusives.
- All real-estate agents should be able to confirm the sale of a
  property they can manage, but we do not want them to be able to
  validate or mark as paid any invoice in the system.

:::: note
::: title
Note
:::

We may actually be fine with some or most of these for a small business.

Because it\'s easier for users to disable unnecessary security rules
than it is to create them from nothing, it\'s better to err on the side
of caution and limit access: users can relax that access if necessary or
convenient.
::::

## Groups

::: seealso
The documentation related to this topic can be found in `the security
reference <reference/security>`{.interpreted-text role="ref"}.

`/contributing/development/coding_guidelines`{.interpreted-text
role="doc"} document the format and location of master data items.
:::

::: admonition
**Goal**

At the end of this section,

- We can make employees *real-estate agents* or *real-estate managers*.
- The `admin` user is a real-estate manager.
- We have a new *real-estate agent* employee with no access to invoicing
  or administration.
:::

It would not be practical to attach individual security rules to
employees any time we need a change so *groups* link security rules and
users. They correspond to roles that can be assigned to employees.

For most Odoo applications[^1] a good baseline is to have *user* and
*manager* (or administrator) roles: the manager can change the
configuration of the application and oversee the entirety of its use
while the user can well, use the application[^2].

This baseline seems sufficient for us:

- Real estate managers can configure the system (manage available types
  and tags) as well as oversee every property in the pipeline.
- Real estate agents can manage the properties under their care, or
  properties which are not specifically under the care of any agent.

In keeping with Odoo\'s data-driven nature, a group is no more than a
record of the `res.groups` model. They are normally part of a module\'s
`master data
<define_module_data>`{.interpreted-text role="doc"}, defined in one of
the module\'s data files.

As simple example [can be found
here](https://github.com/odoo/odoo/blob/532c083cbbe0ee6e7a940e2bdc9c677bd56b62fa/addons/hr/security/hr_security.xml#L9-L14).

::::::: exercise
1.  Create the `security.xml` file in the appropriate folder and add it
    to the `__manifest__.py` file.
2.  If not already, add a `'category'` field to your `__manifest__.py`
    with value `Real Estate/Brokerage`.
3.  Add a record creating a group with the id `estate_group_user`, the
    name \"Agent\" and the category
    `base.module_category_real_estate_brokerage`.
4.  Below that, add a record creating a group with the id
    `estate_group_manager`, the name \"Manager\" and the category
    `base.module_category_real_estate_brokerage`. The
    `estate_group_manager` group needs to imply `estate_group_user`.

:::: note
::: title
Note
:::

Where does that **category** comes from ? It\'s a *module category*.
Here we used the category id
`base.module_category_real_estate_brokerage` which was automatically
generated by Odoo based on the [category]{.title-ref} set in the
`__manifest__.py` of the module. You can also find here the list of
[default module
categories](https://github.com/odoo/odoo/blob/71da80deb044852a2af6b111d695f94aad7803ac/odoo/addons/base/data/ir_module_category_data.xml)
provided by Odoo.
::::

:::: tip
::: title
Tip
:::

Since we modified data files, remember to restart Odoo and update the
module using `-u estate`.
::::

If you go to `Settings --> Manage Users`{.interpreted-text
role="menuselection"} and open the `admin` user (\"Mitchell Admin\"),
you should see a new section:

![](restrict_data_access/groups.png)

Set the admin user to be a *Real Estate manager*.
:::::::

::: exercise
Via the web interface, create a new user with only the \"real estate
agent\" access. The user should not have any Invoicing or Administration
access.

Use a private tab or window to log in with the new user (remember to set
a password), as the real-estate agent you should only see the real
estate application, and possibly the Discuss (chat) application:

![](restrict_data_access/agent.png)
:::

## Access Rights

::: seealso
The documentation related to this topic can be found at
`reference/security/acl`{.interpreted-text role="ref"}.
:::

::: admonition
**Goal**

At the end of this section,

- Employees who are not at least real-estate agents will not see the
  real-estate application.
- Real-estate agents will not be able to update the property types or
  tags.
:::

Access rights were first introduced in
`tutorials/getting_started/05_securityintro`{.interpreted-text
role="ref"}.

Access rights are a way to give users access to models *via* groups:
associate an access right to a group, then all users with that group
will have the access.

For instance we don\'t want real-estate agents to be able to modify what
property types are available, so we would not link that access to the
\"user\" group.

Access rights can only give access, they can\'t remove it: when access
is checked, the system looks to see if *any* access right associated
with the user (via any group) grants that access.

  ------- -------- ------ -------- --------
  group   create   read   update   delete
  A       X        X               
  B                X               
  C                       X        
  ------- -------- ------ -------- --------

A user with the groups A and C will be able to do anything but delete
the object while one with B and C will be able to read and update it,
but not create or delete it.

:::: note
::: title
Note
:::

- The group of an access right can be omitted, this means the ACL
  applies to *every user*, this is a useful but risky fallback as
  depending on the applications installed it can grant even non-users
  access to the model.
- If no access right applies to a user, they are not granted access
  (default-deny).
- If a menu item points to a model to which a user doesn\'t have access
  and has no submenus which the user can see, the menu will not be
  displayed.
::::

::::: exercise
Update the access rights file to:

- Give full access to all objects to your Real Estate Manager group.
- Give agents (real estate users) only read access to types and tags.
- Give nobody the right to delete properties.
- Check that your agent user is not able to alter types or tags, or to
  delete properties, but that they can otherwise create or update
  properties.

:::: warning
::: title
Warning
:::

Remember to give different xids to your `ir.model.access` records
otherwise they will overwrite one another.
::::
:::::

Since the \"demo\" user was not made a real-estate agent or manager,
they should not even be able to see the real-estate application. Use a
private tab or window to check for this (the \"demo\" user has the
password \"demo\").

## Record Rules

::: seealso
The documentation related to this topic can be found at
`reference/security/rules`{.interpreted-text role="ref"}.
:::

::: admonition
**Goal**

At the end of this section, agents will not be able to see the
properties exclusive to their colleagues; but managers will still be
able to see everything.
:::

Access rights can grant access to an entire model but often we need to
be more specific: while an agent can interact with properties in general
we may not want them to update or even see properties managed by one of
their colleagues.

Record *rules* provide that precision: they can grant or reject access
to individual records:

``` xml
<record id="rule_id" model="ir.rule">
    <field name="name">A description of the rule's role</field>
    <field name="model_id" ref="model_to_manage"/>
    <field name="perm_read" eval="False"/>
    <field name="groups" eval="[Command.link(ref('base.group_user'))]"/>
    <field name="domain_force">[
        '|', ('user_id', '=', user.id),
             ('user_id', '=', False)
    ]</field>
</record>
```

The `reference/orm/domains`{.interpreted-text role="ref"} is how access
is managed: if the record passes then access is granted, otherwise
access is rejected.

:::: tip
::: title
Tip
:::

Because rules tends to be rather complex and not created in bulk,
they\'re usually created in XML rather than the CSV used for access
rights.
::::

The rule above:

- Only applies to the \"create\", \"update\" (write) and \"delete\"
  (unlink) operations: here we want every employee to be able to see
  other users\' records but only the author / assignee can update a
  record.
- Is `non-global <reference/security/rules/global>`{.interpreted-text
  role="ref"} so we can provide an additional rule for e.g. managers.
- Allows the operation if the current user (`user.id`) is set (e.g.
  created, or is assigned) on the record, or if the record has no
  associated user at all.

:::: note
::: title
Note
:::

If no rule is defined or applies to a model and operation, then the
operation is allowed (*default-allow*), this can have odd effects if
access rights are not set up correctly (are too permissive).
::::

::: exercise
Define a rule which limits agents to only being able to see or modify
properties which have no salesperson, or for which they are the
salesperson.

You may want to create a second real-estate agent user, or create a few
properties for which the salesperson is a manager or some other user.

Verify that your real estate manager(s) can still see all properties. If
not, why not? Remember:

> The `estate_group_manager` group needs to imply `estate_group_user`.
:::

## Security Override

### Bypassing Security

::: admonition
**Goal**

At the end of this section, agents should be able to confirm property
sales without needing invoicing access.
:::

If you try to mark a property as \"sold\" as the real estate agent, you
should get an access error:

![](restrict_data_access/error.png)

This happens because `estate_account` tries to create an invoice during
the process, but creating an invoice requires the right to all invoice
management.

We want agents to be able to confirm a sale without them having full
invoicing access, which means we need to *bypass* the normal security
checks of Odoo in order to create an invoice *despite* the current user
not having the right to do so.

There are two main ways to bypass existing security checks in Odoo,
either wilfully or as a side-effect:

- The `sudo()` method will create a new recordset in \"sudo mode\", this
  ignores all access rights and record rules (although hard-coded group
  and user checks may still apply).
- Performing raw SQL queries will bypass access rights and record rules
  as a side-effect of bypassing the ORM itself.

::: exercise
Update `estate_account` to bypass access rights and rules when creating
the invoice.
:::

:::: danger
::: title
Danger
:::

These features should generally be avoided, and only used with extreme
care, after having checked that the current user and operation should be
able to bypass normal access rights validation.

Operations performed in such modes should also rely on user input as
little as possible, and should validate it to the maximum extent they
can.
::::

### Programmatically checking security

::: admonition
**Goal**

At the end of this section, the creation of the invoice should be
resilient to security issues regardless to changes to `estate`.
:::

In Odoo, access rights and record rules are only checked *when
performing data access via the ORM* e.g. creating, reading, searching,
writing, or unlinking a record via ORM methods. Other methods do *not*
necessarily check against any sort of access rights.

In the previous section, we bypassed the record rules when creating the
invoice in `action_sold`. This bypass can be reached by any user without
any access right being checked:

- Add a print to `action_sold` in `estate_account` before the creation
  of the invoice (as creating the invoice accesses the property,
  therefore triggers an ACL check) e.g.:

      print(" reached ".center(100, '='))

You should see `reached` in your Odoo log, followed by an access error.

:::: danger
::: title
Danger
:::

Just because you\'re already in Python code does not mean any access
right or rule has or will be checked.
::::

*Currently* the accesses are implicitly checked by accessing data on
`self` as well as calling `super()` (which does the same and *updates*
`self`), triggering access errors and cancelling the transaction
\"uncreating\" our invoice.

*However* if this changes in the future, or we add side-effects to the
method (e.g. reporting the sale to a government agency), or bugs are
introduced in `estate`, \... it would be possible for non-agents to
trigger operations they should not have access to.

Therefore when performing non-CRUD operations, or legitimately bypassing
the ORM or security, or when triggering other side-effects, it is
extremely important to perform *explicit security checks*.

Explicit security checks can be performed by:

- Checking who the current user is (`self.env.user`) and match them
  against specific models or records.
- Checking that the current user has specific groups hard-coded to allow
  or deny an operation (`self.env.user.has_group`).
- Calling the `check_access_rights(operation)` method on a recordset,
  this verifies whether the current user has access to the model itself.
- Calling `check_access_rule(operations)` on a non-empty recordset, this
  verifies that the current user is allowed to perform the operation on
  *every* record of the set.

:::: warning
::: title
Warning
:::

Checking access rights and checking record rules are separate
operations, if you\'re checking record rules you usually want to also
check access rights beforehand.
::::

::: exercise
Before creating the invoice, use `check_access_rights` and
`check_access_rule` to ensure that the current user can update
properties in general as well as the specific property the invoice is
for.

Re-run the bypass script, check that the error occurs before the print.
:::

## Multi-company security {#tutorials/restrict_data_access/multicompany}

::: seealso
`reference/howtos/company`{.interpreted-text role="ref"} for an overview
of multi-company facilities in general, and
`multi-company security rules <howto/company/security>`{.interpreted-text
role="ref"} in particular.

Documentation on rules in general can, again, be found at
`reference/security/rules`{.interpreted-text role="ref"}.
:::

::: admonition
**Goal**

At the end of this section, agents should only have access to properties
of their agency (or agencies).
:::

For one reason or another we might need to manage our real-estate
business as multiple companies e.g. we might have largely autonomous
agencies, a franchise setup, or multiple brands (possibly from having
acquired other real-estate businesses) which remain legally or
financially separate from one another.

Odoo can be used to manage multiple companies inside the same system,
however the actual handling is up to individual modules: Odoo itself
provides the tools to manage the issue of company-dependent fields and
*multi-company rules*, which is what we\'re going to concern ourselves
with.

We want different agencies to be \"siloed\" from one another, with
properties belonging to a given agency and users (whether agents or
managers) only able to see properties linked to their agency.

As before, because this is based on non-trivial records it\'s easier for
a user to relax rules than to tighten them so it makes sense to default
to a relatively stronger security model.

Multi-company rules are simply record rules based on the `company_ids`
or `company_id` fields:

- `company_ids` is all the companies to which the current user has
  access
- `company_id` is the currently active company (the one the user is
  currently working in / for).

Multi-company rules will *usually* use the former i.e. check if the
record is associated with *one* of the companies the user has access to:

``` xml
<record model="ir.rule" id="hr_appraisal_plan_comp_rule">
    <field name="name">Appraisal Plan multi-company</field>
    <field name="model_id" ref="model_hr_appraisal_plan"/>
    <field name="domain_force">[
        '|', ('company_id', '=', False),
             ('company_id', 'in', company_ids)
    ]</field>
</record>
```

:::: danger
::: title
Danger
:::

Multi-company rules are usually
`global <reference/security/rules/global>`{.interpreted-text
role="ref"}, otherwise there is a high risk that additional rules would
allow bypassing the multi-company rules.
::::

::: exercise
- Add a `company_id` field to `estate.property`, it should be required
  (we don\'t want agency-less properties), and should default to the
  current user\'s current company.
- Create a new company, with a new estate agent in that company.
- The manager should be a member of both companies.
- The old agent should only be a member of the old company.
- Create a few properties in each company (either use the company
  selector as the manager or use the agents). Unset the default salesman
  to avoid triggering *that* rule.
- All agents can see all companies, which is not desirable, add the
  record rule restricting this behaviour.
:::

:::: warning
::: title
Warning
:::

remember to `--update` your module when you change its model or data
::::

## Visibility != security

::: admonition
**Goal**

At the end of this section, real-estate agents should not see the
Settings menu of the real-estate application, but should still be able
to set the property type or tags.
:::

Specific Odoo models can be associated directly with groups (or
companies, or users). It is important to figure out whether this
association is a *security* or a *visibility* feature before using it:

- *Visibility* features mean a user can still access the model or record
  otherwise, either through another part of the interface or by
  `performing
  operations remotely using RPC <../reference/external_api>`{.interpreted-text
  role="doc"}, things might just not be visible in the web interface in
  some contexts.
- *Security* features mean a user can not access records, fields or
  operations.

Here are some examples:

- Groups on *model fields* (in Python) are a security feature, users
  outside the group will not be able to retrieve the field, or even know
  it exists.

  Example: in server actions, [only system users can see or update
  Python
  code](https://github.com/odoo/odoo/blob/7058e338a980268df1c502b8b2860bdd8be9f727/odoo/addons/base/models/ir_actions.py#L414-L417).

- Groups on *view elements* (in XML) are a visibility feature, users
  outside the group will not be able to see the element or its content
  in the form but they will otherwise be able to interact with the
  object (including that field).

  Example: [only managers have an immediate filter to see their teams\'
  leaves](https://github.com/odoo/odoo/blob/8e19904bcaff8300803a7b596c02ec45fcf36ae6/addons/hr_holidays/report/hr_leave_reports.xml#L16).

- Groups on menus and actions are visibility features, the menu or
  action will not be shown in the interface but that doesn\'t prevent
  directly interacting with the underlying object.

  Example: [only system administrators can see the elearning settings
  menu](https://github.com/odoo/odoo/blob/ff828a3e0c5386dc54e6a46fd71de9272ef3b691/addons/website_slides/views/website_slides_menu_views.xml#L64-L69).

::: exercise
Real Estate agents can not add property types or tags, but can see their
options from the Property form view when creating it.

The Settings menu just adds noise to their interface, make it only
visible to managers.
:::

Despite not having access to the Property Types and Property Tags menus
anymore, agents can still access the underlying objects since they can
still select tags or a type to set on their properties.

[^1]: An Odoo Application is a group of related modules covering a
    business area or field, usually composed of a base module and a
    number of expansions on that base to add optional or specific
    features, or link to other business areas.

[^2]: For applications which would be used by most or every employees,
    the \"application user\" role might be done away with and its
    abilities granted to all employees directly e.g. generally all
    employees can submit expenses or take time off.




--- SOURCE: developer/tutorials/unit_tests.md ---

# Safeguard your code with unit tests

:::: important
::: title
Important
:::

This tutorial is an extension of the `getting_started`{.interpreted-text
role="doc"} tutorial. Make sure you have completed it and use the
[estate]{.title-ref} module you have built as a base for the exercises
in this tutorial. Fetch the branch [{BRANCH}-core]{.title-ref} from the
[technical-training-solutions](https://github.com/odoo/technical-training-solutions/tree/{BRANCH}-core)
repository if you want to start from a clean base.
::::

**Reference**: [Odoo\'s Test Framework: Learn Best
Practices](https://www.youtube.com/watch?v=JEIscps0OOQ) (Odoo Experience
2020) on YouTube.

Writing tests is a necessity for multiple reasons. Here is a
non-exhaustive list:

- Ensure code will not be broken in the future
- Define the scope of your code
- Give examples of use cases
- It is one way to technically document the code
- Help your coding by defining your goal before working towards it

## Running Tests

Before knowing how to write tests, we need to know how to run them.

``` console
$ odoo-bin -h
Usage: odoo-bin [options]

Options:
--version             show program's version number and exit
-h, --help            show this help message and exit

[...]

Testing Configuration:
  --test-file=TEST_FILE
                      Launch a python test file.
  --test-enable       Enable unit tests.
  --test-tags=TEST_TAGS
                      Comma-separated list of specs to filter which tests to
                      execute. Enable unit tests if set. A filter spec has
                      the format: [-][tag][/module][:class][.method] The '-'
                      specifies if we want to include or exclude tests
                      matching this spec. The tag will match tags added on a
                      class with a @tagged decorator (all Test classes have
                      'standard' and 'at_install' tags until explicitly
                      removed, see the decorator documentation). '*' will
                      match all tags. If tag is omitted on include mode, its
                      value is 'standard'. If tag is omitted on exclude
                      mode, its value is '*'. The module, class, and method
                      will respectively match the module name, test class
                      name and test method name. Example: --test-tags
                      :TestClass.test_func,/test_module,external  Filtering
                      and executing the tests happens twice: right after
                      each module installation/update and at the end of the
                      modules loading. At each stage tests are filtered by
                      --test-tags specs and additionally by dynamic specs
                      'at_install' and 'post_install' correspondingly.
  --screencasts=DIR   Screencasts will go in DIR/{db_name}/screencasts.
  --screenshots=DIR   Screenshots will go in DIR/{db_name}/screenshots.
                      Defaults to /tmp/odoo_tests.

$ # run all the tests of account, and modules installed by account
$ # the dependencies already installed are not tested
$ # this takes some time because you need to install the modules, but at_install
$ # and post_install are respected
$ odoo-bin -i account --test-enable
$ # run all the tests in this file
$ odoo-bin --test-file=addons/account/tests/test_account_move_entry.py
$ # test tags can help you filter quite easily
$ odoo-bin --test-tags=/account:TestAccountMove.test_custom_currency_on_account_1
```

## Integration Bots

:::: note
::: title
Note
:::

This section is only for Odoo employees and people that are contributing
to [github.com/odoo]{.title-ref}. We highly recommend having your own CI
otherwise.
::::

When a test is written, it is important to make sure it always passes
when modifications are applied to the source code. To automate this
task, we use a development practice called Continuous Integration (CI).
This is why we have some bots running all the tests at different
moments. Whether you are working at Odoo or not, if you are trying to
merge something inside [odoo/odoo]{.title-ref},
[odoo/enterprise]{.title-ref}, [odoo/upgrade]{.title-ref} or on odoo.sh,
you will have to go through the CI. If you are working on another
project, you should think of adding your own CI.

### Runbot

**Reference**: the documentation related to this topic can be found in
[Runbot FAQ](https://runbot.odoo.com/doc).

Most of the tests are run on [Runbot](https://runbot.odoo.com) every
time a commit is pushed on GitHub.

You can see the state of a commit/branch by filtering on the runbot
dashboard.

A **bundle** is created for each branch. A bundle consists of a
configuration and batches.

A **batch** is a set of builds, depending on the parameters of the
bundle. A batch is green (i.e. passes the tests) if all the builds are
green.

A **build** is when we launch a server. It can be divided in sub-builds.
Usually there are builds for the community version, the enterprise
version (only if there is an enterprise branch but you can force the
build), and the migration of the branch. A build is green if every
sub-build is green.

A **sub-build** only does some parts of what a full build does. It is
used to speed up the CI process. Generally it is used to split the post
install tests in 4 parallel instances. A sub-build is green if all the
tests are passing and there are no errors/warnings logged.

:::: note
::: title
Note
:::

\* All tests are run regardless of the modifications done. Correcting a
typo in an error message or refactoring a whole module triggers the same
tests. All modules will be installed as well. This means something might
not work even if the Runbot is green, i.e. your changes depend on a
module that the module the changes are in doesn\'t depend on. \* The
localization modules (i.e. country-specific modules) are not installed
on Runbot (except the generic one). Some modules with external
dependencies can also be excluded. \* There is a nightly build running
additional tests: module operations, localization, single module
installs, multi-builds for nondeterministic bugs, etc. These are not
kept in the standard CI to shorten the time of execution.
::::

You can also login to a build built by Runbot. There are 3 users usable:
[admin]{.title-ref}, [demo]{.title-ref} and [portal]{.title-ref}. The
password is the same as the login. This is useful to quickly test things
on different versions without having to build it locally. The full logs
are also available; these are used for monitoring.

### Robodoo

You will most likely have to gain a little bit more experience before
having the rights to summon robodoo, but here are a few remarks anyways.

Robodoo is the guy spamming the CI status as tags on your PRs, but he is
also the guy that kindly integrates your commits into the main
repositories.

When the last batch is green, the reviewer can ask robodoo to merge your
PR (it is more a [rebase]{.title-ref} than a [merge]{.title-ref}). It
will then go to the mergebot.

### Mergebot

[Mergebot](https://mergebot.odoo.com) is the last testing phase before
merging a PR.

It will take the commits in your branch not yet present on the target,
stage it and rerun the tests one more time, including the enterprise
version even if you are only changing something in community.

This step can fail with a [Staging failed]{.title-ref} error message.
This could be due to

- a nondeterministic bug that is already on the target. If you are an
  Odoo employee, you can check those here:
  <https://runbot.odoo.com/runbot/errors>
- a nondeterministic bug that you introduced but wasn\'t detected in the
  CI before
- an incompatibility with another commit merged right before and what
  you are trying to merge
- an incompatibility with the enterprise repository if you only did
  changes in the community repo

Always check that the issue does not come from you before asking the
merge bot to retry: rebase your branch on the target and rerun the tests
locally.

## Modules

Because Odoo is modular, the tests need to be also modular. This means
tests are defined in the module that adds the functionality you are
adding in, and tests cannot depend on functionality coming from modules
your module doesn\'t depend on.

**Reference**: the documentation related to this topic can be found in
`Special Tags<reference/testing/tags>`{.interpreted-text role="ref"}.

``` python
from odoo.tests.common import TransactionCase
from odoo.tests import tagged

# The CI will run these tests after all the modules are installed,
# not right after installing the one defining it.
@tagged('post_install', '-at_install')  # add `post_install` and remove `at_install`
class PostInstallTestCase(TransactionCase):
    def test_01(self):
        ...

@tagged('at_install')  # this is the default
class AtInstallTestCase(TransactionCase):
    def test_01(self):
        ...
```

If the behavior you want to test can be changed by the installation of
another module, you need to ensure that the tag [at_install]{.title-ref}
is set; otherwise, you can use the tag [post_install]{.title-ref} to
speed up the CI and ensure it is not changed if it shouldn\'t.

## Writing a test

**Reference**: the documentation related to this topic can be found in
[Python unittest](https://docs.python.org/3/library/unittest.html) and
`Testing Odoo<reference/testing>`{.interpreted-text role="ref"}.

Here are a few things to take into consideration before writing a test

- The tests should be independent of the data currently in the database
  (including demo data)
- Tests should not impact the database by leaving/changing residual
  data. This is usually done by the test framework by doing a rollback.
  Therefore, you must never call `cr.commit` in a test (nor anywhere
  else in the business code).
- For a bug fix, the test should fail before applying the fix and pass
  after.
- Don\'t test something that is already tested elsewhere; you can trust
  the ORM. Most of the tests in business modules should only test the
  business flows.
- You shouldn\'t need to flush data into the database.

:::: note
::: title
Note
:::

Remember that `onchange` only applies in the Form views, not by changing
the attributes in python. This also applies in the tests. If you want to
emulate a Form view, you can use `odoo.tests.common.Form`.
::::

The tests should be in a `tests` folder at the root of your module. Each
test file name should start with [test\_]{.title-ref} and be imported in
the `__init__.py` of the test folder. You shouldn\'t import the test
folder/module in the `__init__.py` of the module.

``` bash
estate
├── models
│   ├── *.py
│   └── __init__.py
├── tests
│   ├── test_*.py
│   └── __init__.py
├── __init__.py
└── __manifest__.py
```

All the tests should extend `odoo.tests.common.TransactionCase`. You
usually define a `setUpClass` and the tests. After writing the
[setUpClass]{.title-ref}, you have an [env]{.title-ref} available in the
class and can start interacting with the ORM.

These test classes are built on top of the `unittest` python module.

``` python
from odoo.tests.common import TransactionCase
from odoo.exceptions import UserError
from odoo.tests import tagged

# The CI will run these tests after all the modules are installed,
# not right after installing the one defining it.
@tagged('post_install', '-at_install')
class EstateTestCase(TransactionCase):

    @classmethod
    def setUpClass(cls):
        # add env on cls and many other things
        super(EstateTestCase, cls).setUpClass()

        # create the data for each tests. By doing it in the setUpClass instead
        # of in a setUp or in each test case, we reduce the testing time and
        # the duplication of code.
        cls.properties = cls.env['estate.property'].create([...])

    def test_creation_area(self):
        """Test that the total_area is computed like it should."""
        self.properties.living_area = 20
        self.assertRecordValues(self.properties, [
           {'name': ..., 'total_area': ...},
           {'name': ..., 'total_area': ...},
        ])


    def test_action_sell(self):
        """Test that everything behaves like it should when selling a property."""
        self.properties.action_sold()
        self.assertRecordValues(self.properties, [
           {'name': ..., 'state': ...},
           {'name': ..., 'state': ...},
        ])

        with self.assertRaises(UserError):
            self.properties.forbidden_action_on_sold_property()
```

:::: note
::: title
Note
:::

For better readability, split your tests into multiple files depending
on the scope of the tests. You can also have a Common class that most of
the tests should inherit from; this common class can define the whole
setup for the module. For instance, in
[account]({GITHUB_PATH}/addons/account/tests/common.py).
::::

::: exercise
Update the code so no one can:

- Create an offer for a sold property
- Sell a property with no accepted offers on it

and create tests for both of these cases. Additionally check that
selling a property that can be sold is correctly marked as sold after
selling it.
:::

::::: exercise
Someone keeps breaking the reset of Garden Area and Orientation when you
uncheck the Garden checkbox. Make sure it doesn\'t happen again.

:::: tip
::: title
Tip
:::

Tip: remember the note about [Form]{.title-ref} a little bit above.
::::
:::::




--- SOURCE: developer/tutorials/web.md ---

orphan

:   

# Customizing the web client

:::: danger
::: title
Danger
:::

This tutorial is outdated.
::::

::: default-domain
js
:::

This guide is about creating modules for Odoo\'s web client.

To create websites with Odoo, see `website_theme`{.interpreted-text
role="doc"}; to add business capabilities or extend existing business
systems of Odoo, see `backend`{.interpreted-text role="doc"}.

:::: warning
::: title
Warning
:::

This guide assumes knowledge of:

- Javascript basics and good practices
- [jQuery](http://jquery.org)
- [Underscore.js](http://underscorejs.org)

It also requires
`an installed Odoo </administration/on_premise>`{.interpreted-text
role="doc"}, and [Git](http://git-scm.com).
::::

## A Simple Module

Let\'s start with a simple Odoo module holding basic web component
configuration and letting us test the web framework.

The example module is available online and can be downloaded using the
following command:

``` console
$ git clone http://github.com/odoo/petstore
```

This will create a `petstore` folder wherever you executed the command.
You then need to add that folder to Odoo\'s
`addons path <odoo-bin --addons-path>`{.interpreted-text role="option"},
create a new database and install the `oepetstore` module.

If you browse the `petstore` folder, you should see the following
content:

``` text
oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __manifest__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
```

The module already holds various server customizations. We\'ll come back
to these later, for now let\'s focus on the web-related content, in the
`static` folder.

Files used in the \"web\" side of an Odoo module must be placed in a
`static` folder so they are available to a web browser, files outside
that folder can not be fetched by browsers. The `src/css`, `src/js` and
`src/xml` sub-folders are conventional and not strictly necessary.

`oepetstore/static/css/petstore.css`

:   Currently empty, will hold the
    [CSS](http://www.w3.org/Style/CSS/Overview.en.html) for pet store
    content

`oepetstore/static/xml/petstore.xml`

:   Mostly empty, will hold `reference/qweb`{.interpreted-text
    role="ref"} templates

`oepetstore/static/js/petstore.js`

:   The most important (and interesting) part, contains the logic of the
    application (or at least its web-browser side) as javascript. It
    should currently look like:

    ``` javascript
    odoo.oepetstore = function(instance, local) {
        var _t = instance.web._t,
            _lt = instance.web._lt;
        var QWeb = instance.web.qweb;

        local.HomePage = instance.Widget.extend({
            start: function() {
                console.log("pet store home page loaded");
            },
        });

        instance.web.client_actions.add(
            'petstore.homepage', 'instance.oepetstore.HomePage');
    }
    ```

Which only prints a small message in the browser\'s console.

The files in the `static` folder, need to be defined within the module
in order for them to be loaded correctly. Everything in `src/xml` is
defined in `__manifest__.py` while the contents of `src/css` and
`src/js` are defined in `petstore.xml`, or a similar file.

:::: warning
::: title
Warning
:::

All JavaScript files are concatenated and `minified`{.interpreted-text
role="term"} to improve application load time.

One of the drawback is debugging becomes more difficult as individual
files disappear and the code is made significantly less readable. It is
possible to disable this process by enabling the \"developer mode\": log
into your Odoo instance (user *admin* password *admin* by default) open
the user menu (in the top-right corner of the Odoo screen) and select
`About Odoo`{.interpreted-text role="guilabel"} then `Activate
the developer mode`{.interpreted-text role="guilabel"}:

![image](web/about_odoo.png){.align-center}

![image](web/devmode.png){.align-center}

This will reload the web client with optimizations disabled, making
development and debugging significantly more comfortable.
::::

::: todo
qweb files hooked via \_\_manifest\_\_.py, but js and CSS use bundles
:::

## Odoo JavaScript Module

Javascript doesn\'t have built-in modules. As a result variables defined
in different files are all mashed together and may conflict. This has
given rise to various module patterns used to build clean namespaces and
limit risks of naming conflicts.

The Odoo framework uses one such pattern to define modules within web
addons, in order to both namespace code and correctly order its loading.

`oepetstore/static/js/petstore.js` contains a module declaration:

``` javascript
odoo.oepetstore = function(instance, local) {
    local.xxx = ...;
}
```

In Odoo web, modules are declared as functions set on the global `odoo`
variable. The function\'s name must be the same as the addon (in this
case `oepetstore`) so the framework can find it, and automatically
initialize it.

When the web client loads your module it will call the root function and
provide two parameters:

- the first parameter is the current instance of the Odoo web client, it
  gives access to various capabilities defined by the Odoo
  (translations, network services) as well as objects defined by the
  core or by other modules.
- the second parameter is your own local namespace automatically created
  by the web client. Objects and variables which should be accessible
  from outside your module (either because the Odoo web client needs to
  call them or because others may want to customize them) should be set
  inside that namespace.

## Classes

Much as modules, and contrary to most object-oriented languages,
javascript does not build in *classes*[^1] although it provides roughly
equivalent (if lower-level and more verbose) mechanisms.

For simplicity and developer-friendliness Odoo web provides a class
system based on John Resig\'s [Simple JavaScript
Inheritance](http://ejohn.org/blog/simple-javascript-inheritance/).

New classes are defined by calling the
`~odoo.web.Class.extend`{.interpreted-text role="func"} method of
`odoo.web.Class`{.interpreted-text role="class"}:

``` javascript
var MyClass = instance.web.Class.extend({
    say_hello: function() {
        console.log("hello");
    },
});
```

The `~odoo.web.Class.extend`{.interpreted-text role="func"} method takes
a dictionary describing the new class\'s content (methods and static
attributes). In this case, it will only have a `say_hello` method which
takes no parameters.

Classes are instantiated using the `new` operator:

``` javascript
var my_object = new MyClass();
my_object.say_hello();
// print "hello" in the console
```

And attributes of the instance can be accessed via `this`:

``` javascript
var MyClass = instance.web.Class.extend({
    say_hello: function() {
        console.log("hello", this.name);
    },
});

var my_object = new MyClass();
my_object.name = "Bob";
my_object.say_hello();
// print "hello Bob" in the console
```

Classes can provide an initializer to perform the initial setup of the
instance, by defining an `init()` method. The initializer receives the
parameters passed when using the `new` operator:

``` javascript
var MyClass = instance.web.Class.extend({
    init: function(name) {
        this.name = name;
    },
    say_hello: function() {
        console.log("hello", this.name);
    },
});

var my_object = new MyClass("Bob");
my_object.say_hello();
// print "hello Bob" in the console
```

It is also possible to create subclasses from existing (used-defined)
classes by calling `~odoo.web.Class.extend`{.interpreted-text
role="func"} on the parent class, as is done to subclass
`~odoo.web.Class`{.interpreted-text role="class"}:

``` javascript
var MySpanishClass = MyClass.extend({
    say_hello: function() {
        console.log("hola", this.name);
    },
});

var my_object = new MySpanishClass("Bob");
my_object.say_hello();
// print "hola Bob" in the console
```

When overriding a method using inheritance, you can use `this._super()`
to call the original method:

``` javascript
var MySpanishClass = MyClass.extend({
    say_hello: function() {
        this._super();
        console.log("translation in Spanish: hola", this.name);
    },
});

var my_object = new MySpanishClass("Bob");
my_object.say_hello();
// print "hello Bob \n translation in Spanish: hola Bob" in the console
```

:::: warning
::: title
Warning
:::

`_super` is not a standard method, it is set on-the-fly to the next
method in the current inheritance chain, if any. It is only defined
during the *synchronous* part of a method call, for use in asynchronous
handlers (after network calls or in `setTimeout` callbacks) a reference
to its value should be retained, it should not be accessed via `this`:

``` javascript
// broken, will generate an error
say_hello: function () {
    setTimeout(function () {
        this._super();
    }.bind(this), 0);
}

// correct
say_hello: function () {
    // don't forget .bind()
    var _super = this._super.bind(this);
    setTimeout(function () {
        _super();
    }.bind(this), 0);
}
```
::::

## Widgets Basics

The Odoo web client bundles [jQuery](http://jquery.org) for easy DOM
manipulation. It is useful and provides a better API than standard [W3C
DOM](http://www.w3.org/TR/DOM-Level-3-Core/)[^2], but insufficient to
structure complex applications leading to difficult maintenance.

Much like object-oriented desktop UI toolkits (e.g.
[Qt](http://qt-project.org),
[Cocoa](https://developer.apple.com/technologies/mac/cocoa.html) or
[GTK](http://www.gtk.org)), Odoo Web makes specific components
responsible for sections of a page. In Odoo web, the base for such
components is the `~odoo.Widget`{.interpreted-text role="class"} class,
a component specialized in handling a page section and displaying
information for the user.

### Your First Widget

The initial demonstration module already provides a basic widget:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        console.log("pet store home page loaded");
    },
});
```

It extends `~odoo.Widget`{.interpreted-text role="class"} and overrides
the standard method `~odoo.Widget.start`{.interpreted-text role="func"},
which --- much like the previous `MyClass` --- does little for now.

This line at the end of the file:

``` javascript
instance.web.client_actions.add(
    'petstore.homepage', 'instance.oepetstore.HomePage');
```

registers our basic widget as a client action. Client actions will be
explained later, for now this is just what allows our widget to be
called and displayed when we select the
`Pet Store --> Pet Store --> Home Page`{.interpreted-text
role="menuselection"} menu.

:::: warning
::: title
Warning
:::

because the widget will be called from outside our module, the web
client needs its \"fully qualified\" name, not the local version.
::::

### Display Content

Widgets have a number of methods and features, but the basics are
simple:

- set up a widget
- format the widget\'s data
- display the widget

The `HomePage` widget already has a
`~odoo.Widget.start`{.interpreted-text role="func"} method. That method
is part of the normal widget lifecycle and automatically called once the
widget is inserted in the page. We can use it to display some content.

All widgets have a `~odoo.Widget.$el`{.interpreted-text role="attr"}
which represents the section of page they\'re in charge of (as a
[jQuery](http://jquery.org) object). Widget content should be inserted
there. By default, `~odoo.Widget.$el`{.interpreted-text role="attr"} is
an empty `<div>` element.

A `<div>` element is usually invisible to the user if it has no content
(or without specific styles giving it a size) which is why nothing is
displayed on the page when `HomePage` is launched.

Let\'s add some content to the widget\'s root element, using jQuery:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        this.$el.append("<div>Hello dear Odoo user!</div>");
    },
});
```

That message will now appear when you open `Pet Store
--> Pet Store --> Home Page`{.interpreted-text role="menuselection"}

:::: note
::: title
Note
:::

to refresh the javascript code loaded in Odoo Web, you will need to
reload the page. There is no need to restart the Odoo server.
::::

The `HomePage` widget is used by Odoo Web and managed automatically. To
learn how to use a widget \"from scratch\" let\'s create a new one:

``` javascript
local.GreetingsWidget = instance.Widget.extend({
    start: function() {
        this.$el.append("<div>We are so happy to see you again in this menu!</div>");
    },
});
```

We can now add our `GreetingsWidget` to the `HomePage` by using the
`GreetingsWidget`\'s `~odoo.Widget.appendTo`{.interpreted-text
role="func"} method:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        this.$el.append("<div>Hello dear Odoo user!</div>");
        var greeting = new local.GreetingsWidget(this);
        return greeting.appendTo(this.$el);
    },
});
```

- `HomePage` first adds its own content to its DOM root
- `HomePage` then instantiates `GreetingsWidget`
- Finally it tells `GreetingsWidget` where to insert itself, delegating
  part of its `~odoo.Widget.$el`{.interpreted-text role="attr"} to the
  `GreetingsWidget`.

When the `~odoo.Widget.appendTo`{.interpreted-text role="func"} method
is called, it asks the widget to insert itself at the specified position
and to display its content. The `~odoo.Widget.start`{.interpreted-text
role="func"} method will be called during the call to
`~odoo.Widget.appendTo`{.interpreted-text role="func"}.

To see what happens under the displayed interface, we will use the
browser\'s DOM Explorer. But first let\'s alter our widgets slightly so
we can more easily find where they are, by
`adding a class to their root elements
<odoo.Widget.className>`{.interpreted-text role="attr"}:

``` javascript
local.HomePage = instance.Widget.extend({
    className: 'oe_petstore_homepage',
    ...
});
local.GreetingsWidget = instance.Widget.extend({
    className: 'oe_petstore_greetings',
    ...
});
```

If you can find the relevant section of the DOM (right-click on the text
then `Inspect Element`{.interpreted-text role="guilabel"}), it should
look like this:

``` html
<div class="oe_petstore_homepage">
    <div>Hello dear Odoo user!</div>
    <div class="oe_petstore_greetings">
        <div>We are so happy to see you again in this menu!</div>
    </div>
</div>
```

Which clearly shows the two `<div>` elements automatically created by
`~odoo.Widget`{.interpreted-text role="class"}, because we added some
classes on them.

We can also see the two message-holding divs we added ourselves

Finally, note the `<div class="oe_petstore_greetings">` element which
represents the `GreetingsWidget` instance is *inside* the
`<div class="oe_petstore_homepage">` which represents the `HomePage`
instance, since we appended

### Widget Parents and Children

In the previous part, we instantiated a widget using this syntax:

``` javascript
new local.GreetingsWidget(this);
```

The first argument is `this`, which in that case was a `HomePage`
instance. This tells the widget being created which other widget is its
*parent*.

As we\'ve seen, widgets are usually inserted in the DOM by another
widget and *inside* that other widget\'s root element. This means most
widgets are \"part\" of another widget, and exist on behalf of it. We
call the container the *parent*, and the contained widget the *child*.

Due to multiple technical and conceptual reasons, it is necessary for a
widget to know who is its parent and who are its children.

`~odoo.Widget.getParent`{.interpreted-text role="func"}

:   can be used to get the parent of a widget:

    ``` javascript
    local.GreetingsWidget = instance.Widget.extend({
        start: function() {
            console.log(this.getParent().$el );
            // will print "div.oe_petstore_homepage" in the console
        },
    });
    ```

`~odoo.Widget.getChildren`{.interpreted-text role="func"}

:   can be used to get a list of its children:

    ``` javascript
    local.HomePage = instance.Widget.extend({
        start: function() {
            var greeting = new local.GreetingsWidget(this);
            greeting.appendTo(this.$el);
            console.log(this.getChildren()[0].$el);
            // will print "div.oe_petstore_greetings" in the console
        },
    });
    ```

When overriding the `~odoo.Widget.init`{.interpreted-text role="func"}
method of a widget it is *of the utmost importance* to pass the parent
to the `this._super()` call, otherwise the relation will not be set up
correctly:

``` javascript
local.GreetingsWidget = instance.Widget.extend({
    init: function(parent, name) {
        this._super(parent);
        this.name = name;
    },
});
```

Finally, if a widget does not have a parent (e.g. because it\'s the root
widget of the application), `null` can be provided as parent:

``` javascript
new local.GreetingsWidget(null);
```

### Destroying Widgets

If you can display content to your users, you should also be able to
erase it. This is done via the `~odoo.Widget.destroy`{.interpreted-text
role="func"} method:

``` javascript
greeting.destroy();
```

When a widget is destroyed it will first call
`~odoo.Widget.destroy`{.interpreted-text role="func"} on all its
children. Then it erases itself from the DOM. If you have set up
permanent structures in `~odoo.Widget.init`{.interpreted-text
role="func"} or `~odoo.Widget.start`{.interpreted-text role="func"}
which must be explicitly cleaned up (because the garbage collector will
not handle them), you can override
`~odoo.Widget.destroy`{.interpreted-text role="func"}.

:::: danger
::: title
Danger
:::

when overriding `~odoo.Widget.destroy`{.interpreted-text role="func"},
`_super()` *must always* be called otherwise the widget and its children
are not correctly cleaned up leaving possible memory leaks and \"phantom
events\", even if no error is displayed
::::

## The QWeb Template Engine

In the previous section we added content to our widgets by directly
manipulating (and adding to) their DOM:

``` javascript
this.$el.append("<div>Hello dear Odoo user!</div>");
```

This allows generating and displaying any type of content, but gets
unwieldy when generating significant amounts of DOM (lots of
duplication, quoting issues, \...)

As many other environments, Odoo\'s solution is to use a [template
engine](http://en.wikipedia.org/wiki/Web_template_system). Odoo\'s
template engine is called `reference/qweb`{.interpreted-text
role="ref"}.

QWeb is an XML-based templating language, similar to
[Genshi](http://en.wikipedia.org/wiki/Genshi_(templating_language)),
[Thymeleaf](http://en.wikipedia.org/wiki/Thymeleaf) or
[Facelets](http://en.wikipedia.org/wiki/Facelets). It has the following
characteristics:

- It\'s implemented fully in JavaScript and rendered in the browser
- Each template file (XML files) contains multiple templates
- It has special support in Odoo Web\'s `~odoo.Widget`{.interpreted-text
  role="class"}, though it can be used outside of Odoo\'s web client
  (and it\'s possible to use `~odoo.Widget`{.interpreted-text
  role="class"} without relying on QWeb)

:::: note
::: title
Note
:::

The rationale behind using QWeb instead of existing javascript template
engines is the extensibility of pre-existing (third-party) templates,
much like Odoo `views <reference/views>`{.interpreted-text role="ref"}.

Most javascript template engines are text-based which precludes easy
structural extensibility where an XML-based templating engine can be
generically altered using e.g. XPath or CSS and a tree-alteration DSL
(or even just XSLT). This flexibility and extensibility is a core
characteristic of Odoo, and losing it was considered unacceptable.
::::

### Using QWeb

First let\'s define a simple QWeb template in the almost-empty
`oepetstore/static/src/xml/petstore.xml` file:

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="HomePageTemplate">
        <div style="background-color: red;">This is some simple HTML</div>
    </t>
</templates>
```

Now we can use this template inside of the `HomePage` widget. Using the
`QWeb` loader variable defined at the top of the page, we can call to
the template defined in the XML file:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        this.$el.append(QWeb.render("HomePageTemplate"));
    },
});
```

`QWeb.render`{.interpreted-text role="func"} looks for the specified
template, renders it to a string and returns the result.

However, because `~odoo.Widget`{.interpreted-text role="class"} has
special integration for QWeb the template can be set directly on the
widget via its `~odoo.Widget.template`{.interpreted-text role="attr"}
attribute:

``` javascript
local.HomePage = instance.Widget.extend({
    template: "HomePageTemplate",
    start: function() {
        ...
    },
});
```

Although the result looks similar, there are two differences between
these usages:

- with the second version, the template is rendered right before
  `~odoo.Widget.start`{.interpreted-text role="func"} is called
- in the first version the template\'s content is added to the widget\'s
  root element, whereas in the second version the template\'s root
  element is directly *set as* the widget\'s root element. Which is why
  the \"greetings\" sub-widget also gets a red background

:::: warning
::: title
Warning
:::

templates should have a single non-`t` root element, especially if
they\'re set as a widget\'s `~odoo.Widget.template`{.interpreted-text
role="attr"}. If there are multiple \"root elements\", results are
undefined (usually only the first root element will be used and the
others will be ignored)
::::

#### QWeb Context

QWeb templates can be given data and can contain basic display logic.

For explicit calls to `QWeb.render`{.interpreted-text role="func"}, the
template data is passed as second parameter:

``` javascript
QWeb.render("HomePageTemplate", {name: "Klaus"});
```

with the template modified to:

``` xml
<t t-name="HomePageTemplate">
    <div>Hello <t t-esc="name"/></div>
</t>
```

will result in:

``` html
<div>Hello Klaus</div>
```

When using `~odoo.Widget`{.interpreted-text role="class"}\'s integration
it is not possible to provide additional data to the template. The
template will be given a single `widget` context variable, referencing
the widget being rendered right before
`~odoo.Widget.start`{.interpreted-text role="func"} is called (the
widget\'s state will essentially be that set up by
`~odoo.Widget.init`{.interpreted-text role="func"}):

``` xml
<t t-name="HomePageTemplate">
    <div>Hello <t t-esc="widget.name"/></div>
</t>
```

``` javascript
local.HomePage = instance.Widget.extend({
    template: "HomePageTemplate",
    init: function(parent) {
        this._super(parent);
        this.name = "Mordecai";
    },
    start: function() {
    },
});
```

Result:

``` html
<div>Hello Mordecai</div>
```

#### Template Declaration

We\'ve seen how to *render* QWeb templates, let\'s now see the syntax of
the templates themselves.

A QWeb template is composed of regular XML mixed with QWeb *directives*.
A QWeb directive is declared with XML attributes starting with `t-`.

The most basic directive is `t-name`, used to declare new templates in a
template file:

``` xml
<templates>
    <t t-name="HomePageTemplate">
        <div>This is some simple HTML</div>
    </t>
</templates>
```

`t-name` takes the name of the template being defined, and declares that
it can be called using `QWeb.render`{.interpreted-text role="func"}. It
can only be used at the top-level of a template file.

#### Escaping

The `t-esc` directive can be used to output text:

``` xml
<div>Hello <t t-esc="name"/></div>
```

It takes a Javascript expression which is evaluated, the result of the
expression is then HTML-escaped and inserted in the document. Since
it\'s an expression it\'s possible to provide just a variable name as
above, or a more complex expression like a computation:

``` xml
<div><t t-esc="3+5"/></div>
```

or method calls:

``` xml
<div><t t-esc="name.toUpperCase()"/></div>
```

#### Outputting HTML

To inject HTML in the page being rendered, use `t-raw`. Like `t-esc` it
takes an arbitrary Javascript expression as parameter, but it does not
perform an HTML-escape step.

``` xml
<div><t t-raw="name.link(user_account)"/></div>
```

:::: danger
::: title
Danger
:::

`t-raw` *must not* be used on any data which may contain non-escaped
user-provided content as this leads to [cross-site
scripting](http://en.wikipedia.org/wiki/Cross-site_scripting)
vulnerabilities
::::

#### Conditionals

QWeb can have conditional blocks using `t-if`. The directive takes an
arbitrary expression, if the expression is falsy (`false`, `null`, `0`
or an empty string) the whole block is suppressed, otherwise it is
displayed.

``` xml
<div>
    <t t-if="true == true">
        true is true
    </t>
    <t t-if="true == false">
        true is not true
    </t>
</div>
```

:::: note
::: title
Note
:::

QWeb doesn\'t have an \"else\" structure, use a second `t-if` with the
original condition inverted. You may want to store the condition in a
local variable if it\'s a complex or expensive expression.
::::

#### Iteration

To iterate on a list, use `t-foreach` and `t-as`. `t-foreach` takes an
expression returning a list to iterate on `t-as` takes a variable name
to bind to each item during iteration.

``` xml
<div>
    <t t-foreach="names" t-as="name">
        <div>
            Hello <t t-esc="name"/>
        </div>
    </t>
</div>
```

:::: note
::: title
Note
:::

`t-foreach` can also be used with numbers and objects (dictionaries)
::::

#### Defining attributes

QWeb provides two related directives to define computed attributes:
`t-att-{name}`{.interpreted-text role="samp"} and
`t-attf-{name}`{.interpreted-text role="samp"}. In either case, *name*
is the name of the attribute to create (e.g. `t-att-id` defines the
attribute `id` after rendering).

`t-att-` takes a javascript expression whose result is set as the
attribute\'s value, it is most useful if all of the attribute\'s value
is computed:

``` xml
<div>
    Input your name:
    <input type="text" t-att-value="defaultName"/>
</div>
```

`t-attf-` takes a *format string*. A format string is literal text with
interpolation blocks inside, an interpolation block is a javascript
expression between `{{` and `}}`, which will be replaced by the result
of the expression. It is most useful for attributes which are partially
literal and partially computed such as a class:

``` xml
<div t-attf-class="container {{ left ? 'text-left' : '' }} {{ extra_class }}">
    insert content here
</div>
```

#### Calling other templates

Templates can be split into sub-templates (for simplicity,
maintainability, reusability or to avoid excessive markup nesting).

This is done using the `t-call` directive, which takes the name of the
template to render:

``` xml
<t t-name="A">
    <div class="i-am-a">
        <t t-call="B"/>
    </div>
</t>
<t t-name="B">
    <div class="i-am-b"/>
</t>
```

rendering the `A` template will result in:

``` xml
<div class="i-am-a">
    <div class="i-am-b"/>
</div>
```

Sub-templates inherit the rendering context of their caller.

#### To Learn More About QWeb

For a QWeb reference, see `reference/qweb`{.interpreted-text
role="ref"}.

#### Exercise

:::: exercise
Usage of QWeb in Widgets

Create a widget whose constructor takes two parameters aside from
`parent`: `product_names` and `color`.

- `product_names` should an array of strings, each one the name of a
  product
- `color` is a string containing a color in CSS color format (ie:
  `#000000` for black).

The widget should display the given product names one under the other,
each one in a separate box with a background color with the value of
`color` and a border. You should use QWeb to render the HTML. Any
necessary CSS should be in `oepetstore/static/src/css/petstore.css`.

Use the widget in `HomePage` with half a dozen products.

::: only
solutions

``` javascript
odoo.oepetstore = function(instance, local) {
    var _t = instance.web._t,
        _lt = instance.web._lt;
    var QWeb = instance.web.qweb;

    local.HomePage = instance.Widget.extend({
        start: function() {
            var products = new local.ProductsWidget(
                this, ["cpu", "mouse", "keyboard", "graphic card", "screen"], "#00FF00");
            products.appendTo(this.$el);
        },
    });

    local.ProductsWidget = instance.Widget.extend({
        template: "ProductsWidget",
        init: function(parent, products, color) {
            this._super(parent);
            this.products = products;
            this.color = color;
        },
    });

    instance.web.client_actions.add(
        'petstore.homepage', 'instance.oepetstore.HomePage');
}
```

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ProductsWidget">
        <div>
            <t t-foreach="widget.products" t-as="product">
                <span class="oe_products_item"
                      t-attf-style="background-color: {{ widget.color }};">
                    <t t-esc="product"/>
                </span>
                <br/>
            </t>
        </div>
    </t>
</templates>
```

``` css
.oe_products_item {
    display: inline-block;
    padding: 3px;
    margin: 5px;
    border: 1px solid black;
    border-radius: 3px;
}
```

![image](web/qweb.png){.align-center width="70.0%"}
:::
::::

## Widget Helpers

### `Widget`\'s jQuery Selector

Selecting DOM elements within a widget can be performed by calling the
`find()` method on the widget\'s DOM root:

``` javascript
this.$el.find("input.my_input")...
```

But because it\'s a common operation, `~odoo.Widget`{.interpreted-text
role="class"} provides an equivalent shortcut through the
`~odoo.Widget.$`{.interpreted-text role="func"} method:

``` javascript
local.MyWidget = instance.Widget.extend({
    start: function() {
        this.$("input.my_input")...
    },
});
```

:::: warning
::: title
Warning
:::

The global jQuery function `$()` should *never* be used unless it is
absolutely necessary: selection on a widget\'s root are scoped to the
widget and local to it, but selections with `$()` are global to the
page/application and may match parts of other widgets and views, leading
to odd or dangerous side-effects. Since a widget should generally act
only on the DOM section it owns, there is no cause for global selection.
::::

### Easier DOM Events Binding

We have previously bound DOM events using normal jQuery event handlers
(e.g. `.click()` or `.change()`) on widget elements:

``` javascript
local.MyWidget = instance.Widget.extend({
    start: function() {
        var self = this;
        this.$(".my_button").click(function() {
            self.button_clicked();
        });
    },
    button_clicked: function() {
        ..
    },
});
```

While this works it has a few issues:

1.  it is rather verbose
2.  it does not support replacing the widget\'s root element at runtime
    as the binding is only performed when `start()` is run (during
    widget initialization)
3.  it requires dealing with `this`-binding issues

Widgets thus provide a shortcut to DOM event binding via
`~odoo.Widget.events`{.interpreted-text role="attr"}:

``` javascript
local.MyWidget = instance.Widget.extend({
    events: {
        "click .my_button": "button_clicked",
    },
    button_clicked: function() {
        ..
    }
});
```

`~odoo.Widget.events`{.interpreted-text role="attr"} is an object
(mapping) of an event to the function or method to call when the event
is triggered:

- the key is an event name, possibly refined with a CSS selector in
  which case only if the event happens on a selected sub-element will
  the function or method run: `click` will handle all clicks within the
  widget, but `click .my_button` will only handle clicks in elements
  bearing the `my_button` class

- the value is the action to perform when the event is triggered

  It can be either a function:

  ``` javascript
  events: {
      'click': function (e) { /* code here */ }
  }
  ```

  or the name of a method on the object (see example above).

  In either case, the `this` is the widget instance and the handler is
  given a single parameter, the [jQuery event
  object](http://api.jquery.com/category/events/event-object/) for the
  event.

## Widget Events and Properties

### Events

Widgets provide an event system (separate from the DOM/jQuery event
system described above): a widget can fire events on itself, and other
widgets (or itself) can bind themselves and listen for these events:

``` javascript
local.ConfirmWidget = instance.Widget.extend({
    events: {
        'click button.ok_button': function () {
            this.trigger('user_chose', true);
        },
        'click button.cancel_button': function () {
            this.trigger('user_chose', false);
        }
    },
    start: function() {
        this.$el.append("<div>Are you sure you want to perform this action?</div>" +
            "<button class='ok_button'>Ok</button>" +
            "<button class='cancel_button'>Cancel</button>");
    },
});
```

This widget acts as a facade, transforming user input (through DOM
events) into a documentable internal event to which parent widgets can
bind themselves.

`~odoo.Widget.trigger`{.interpreted-text role="func"} takes the name of
the event to trigger as its first (mandatory) argument, any further
arguments are treated as event data and passed directly to listeners.

We can then set up a parent event instantiating our generic widget and
listening to the `user_chose` event using
`~odoo.Widget.on`{.interpreted-text role="func"}:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        var widget = new local.ConfirmWidget(this);
        widget.on("user_chose", this, this.user_chose);
        widget.appendTo(this.$el);
    },
    user_chose: function(confirm) {
        if (confirm) {
            console.log("The user agreed to continue");
        } else {
            console.log("The user refused to continue");
        }
    },
});
```

`~odoo.Widget.on`{.interpreted-text role="func"} binds a function to be
called when the event identified by `event_name` is. The `func` argument
is the function to call and `object` is the object to which that
function is related if it is a method. The bound function will be called
with the additional arguments of
`~odoo.Widget.trigger`{.interpreted-text role="func"} if it has any.
Example:

``` javascript
start: function() {
    var widget = ...
    widget.on("my_event", this, this.my_event_triggered);
    widget.trigger("my_event", 1, 2, 3);
},
my_event_triggered: function(a, b, c) {
    console.log(a, b, c);
    // will print "1 2 3"
}
```

:::: note
::: title
Note
:::

Triggering events on an other widget is generally a bad idea. The main
exception to that rule is `odoo.web.bus` which exists specifically to
broadcasts evens in which any widget could be interested throughout the
Odoo web application.
::::

### Properties

Properties are very similar to normal object attributes in that they
allow storing data on a widget instance, however they have the
additional feature that they trigger events when set:

``` javascript
start: function() {
    this.widget = ...
    this.widget.on("change:name", this, this.name_changed);
    this.widget.set("name", "Nicolas");
},
name_changed: function() {
    console.log("The new value of the property 'name' is", this.widget.get("name"));
}
```

- `~odoo.Widget.set`{.interpreted-text role="func"} sets the value of a
  property and triggers `change:{propname}`{.interpreted-text
  role="samp"} (where *propname* is the property name passed as first
  parameter to `~odoo.Widget.set`{.interpreted-text role="func"}) and
  `change`
- `~odoo.Widget.get`{.interpreted-text role="func"} retrieves the value
  of a property.

### Exercise

:::: exercise
Widget Properties and Events

Create a widget `ColorInputWidget` that will display 3
`<input type="text">`. Each of these `<input>` is dedicated to type a
hexadecimal number from 00 to FF. When any of these `<input>` is
modified by the user the widget must query the content of the three
`<input>`, concatenate their values to have a complete CSS color code
(ie: `#00FF00`) and put the result in a property named `color`. Please
note the jQuery `change()` event that you can bind on any HTML `<input>`
element and the `val()` method that can query the current value of that
`<input>` could be useful to you for this exercise.

Then, modify the `HomePage` widget to instantiate `ColorInputWidget` and
display it. The `HomePage` widget should also display an empty
rectangle. That rectangle must always, at any moment, have the same
background color as the color in the `color` property of the
`ColorInputWidget` instance.

Use QWeb to generate all HTML.

::: only
solutions

``` javascript
odoo.oepetstore = function(instance, local) {
    var _t = instance.web._t,
        _lt = instance.web._lt;
    var QWeb = instance.web.qweb;

    local.ColorInputWidget = instance.Widget.extend({
        template: "ColorInputWidget",
        events: {
            'change input': 'input_changed'
        },
        start: function() {
            this.input_changed();
            return this._super();
        },
        input_changed: function() {
            var color = [
                "#",
                this.$(".oe_color_red").val(),
                this.$(".oe_color_green").val(),
                this.$(".oe_color_blue").val()
            ].join('');
            this.set("color", color);
        },
    });

    local.HomePage = instance.Widget.extend({
        template: "HomePage",
        start: function() {
            this.colorInput = new local.ColorInputWidget(this);
            this.colorInput.on("change:color", this, this.color_changed);
            return this.colorInput.appendTo(this.$el);
        },
        color_changed: function() {
            this.$(".oe_color_div").css("background-color", this.colorInput.get("color"));
        },
    });

    instance.web.client_actions.add('petstore.homepage', 'instance.oepetstore.HomePage');
}
```

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ColorInputWidget">
        <div>
            Red: <input type="text" class="oe_color_red" value="00"></input><br />
            Green: <input type="text" class="oe_color_green" value="00"></input><br />
            Blue: <input type="text" class="oe_color_blue" value="00"></input><br />
        </div>
    </t>
    <t t-name="HomePage">
        <div>
            <div class="oe_color_div"></div>
        </div>
    </t>
</templates>
```

``` css
.oe_color_div {
    width: 100px;
    height: 100px;
    margin: 10px;
}
```
:::
::::

## Modify existing widgets and classes

The class system of the Odoo web framework allows direct modification of
existing classes using the `~odoo.web.Class.include`{.interpreted-text
role="func"} method:

``` javascript
var TestClass = instance.web.Class.extend({
    testMethod: function() {
        return "hello";
    },
});

TestClass.include({
    testMethod: function() {
        return this._super() + " world";
    },
});

console.log(new TestClass().testMethod());
// will print "hello world"
```

This system is similar to the inheritance mechanism, except it will
alter the target class in-place instead of creating a new class.

In that case, `this._super()` will call the original implementation of a
method being replaced/redefined. If the class already had sub-classes,
all calls to `this._super()` in sub-classes will call the new
implementations defined in the call to
`~odoo.web.Class.include`{.interpreted-text role="func"}. This will also
work if some instances of the class (or of any of its sub-classes) were
created prior to the call to `~odoo.Widget.include`{.interpreted-text
role="func"}.

## Translations

The process to translate text in Python and JavaScript code is very
similar. You could have noticed these lines at the beginning of the
`petstore.js` file:

``` javascript
var _t = instance.web._t,
    _lt = instance.web._lt;
```

These lines are simply used to import the translation functions in the
current JavaScript module. They are used thus:

``` javascript
this.$el.text(_t("Hello user!"));
```

In Odoo, translations files are automatically generated by scanning the
source code. All piece of code that calls a certain function are
detected and their content is added to a translation file that will then
be sent to the translators. In Python, the function is `_()`. In
JavaScript the function is `~odoo.web._t`{.interpreted-text role="func"}
(and also `~odoo.web._lt`{.interpreted-text role="func"}).

`_t()` will return the translation defined for the text it is given. If
no translation is defined for that text, it will return the original
text as-is.

:::: note
::: title
Note
:::

To inject user-provided values in translatable strings, it is
recommended to use
[\_.str.sprintf](http://gabceb.github.io/underscore.string.site/#sprintf)
with named arguments *after* the translation:

``` javascript
this.$el.text(_.str.sprintf(
    _t("Hello, %(user)s!"), {
    user: "Ed"
}));
```

This makes translatable strings more readable to translators, and gives
them more flexibility to reorder or ignore parameters.
::::

`~odoo.web._lt`{.interpreted-text role="func"} (\"lazy translate\") is
similar but somewhat more complex: instead of translating its parameter
immediately, it returns an object which, when converted to a string,
will perform the translation.

It is used to define translatable terms before the translations system
is initialized, for class attributes for instance (as modules are loaded
before the user\'s language is configured and translations are
downloaded).

## Communication with the Odoo Server

### Contacting Models

Most operations with Odoo involve communicating with *models*
implementing business concern, these models will then (potentially)
interact with some storage engine (usually
[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)).

Although [jQuery](http://jquery.org) provides a
[\$.ajax](http://api.jquery.com/jquery.ajax/) function for network
interactions, communicating with Odoo requires additional metadata whose
setup before every call would be verbose and error-prone. As a result,
Odoo web provides higher-level communication primitives.

To demonstrate this, the file `petstore.py` already contains a small
model with a sample method:

``` python
class message_of_the_day(models.Model):
    _name = "oepetstore.message_of_the_day"

    @api.model
    def my_method(self):
        return {"hello": "world"}

    message = fields.Text(),
    color = fields.Char(size=20),
```

This declares a model with two fields, and a method `my_method()` which
returns a literal dictionary.

Here is a sample widget that calls `my_method()` and displays the
result:

``` javascript
local.HomePage = instance.Widget.extend({
    start: function() {
        var self = this;
        var model = new instance.web.Model("oepetstore.message_of_the_day");
        model.call("my_method", {context: new instance.web.CompoundContext()}).then(function(result) {
            self.$el.append("<div>Hello " + result["hello"] + "</div>");
            // will show "Hello world" to the user
        });
    },
});
```

The class used to call Odoo models is `odoo.Model`{.interpreted-text
role="class"}. It is instantiated with the Odoo model\'s name as first
parameter (`oepetstore.message_of_the_day` here).

`~odoo.web.Model.call`{.interpreted-text role="func"} can be used to
call any (public) method of an Odoo model. It takes the following
positional arguments:

`name`

:   The name of the method to call, `my_method` here

`args`

:   an array of [positional
    arguments](https://docs.python.org/2/glossary.html#term-argument) to
    provide to the method. Because the example has no positional
    argument to provide, the `args` parameter is not provided.

    Here is an other example with positional arguments:

    ``` python
    @api.model
    def my_method2(self, a, b, c): ...
    ```

    ``` javascript
    model.call("my_method", [1, 2, 3], ...
    // with this a=1, b=2 and c=3
    ```

`kwargs`

:   a mapping of [keyword
    arguments](https://docs.python.org/2/glossary.html#term-argument) to
    pass. The example provides a single named argument `context`.

    ``` python
    @api.model
    def my_method2(self, a, b, c): ...
    ```

    ``` javascript
    model.call("my_method", [], {a: 1, b: 2, c: 3, ...
    // with this a=1, b=2 and c=3
    ```

`~odoo.Widget.call`{.interpreted-text role="func"} returns a deferred
resolved with the value returned by the model\'s method as first
argument.

### CompoundContext

The previous section used a `context` argument which was not explained
in the method call:

``` javascript
model.call("my_method", {context: new instance.web.CompoundContext()})
```

The context is like a \"magic\" argument that the web client will always
give to the server when calling a method. The context is a dictionary
containing multiple keys. One of the most important key is the language
of the user, used by the server to translate all the messages of the
application. Another one is the time zone of the user, used to compute
correctly dates and times if Odoo is used by people in different
countries.

The `argument` is necessary in all methods, otherwise bad things could
happen (such as the application not being translated correctly). That\'s
why, when you call a model\'s method, you should always provide that
argument. The solution to achieve that is to use
`odoo.web.CompoundContext`{.interpreted-text role="class"}.

`~odoo.web.CompoundContext`{.interpreted-text role="class"} is a class
used to pass the user\'s context (with language, time zone, etc\...) to
the server as well as adding new keys to the context (some models\'
methods use arbitrary keys added to the context). It is created by
giving to its constructor any number of dictionaries or other
`~odoo.web.CompoundContext`{.interpreted-text role="class"} instances.
It will merge all those contexts before sending them to the server.

``` javascript
model.call("my_method", {context: new instance.web.CompoundContext({'new_key': 'key_value'})})
```

``` python
@api.model
def my_method(self):
    print(self.env.context)
    // will print: {'lang': 'en_US', 'new_key': 'key_value', 'tz': 'Europe/Brussels', 'uid': 1}
```

You can see the dictionary in the argument `context` contains some keys
that are related to the configuration of the current user in Odoo plus
the `new_key` key that was added when instantiating
`~odoo.web.CompoundContext`{.interpreted-text role="class"}.

### Queries

While `~odoo.Model.call`{.interpreted-text role="func"} is sufficient
for any interaction with Odoo models, Odoo Web provides a helper for
simpler and clearer querying of models (fetching of records based on
various conditions): `~odoo.Model.query`{.interpreted-text role="func"}
which acts as a shortcut for the common combination of
`~odoo.models.Model.search`{.interpreted-text role="py:meth"} and
`~odoo.models.Model.read`{.interpreted-text role=":py:meth"}. It
provides a clearer syntax to search and read models:

``` javascript
model.query(['name', 'login', 'user_email', 'signature'])
     .filter([['active', '=', true], ['company_id', '=', main_company]])
     .limit(15)
     .all().then(function (users) {
    // do work with users records
});
```

versus:

``` javascript
model.call('search', [['active', '=', true], ['company_id', '=', main_company]], {limit: 15})
    .then(function (ids) {
        return model.call('read', [ids, ['name', 'login', 'user_email', 'signature']]);
    })
    .then(function (users) {
        // do work with users records
    });
```

- `~odoo.web.Model.query`{.interpreted-text role="func"} takes an
  optional list of fields as parameter (if no field is provided, all
  fields of the model are fetched). It returns a
  `odoo.web.Query`{.interpreted-text role="class"} which can be further
  customized before being executed
- `~odoo.web.Query`{.interpreted-text role="class"} represents the query
  being built. It is immutable, methods to customize the query actually
  return a modified copy, so it\'s possible to use the original and the
  new version side-by-side. See `~odoo.web.Query`{.interpreted-text
  role="class"} for its customization options.

When the query is set up as desired, simply call
`~odoo.web.Query.all`{.interpreted-text role="func"} to execute it and
return a deferred to its result. The result is the same as
`~odoo.models.Model.read`{.interpreted-text role="py:meth"}\'s, an array
of dictionaries where each dictionary is a requested record, with each
requested field a dictionary key.

## Exercises

:::: exercise
Message of the Day

Create a `MessageOfTheDay` widget displaying the last record of the
`oepetstore.message_of_the_day` model. The widget should fetch its
record as soon as it is displayed.

Display the widget in the Pet Store home page.

::: only
solutions

``` javascript
odoo.oepetstore = function(instance, local) {
    var _t = instance.web._t,
        _lt = instance.web._lt;
    var QWeb = instance.web.qweb;

    local.HomePage = instance.Widget.extend({
        template: "HomePage",
        start: function() {
            return new local.MessageOfTheDay(this).appendTo(this.$el);
        },
    });

    instance.web.client_actions.add('petstore.homepage', 'instance.oepetstore.HomePage');

    local.MessageOfTheDay = instance.Widget.extend({
        template: "MessageOfTheDay",
        start: function() {
            var self = this;
            return new instance.web.Model("oepetstore.message_of_the_day")
                .query(["message"])
                .order_by('-create_date', '-id')
                .first()
                .then(function(result) {
                    self.$(".oe_mywidget_message_of_the_day").text(result.message);
                });
        },
    });

}
```

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="HomePage">
        <div class="oe_petstore_homepage">
        </div>
    </t>
    <t t-name="MessageOfTheDay">
        <div class="oe_petstore_motd">
            <p class="oe_mywidget_message_of_the_day"></p>
        </div>
    </t>
</templates>
```

``` css
.oe_petstore_motd {
    margin: 5px;
    padding: 5px;
    border-radius: 3px;
    background-color: #F0EEEE;
}
```
:::
::::

:::: exercise
Pet Toys List

Create a `PetToysList` widget displaying 5 toys (using their name and
their images).

The pet toys are not stored in a new model, instead they\'re stored in
`product.product` using a special category *Pet Toys*. You can see the
pre-generated toys and add new ones by going to
`Pet Store --> Pet Store --> Pet Toys`{.interpreted-text
role="menuselection"}. You will probably need to explore
`product.product` to create the right domain to select just pet toys.

In Odoo, images are generally stored in regular fields encoded as
[base64](http://en.wikipedia.org/wiki/Base64), HTML supports displaying
images straight from base64 with
`<img src="data:{mime_type};base64,{base64_image_data}"/>`{.interpreted-text
role="samp"}

The `PetToysList` widget should be displayed on the home page on the
right of the `MessageOfTheDay` widget. You will need to make some layout
with CSS to achieve this.

::: only
solutions

``` javascript
odoo.oepetstore = function(instance, local) {
    var _t = instance.web._t,
        _lt = instance.web._lt;
    var QWeb = instance.web.qweb;

    local.HomePage = instance.Widget.extend({
        template: "HomePage",
        start: function () {
            return Promise.all([
                new local.PetToysList(this).appendTo(this.$('.oe_petstore_homepage_left')),
                new local.MessageOfTheDay(this).appendTo(this.$('.oe_petstore_homepage_right'))
            ]);
        }
    });
    instance.web.client_actions.add('petstore.homepage', 'instance.oepetstore.HomePage');

    local.MessageOfTheDay = instance.Widget.extend({
        template: 'MessageOfTheDay',
        start: function () {
            var self = this;
            return new instance.web.Model('oepetstore.message_of_the_day')
                .query(["message"])
                .order_by('-create_date', '-id')
                .first()
                .then(function (result) {
                    self.$(".oe_mywidget_message_of_the_day").text(result.message);
                });
        }
    });

    local.PetToysList = instance.Widget.extend({
        template: 'PetToysList',
        start: function () {
            var self = this;
            return new instance.web.Model('product.product')
                .query(['name', 'image'])
                .filter([['categ_id.name', '=', "Pet Toys"]])
                .limit(5)
                .all()
                .then(function (results) {
                    _(results).each(function (item) {
                        self.$el.append(QWeb.render('PetToy', {item: item}));
                    });
                });
        }
    });
}
```

``` xml
<?xml version="1.0" encoding="UTF-8"?>

<templates xml:space="preserve">
    <t t-name="HomePage">
        <div class="oe_petstore_homepage">
            <div class="oe_petstore_homepage_left"></div>
            <div class="oe_petstore_homepage_right"></div>
        </div>
    </t>
    <t t-name="MessageOfTheDay">
        <div class="oe_petstore_motd">
            <p class="oe_mywidget_message_of_the_day"></p>
        </div>
    </t>
    <t t-name="PetToysList">
        <div class="oe_petstore_pettoyslist">
        </div>
    </t>
    <t t-name="PetToy">
        <div class="oe_petstore_pettoy">
            <p><t t-esc="item.name"/></p>
            <p><img t-att-src="'data:image/jpg;base64,'+item.image"/></p>
        </div>
    </t>
</templates>
```

``` css
.oe_petstore_homepage {
    display: table;
}

.oe_petstore_homepage_left {
    display: table-cell;
    width : 300px;
}

.oe_petstore_homepage_right {
    display: table-cell;
    width : 300px;
}

.oe_petstore_motd {
    margin: 5px;
    padding: 5px;
    border-radius: 3px;
    background-color: #F0EEEE;
}

.oe_petstore_pettoyslist {
    padding: 5px;
}

.oe_petstore_pettoy {
    margin: 5px;
    padding: 5px;
    border-radius: 3px;
    background-color: #F0EEEE;
}
```
:::
::::

## Existing web components

### The Action Manager

In Odoo, many operations start from an
`action <reference/actions>`{.interpreted-text role="ref"}: opening a
menu item (to a view), printing a report, \...

Actions are pieces of data describing how a client should react to the
activation of a piece of content. Actions can be stored (and read
through a model) or they can be generated on-the fly (locally to the
client by javascript code, or remotely by a method of a model).

In Odoo Web, the component responsible for handling and reacting to
these actions is the *Action Manager*.

#### Using the Action Manager

The action manager can be invoked explicitly from javascript code by
creating a dictionary describing
`an action <reference/actions>`{.interpreted-text role="ref"} of the
right type, and calling an action manager instance with it.

`~odoo.Widget.do_action`{.interpreted-text role="func"} is a shortcut of
`~odoo.Widget`{.interpreted-text role="class"} looking up the
\"current\" action manager and executing the action:

``` javascript
instance.web.TestWidget = instance.Widget.extend({
    dispatch_to_new_action: function() {
        this.do_action({
            type: 'ir.actions.act_window',
            res_model: "product.product",
            res_id: 1,
            views: [[false, 'form']],
            target: 'current',
            context: {},
        });
    },
});
```

The most common action `type` is `ir.actions.act_window` which provides
views to a model (displays a model in various manners), its most common
attributes are:

`res_model`

:   The model to display in views

`res_id` (optional)

:   For form views, a preselected record in `res_model`

`views`

:   Lists the views available through the action. A list of
    `[view_id, view_type]`, `view_id` can either be the database
    identifier of a view of the right type, or `false` to use the view
    by default for the specified type. View types can not be present
    multiple times. The action will open the first view of the list by
    default.

`target`

:   Either `current` (the default) which replaces the \"content\"
    section of the web client by the action, or `new` to open the action
    in a dialog box.

`context`

:   Additional context data to use within the action.

:::: exercise
Jump to Product

Modify the `PetToysList` component so clicking on a toy replaces the
homepage by the toy\'s form view.

::: only
solutions

``` javascript
local.PetToysList = instance.Widget.extend({
    template: 'PetToysList',
    events: {
        'click .oe_petstore_pettoy': 'selected_item',
    },
    start: function () {
        var self = this;
        return new instance.web.Model('product.product')
            .query(['name', 'image'])
            .filter([['categ_id.name', '=', "Pet Toys"]])
            .limit(5)
            .all()
            .then(function (results) {
                _(results).each(function (item) {
                    self.$el.append(QWeb.render('PetToy', {item: item}));
                });
            });
    },
    selected_item: function (event) {
        this.do_action({
            type: 'ir.actions.act_window',
            res_model: 'product.product',
            res_id: $(event.currentTarget).data('id'),
            views: [[false, 'form']],
        });
    },
});
```

``` xml
<t t-name="PetToy">
    <div class="oe_petstore_pettoy" t-att-data-id="item.id">
        <p><t t-esc="item.name"/></p>
        <p><img t-attf-src="data:image/jpg;base64,{{item.image}}"/></p>
    </div>
</t>
```
:::
::::

### Client Actions {#howtos/web/client_actions}

Throughout this guide, we used a simple `HomePage` widget which the web
client automatically starts when we select the right menu item. But how
did the Odoo web know to start this widget? Because the widget is
registered as a *client action*.

A client action is (as its name implies) an action type defined almost
entirely in the client, in javascript for Odoo web. The server simply
sends an action tag (an arbitrary name), and optionally adds a few
parameters, but beyond that *everything* is handled by custom client
code.

Our widget is registered as the handler for the client action through
this:

``` javascript
instance.web.client_actions.add('petstore.homepage', 'instance.oepetstore.HomePage');
```

`instance.web.client_actions` is a
`~odoo.web.Registry`{.interpreted-text role="class"} in which the action
manager looks up client action handlers when it needs to execute one.
The first parameter of `~odoo.web.Registry.add`{.interpreted-text
role="class"} is the name (tag) of the client action, and the second
parameter is the path to the widget from the Odoo web client root.

When a client action must be executed, the action manager looks up its
tag in the registry, walks the specified path and displays the widget it
finds at the end.

:::: note
::: title
Note
:::

a client action handler can also be a regular function, in which case
it\'ll be called and its result (if any) will be interpreted as the next
action to execute.
::::

On the server side, we had simply defined an `ir.actions.client` action:

``` xml
<record id="action_home_page" model="ir.actions.client">
    <field name="tag">petstore.homepage</field>
</record>
```

and a menu opening the action:

``` xml
<menuitem id="home_page_petstore_menu" parent="petstore_menu"
          name="Home Page" action="action_home_page"/>
```

### Architecture of the Views

Much of Odoo web\'s usefulness (and complexity) resides in views. Each
view type is a way of displaying a model in the client.

#### The View Manager

When an `ActionManager` instance receive an action of type
`ir.actions.act_window`, it delegates the synchronization and handling
of the views themselves to a *view manager*, which will then set up one
or multiple views depending on the original action\'s requirements:

![image](web/viewarchitecture.png){.align-center width="40.0%"}

#### The Views

Most `Odoo views <reference/views>`{.interpreted-text role="ref"} are
implemented through a subclass of `odoo.web.View`{.interpreted-text
role="class"} which provides a bit of generic basic structure for
handling events and displaying model information.

The *search view* is considered a view type by the main Odoo framework,
but handled separately by the web client (as it\'s a more permanent
fixture and can interact with other views, which regular views don\'t
do).

A view is responsible for loading its own description XML (using
`~odoo.models.Model.fields_view_get`{.interpreted-text role="py:class"})
and any other data source it needs. To that purpose, views are provided
with an optional view identifier set as the
`~odoo.web.View.view_id`{.interpreted-text role="attr"} attribute.

Views are also provided with a `~odoo.web.DataSet`{.interpreted-text
role="class"} instance which holds most necessary model information (the
model name and possibly various record ids).

Views may also want to handle search queries by overriding
`~odoo.web.View.do_search`{.interpreted-text role="func"}, and updating
their `~odoo.web.DataSet`{.interpreted-text role="class"} as necessary.

### The Form View Fields

A common need is the extension of the web form view to add new ways of
displaying fields.

All built-in fields have a default display implementation, a new form
widget may be necessary to correctly interact with a new field type
(e.g. a `GIS`{.interpreted-text role="term"} field) or to provide new
representations and ways to interact with existing field types (e.g.
validate `~odoo.fields.Char`{.interpreted-text role="py:class"} fields
which should contain email addresses and display them as email links).

To explicitly specify which form widget should be used to display a
field, simply use the `widget` attribute in the view\'s XML description:

``` xml
<field name="contact_mail" widget="email"/>
```

:::: note
::: title
Note
:::

- the same widget is used in both \"view\" (read-only) and \"edit\"
  modes of a form view, it\'s not possible to use a widget in one and an
  other widget in the other
- and a given field (name) can not be used multiple times in the same
  form
- a widget may ignore the current mode of the form view and remain the
  same in both view and edit modes
::::

::: todo
most of this should probably move to an advanced form view guide
:::

Fields are instantiated by the form view after it has read its XML
description and constructed the corresponding HTML representing that
description. After that, the form view will communicate with the field
objects using some methods. These methods are defined by the
`FieldInterface` interface. Almost all fields inherit the
`AbstractField` abstract class. That class defines some default
mechanisms that need to be implemented by most fields.

Here are some of the responsibilities of a field class:

- The field class must display and allow the user to edit the value of
  the field.
- It must correctly implement the 3 field attributes available in all
  fields of Odoo. The `AbstractField` class already implements an
  algorithm that dynamically calculates the value of these attributes
  (they can change at any moment because their value change according to
  the value of other fields). Their values are stored in *Widget
  Properties* (the widget properties were explained earlier in this
  guide). It is the responsibility of each field class to check these
  widget properties and dynamically adapt depending of their values.
  Here is a description of each of these attributes:
  - `required`: The field must have a value before saving. If `required`
    is `true` and the field doesn\'t have a value, the method
    `is_valid()` of the field must return `false`.
  - `invisible`: When this is `true`, the field must be invisible. The
    `AbstractField` class already has a basic implementation of this
    behavior that fits most fields.
  - `readonly`: When `true`, the field must not be editable by the user.
    Most fields in Odoo have a completely different behavior depending
    on the value of `readonly`. As example, the `FieldChar` displays an
    HTML `<input>` when it is editable and simply displays the text when
    it is read-only. This also means it has much more code it would need
    to implement only one behavior, but this is necessary to ensure a
    good user experience.
- Fields have two methods, `set_value()` and `get_value()`, which are
  called by the form view to give it the value to display and get back
  the new value entered by the user. These methods must be able to
  handle the value as given by the Odoo server when a `read()` is
  performed on a model and give back a valid value for a `write()`.
  Remember that the JavaScript/Python data types used to represent the
  values given by `read()` and given to `write()` is not necessarily the
  same in Odoo. As example, when you read a many2one, it is always a
  tuple whose first value is the id of the pointed record and the second
  one is the name get (ie: `(15, "Agrolait")`). But when you write a
  many2one it must be a single integer, not a tuple anymore.
  `AbstractField` has a default implementation of these methods that
  works well for simple data type and set a widget property named
  `value`.

Please note that, to better understand how to implement fields, you are
strongly encouraged to look at the definition of the `FieldInterface`
interface and the `AbstractField` class directly in the code of the Odoo
web client.

#### Creating a New Type of Field

In this part we will explain how to create a new type of field. The
example here will be to re-implement the `FieldChar` class and
progressively explain each part.

##### Simple Read-Only Field

Here is a first implementation that will only display text. The user
will not be able to modify the content of the field.

``` javascript
local.FieldChar2 = instance.web.form.AbstractField.extend({
    init: function() {
        this._super.apply(this, arguments);
        this.set("value", "");
    },
    render_value: function() {
        this.$el.text(this.get("value"));
    },
});

instance.web.form.widgets.add('char2', 'instance.oepetstore.FieldChar2');
```

In this example, we declare a class named `FieldChar2` inheriting from
`AbstractField`. We also register this class in the registry
`instance.web.form.widgets` under the key `char2`. That will allow us to
use this new field in any form view by specifying `widget="char2"` in
the `<field/>` tag in the XML declaration of the view.

In this example, we define a single method: `render_value()`. All it
does is display the widget property `value`. Those are two tools defined
by the `AbstractField` class. As explained before, the form view will
call the method `set_value()` of the field to set the value to display.
This method already has a default implementation in `AbstractField`
which simply sets the widget property `value`. `AbstractField` also
watch the `change:value` event on itself and calls the `render_value()`
when it occurs. So, `render_value()` is a convenience method to
implement in child classes to perform some operation each time the value
of the field changes.

In the `init()` method, we also define the default value of the field if
none is specified by the form view (here we assume the default value of
a `char` field should be an empty string).

##### Read-Write Field

Read-only fields, which only display content and don\'t allow the user
to modify it can be useful, but most fields in Odoo also allow editing.
This makes the field classes more complicated, mostly because fields are
supposed to handle both editable and non-editable mode, those modes are
often completely different (for design and usability purpose) and the
fields must be able to switch between modes at any moment.

To know in which mode the current field should be, the `AbstractField`
class sets a widget property named `effective_readonly`. The field
should watch for changes in that widget property and display the correct
mode accordingly. Example:

``` javascript
local.FieldChar2 = instance.web.form.AbstractField.extend({
    init: function() {
        this._super.apply(this, arguments);
        this.set("value", "");
    },
    start: function() {
        this.on("change:effective_readonly", this, function() {
            this.display_field();
            this.render_value();
        });
        this.display_field();
        return this._super();
    },
    display_field: function() {
        var self = this;
        this.$el.html(QWeb.render("FieldChar2", {widget: this}));
        if (! this.get("effective_readonly")) {
            this.$("input").change(function() {
                self.internal_set_value(self.$("input").val());
            });
        }
    },
    render_value: function() {
        if (this.get("effective_readonly")) {
            this.$el.text(this.get("value"));
        } else {
            this.$("input").val(this.get("value"));
        }
    },
});

instance.web.form.widgets.add('char2', 'instance.oepetstore.FieldChar2');
```

``` xml
<t t-name="FieldChar2">
    <div class="oe_field_char2">
        <t t-if="! widget.get('effective_readonly')">
            <input type="text"></input>
        </t>
    </div>
</t>
```

In the `start()` method (which is called immediately after a widget has
been appended to the DOM), we bind on the event
`change:effective_readonly`. That allows us to redisplay the field each
time the widget property `effective_readonly` changes. This event
handler will call `display_field()`, which is also called directly in
`start()`. This `display_field()` was created specifically for this
field, it\'s not a method defined in `AbstractField` or any other class.
We can use this method to display the content of the field depending on
the current mode.

From now on the conception of this field is typical, except there is a
lot of verifications to know the state of the `effective_readonly`
property:

- In the QWeb template used to display the content of the widget, it
  displays an `<input type="text" />` if we are in read-write mode and
  nothing in particular in read-only mode.
- In the `display_field()` method, we have to bind on the `change` event
  of the `<input type="text" />` to know when the user has changed the
  value. When it happens, we call the `internal_set_value()` method with
  the new value of the field. This is a convenience method provided by
  the `AbstractField` class. That method will set a new value in the
  `value` property but will not trigger a call to `render_value()`
  (which is not necessary since the `<input type="text" />` already
  contains the correct value).
- In `render_value()`, we use a completely different code to display the
  value of the field depending if we are in read-only or in read-write
  mode.

:::: exercise
Create a Color Field

Create a `FieldColor` class. The value of this field should be a string
containing a color code like those used in CSS (example: `#FF0000` for
red). In read-only mode, this color field should display a little block
whose color corresponds to the value of the field. In read-write mode,
you should display an `<input type="color" />`. That type of `<input />`
is an HTML5 component that doesn\'t work in all browsers but works well
in Google Chrome. So it\'s OK to use as an exercise.

You can use that widget in the form view of the `message_of_the_day`
model for its field named `color`. As a bonus, you can change the
`MessageOfTheDay` widget created in the previous part of this guide to
display the message of the day with the background color indicated in
the `color` field.

::: only
solutions

``` javascript
local.FieldColor = instance.web.form.AbstractField.extend({
    events: {
        'change input': function (e) {
            if (!this.get('effective_readonly')) {
                this.internal_set_value($(e.currentTarget).val());
            }
        }
    },
    init: function() {
        this._super.apply(this, arguments);
        this.set("value", "");
    },
    start: function() {
        this.on("change:effective_readonly", this, function() {
            this.display_field();
            this.render_value();
        });
        this.display_field();
        return this._super();
    },
    display_field: function() {
        this.$el.html(QWeb.render("FieldColor", {widget: this}));
    },
    render_value: function() {
        if (this.get("effective_readonly")) {
            this.$(".oe_field_color_content").css("background-color", this.get("value") || "#FFFFFF");
        } else {
            this.$("input").val(this.get("value") || "#FFFFFF");
        }
    },
});
instance.web.form.widgets.add('color', 'instance.oepetstore.FieldColor');
```

``` xml
<t t-name="FieldColor">
    <div class="oe_field_color">
        <t t-if="widget.get('effective_readonly')">
            <div class="oe_field_color_content" />
        </t>
        <t t-if="! widget.get('effective_readonly')">
            <input type="color"></input>
        </t>
    </div>
</t>
```

``` css
.oe_field_color_content {
    height: 20px;
    width: 50px;
    border: 1px solid black;
}
```
:::
::::

### The Form View Custom Widgets

Form fields are used to edit a single field, and are intrinsically
linked to a field. Because this may be limiting, it is also possible to
create *form widgets* which are not so restricted and have less ties to
a specific lifecycle.

Custom form widgets can be added to a form view through the `widget`
tag:

``` xml
<widget type="xxx" />
```

This type of widget will simply be created by the form view during the
creation of the HTML according to the XML definition. They have
properties in common with the fields (like the `effective_readonly`
property) but they are not assigned a precise field. And so they don\'t
have methods like `get_value()` and `set_value()`. They must inherit
from the `FormWidget` abstract class.

Form widgets can interact with form fields by listening for their
changes and fetching or altering their values. They can access form
fields through their
`~odoo.web.form.FormWidget.field_manager`{.interpreted-text role="attr"}
attribute:

``` javascript
local.WidgetMultiplication = instance.web.form.FormWidget.extend({
    start: function() {
        this._super();
        this.field_manager.on("field_changed:integer_a", this, this.display_result);
        this.field_manager.on("field_changed:integer_b", this, this.display_result);
        this.display_result();
    },
    display_result: function() {
        var result = this.field_manager.get_field_value("integer_a") *
                     this.field_manager.get_field_value("integer_b");
        this.$el.text("a*b = " + result);
    }
});

instance.web.form.custom_widgets.add('multiplication', 'instance.oepetstore.WidgetMultiplication');
```

`~odoo.web.form.FormWidget`{.interpreted-text role="attr"} is generally
the `~odoo.web.form.FormView`{.interpreted-text role="class"} itself,
but features used from it should be limited to those defined by
`~odoo.web.form.FieldManagerMixin`{.interpreted-text role="class"}, the
most useful being:

- `~odoo.web.form.FieldManagerMixin.get_field_value(field_name)`{.interpreted-text
  role="func"} which returns the value of a field.
- `~odoo.web.form.FieldManagerMixin.set_values(values)`{.interpreted-text
  role="func"} sets multiple field values, takes a mapping of
  `{field_name: value_to_set}`
- An event `field_changed:{field_name}`{.interpreted-text role="samp"}
  is triggered any time the value of the field called `field_name` is
  changed

:::: exercise
Show Coordinates on Google Map

Add two fields to `product.product` storing a latitude and a longitude,
then create a new form widget to display the latitude and longitude of a
product\'s origin on a map

To display the map, use Google Map\'s embedding:

``` html
<iframe width="400" height="300" src="https://maps.google.com/?ie=UTF8&amp;ll=XXX,YYY&amp;output=embed">
</iframe>
```

where `XXX` should be replaced by the latitude and `YYY` by the
longitude.

Display the two position fields and a map widget using them in a new
notebook page of the product\'s form view.

::: only
solutions

``` javascript
local.WidgetCoordinates = instance.web.form.FormWidget.extend({
    start: function() {
        this._super();
        this.field_manager.on("field_changed:provider_latitude", this, this.display_map);
        this.field_manager.on("field_changed:provider_longitude", this, this.display_map);
        this.display_map();
    },
    display_map: function() {
        this.$el.html(QWeb.render("WidgetCoordinates", {
            "latitude": this.field_manager.get_field_value("provider_latitude") || 0,
            "longitude": this.field_manager.get_field_value("provider_longitude") || 0,
        }));
    }
});

instance.web.form.custom_widgets.add('coordinates', 'instance.oepetstore.WidgetCoordinates');
```

``` xml
<t t-name="WidgetCoordinates">
    <iframe width="400" height="300"
        t-attf-src="https://maps.google.com/?ie=UTF8&amp;ll={{latitude}},{{longitude}}&amp;output=embed">
    </iframe>
</t>
```
:::
::::

:::: exercise
Get the Current Coordinate

Add a button resetting the product\'s coordinates to the location of the
user, you can get these coordinates using the [javascript geolocation
API](http://diveintohtml5.info/geolocation.html).

Now we would like to display an additional button to automatically set
the coordinates to the location of the current user.

To get the coordinates of the user, an easy way is to use the
geolocation JavaScript API. [See the online documentation to know how to
use it](http://www.w3schools.com/html/html5_geolocation.asp).

Please also note that the user should not be able to click on that
button when the form view is in read-only mode. So, this custom widget
should handle correctly the `effective_readonly` property just like any
field. One way to do this would be to make the button disappear when
`effective_readonly` is true.

::: only
solutions

``` javascript
local.WidgetCoordinates = instance.web.form.FormWidget.extend({
    events: {
        'click button': function () {
            navigator.geolocation.getCurrentPosition(
                this.proxy('received_position'));
        }
    },
    start: function() {
        var sup = this._super();
        this.field_manager.on("field_changed:provider_latitude", this, this.display_map);
        this.field_manager.on("field_changed:provider_longitude", this, this.display_map);
        this.on("change:effective_readonly", this, this.display_map);
        this.display_map();
        return sup;
    },
    display_map: function() {
        this.$el.html(QWeb.render("WidgetCoordinates", {
            "latitude": this.field_manager.get_field_value("provider_latitude") || 0,
            "longitude": this.field_manager.get_field_value("provider_longitude") || 0,
        }));
        this.$("button").toggle(! this.get("effective_readonly"));
    },
    received_position: function(obj) {
        this.field_manager.set_values({
            "provider_latitude": obj.coords.latitude,
            "provider_longitude": obj.coords.longitude,
        });
    },
});

instance.web.form.custom_widgets.add('coordinates', 'instance.oepetstore.WidgetCoordinates');
```

``` xml
<t t-name="WidgetCoordinates">
    <iframe width="400" height="300"
        t-attf-src="https://maps.google.com/?ie=UTF8&amp;ll={{latitude}},{{longitude}}&amp;output=embed">
    </iframe>
    <button>Get My Current Coordinate</button>
</t>
```
:::
::::

[^1]: as a separate concept from instances. In many languages classes
    are full-fledged objects and themselves instance (of metaclasses)
    but there remains two fairly separate hierarchies between classes
    and instances

[^2]: as well as papering over cross-browser differences, although this
    has become less necessary over time




--- SOURCE: developer/tutorials/website_theme/01_theming.md ---

# Chapter 1 - Theming

Now that you have Odoo installed and your server is running locally,
it\'s time to create your own theme module for your website.

## Setup {#tutorials/website_theme/theming/setup}

| The first step is to ensure that Odoo is running correctly locally. To
  do this, use a Shell script to run the server.
| In this script, define the database name and install only the
  [website]{.title-ref} module.

::: seealso
See reference documentation on how to
`run Odoo <website_themes/setup/getting_started>`{.interpreted-text
role="ref"}.
:::

## Build your module structure {#tutorials/website_theme/theming/module}

Now that we know everything is working properly, let\'s start building
our module.

Based on the following structure, start creating your module that will
be used as a theme. This is where you are going to add your XML pages,
SCSS, JS, ...

::: seealso
See reference documentation on how to structure your
`theming/module`{.interpreted-text role="ref"}.
:::

| Start with the basics : `/data`{.interpreted-text role="file"},
  `/img`{.interpreted-text role="file"}, `/scss`{.interpreted-text
  role="file"}, `/js`{.interpreted-text role="file"}.
| Don\'t forget to add the `__init__.py`{.interpreted-text role="file"}
  and `__manifest__.py`{.interpreted-text role="file"} files.

In your `__manifest__.py`{.interpreted-text role="file"} file, you can
declare your module with the following information:

- name (required)
- description
- category
- version
- author
- license
- depends

## Declare Odoo variables {#tutorials/website_theme/theming/odoo_variables}

In the `primary_variables.scss`{.interpreted-text role="file"} file, you
can override the default Odoo SCSS variables to match your design.

Based on the Airproof design, create your
`primary_variables.scss`{.interpreted-text role="file"} file and define
the following elements:

- Headings font family : Space Grotesk
- Content font family : Lato
- The color palette name and the 5 main colors that compose it:
  [#000000]{.title-ref}, [#BBE1FA]{.title-ref}, [#CEF8A1]{.title-ref},
  [#FFFFFF]{.title-ref}, [#0B8EE6]{.title-ref}
- Header & Footer : Use one of the default templates for the moment, we
  will create a custom header later.

::: seealso
See reference documentation on how to use
`primary variables <theming/module/variables>`{.interpreted-text
role="ref"}, as well as a list of all [primary
variables]({GITHUB_PATH}/addons/website/static/src/scss/primary_variables.scss)
available.
:::

| Restart your script to immediately see the application of your
  changes.
| Don\'t forget to add the path to your manifest in the script and set
  your module as the app to install.

To ensure your changes are applied correctly, log in to your website and
check that your color palette includes your specified colors.

:::: tip
::: title
Tip
:::

You will need to override more variables to replicate the Airproof
design. Remember to add them throughout the creation of your website.
::::

:::: note
::: title
Note
:::

The font families are from [Google fonts](https://fonts.google.com/).
::::

::: spoiler
Solutions

To complete this exercise, you need to:

1.  Create your `primary_variables.scss`{.interpreted-text role="file"}
    file. You can find all the necessary information in the
    [primary_variables.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/primary_variables.scss)
    file from our example module.
2.  Declare your file in the `__manifest__.py`{.interpreted-text
    role="file"} as indicated in the documentation.
3.  Install your module via your script. In our example, it looks like
    this:

``` xml
./odoo-bin --addons-path=../enterprise,addons,../myprojects --db-filter=theming -d theming
--without-demo=all -i website_airproof --dev=xml
```
:::

## Declare Bootstrap variables {#tutorials/website_theme/theming/bootstrap_variables}

On top of the default Odoo variables, you can also redefine the
Bootstrap variables. Bootstrap is a front-end framework which is
included by default in Odoo.

Based on the Airproof design, define the following elements:

- Headings font sizes :
  - h1 : 3.125rem
  - h2 : 2.5rem
  - h3 : 2rem
  - h4 : 1.75rem
  - h5 : 1.5rem
  - h6 : 1.25rem
- Inputs border radius : 10px
- Inputs border color : black
- Inputs border width : 1px
- Large buttons border radius : 0px 10px 10px 10px

::: seealso
\- See reference documentation on how to use
`theming/module/bootstrap`{.interpreted-text role="ref"}. - A list of
all [Bootstrap
variables]({GITHUB_PATH}/addons/web/static/lib/bootstrap/scss/_variables.scss)
used by Odoo. - And [Bootstrap
framework](https://getbootstrap.com/docs/4.6/getting-started/introduction/)
official documentation.
:::

:::: tip
::: title
Tip
:::

\- You will need to override more variables to replicate the Airproof
design. Remember to add them throughout the creation of your website. -
Make it a habit to regularly check locally that your changes have been
successfully applied and have not caused any errors.
::::

::: spoiler
Solutions

To complete this exercise, you need to:

1.  Create your `bootstrap_overridden.scss`{.interpreted-text
    role="file"} file. You can find all the necessary information in the
    [bootstrap_overridden.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/bootstrap_overridden.scss)
    file from our example module.
2.  Declare your file in the `__manifest__.py`{.interpreted-text
    role="file"} as indicated in the documentation.
:::

## Define presets {#tutorials/website_theme/theming/presets}

In addition to the variables we have just covered, you can also activate
specific views to modify the design.

Add your `presets.xml`{.interpreted-text role="file"} file and based on
the Airproof design, activate the appropriate views to meet the
following client requests:

- Deactivate the Call-to-action in the header.
- Deactivate the wishlist feature in the shop but activate it on the
  product page.
- On the shop page, activate the filtering by categories only on the
  left side.

::: seealso
\| See how you can define your
`presets <theming/module/views/presets>`{.interpreted-text role="ref"}.
\| To start writing your file, follow the instructions for any Odoo XML
page described in
`/developer/howtos/website_themes/layout`{.interpreted-text role="doc"}.
:::

:::: tip
::: title
Tip
:::

\- To complete the exercise, you need to install the **eCommerce**
([website_sale]{.title-ref}) and **wishlist**
([website_sale_whishlist]{.title-ref}) applications. **Be careful!**
Referencing an application in your code that hasn\'t been installed will
result in an error. - \| In order to find the templates to activate or
not, go to the source code:
[odoo/addons/website/views/\*\*]{.title-ref}. \| For example, you can
find all the templates for the header in
[website_templates.xml]({GITHUB_PATH}/addons/website/views/website_templates.xml). -
To see the effect of your presets, add some **products** (*Airproof
Mini*, *Airproof Robin*, *Warranty*, *Charger cable*) and create
**eCommerce categories** (*Warranties*, *Accessories*, and *Drones* with
*Camera drones* and *Waterproof drones*) in the database. You will find
the [product images
here]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content). - You
will need to activate more views to replicate the Airproof design.
Remember to add them throughout the creation of your website.
::::

::: spoiler
Solutions

To deactivate the Call-to-action:

1.  The view you have to find is in
    `odoo/addons/website/views/website_templates.xml l:2113`{.interpreted-text
    role="file"}

2.  Create your `presets.xml`{.interpreted-text role="file"} file with
    the right records

    ``` {.xml caption="``/website_airproof/data/presets.xml``"}
    <?xml version="1.0" encoding="utf-8"?>
    <odoo>
       <!-- Disable Call-to-action in header -->
       <record id="website.header_call_to_action" model="ir.ui.view">
          <field name="active" eval="False"/>
       </record>
    </odoo>
    ```

3.  In the manifest, add the 2 apps and declare your file.

    ``` {.python caption="``/website_airproof/__manifest__.py``"}
    'depends': ['website_sale', 'website_sale_wishlist'],
    'data': [
       # Options
       'data/presets.xml',
    ]
    ```
:::




--- SOURCE: developer/tutorials/website_theme/02_build_website.md ---

# Chapter 2 - Build your website

## Create a page {#tutorials/website_theme/build_website/page}

Now that the theme has been set up, let\'s move on to creating the
content.

First of all, start by creating your first theme page: the home page.
For now, only indicate "Hello" as content in the page.

:::: tip
::: title
Tip
:::

You will need to deactivate the default homepage.
::::

::: seealso
See reference documentation on how to `desactivate a default page
<website_themes/pages/default>`{.interpreted-text role="ref"} and how to
`start a new page
<website_themes/pages/theme_pages>`{.interpreted-text role="ref"}.
:::

::: spoiler
Solutions

``` {.python caption="``/website_airproof/__manifest__.py``"}
'data': [
   # Pages
   'data/pages/home.xml',
]
```

``` {.xml caption="``/website_airproof/data/pages/home.xml``"}
<?xml version="1.0" encoding="utf-8"?>
<odoo>
   <data noupdate="1">
      <!-- Deactivate default homepage -->
      <record id="website.homepage" model="ir.ui.view">
         <field name="active" eval="False"/>
      </record>
      <!-- Home -->
      <record id="page_home" model="website.page">
         <field name="name">Home</field>
         <field name="is_published" eval="True"/>
         <field name="key">website_airproof.page_home</field>
         <field name="url">/</field>
         <field name="type">qweb</field>
         <field name="arch" type="xml">
            <t t-name="website_airproof.page_home">
               <t t-call="website.layout">
                  <!-- Title -->
                  <t t-set="additional_title">One step beyond the horizon | Airproof</t>
                  <!-- Content -->
                  <div id="wrap" class="oe_structure">
                     <p>Hello</p>
                  </div>
               </t>
            </t>
         </field>
      </record>
   </data>
</odoo>
```
:::

## Add a media {#tutorials/website_theme/build_website/media}

If you want the client to be able to reuse certain pictures that you are
going to add on the website, they must be added to the image library.

To do the test, declare the drone image to add it to the library. You
will find the [drone picture
here]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/drone-robin.png).

::: seealso
See reference documentation on how to
`add a media <website_themes/media/images>`{.interpreted-text
role="ref"}.
:::

Go to the `Website Builder`{.interpreted-text role="guilabel"},
double-click on the `logo`{.interpreted-text role="guilabel"}, and you
will see the drone image in the library.

::: spoiler
Solutions

To complete this exercise, you need to:

1.  Put your PNG in the right image folder.
2.  Create your `images.xml`{.interpreted-text role="file"} file. You
    can find all the necessary information in the
    [images.xml]({GITHUB_TUTO_PATH}/website_airproof/data/images.xml)
    file from our example module.
3.  Declare your file in the `__manifest__.py`{.interpreted-text
    role="file"}.
:::

## Add building blocks {#tutorials/website_theme/build_website/building_blocks}

Now, let\'s get into the real work. Start adding content to the pages.

In an Odoo website, we create the content of a page using building
blocks. These can be compared to snippets editable by the user in the
Website Builder. The standard main container for any snippet is a
[section]{.title-ref}.

Based on the Airproof design, add the following elements to the homepage
:

- Create a section with the 3 boxes using the
  `Big boxes`{.interpreted-text role="guilabel"} building block.
  - For this section, you don\'t want the future user to be able to edit
    it via the Website Builder.
  - Put an opacity filter on the background image of the 3 boxes.
- Create another section containing the title and icons.

You can use these
[images]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content) and
[icons]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/icons).

::: seealso
See reference documentation on how to `write standard snippets
<website_themes/building_blocks/layout>`{.interpreted-text role="ref"}.
:::

![Airproof building blocks.](02_build_website/building-blocks.png)

:::: tip
::: title
Tip
:::

To determine the code needed to create your building blocks :

- | Create a test page via the website builder.
  | Drag & drop the building block that interests you and apply the
    right design.
  | Use the code generated via `Editor HTML/SCSS`{.interpreted-text
    role="guilabel"} in the menu.

- You can also find the original building block code in Odoo :
  `odoo/addons/website/views/snippets/**.xml`{.interpreted-text
  role="file"}.
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[home.xml]({GITHUB_TUTO_PATH}/website_airproof/data/pages/home.xml).
:::

## Navigation {#tutorials/website_theme/build_website/navigation}

For now, the client is fine with the default header but has requested
some navigation adjustments.

The client has requested the following changes:

- Remove the link to the homepage and the shop.
- Add a link to the future "About us" page.
- Replace the default blog item with a dropdown to display the different
  blogs: "Our latest news" and "Tutorials".
- Add a mega-menu "Waterproof drones" to display the different products.

::: seealso
\- You can find the original mega-menu templates code in Odoo :
[odoo/addons/website/views/snippets/s_mega_menu\_\*\*.xml]({GITHUB_PATH}/addons/website/views/snippets) -
See reference documentation on how to modifiy the
`/developer/howtos/website_themes/navigation`{.interpreted-text
role="doc"}.
:::

![Aiproof mega-menu.](02_build_website/mega-menu.png)

:::: tip
::: title
Tip
:::

\- Make sure the Blog app is installed and create the two different
blogs in the backend. - Create the different products via the backend.
You can use these [product
pictures]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content).
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[menu.xml]({GITHUB_TUTO_PATH}/website_airproof/data/menu.xml).
:::




--- SOURCE: developer/tutorials/website_theme/03_customisation_part1.md ---

# Chapter 3 - Customisation, Part I

## Add custom SCSS {#tutorials/website_theme/customisation_part1/custom_scss}

You\'ve adjusted Odoo and Bootstrap variables and set presets, yet you
still notice disparities between your website and the client\'s design.
The only solution is to incorporate custom SCSS.

In `theme.scss`{.interpreted-text role="file"}, reproduce the following
design elements:

- Add a **green underline** on active nav items.
- Modify the **arrow** for collapsible nav items.
- Modify the **slider\'s arrows** by adding a green background and
  changing their design.

You will find the various [media
here]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/icons).

::: seealso
See reference documentation on how to
`add your SCSS rules <theming/assets/styles>`{.interpreted-text
role="ref"}.
:::

![image](03_customisation_part1/menu.png)

![image](03_customisation_part1/slider.png)

:::: note
::: title
Note
:::

\| It\'s always preferable to include all your SCSS rules in
[#wrapwrap]{.title-ref}. This ID is applied to the div that groups the
`header`{.interpreted-text role="guilabel"}, `footer`{.interpreted-text
role="guilabel"}, and `main`{.interpreted-text role="guilabel"} content
of all your pages. \| So you will be sure that your rules will only have
an impact on the website parts.
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[header.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/layout/header.scss)
and
[caroussel.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/snippets/caroussel.scss).
:::

## Add custom JS {#tutorials/website_theme/customisation_part1/custom_js}

Now, let\'s add a mouse follower to the website. This interactive
element will enhance the browsing experience, making it more engaging
and visually appealing.

![image](03_customisation_part1/mouse-follower.gif)

Use your JavaScript skills to implement this.

::: seealso
See reference documentation on how to
`add Javascript code <theming/assets/interactivity>`{.interpreted-text
role="ref"}.
:::

::: spoiler
Solutions

Find the solution in our Airproof example on
[mouse_follower.js]({GITHUB_TUTO_PATH}/website_airproof/static/src/js/mouse_follower.js)
and
[mouse_follower.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/components/mouse_follower.scss).
:::

## Create a custom header {#tutorials/website_theme/customisation_part1/custom_header}

With variables, presets, and custom SCSS in place, it\'s time to refine
the layout and add key cross-page elements, starting with the header.

Based on the Airproof design, create a custom header with the following
elements:

- A centered logo. Ensure to declare the logo so that it appears
  automatically in the header.
- A custom shopping cart icon.
- A login/user as a button.
- Navigation text to 14px.

You can find the
[logo]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/branding/airproof-logo.svg),
[cart
icon]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/icons/shopping.svg)
and [template
illustration]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/wbuilder/template-header-opt.svg).

::: seealso
See reference documentation on how to:

- create
  `custom headers <website_themes/layout/header/custom>`{.interpreted-text
  role="ref"},
- do a `website_themes/layout/xpath`{.interpreted-text role="ref"},
- declare a `website_themes/media/images/use/logo`{.interpreted-text
  role="ref"}.
:::

![image](03_customisation_part1/header.png)

:::: tip
::: title
Tip
:::

\- Base yourself on the code of existing header templates that you can
find in
[odoo/addons/website/views/website_templates.xml]({GITHUB_PATH}/addons/website/views/website_templates.xml). -
A good practise should be to create different files to manage your
custom views and templates. For example, everything concerning the
general layout (header, footer\...) in
`website_templates.xml`{.interpreted-text role="file"}, everything
related to blog in `website_blog_templates.xml`{.interpreted-text
role="file"}, to event in
`website_event_templates.xml`{.interpreted-text role="file"}, etc. - \|
To modify the cart icon, you can use an [XPath]{.title-ref}. \| Since
this is linked to eCommerce, place it in a new file called
`website_sale_templates.xml`{.interpreted-text role="file"}. - Don\'t
forget to continue making as many modifications as you can through the
`Bootstrap
variables`{.interpreted-text role="file"} and
`primary variables`{.interpreted-text role="file"} (font, colors,
size\...). You can use them to help you with this exercise.
::::

::: spoiler
Solutions

Find the solution in our Airproof example for:

- the xml structure and to add the template to the options list on
  [website_template.xml]({GITHUB_TUTO_PATH}/website_airproof/views/website_templates.xml).

- disable the default header:

  ``` {.xml caption="``/website_airproof/data/presets.xml``"}
  <!-- Disable default header -->
  <record id="website.template_header_default" model="ir.ui.view">
     <field name="active" eval="False"/>
  </record>
  ```

- record the logo:

  ``` {.xml caption="``/website_airproof/data/images.xml``"}
  <!-- Set as the logo of the website -->
  <record id="website.default_website" model="website">
     <field name="logo" type="base64" file="website_airproof/static/src/img/content/branding/airproof-logo.svg"/>
  </record>
  ```

- declare your `website_templates.xml`{.interpreted-text role="file"}
  file along with all the new ones in your `manifest`{.interpreted-text
  role="file"}.

- make the use of
  [primaries]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/primary_variables.scss)
  like [header-template]{.title-ref}, [navbar-font]{.title-ref},
  [header-font-size]{.title-ref}\...

- use
  [bootstrap_overridden]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/bootstrap_overridden.scss)
  like [\$navbar-light-color]{.title-ref},
  [\$navbar-light-hover-color]{.title-ref},
  [\$navbar-padding-y]{.title-ref}\...

- add some
  [scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/layout/header.scss)
  rules.
:::

## Create a custom footer {#tutorials/website_theme/customisation_part1/custom_footer}

The client is delighted with the new header, as it aligns perfectly with
the provided design. Now, he wants a matching custom footer.

Based on the Airproof design, create a custom footer with the following
elements:

- A section for newsletter subscription.
- A section for the copyright and social media.

You will find the [icons
here]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/icons).

::: seealso
See reference documentation on how to create a `custom footer
<website_themes/layout/footer/custom>`{.interpreted-text role="ref"} and
adapt the `website_themes/layout/copyright`{.interpreted-text
role="ref"}.
:::

![image](03_customisation_part1/footer.png)

:::: tip
::: title
Tip
:::

\- You can enable or disable the copyright section via the presets. -
For the newsletter section to work, you need to install the
[website_mass_mailing]{.title-ref} application.
::::

::: spoiler
Solutions

To complete this exercise, you need to:

- add [mass mailing]{.title-ref} to your depends:

  ``` {.python caption="``/website_airproof/__manifest__.py``"}
  'depends': ['website_sale', 'website_sale_wishlist', 'website_blog',
  'website_mass_mailing'],
  ```

- find the xml structure and add the template to the options list on
  [website_template.xml]({GITHUB_TUTO_PATH}/website_airproof/views/website_templates.xml).

- disable the default footer and enable the copyright:

  ``` {.xml caption="``/website_airproof/data/presets.xml``"}
  <!-- Disable Default Footer -->
  <record id="website.footer_custom" model="ir.ui.view">
     <field name="active" eval="False"/>
  </record>
  <!-- Enable Copyright -->
  <record id="website.footer_no_copyright" model="ir.ui.view">
     <field name="active" eval="False"/>
  </record>
  ```

- make the use of
  [primaries]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/primary_variables.scss)
  like [footer-template]{.title-ref}, [footer]{.title-ref},
  [o-cc4-link]{.title-ref}\...

- add a little scss rule for the
  [newsletter]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/snippets/newsletter.scss)
  section.
:::

## Create your custom building blocks {#tutorials/website_theme/customisation_part1/custom_building_blocks}

To allow your client to further customize his website, create
tailor-made building blocks that he can freely drag & drop onto
different pages.

Based on the Airproof design, create a custom carousel snippet to
showcase drones. Then, add it as cover section on your homepage.

1.  Create the snippet template and add it to the list of building
    blocks available in the website builder. Here you will find the
    [images]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/snippets/s_airproof_caroussel)
    and [snippet
    illustration]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/wbuilder/s-airproof-snippet.svg).

    ::: seealso
    See reference documentation on how to create a
    `custom building blocks
    <website_themes/building_blocks/custom>`{.interpreted-text
    role="ref"}.
    :::

    ![image](03_customisation_part1/custom-building-block.png)

2.  Add an option in the Website Builder to allow users to choose
    between a blue or green bubble shadow.

    ::: seealso
    See reference documentation on how to add `snippet options
    <website_themes/building_blocks/custom/options>`{.interpreted-text
    role="ref"}.
    :::

    ![image](03_customisation_part1/custom-building-block-option.png)

3.  Add the snippet on your homepage.

:::: tip
::: title
Tip
:::

Don\'t forget to always properly declare your new files in your
`__manifest__.py`{.interpreted-text role="file"} and follow the good
`folder structure <theming/module/structure>`{.interpreted-text
role="ref"} seen previously.
::::

::: spoiler
Solutions

To complete this exercise, you need to:

1.  Create your template.

    - You can find all the necessary information in
      [s_airproof_carousel.xml]({GITHUB_TUTO_PATH}/website_airproof/views/snippets/s_airproof_carousel.xml)
      file and
      [s_airproof_carousel/000.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/snippets/s_airproof_carousel/000.scss)
      file from our example module.

    - Record your images in
      [images.xml]({GITHUB_TUTO_PATH}/website_airproof/data/images.xml).

    - Declare your files in the
      [\_\_manifest\_\_.py]({GITHUB_TUTO_PATH}/website_airproof/__manifest__.py).

    - Add it to the list of building blocks. In our example, it looks
      like this:

      ``` {.xml caption="``/website_airproof/views/snippets/options.xml``"}
      <!-- Add custom snippets to the builder -->
      <template id="snippets" inherit_id="website.snippets" name="Airproof - Custom Snippets">
         <xpath expr="//*[@id='default_snippets']" position="before">
            <t id="x_theme_snippets">
               <div id="x_airproof_snippets" class="o_panel">
                  <div class="o_panel_header">Airproof</div>
                  <div class="o_panel_body">
                     <!-- Carousel snippet -->
                     <t t-snippet="website_airproof.s_airproof_carousel"
                     t-thumbnail="/website_airproof/static/src/img/wbuilder/s-airproof-snippet.svg">
                        <keywords>Carousel block</keywords>
                     </t>
                  </div>
               </div>
            </t>
         </xpath>
      </template>
      ```

2.  Add the option to the Website Builder. In our example, it looks like
    this:

    ``` {.xml caption="``/website_airproof/views/snippets/s_airproof_carousel.xml``"}
    <!-- Add options to snippets -->
    <template id="snippet_options" inherit_id="website.snippet_options" name="Airproof -
    Snippets Options">
       <xpath expr="." position="inside">
          <!-- *** Carousel snippet : blue or green bubble *** -->
          <div data-selector=".x_bubble_item">
             <we-button-group string="Bubble shadow">
                <we-button data-select-class="x_bubble1">Blue</we-button>
                <we-button data-select-class="x_bubble2">Green</we-button>
             </we-button-group>
          </div>
       </xpath>
    </template>
    ```

    Additionally, the SCSS related to the bubbles in the
    [s_airproof_carousel/000.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/snippets/s_airproof_carousel/000.scss)
    file.

3.  Add your snippet to the homepage. You can find all the necessary
    information in the
    [home.xml]({GITHUB_TUTO_PATH}/website_airproof/data/pages/home.xml)
    file from our example module.
:::

## Create a new dynamic snippets template {#tutorials/website_theme/customisation_part1/custom_dynamic_template}

| Dynamic snippets are useful building blocks. These allow you to fetch
  information from the backend and display it on the website according
  to certain filters.
| There are already several layout templates for displaying dynamic
  snippets. However, none of the existing templates fully match your
  client\'s needs.

Based on the Airproof design, create a custom template that you will
apply to a product dynamic snippet on the homepage.

1.  First, create a custom template that will be added to the list of
    dynamic products templates. It has to include the following
    elements:

    - Add a `Discover more`{.interpreted-text role="guilabel"} link.
    - Add a hover effect on cards.
    - Move the navigation arrows.

    You will find the [icons
    here]({GITHUB_TUTO_PATH}/website_airproof/static/src/img/content/icons).

    ::: seealso
    See reference documentation on how to
    `create a template for dynamic snippets
    <website_themes/building_blocks/custom/dynamic>`{.interpreted-text
    role="ref"}.
    :::

    ![image](03_customisation_part1/custom-template.png)

    :::: tip
    ::: title
    Tip
    :::

    You can verify in the Website Builder that your template appears in
    the list of available templates for the product dynamic snippet.
    ::::

2.  Then, add a product dynamic snippet with the template you just
    created to the homepage.

    ::: seealso
    See reference documentation on how to `call a template
    <website_themes/building_blocks/custom/dynamic/call>`{.interpreted-text
    role="ref"}.
    :::

::: spoiler
Solutions

To complete this exercise, you need to:

1.  Create your snippet template. You can find all the necessary
    information in the
    [options.xml]({GITHUB_TUTO_PATH}/website_airproof/views/snippets/options.xml)
    file and
    [caroussel.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/snippets/caroussel.scss)
    file from our example module.
2.  Apply the template to a product dynamic snippet on the homepage. You
    can find all the necessary information in the
    [home.xml]({GITHUB_TUTO_PATH}/website_airproof/data/pages/home.xml)
    file from our example module.
:::




--- SOURCE: developer/tutorials/website_theme/04_customisation_part2.md ---

# Chapter 4 - Customisation, Part II

## Create a custom background shape {#tutorials/website_theme/customisation_part2/background_shape}

Shapes are decorative elements that can be applied to backgrounds or
images. They are SVG files that can be animated and customized with
different colors.

1.  To better align with the website\'s desired atmosphere, create a
    custom background shape that the client can reuse on different
    blocks.

    Create your custom shape using the following setup:

    - Declare your shape. You can find the original [SVG shape
      here]({GITHUB_TUTO_PATH}/website_airproof/shape-waves.svg).
    - Set the base color of the shape to the theme\'s green, and add it
      to the list of available shapes.

::: seealso
See reference documentation on how to add a `custom background shapes
<website_themes/shapes/bg/custom>`{.interpreted-text role="ref"}.
:::

![image](04_customisation_part2/shape.png)

:::: tip
::: title
Tip
:::

\| **Be careful,** there is a trick! \| In your shape SVG file, you have
to use the colors from the default Odoo palette. \| Here, I want it to
match my primary color 3 ([#CEF8A1]{.title-ref}). Therefore, in the SVG
file, you must use color 3 from Odoo\'s default palette
([#F6F6F6]{.title-ref}).
::::

::: spoiler
Solutions

Find the solution in our Airproof example for:

- the shape declaration on
  [shapes.xml]({GITHUB_TUTO_PATH}/website_airproof/data/shapes.xml).
- adding the shape to the list thanks to
  [primary_variable.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/primary_variables.scss)
  and
  [option.xml]({GITHUB_TUTO_PATH}/website_airproof/views/snippets/options.xml).
:::

2.  Based on the Airproof design, apply the shape you just added to a
    [Text-Image]{.title-ref} building block on the homepage:
    - Ensure the shape is in the right position.
    - Set its color to the theme\'s light blue.

::: seealso
See reference documentation on how to use `background shapes
<website_themes/shapes/bg/custom/use>`{.interpreted-text role="ref"}.
:::

![image](04_customisation_part2/shape-section.png)

:::: tip
::: title
Tip
:::

Unlike a standard Odoo shapes, when applying a custom shape to a
section, replace [web_editor]{.title-ref} with
[illustration]{.title-ref} in the shape class.
::::

::: spoiler
Solutions

``` {.xml caption="``/website_airproof/data/pages/home.xml``"}
<!-- Text-image block & Background shape -->
<section class="s_text_image o_cc o_cc5 o_colored_level pt120 pb96"
data-snippet="s_image_text" data-name="Image - Text" style="background-color: rgb(41, 128,
187);" data-oe-shape-data="{'shape': 'illustration/airproof/waves', 'colors': {'c3': '#BBE1FA'},
'flip': ['x']}">
   <div class="o_we_shape o_illustration_airproof_waves o_we_flip_x" style="background-image:
   url('/web_editor/shape/illustration%2Fairproof%2Fwaves.svg?c2=%23BBE1FA');
   background-position: 100% 100%;"/>
   [...]
</section>
```
:::

## Add a background gradient {#tutorials/website_theme/customisation_part2/background_gradient}

Apply a custom background gradient to your "*Latest products*" block,
transitioning from blue [rgb(11, 142, 230)]{.title-ref} to dark blue
[rgb(41, 128, 187)]{.title-ref}.

::: seealso
See reference documentation on how to use
`/developer/howtos/website_themes/gradients`{.interpreted-text
role="doc"}.
:::

::: spoiler
Solutions

``` {.xml caption="``/website_airproof/data/pages/home.xml``"}
<!-- Latest products section -->
<section class="s_parallax o_colored_level o_cc o_cc5 s_parallax_no_overflow_hidden pt40 pb32"
data-scroll-background-ratio="0" data-snippet="s_parallax" data-name="Parallax"
style="background-image: linear-gradient(0deg, rgb(41, 128, 187) 0%, rgb(11, 142, 230) 100%)
!important;">
   [...]
</section>
```
:::

## Animations {#tutorials/website_theme/customisation_part2/animations}

The client loves the overall design but finds the page a bit static.
Enhance page interactivity with animations such as
[fade-in]{.title-ref}, [rotate]{.title-ref}, [bounce]{.title-ref}, etc.
These can be applied to columns, images, texts, buttons...

Based on the airproof design, animate the following elements:

- the text of the first slide of the carousel.
- the sticker and the photo of the drone from the first slide.
- the 4 columns with icons.

Adjust animation delays for smoother transitions.

::: seealso
See reference documentation on how to apply
`/developer/howtos/website_themes/animations`{.interpreted-text
role="doc"}.
:::

![image](04_customisation_part2/animations.gif)

::: spoiler
Solutions

Find the solution in our Airproof example on
[home.xml]({GITHUB_TUTO_PATH}/website_airproof/data/pages/home.xml).

``` {.xml caption="Image animation"}
<img src="/web/image/website_airproof.img_sticker" class="img img-fluid position-absolute
x_sticker o_animate o_anim_rotate_in o_visible" style="animation-delay: 0.8s;
--wanim-intensity: 30;"/>

<img src="/web/image/website_airproof.img_drone" class="img img-fluid o_animate
o_anim_zoom_out o_visible" alt="Drone"/>
```

``` {.xml caption="Text animation"}
<span class="o_animated_text o_animate o_anim_fade_in o_anim_from_bottom o_visible">One
step</span>
```

``` {.xml caption="Columns animation"}
<div class="o_grid_item o_colored_level g-height-7 g-col-lg-3 col-lg-3 text-center
o_anim_fade_in o_animate o_anim_from_bottom o_visible" style="z-index: 2;
grid-area: 6 / 1 / 12 / 4; --wanim-intensity: 15;">
</div>
```
:::

## Forms {#tutorials/website_theme/customisation_part2/forms}

The forms in Odoo are very powerful. They can send emails directly to a
personal inbox or integrate directly with other Odoo applications. This
is great, as one of your client\'s main priorities is after-sales
service. Therefore, the contact form must be properly configured.

Based on the airproof design, create a contact page. Remember to disable
the default one and add the new page link to the menu. The client has
the following requests for their contact form:

- *Name* and *email address* field.
- *Company name* field.
- *Conditional VAT* field displayed only if *Company name* is filled in.
- All fields should be mandatory, except for *Company name*.
- Form submission must trigger an email.
- After form submission, the [thank-you message]{.title-ref} should
  remain visible on the contact page.

::: seealso
See reference documentation on how to:

- `deactivate default pages <website_themes/pages/default>`{.interpreted-text
  role="ref"},
- `create a new page <website_themes/pages/theme_pages>`{.interpreted-text
  role="ref"},
- `add a menu item <website_themes/navigation/menu>`{.interpreted-text
  role="ref"},
- `create a form </developer/howtos/website_themes/forms>`{.interpreted-text
  role="doc"}.
:::

:::: tip
::: title
Tip
:::

To determine the correct code for your form:

- | Create a test page via the Website Builder.
  | Drag & drop the building block that interests you and apply the
    right design.
  | Use the code generated through `Editor HTML/SCSS`{.interpreted-text
    role="guilabel"}.

- You can also find the original building block code in Odoo:
  [odoo/addons/website/views/snippets/s_website_form.xml]({GITHUB_PATH}/addons/website/views/snippets/s_website_form.xml).
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[contact.xml]({GITHUB_TUTO_PATH}/website_airproof/data/pages/contact.xml).
:::




--- SOURCE: developer/tutorials/website_theme/05_dynamic_templates.md ---

# Chapter 5 - Dynamic templates

## Adapt the shop template {#tutorials/website_theme/dynamic_templates/shop}

Now, let\'s adapt the dynamic sections of the website. As you may know,
some pages such as those for eCommerce are automatically generated.
Pages like the shop, product, and checkout are automatically generated
when the [website_sale]{.title-ref} application is installed. These
template pages pull their displayed information from the backend.

To modify these pages, we need to edit the standard Odoo template. This
can be done using SCSS, presets, and especially XPath. Locate the
standard Odoo template you want to modify and extend it using
[XPath]{.title-ref}. Following the Airproof design, let\'s begin by
modifying the shop view.

1.  First, locate the standard template in Odoo :
    `website_sale --> templates.xml -->
    id="products"`{.interpreted-text role="menuselection"}.
2.  Apply all changes in your
    `website_sale_templates.xml`{.interpreted-text role="file"} file.
    Start by:
    - Add a banner.
    - Adapt the layout of the e-commerce category filtering on the left.
    - Remove the search bar (you can remove it from both the shop and
      the product pages at the same time).
    - Move the breadcrumb.
    - Hide the list or grid view option.
    - Create the appropriate design and information for the product
      cards.

![image](05_dynamic_templates/airproof-shop-page.png){.align-center}

:::: tip
::: title
Tip
:::

\- Apply your modifications using presets, XPath and SCSS. - To enable
attribute/variant filtering, activate the
`/applications/sales/sales/products_prices/products/variants`{.interpreted-text
role="doc"} option in the website backend settings and
`configure attributes and variants
</applications/websites/ecommerce/managing_products/variants>`{.interpreted-text
role="doc"} for the products.
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[presets.xml]({GITHUB_TUTO_PATH}/website_airproof/data/presets.xml),
[website_sale_templates.xml]({GITHUB_TUTO_PATH}/website_airproof/views/website_sale_templates.xml)
part *shop page*, and
[shop.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/pages/shop.scss).
:::

## Adapt the product page template {#tutorials/website_theme/dynamic_templates/product}

The client is thrilled with the shop modifications. Next, let\'s apply
our design to the product pages. Based on the Airproof design below,
adapt a few elements including:

- Remove the search bar (if not done with the previous exercise).
- Remove the quantity selector, Terms and Conditions, and share icons.
- Update the `Add to cart`{.interpreted-text role="guilabel"} button
  icon.
- Insert a title above the product specifications (this section appears
  only when the product has one variant per attribute).
- Design the appropriate layout for the carousel.
- Add a title and apply the previously created product template to the
  [Alternative products]{.title-ref} section (ensure alternative
  products are assigned on the product in the backend for this section
  to appear).
- Implement a new drop zone below product details, visible on all
  products. As a use case, add an [Text-Image]{.title-ref} building
  block using the Website Builder (e.g.: See Airproof product page
  screenshot with "*Six reasons to buy...*").

::: seealso
See reference documentation on how to create a
`website_themes/layout/dropzone`{.interpreted-text role="ref"}.
:::

![image](05_dynamic_templates/airproof-product-page.png){.align-center}

:::: tip
::: title
Tip
:::

\- Make your modifications using presets, XPath, and SCSS. Be sure to
comment your code properly so you can find your way around. - The drop
zone will be visible on all products. To create a specific dropzone per
product, you need to add a new field to the product model.
::::

::: spoiler
Solutions

Find the solution in our Airproof example on
[presets.xml]({GITHUB_TUTO_PATH}/website_airproof/data/presets.xml),
[website_sale_templates.xml]({GITHUB_TUTO_PATH}/website_airproof/views/website_sale_templates.xml)
part *product page*, and
[product_page.scss]({GITHUB_TUTO_PATH}/website_airproof/static/src/scss/pages/product_page.scss).
:::




--- SOURCE: developer/tutorials/website_theme/06_going_live.md ---

# Chapter 6 - Going live

## Translations {#tutorials/website_theme/going_live/translations}

Congratulations! Your client has a beautifully designed homepage and
contact page, and the eCommerce is fully adapted to the Airproof design.
Amazing!

Now, the client wants the website translated into French. To do so:

1.  Add French to the website in the settings and enable the language
    switcher in the header via presets.
2.  Then for the translation itself, you have two options. We shall
    therefore test both:
    - Translate the content of the homepage carousel through the
      backend.
    - But for the menu, make the translations through the frontend.
3.  Export the French `.po`{.interpreted-text role="file"} file for your
    Airproof module and place it in the `/i18n`{.interpreted-text
    role="file"} translations folder.
4.  If you would like, you can add more translations directly by editing
    the `.po`{.interpreted-text role="file"} file. (Using Poedit
    software, your code editor, or another translation tool.)

::: seealso
See reference documentation on
`website_themes/translations/backend`{.interpreted-text role="ref"} and
`website_themes/translations/frontend`{.interpreted-text role="ref"}
translations, and how to
`website_themes/translations/export`{.interpreted-text role="ref"} them.
:::

:::: note
::: title
Note
:::

\- Be careful when using Poedit, as it doesn\'t handle tags with styles
well and generates an `.mo`{.interpreted-text role="file"} file. - To
see the changes made directly via the `.po`{.interpreted-text
role="file"} file, you will need to manually import the file.
::::

::: spoiler
Solutions

Take a look at what the file
[i18n/fr_BE.po]({GITHUB_TUTO_PATH}/website_airproof/i18n/fr_BE.po) of
our Airproof example looks like.
:::

## Module import {#tutorials/website_theme/going_live/module_import}

Great job! The website is now completely finished and your module is
ready for installation in the client\'s SaaS database.

Just before that, test the import process on a new database.

::: seealso
See reference documentation on how to `deploy a module
</developer/howtos/website_themes/going_live>`{.interpreted-text
role="doc"} on an Odoo SaaS database.
:::

:::: tip
::: title
Tip
:::

\- Ensure the [base_import_module]{.title-ref} is installed on the
database before the module installation. - Verify all required
applications are installed. - Skip the theme installation steps and
start from scratch. - Manually import translations after module
installation, as they won\'t apply automatically.
::::

## Conclusion

Congratulations on completing the **Build a module for a website theme**
tutorial! You\'ve successfully navigated through every stage, from
setting up your development environment to launching a fully customized
Odoo website theme.

Throughout this journey, you\'ve mastered:

| ✅ **Theme module creation** - setting up the structure, declaring
  Odoo and Bootstrap variables.
| ✅ **Website building** - creating pages, adding media, and
  constructing dynamic building blocks.
| ✅ **Advanced customization** - implementing custom SCSS, JavaScript,
  headers, footers, and unique design elements.
| ✅ **Visual enhancements** - designing background shapes, gradients,
  and animations for an engaging user experience.
| ✅ **eCommerce optimization** - adapting shop and product templates
  for a seamless shopping experience.
| ✅ **Final preparations** - managing translations and ensuring a
  smooth module import.

| With these skills, you\'re now ready to design and develop
  professional, fully customized website themes. Well done!
| We can\'t wait to see the amazing themes you\'ll create in the future.




--- SOURCE: developer/tutorials/website_theme.md ---

show-content

:   

show-toc

:   

hide-page-toc

:   

# Build a website theme

| For this project, we\'ll collaborate on creating a custom website
  theme fully integrated with Odoo.
| Our client, Airproof, has provided their latest design for their
  waterproof drone e-commerce, which we\'ll replicate.

To start, you must have
`installed Odoo locally </administration/on_premise/source>`{.interpreted-text
role="doc"}. You will also need some knowledge in:

- XML
- JavaScript (not mandatory)
- Bootstrap 5.1.3
- SCSS
- QWeb (Odoo\'s own templating system)
- OWL (JavaScript framework, not mandatory)

| **Goal**
| Replicate the Airproof design.

![Airproof homepage.](website_theme/airproof-home.png){.align-center}

| In the `README.md`{.interpreted-text role="file"} of the [Airproof
  module]({GITHUB_TUTO_PATH}/website_airproof), you can find the various
  Airproof designs that you will replicate throughout the different
  exercises in this tutorial.
| You can also find all the code necessary for creating the Airproof
  website there. You should also obtain this by the end of the tutorial.
  It is recommended to try solving the exercices first without looking
  at the solution!

| **Don\'t go too fast!**
| Follow the exercises step by step and you will reach the final design
  at the end of the tutorial.

Throughout this tutorial, you will find \"See also\" sections leading to
parts of the `How-to
guide: Website themes <../howtos/website_themes>`{.interpreted-text
role="doc"} documentation. Be sure to read this documentation thoroughly
each time! With it, you will find the solution to every exercise.

Ready? Let\'s get started!

::: {.toctree maxdepth="2"}
website_theme/01_theming website_theme/02_build_website
website_theme/03_customisation_part1
website_theme/04_customisation_part2 website_theme/05_dynamic_templates
website_theme/06_going_live
:::




--- SOURCE: developer/tutorials.md ---

show-content

:   

hide-page-toc

:   

# Tutorials

::: {.toctree titlesonly=""}
tutorials/getting_started tutorials/discover_js_framework
tutorials/master_odoo_web_framework tutorials/define_module_data
tutorials/restrict_data_access tutorials/unit_tests tutorials/mixins
tutorials/pdf_reports tutorials/website_theme
:::

:::::::::::: cards
::: {.card target="tutorials/getting_started" tag="Beginner" large=""}
Getting started

Develop your own module with the Odoo framework. This step-by-step
tutorial is crafted for newcomers and any other individual curious about
Odoo development.
:::

::: {.card target="tutorials/discover_js_framework" tag="Beginner" large=""}
Discover the JavaScript Framework

Learn the basics of the JavaScript framework of Odoo. This tutorial will
teach you how to work with Owl components and introduce the basic
principles underlying the Odoo JavaScript codebase.
:::

::: {.card target="tutorials/master_odoo_web_framework" tag="Advanced"}
Master the Odoo Web Framework

Become an expert in the Odoo Web Framework. A large variety of features
are covered such as fields, views, and even the kitten mode.
:::

::: {.card target="tutorials/define_module_data" tag="Beginner"}
Define module data

Define master and demo data for an Odoo module, leveraging the strengths
of the CSV and XML file formats to accommodate specific data
requirements.
:::

::: {.card target="tutorials/restrict_data_access" tag="Beginner"}
Restrict access to data

Implement security measures to restrict access to sensitive data with
the help of groups, access rights, and record rules.
:::

::: {.card target="tutorials/unit_tests" tag="Beginner"}
Safeguard your code with unit tests

Write effective unit tests in Python to ensure the resilience of your
code and safeguard it against unexpected behaviors and regressions.
:::

::: {.card target="tutorials/mixins"}
Reuse code with mixins

Create mixins to code features once and reuse them in multiple models.
:::

::: {.card target="tutorials/pdf_reports"}
Build PDF reports

Use QWeb, Odoo\'s powerful templating engine, to create custom PDF
reports for your documents.
:::

::: {.card target="tutorials/website_theme"}
Build a website theme

Create a tailored website from scratch fully integrated with Odoo and
editable via the Website Builder.
:::
::::::::::::


